!function(){function t(t,e,i,s){Object.defineProperty(t,e,{get:i,set:s,enumerable:!0,configurable:!0})}function e(t){return t&&t.__esModule?t.default:t}var i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},s={},r={},n=i.parcelRequiref482;null==n&&((n=function(t){if(t in s)return s[t].exports;if(t in r){let e=r[t];delete r[t];let i={id:t,exports:{}};return s[t]=i,e.call(i.exports,i,i.exports),i.exports}var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}).register=function(t,e){r[t]=e},i.parcelRequiref482=n),n.register("3OOJ5",(function(e,i){var s,r;t(e.exports,"resolve",(()=>r),(t=>r=t)),t(e.exports,"register",(()=>s),(t=>s=t));var n={};s=function(t){for(var e=Object.keys(t),i=0;i<e.length;i++)n[e[i]]=t[e[i]]},r=function(t){var e=n[t];if(null==e)throw new Error("Could not resolve bundle with id "+t);return e}})),n("3OOJ5").register(JSON.parse('{"2zX4k":"index.866dc970.js","nuBan":"sword.f5e0cb6e.png"}'));var o,a,h={};o=self,a=function(){return(()=>{var t={1390:(t,e,i)=>{i(8673),i(7233),i(8145),i(3370),i(8178),i(1021),i(8986),i(2656),i(5342),i(9228),i(9949),i(7072),i(4870),i(8695),i(9529),i(4083),i(5735),i(6781),i(4660),i(3450),i(3108),i(9731),i(9992),i(2501),i(7321),i(3430),i(747),i(9805),i(7694),i(3985);var s=i(9276);t.exports=s.Array},8816:(t,e,i)=>{i(5584),i(6936),i(4326);var s=i(9276);t.exports=s.Function},6305:(t,e,i)=>{i(4115),i(3105),i(7256),i(5094),i(6555),i(5883),i(2144),i(1804),i(8625),i(2775),i(4905),i(6928),i(9170),i(8892),i(5060),i(2321),i(4769),i(4682),i(3280),i(2506),i(7890),i(8188),i(7846),i(6635),i(2586),i(3045),i(7525),i(8275),i(2215);var s=i(9276);t.exports=s.Object},3819:t=>{t.exports=function(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t}},8505:(t,e,i)=>{var s=i(5052);t.exports=function(t){if(!s(t)&&null!==t)throw TypeError("Can't set "+String(t)+" as a prototype");return t}},9736:(t,e,i)=>{var s=i(95),r=i(2391),n=i(1787),o=s("unscopables"),a=Array.prototype;null==a[o]&&n.f(a,o,{configurable:!0,value:r(null)}),t.exports=function(t){a[o][t]=!0}},1176:(t,e,i)=>{var s=i(5052);t.exports=function(t){if(!s(t))throw TypeError(String(t)+" is not an object");return t}},7154:(t,e,i)=>{"use strict";var s=i(2991),r=i(3231),n=i(4237),o=Math.min;t.exports=[].copyWithin||function(t,e){var i=s(this),a=n(i.length),h=r(t,a),l=r(e,a),c=arguments.length>2?arguments[2]:void 0,d=o((void 0===c?a:r(c,a))-l,a-h),u=1;for(l<h&&h<l+d&&(u=-1,l+=d-1,h+=d-1);d-- >0;)l in i?i[h]=i[l]:delete i[h],h+=u,l+=u;return i}},7065:(t,e,i)=>{"use strict";var s=i(2991),r=i(3231),n=i(4237);t.exports=function(t){for(var e=s(this),i=n(e.length),o=arguments.length,a=r(o>1?arguments[1]:void 0,i),h=o>2?arguments[2]:void 0,l=void 0===h?i:r(h,i);l>a;)e[a++]=t;return e}},6570:(t,e,i)=>{"use strict";var s=i(9996).forEach,r=i(6038)("forEach");t.exports=r?[].forEach:function(t){return s(this,t,arguments.length>1?arguments[1]:void 0)}},507:(t,e,i)=>{"use strict";var s=i(7636),r=i(2991),n=i(4960),o=i(1943),a=i(4237),h=i(2324),l=i(8830);t.exports=function(t){var e,i,c,d,u,p,g=r(t),_="function"==typeof this?this:Array,f=arguments.length,m=f>1?arguments[1]:void 0,y=void 0!==m,w=l(g),v=0;if(y&&(m=s(m,f>2?arguments[2]:void 0,2)),null==w||_==Array&&o(w))for(i=new _(e=a(g.length));e>v;v++)p=y?m(g[v],v):g[v],h(i,v,p);else for(u=(d=w.call(g)).next,i=new _;!(c=u.call(d)).done;v++)p=y?n(d,m,[c.value,v],!0):c.value,h(i,v,p);return i.length=v,i}},9540:(t,e,i)=>{var s=i(905),r=i(4237),n=i(3231),o=function(t){return function(e,i,o){var a,h=s(e),l=r(h.length),c=n(o,l);if(t&&i!=i){for(;l>c;)if((a=h[c++])!=a)return!0}else for(;l>c;c++)if((t||c in h)&&h[c]===i)return t||c||0;return!t&&-1}};t.exports={includes:o(!0),indexOf:o(!1)}},9996:(t,e,i)=>{var s=i(7636),r=i(9337),n=i(2991),o=i(4237),a=i(7501),h=[].push,l=function(t){var e=1==t,i=2==t,l=3==t,c=4==t,d=6==t,u=7==t,p=5==t||d;return function(g,_,f,m){for(var y,w,v=n(g),b=r(v),x=s(_,f,3),A=o(b.length),S=0,P=m||a,C=e?P(g,A):i||u?P(g,0):void 0;A>S;S++)if((p||S in b)&&(w=x(y=b[S],S,v),t))if(e)C[S]=w;else if(w)switch(t){case 3:return!0;case 5:return y;case 6:return S;case 2:h.call(C,y)}else switch(t){case 4:return!1;case 7:h.call(C,y)}return d?-1:l||c?c:C}};t.exports={forEach:l(0),map:l(1),filter:l(2),some:l(3),every:l(4),find:l(5),findIndex:l(6),filterOut:l(7)}},6462:(t,e,i)=>{"use strict";var s=i(905),r=i(6051),n=i(4237),o=i(6038),a=Math.min,h=[].lastIndexOf,l=!!h&&1/[1].lastIndexOf(1,-0)<0,c=o("lastIndexOf"),d=l||!c;t.exports=d?function(t){if(l)return h.apply(this,arguments)||0;var e=s(this),i=n(e.length),o=i-1;for(arguments.length>1&&(o=a(o,r(arguments[1]))),o<0&&(o=i+o);o>=0;o--)if(o in e&&e[o]===t)return o||0;return-1}:h},1460:(t,e,i)=>{var s=i(4229),r=i(95),n=i(6358),o=r("species");t.exports=function(t){return n>=51||!s((function(){var e=[];return(e.constructor={})[o]=function(){return{foo:1}},1!==e[t](Boolean).foo}))}},6038:(t,e,i)=>{"use strict";var s=i(4229);t.exports=function(t,e){var i=[][t];return!!i&&s((function(){i.call(null,e||function(){throw 1},1)}))}},3143:(t,e,i)=>{var s=i(3819),r=i(2991),n=i(9337),o=i(4237),a=function(t){return function(e,i,a,h){s(i);var l=r(e),c=n(l),d=o(l.length),u=t?d-1:0,p=t?-1:1;if(a<2)for(;;){if(u in c){h=c[u],u+=p;break}if(u+=p,t?u<0:d<=u)throw TypeError("Reduce of empty array with no initial value")}for(;t?u>=0:d>u;u+=p)u in c&&(h=i(h,c[u],u,l));return h}};t.exports={left:a(!1),right:a(!0)}},7501:(t,e,i)=>{var s=i(5052),r=i(3718),n=i(95)("species");t.exports=function(t,e){var i;return r(t)&&("function"!=typeof(i=t.constructor)||i!==Array&&!r(i.prototype)?s(i)&&null===(i=i[n])&&(i=void 0):i=void 0),new(void 0===i?Array:i)(0===e?0:e)}},4960:(t,e,i)=>{var s=i(1176),r=i(7281);t.exports=function(t,e,i,n){try{return n?e(s(i)[0],i[1]):e(i)}catch(e){throw r(t),e}}},4575:(t,e,i)=>{var s=i(95)("iterator"),r=!1;try{var n=0,o={next:function(){return{done:!!n++}},return:function(){r=!0}};o[s]=function(){return this},Array.from(o,(function(){throw 2}))}catch(t){}t.exports=function(t,e){if(!e&&!r)return!1;var i=!1;try{var n={};n[s]=function(){return{next:function(){return{done:i=!0}}}},t(n)}catch(t){}return i}},7079:t=>{var e={}.toString;t.exports=function(t){return e.call(t).slice(8,-1)}},1589:(t,e,i)=>{var s=i(1601),r=i(7079),n=i(95)("toStringTag"),o="Arguments"==r(function(){return arguments}());t.exports=s?r:function(t){var e,i,s;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(i=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),n))?i:o?r(e):"Object"==(s=r(e))&&"function"==typeof e.callee?"Arguments":s}},7081:(t,e,i)=>{var s=i(816),r=i(4826),n=i(7933),o=i(1787);t.exports=function(t,e){for(var i=r(e),a=o.f,h=n.f,l=0;l<i.length;l++){var c=i[l];s(t,c)||a(t,c,h(e,c))}}},7528:(t,e,i)=>{var s=i(4229);t.exports=!s((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}))},3723:(t,e,i)=>{"use strict";var s=i(693).IteratorPrototype,r=i(2391),n=i(5358),o=i(4555),a=i(5495),h=function(){return this};t.exports=function(t,e,i){var l=e+" Iterator";return t.prototype=r(s,{next:n(1,i)}),o(t,l,!1,!0),a[l]=h,t}},5762:(t,e,i)=>{var s=i(7400),r=i(1787),n=i(5358);t.exports=s?function(t,e,i){return r.f(t,e,n(1,i))}:function(t,e,i){return t[e]=i,t}},5358:t=>{t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},2324:(t,e,i)=>{"use strict";var s=i(2066),r=i(1787),n=i(5358);t.exports=function(t,e,i){var o=s(e);o in t?r.f(t,o,n(0,i)):t[o]=i}},7675:(t,e,i)=>{"use strict";var s=i(3103),r=i(3723),n=i(7567),o=i(6540),a=i(4555),h=i(5762),l=i(7487),c=i(95),d=i(4231),u=i(5495),p=i(693),g=p.IteratorPrototype,_=p.BUGGY_SAFARI_ITERATORS,f=c("iterator"),m=function(){return this};t.exports=function(t,e,i,c,p,y,w){r(i,e,c);var v,b,x,A=function(t){if(t===p&&T)return T;if(!_&&t in C)return C[t];switch(t){case"keys":case"values":case"entries":return function(){return new i(this,t)}}return function(){return new i(this)}},S=e+" Iterator",P=!1,C=t.prototype,E=C[f]||C["@@iterator"]||p&&C[p],T=!_&&E||A(p),D="Array"==e&&C.entries||E;if(D&&(v=n(D.call(new t)),g!==Object.prototype&&v.next&&(d||n(v)===g||(o?o(v,g):"function"!=typeof v[f]&&h(v,f,m)),a(v,S,!0,!0),d&&(u[S]=m))),"values"==p&&E&&"values"!==E.name&&(P=!0,T=function(){return E.call(this)}),d&&!w||C[f]===T||h(C,f,T),u[e]=T,p)if(b={values:A("values"),keys:y?T:A("keys"),entries:A("entries")},w)for(x in b)(_||P||!(x in C))&&l(C,x,b[x]);else s({target:e,proto:!0,forced:_||P},b);return b}},8423:(t,e,i)=>{var s=i(9276),r=i(816),n=i(5391),o=i(1787).f;t.exports=function(t){var e=s.Symbol||(s.Symbol={});r(e,t)||o(e,t,{value:n.f(t)})}},7400:(t,e,i)=>{var s=i(4229);t.exports=!s((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},2635:(t,e,i)=>{var s=i(9859),r=i(5052),n=s.document,o=r(n)&&r(n.createElement);t.exports=function(t){return o?n.createElement(t):{}}},8801:(t,e,i)=>{var s=i(7079),r=i(9859);t.exports="process"==s(r.process)},598:(t,e,i)=>{var s=i(1333);t.exports=s("navigator","userAgent")||""},6358:(t,e,i)=>{var s,r,n=i(9859),o=i(598),a=n.process,h=a&&a.versions,l=h&&h.v8;l?r=(s=l.split("."))[0]<4?1:s[0]+s[1]:o&&(!(s=o.match(/Edge\/(\d+)/))||s[1]>=74)&&(s=o.match(/Chrome\/(\d+)/))&&(r=s[1]),t.exports=r&&+r},3837:t=>{t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},3103:(t,e,i)=>{var s=i(9859),r=i(7933).f,n=i(5762),o=i(7487),a=i(2079),h=i(7081),l=i(6541);t.exports=function(t,e){var i,c,d,u,p,g=t.target,_=t.global,f=t.stat;if(i=_?s:f?s[g]||a(g,{}):(s[g]||{}).prototype)for(c in e){if(u=e[c],d=t.noTargetGet?(p=r(i,c))&&p.value:i[c],!l(_?c:g+(f?".":"#")+c,t.forced)&&void 0!==d){if(typeof u==typeof d)continue;h(u,d)}(t.sham||d&&d.sham)&&n(u,"sham",!0),o(i,c,u,t)}}},4229:t=>{t.exports=function(t){try{return!!t()}catch(t){return!0}}},4990:(t,e,i)=>{"use strict";var s=i(3718),r=i(4237),n=i(7636),o=function(t,e,i,a,h,l,c,d){for(var u,p=h,g=0,_=!!c&&n(c,d,3);g<a;){if(g in i){if(u=_?_(i[g],g,e):i[g],l>0&&s(u))p=o(t,e,u,r(u.length),p,l-1)-1;else{if(p>=9007199254740991)throw TypeError("Exceed the acceptable array length");t[p]=u}p++}g++}return p};t.exports=o},8476:(t,e,i)=>{var s=i(4229);t.exports=!s((function(){return Object.isExtensible(Object.preventExtensions({}))}))},7636:(t,e,i)=>{var s=i(3819);t.exports=function(t,e,i){if(s(t),void 0===e)return t;switch(i){case 0:return function(){return t.call(e)};case 1:return function(i){return t.call(e,i)};case 2:return function(i,s){return t.call(e,i,s)};case 3:return function(i,s,r){return t.call(e,i,s,r)}}return function(){return t.apply(e,arguments)}}},4128:(t,e,i)=>{"use strict";var s=i(3819),r=i(5052),n=[].slice,o={},a=function(t,e,i){if(!(e in o)){for(var s=[],r=0;r<e;r++)s[r]="a["+r+"]";o[e]=Function("C,a","return new C("+s.join(",")+")")}return o[e](t,i)};t.exports=Function.bind||function(t){var e=s(this),i=n.call(arguments,1),o=function(){var s=i.concat(n.call(arguments));return this instanceof o?a(e,s.length,s):e.apply(t,s)};return r(e.prototype)&&(o.prototype=e.prototype),o}},1333:(t,e,i)=>{var s=i(9276),r=i(9859),n=function(t){return"function"==typeof t?t:void 0};t.exports=function(t,e){return arguments.length<2?n(s[t])||n(r[t]):s[t]&&s[t][e]||r[t]&&r[t][e]}},8830:(t,e,i)=>{var s=i(1589),r=i(5495),n=i(95)("iterator");t.exports=function(t){if(null!=t)return t[n]||t["@@iterator"]||r[s(t)]}},9859:(t,e,i)=>{var s=function(t){return t&&t.Math==Math&&t};t.exports=s("object"==typeof globalThis&&globalThis)||s("object"==typeof window&&window)||s("object"==typeof self&&self)||s("object"==typeof i.g&&i.g)||function(){return this}()||Function("return this")()},816:(t,e,i)=>{var s=i(2991),r={}.hasOwnProperty;t.exports=Object.hasOwn||function(t,e){return r.call(s(t),e)}},5977:t=>{t.exports={}},3777:(t,e,i)=>{var s=i(1333);t.exports=s("document","documentElement")},4394:(t,e,i)=>{var s=i(7400),r=i(4229),n=i(2635);t.exports=!s&&!r((function(){return 7!=Object.defineProperty(n("div"),"a",{get:function(){return 7}}).a}))},9337:(t,e,i)=>{var s=i(4229),r=i(7079),n="".split;t.exports=s((function(){return!Object("z").propertyIsEnumerable(0)}))?function(t){return"String"==r(t)?n.call(t,""):Object(t)}:Object},8511:(t,e,i)=>{var s=i(5353),r=Function.toString;"function"!=typeof s.inspectSource&&(s.inspectSource=function(t){return r.call(t)}),t.exports=s.inspectSource},5926:(t,e,i)=>{var s=i(5977),r=i(5052),n=i(816),o=i(1787).f,a=i(1441),h=i(8476),l=a("meta"),c=0,d=Object.isExtensible||function(){return!0},u=function(t){o(t,l,{value:{objectID:"O"+ ++c,weakData:{}}})},p=t.exports={REQUIRED:!1,fastKey:function(t,e){if(!r(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!n(t,l)){if(!d(t))return"F";if(!e)return"E";u(t)}return t[l].objectID},getWeakData:function(t,e){if(!n(t,l)){if(!d(t))return!0;if(!e)return!1;u(t)}return t[l].weakData},onFreeze:function(t){return h&&p.REQUIRED&&d(t)&&!n(t,l)&&u(t),t}};s[l]=!0},6407:(t,e,i)=>{var s,r,n,o=i(8694),a=i(9859),h=i(5052),l=i(5762),c=i(816),d=i(5353),u=i(4399),p=i(5977),g=a.WeakMap;if(o||d.state){var _=d.state||(d.state=new g),f=_.get,m=_.has,y=_.set;s=function(t,e){if(m.call(_,t))throw new TypeError("Object already initialized");return e.facade=t,y.call(_,t,e),e},r=function(t){return f.call(_,t)||{}},n=function(t){return m.call(_,t)}}else{var w=u("state");p[w]=!0,s=function(t,e){if(c(t,w))throw new TypeError("Object already initialized");return e.facade=t,l(t,w,e),e},r=function(t){return c(t,w)?t[w]:{}},n=function(t){return c(t,w)}}t.exports={set:s,get:r,has:n,enforce:function(t){return n(t)?r(t):s(t,{})},getterFor:function(t){return function(e){var i;if(!h(e)||(i=r(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return i}}}},1943:(t,e,i)=>{var s=i(95),r=i(5495),n=s("iterator"),o=Array.prototype;t.exports=function(t){return void 0!==t&&(r.Array===t||o[n]===t)}},3718:(t,e,i)=>{var s=i(7079);t.exports=Array.isArray||function(t){return"Array"==s(t)}},6541:(t,e,i)=>{var s=i(4229),r=/#|\.prototype\./,n=function(t,e){var i=a[o(t)];return i==l||i!=h&&("function"==typeof e?s(e):!!e)},o=n.normalize=function(t){return String(t).replace(r,".").toLowerCase()},a=n.data={},h=n.NATIVE="N",l=n.POLYFILL="P";t.exports=n},5052:t=>{t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},4231:t=>{t.exports=!1},9003:(t,e,i)=>{var s=i(1176),r=i(1943),n=i(4237),o=i(7636),a=i(8830),h=i(7281),l=function(t,e){this.stopped=t,this.result=e};t.exports=function(t,e,i){var c,d,u,p,g,_,f,m=i&&i.that,y=!(!i||!i.AS_ENTRIES),w=!(!i||!i.IS_ITERATOR),v=!(!i||!i.INTERRUPTED),b=o(e,m,1+y+v),x=function(t){return c&&h(c),new l(!0,t)},A=function(t){return y?(s(t),v?b(t[0],t[1],x):b(t[0],t[1])):v?b(t,x):b(t)};if(w)c=t;else{if("function"!=typeof(d=a(t)))throw TypeError("Target is not iterable");if(r(d)){for(u=0,p=n(t.length);p>u;u++)if((g=A(t[u]))&&g instanceof l)return g;return new l(!1)}c=d.call(t)}for(_=c.next;!(f=_.call(c)).done;){try{g=A(f.value)}catch(t){throw h(c),t}if("object"==typeof g&&g&&g instanceof l)return g}return new l(!1)}},7281:(t,e,i)=>{var s=i(1176);t.exports=function(t){var e=t.return;if(void 0!==e)return s(e.call(t)).value}},693:(t,e,i)=>{"use strict";var s,r,n,o=i(4229),a=i(7567),h=i(5762),l=i(816),c=i(95),d=i(4231),u=c("iterator"),p=!1;[].keys&&("next"in(n=[].keys())?(r=a(a(n)))!==Object.prototype&&(s=r):p=!0);var g=null==s||o((function(){var t={};return s[u].call(t)!==t}));g&&(s={}),d&&!g||l(s,u)||h(s,u,(function(){return this})),t.exports={IteratorPrototype:s,BUGGY_SAFARI_ITERATORS:p}},5495:t=>{t.exports={}},3839:(t,e,i)=>{var s=i(6358),r=i(4229);t.exports=!!Object.getOwnPropertySymbols&&!r((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&s&&s<41}))},8694:(t,e,i)=>{var s=i(9859),r=i(8511),n=s.WeakMap;t.exports="function"==typeof n&&/native code/.test(r(n))},47:(t,e,i)=>{"use strict";var s=i(7400),r=i(4229),n=i(5632),o=i(894),a=i(9195),h=i(2991),l=i(9337),c=Object.assign,d=Object.defineProperty;t.exports=!c||r((function(){if(s&&1!==c({b:1},c(d({},"a",{enumerable:!0,get:function(){d(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},e={},i=Symbol();return t[i]=7,"abcdefghijklmnopqrst".split("").forEach((function(t){e[t]=t})),7!=c({},t)[i]||"abcdefghijklmnopqrst"!=n(c({},e)).join("")}))?function(t,e){for(var i=h(t),r=arguments.length,c=1,d=o.f,u=a.f;r>c;)for(var p,g=l(arguments[c++]),_=d?n(g).concat(d(g)):n(g),f=_.length,m=0;f>m;)p=_[m++],s&&!u.call(g,p)||(i[p]=g[p]);return i}:c},2391:(t,e,i)=>{var s,r=i(1176),n=i(219),o=i(3837),a=i(5977),h=i(3777),l=i(2635),c=i(4399)("IE_PROTO"),d=function(){},u=function(t){return"<script>"+t+"<\/script>"},p=function(){try{s=document.domain&&new ActiveXObject("htmlfile")}catch(t){}var t,e;p=s?function(t){t.write(u("")),t.close();var e=t.parentWindow.Object;return t=null,e}(s):((e=l("iframe")).style.display="none",h.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write(u("document.F=Object")),t.close(),t.F);for(var i=o.length;i--;)delete p.prototype[o[i]];return p()};a[c]=!0,t.exports=Object.create||function(t,e){var i;return null!==t?(d.prototype=r(t),i=new d,d.prototype=null,i[c]=t):i=p(),void 0===e?i:n(i,e)}},219:(t,e,i)=>{var s=i(7400),r=i(1787),n=i(1176),o=i(5632);t.exports=s?Object.defineProperties:function(t,e){n(t);for(var i,s=o(e),a=s.length,h=0;a>h;)r.f(t,i=s[h++],e[i]);return t}},1787:(t,e,i)=>{var s=i(7400),r=i(4394),n=i(1176),o=i(2066),a=Object.defineProperty;e.f=s?a:function(t,e,i){if(n(t),e=o(e,!0),n(i),r)try{return a(t,e,i)}catch(t){}if("get"in i||"set"in i)throw TypeError("Accessors not supported");return"value"in i&&(t[e]=i.value),t}},7933:(t,e,i)=>{var s=i(7400),r=i(9195),n=i(5358),o=i(905),a=i(2066),h=i(816),l=i(4394),c=Object.getOwnPropertyDescriptor;e.f=s?c:function(t,e){if(t=o(t),e=a(e,!0),l)try{return c(t,e)}catch(t){}if(h(t,e))return n(!r.f.call(t,e),t[e])}},166:(t,e,i)=>{var s=i(905),r=i(8151).f,n={}.toString,o="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];t.exports.f=function(t){return o&&"[object Window]"==n.call(t)?function(t){try{return r(t)}catch(t){return o.slice()}}(t):r(s(t))}},8151:(t,e,i)=>{var s=i(140),r=i(3837).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return s(t,r)}},894:(t,e)=>{e.f=Object.getOwnPropertySymbols},7567:(t,e,i)=>{var s=i(816),r=i(2991),n=i(4399),o=i(7528),a=n("IE_PROTO"),h=Object.prototype;t.exports=o?Object.getPrototypeOf:function(t){return t=r(t),s(t,a)?t[a]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?h:null}},140:(t,e,i)=>{var s=i(816),r=i(905),n=i(9540).indexOf,o=i(5977);t.exports=function(t,e){var i,a=r(t),h=0,l=[];for(i in a)!s(o,i)&&s(a,i)&&l.push(i);for(;e.length>h;)s(a,i=e[h++])&&(~n(l,i)||l.push(i));return l}},5632:(t,e,i)=>{var s=i(140),r=i(3837);t.exports=Object.keys||function(t){return s(t,r)}},9195:(t,e)=>{"use strict";var i={}.propertyIsEnumerable,s=Object.getOwnPropertyDescriptor,r=s&&!i.call({1:2},1);e.f=r?function(t){var e=s(this,t);return!!e&&e.enumerable}:i},5020:(t,e,i)=>{"use strict";var s=i(4231),r=i(9859),n=i(4229),o=i(598);t.exports=s||!n((function(){var t=o.match(/AppleWebKit\/(\d+)\./);if(!(t&&+t[1]<535)){var e=Math.random();__defineSetter__.call(null,e,(function(){})),delete r[e]}}))},6540:(t,e,i)=>{var s=i(1176),r=i(8505);t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,i={};try{(t=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(i,[]),e=i instanceof Array}catch(t){}return function(i,n){return s(i),r(n),e?t.call(i,n):i.__proto__=n,i}}():void 0)},7664:(t,e,i)=>{var s=i(7400),r=i(5632),n=i(905),o=i(9195).f,a=function(t){return function(e){for(var i,a=n(e),h=r(a),l=h.length,c=0,d=[];l>c;)i=h[c++],s&&!o.call(a,i)||d.push(t?[i,a[i]]:a[i]);return d}};t.exports={entries:a(!0),values:a(!1)}},4059:(t,e,i)=>{"use strict";var s=i(1601),r=i(1589);t.exports=s?{}.toString:function(){return"[object "+r(this)+"]"}},4826:(t,e,i)=>{var s=i(1333),r=i(8151),n=i(894),o=i(1176);t.exports=s("Reflect","ownKeys")||function(t){var e=r.f(o(t)),i=n.f;return i?e.concat(i(t)):e}},9276:(t,e,i)=>{var s=i(9859);t.exports=s},7487:(t,e,i)=>{var s=i(9859),r=i(5762),n=i(816),o=i(2079),a=i(8511),h=i(6407),l=h.get,c=h.enforce,d=String(String).split("String");(t.exports=function(t,e,i,a){var h,l=!!a&&!!a.unsafe,u=!!a&&!!a.enumerable,p=!!a&&!!a.noTargetGet;"function"==typeof i&&("string"!=typeof e||n(i,"name")||r(i,"name",e),(h=c(i)).source||(h.source=d.join("string"==typeof e?e:""))),t!==s?(l?!p&&t[e]&&(u=!0):delete t[e],u?t[e]=i:r(t,e,i)):u?t[e]=i:o(e,i)})(Function.prototype,"toString",(function(){return"function"==typeof this&&l(this).source||a(this)}))},8885:t=>{t.exports=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t}},2101:t=>{t.exports=Object.is||function(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}},2079:(t,e,i)=>{var s=i(9859),r=i(5762);t.exports=function(t,e){try{r(s,t,e)}catch(i){s[t]=e}return e}},1832:(t,e,i)=>{"use strict";var s=i(1333),r=i(1787),n=i(95),o=i(7400),a=n("species");t.exports=function(t){var e=s(t),i=r.f;o&&e&&!e[a]&&i(e,a,{configurable:!0,get:function(){return this}})}},4555:(t,e,i)=>{var s=i(1787).f,r=i(816),n=i(95)("toStringTag");t.exports=function(t,e,i){t&&!r(t=i?t:t.prototype,n)&&s(t,n,{configurable:!0,value:e})}},4399:(t,e,i)=>{var s=i(3036),r=i(1441),n=s("keys");t.exports=function(t){return n[t]||(n[t]=r(t))}},5353:(t,e,i)=>{var s=i(9859),r=i(2079),n=s["__core-js_shared__"]||r("__core-js_shared__",{});t.exports=n},3036:(t,e,i)=>{var s=i(4231),r=i(5353);(t.exports=function(t,e){return r[t]||(r[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.13.1",mode:s?"pure":"global",copyright:"© 2021 Denis Pushkarev (zloirock.ru)"})},966:(t,e,i)=>{var s=i(6051),r=i(8885),n=function(t){return function(e,i){var n,o,a=String(r(e)),h=s(i),l=a.length;return h<0||h>=l?t?"":void 0:(n=a.charCodeAt(h))<55296||n>56319||h+1===l||(o=a.charCodeAt(h+1))<56320||o>57343?t?a.charAt(h):n:t?a.slice(h,h+2):o-56320+(n-55296<<10)+65536}};t.exports={codeAt:n(!1),charAt:n(!0)}},3231:(t,e,i)=>{var s=i(6051),r=Math.max,n=Math.min;t.exports=function(t,e){var i=s(t);return i<0?r(i+e,0):n(i,e)}},905:(t,e,i)=>{var s=i(9337),r=i(8885);t.exports=function(t){return s(r(t))}},6051:t=>{var e=Math.ceil,i=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?i:e)(t)}},4237:(t,e,i)=>{var s=i(6051),r=Math.min;t.exports=function(t){return t>0?r(s(t),9007199254740991):0}},2991:(t,e,i)=>{var s=i(8885);t.exports=function(t){return Object(s(t))}},2066:(t,e,i)=>{var s=i(5052);t.exports=function(t,e){if(!s(t))return t;var i,r;if(e&&"function"==typeof(i=t.toString)&&!s(r=i.call(t)))return r;if("function"==typeof(i=t.valueOf)&&!s(r=i.call(t)))return r;if(!e&&"function"==typeof(i=t.toString)&&!s(r=i.call(t)))return r;throw TypeError("Can't convert object to primitive value")}},1601:(t,e,i)=>{var s={};s[i(95)("toStringTag")]="z",t.exports="[object z]"===String(s)},1441:t=>{var e=0,i=Math.random();t.exports=function(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++e+i).toString(36)}},6969:(t,e,i)=>{var s=i(3839);t.exports=s&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},5391:(t,e,i)=>{var s=i(95);e.f=s},95:(t,e,i)=>{var s=i(9859),r=i(3036),n=i(816),o=i(1441),a=i(3839),h=i(6969),l=r("wks"),c=s.Symbol,d=h?c:c&&c.withoutSetter||o;t.exports=function(t){return n(l,t)&&(a||"string"==typeof l[t])||(a&&n(c,t)?l[t]=c[t]:l[t]=d("Symbol."+t)),l[t]}},8178:(t,e,i)=>{"use strict";var s=i(3103),r=i(4229),n=i(3718),o=i(5052),a=i(2991),h=i(4237),l=i(2324),c=i(7501),d=i(1460),u=i(95),p=i(6358),g=u("isConcatSpreadable"),_=p>=51||!r((function(){var t=[];return t[g]=!1,t.concat()[0]!==t})),f=d("concat"),m=function(t){if(!o(t))return!1;var e=t[g];return void 0!==e?!!e:n(t)};s({target:"Array",proto:!0,forced:!_||!f},{concat:function(t){var e,i,s,r,n,o=a(this),d=c(o,0),u=0;for(e=-1,s=arguments.length;e<s;e++)if(m(n=-1===e?o:arguments[e])){if(u+(r=h(n.length))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(i=0;i<r;i++,u++)i in n&&l(d,u,n[i])}else{if(u>=9007199254740991)throw TypeError("Maximum allowed index exceeded");l(d,u++,n)}return d.length=u,d}})},1021:(t,e,i)=>{var s=i(3103),r=i(7154),n=i(9736);s({target:"Array",proto:!0},{copyWithin:r}),n("copyWithin")},8986:(t,e,i)=>{"use strict";var s=i(3103),r=i(9996).every;s({target:"Array",proto:!0,forced:!i(6038)("every")},{every:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}})},2656:(t,e,i)=>{var s=i(3103),r=i(7065),n=i(9736);s({target:"Array",proto:!0},{fill:r}),n("fill")},5342:(t,e,i)=>{"use strict";var s=i(3103),r=i(9996).filter;s({target:"Array",proto:!0,forced:!i(1460)("filter")},{filter:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}})},9949:(t,e,i)=>{"use strict";var s=i(3103),r=i(9996).findIndex,n=i(9736),o=!0;"findIndex"in[]&&Array(1).findIndex((function(){o=!1})),s({target:"Array",proto:!0,forced:o},{findIndex:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),n("findIndex")},9228:(t,e,i)=>{"use strict";var s=i(3103),r=i(9996).find,n=i(9736),o=!0;"find"in[]&&Array(1).find((function(){o=!1})),s({target:"Array",proto:!0,forced:o},{find:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),n("find")},4870:(t,e,i)=>{"use strict";var s=i(3103),r=i(4990),n=i(2991),o=i(4237),a=i(3819),h=i(7501);s({target:"Array",proto:!0},{flatMap:function(t){var e,i=n(this),s=o(i.length);return a(t),(e=h(i,0)).length=r(e,i,i,s,0,1,t,arguments.length>1?arguments[1]:void 0),e}})},7072:(t,e,i)=>{"use strict";var s=i(3103),r=i(4990),n=i(2991),o=i(4237),a=i(6051),h=i(7501);s({target:"Array",proto:!0},{flat:function(){var t=arguments.length?arguments[0]:void 0,e=n(this),i=o(e.length),s=h(e,0);return s.length=r(s,e,e,i,0,void 0===t?1:a(t)),s}})},8695:(t,e,i)=>{"use strict";var s=i(3103),r=i(6570);s({target:"Array",proto:!0,forced:[].forEach!=r},{forEach:r})},7233:(t,e,i)=>{var s=i(3103),r=i(507);s({target:"Array",stat:!0,forced:!i(4575)((function(t){Array.from(t)}))},{from:r})},9529:(t,e,i)=>{"use strict";var s=i(3103),r=i(9540).includes,n=i(9736);s({target:"Array",proto:!0},{includes:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),n("includes")},4083:(t,e,i)=>{"use strict";var s=i(3103),r=i(9540).indexOf,n=i(6038),o=[].indexOf,a=!!o&&1/[1].indexOf(1,-0)<0,h=n("indexOf");s({target:"Array",proto:!0,forced:a||!h},{indexOf:function(t){return a?o.apply(this,arguments)||0:r(this,t,arguments.length>1?arguments[1]:void 0)}})},8145:(t,e,i)=>{i(3103)({target:"Array",stat:!0},{isArray:i(3718)})},5735:(t,e,i)=>{"use strict";var s=i(905),r=i(9736),n=i(5495),o=i(6407),a=i(7675),h=o.set,l=o.getterFor("Array Iterator");t.exports=a(Array,"Array",(function(t,e){h(this,{type:"Array Iterator",target:s(t),index:0,kind:e})}),(function(){var t=l(this),e=t.target,i=t.kind,s=t.index++;return!e||s>=e.length?(t.target=void 0,{value:void 0,done:!0}):"keys"==i?{value:s,done:!1}:"values"==i?{value:e[s],done:!1}:{value:[s,e[s]],done:!1}}),"values"),n.Arguments=n.Array,r("keys"),r("values"),r("entries")},6781:(t,e,i)=>{"use strict";var s=i(3103),r=i(9337),n=i(905),o=i(6038),a=[].join,h=r!=Object,l=o("join",",");s({target:"Array",proto:!0,forced:h||!l},{join:function(t){return a.call(n(this),void 0===t?",":t)}})},4660:(t,e,i)=>{var s=i(3103),r=i(6462);s({target:"Array",proto:!0,forced:r!==[].lastIndexOf},{lastIndexOf:r})},3450:(t,e,i)=>{"use strict";var s=i(3103),r=i(9996).map;s({target:"Array",proto:!0,forced:!i(1460)("map")},{map:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}})},3370:(t,e,i)=>{"use strict";var s=i(3103),r=i(4229),n=i(2324);s({target:"Array",stat:!0,forced:r((function(){function t(){}return!(Array.of.call(t)instanceof t)}))},{of:function(){for(var t=0,e=arguments.length,i=new("function"==typeof this?this:Array)(e);e>t;)n(i,t,arguments[t++]);return i.length=e,i}})},9731:(t,e,i)=>{"use strict";var s=i(3103),r=i(3143).right,n=i(6038),o=i(6358),a=i(8801);s({target:"Array",proto:!0,forced:!n("reduceRight")||!a&&o>79&&o<83},{reduceRight:function(t){return r(this,t,arguments.length,arguments.length>1?arguments[1]:void 0)}})},3108:(t,e,i)=>{"use strict";var s=i(3103),r=i(3143).left,n=i(6038),o=i(6358),a=i(8801);s({target:"Array",proto:!0,forced:!n("reduce")||!a&&o>79&&o<83},{reduce:function(t){return r(this,t,arguments.length,arguments.length>1?arguments[1]:void 0)}})},9992:(t,e,i)=>{"use strict";var s=i(3103),r=i(3718),n=[].reverse,o=[1,2];s({target:"Array",proto:!0,forced:String(o)===String(o.reverse())},{reverse:function(){return r(this)&&(this.length=this.length),n.call(this)}})},2501:(t,e,i)=>{"use strict";var s=i(3103),r=i(5052),n=i(3718),o=i(3231),a=i(4237),h=i(905),l=i(2324),c=i(95),d=i(1460)("slice"),u=c("species"),p=[].slice,g=Math.max;s({target:"Array",proto:!0,forced:!d},{slice:function(t,e){var i,s,c,d=h(this),_=a(d.length),f=o(t,_),m=o(void 0===e?_:e,_);if(n(d)&&("function"!=typeof(i=d.constructor)||i!==Array&&!n(i.prototype)?r(i)&&null===(i=i[u])&&(i=void 0):i=void 0,i===Array||void 0===i))return p.call(d,f,m);for(s=new(void 0===i?Array:i)(g(m-f,0)),c=0;f<m;f++,c++)f in d&&l(s,c,d[f]);return s.length=c,s}})},7321:(t,e,i)=>{"use strict";var s=i(3103),r=i(9996).some;s({target:"Array",proto:!0,forced:!i(6038)("some")},{some:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}})},3430:(t,e,i)=>{"use strict";var s=i(3103),r=i(3819),n=i(2991),o=i(4229),a=i(6038),h=[],l=h.sort,c=o((function(){h.sort(void 0)})),d=o((function(){h.sort(null)})),u=a("sort");s({target:"Array",proto:!0,forced:c||!d||!u},{sort:function(t){return void 0===t?l.call(n(this)):l.call(n(this),r(t))}})},747:(t,e,i)=>{i(1832)("Array")},9805:(t,e,i)=>{"use strict";var s=i(3103),r=i(3231),n=i(6051),o=i(4237),a=i(2991),h=i(7501),l=i(2324),c=i(1460)("splice"),d=Math.max,u=Math.min;s({target:"Array",proto:!0,forced:!c},{splice:function(t,e){var i,s,c,p,g,_,f=a(this),m=o(f.length),y=r(t,m),w=arguments.length;if(0===w?i=s=0:1===w?(i=0,s=m-y):(i=w-2,s=u(d(n(e),0),m-y)),m+i-s>9007199254740991)throw TypeError("Maximum allowed length exceeded");for(c=h(f,s),p=0;p<s;p++)(g=y+p)in f&&l(c,p,f[g]);if(c.length=s,i<s){for(p=y;p<m-s;p++)_=p+i,(g=p+s)in f?f[_]=f[g]:delete f[_];for(p=m;p>m-s+i;p--)delete f[p-1]}else if(i>s)for(p=m-s;p>y;p--)_=p+i-1,(g=p+s-1)in f?f[_]=f[g]:delete f[_];for(p=0;p<i;p++)f[p+y]=arguments[p+2];return f.length=m-s+i,c}})},3985:(t,e,i)=>{i(9736)("flatMap")},7694:(t,e,i)=>{i(9736)("flat")},5584:(t,e,i)=>{i(3103)({target:"Function",proto:!0},{bind:i(4128)})},4326:(t,e,i)=>{"use strict";var s=i(5052),r=i(1787),n=i(7567),o=i(95)("hasInstance"),a=Function.prototype;o in a||r.f(a,o,{value:function(t){if("function"!=typeof this||!s(t))return!1;if(!s(this.prototype))return t instanceof this;for(;t=n(t);)if(this.prototype===t)return!0;return!1}})},6936:(t,e,i)=>{var s=i(7400),r=i(1787).f,n=Function.prototype,o=n.toString,a=/^\s*function ([^ (]*)/;s&&!("name"in n)&&r(n,"name",{configurable:!0,get:function(){try{return o.call(this).match(a)[1]}catch(t){return""}}})},7525:(t,e,i)=>{var s=i(9859);i(4555)(s.JSON,"JSON",!0)},8275:(t,e,i)=>{i(4555)(Math,"Math",!0)},3105:(t,e,i)=>{var s=i(3103),r=i(47);s({target:"Object",stat:!0,forced:Object.assign!==r},{assign:r})},7256:(t,e,i)=>{i(3103)({target:"Object",stat:!0,sham:!i(7400)},{create:i(2391)})},7846:(t,e,i)=>{"use strict";var s=i(3103),r=i(7400),n=i(5020),o=i(2991),a=i(3819),h=i(1787);r&&s({target:"Object",proto:!0,forced:n},{__defineGetter__:function(t,e){h.f(o(this),t,{get:a(e),enumerable:!0,configurable:!0})}})},6555:(t,e,i)=>{var s=i(3103),r=i(7400);s({target:"Object",stat:!0,forced:!r,sham:!r},{defineProperties:i(219)})},5094:(t,e,i)=>{var s=i(3103),r=i(7400);s({target:"Object",stat:!0,forced:!r,sham:!r},{defineProperty:i(1787).f})},6635:(t,e,i)=>{"use strict";var s=i(3103),r=i(7400),n=i(5020),o=i(2991),a=i(3819),h=i(1787);r&&s({target:"Object",proto:!0,forced:n},{__defineSetter__:function(t,e){h.f(o(this),t,{set:a(e),enumerable:!0,configurable:!0})}})},5883:(t,e,i)=>{var s=i(3103),r=i(7664).entries;s({target:"Object",stat:!0},{entries:function(t){return r(t)}})},2144:(t,e,i)=>{var s=i(3103),r=i(8476),n=i(4229),o=i(5052),a=i(5926).onFreeze,h=Object.freeze;s({target:"Object",stat:!0,forced:n((function(){h(1)})),sham:!r},{freeze:function(t){return h&&o(t)?h(a(t)):t}})},1804:(t,e,i)=>{var s=i(3103),r=i(9003),n=i(2324);s({target:"Object",stat:!0},{fromEntries:function(t){var e={};return r(t,(function(t,i){n(e,t,i)}),{AS_ENTRIES:!0}),e}})},8625:(t,e,i)=>{var s=i(3103),r=i(4229),n=i(905),o=i(7933).f,a=i(7400),h=r((function(){o(1)}));s({target:"Object",stat:!0,forced:!a||h,sham:!a},{getOwnPropertyDescriptor:function(t,e){return o(n(t),e)}})},2775:(t,e,i)=>{var s=i(3103),r=i(7400),n=i(4826),o=i(905),a=i(7933),h=i(2324);s({target:"Object",stat:!0,sham:!r},{getOwnPropertyDescriptors:function(t){for(var e,i,s=o(t),r=a.f,l=n(s),c={},d=0;l.length>d;)void 0!==(i=r(s,e=l[d++]))&&h(c,e,i);return c}})},4905:(t,e,i)=>{var s=i(3103),r=i(4229),n=i(166).f;s({target:"Object",stat:!0,forced:r((function(){return!Object.getOwnPropertyNames(1)}))},{getOwnPropertyNames:n})},6928:(t,e,i)=>{var s=i(3103),r=i(4229),n=i(2991),o=i(7567),a=i(7528);s({target:"Object",stat:!0,forced:r((function(){o(1)})),sham:!a},{getPrototypeOf:function(t){return o(n(t))}})},8892:(t,e,i)=>{var s=i(3103),r=i(4229),n=i(5052),o=Object.isExtensible;s({target:"Object",stat:!0,forced:r((function(){o(1)}))},{isExtensible:function(t){return!!n(t)&&(!o||o(t))}})},5060:(t,e,i)=>{var s=i(3103),r=i(4229),n=i(5052),o=Object.isFrozen;s({target:"Object",stat:!0,forced:r((function(){o(1)}))},{isFrozen:function(t){return!n(t)||!!o&&o(t)}})},2321:(t,e,i)=>{var s=i(3103),r=i(4229),n=i(5052),o=Object.isSealed;s({target:"Object",stat:!0,forced:r((function(){o(1)}))},{isSealed:function(t){return!n(t)||!!o&&o(t)}})},9170:(t,e,i)=>{i(3103)({target:"Object",stat:!0},{is:i(2101)})},4769:(t,e,i)=>{var s=i(3103),r=i(2991),n=i(5632);s({target:"Object",stat:!0,forced:i(4229)((function(){n(1)}))},{keys:function(t){return n(r(t))}})},2586:(t,e,i)=>{"use strict";var s=i(3103),r=i(7400),n=i(5020),o=i(2991),a=i(2066),h=i(7567),l=i(7933).f;r&&s({target:"Object",proto:!0,forced:n},{__lookupGetter__:function(t){var e,i=o(this),s=a(t,!0);do{if(e=l(i,s))return e.get}while(i=h(i))}})},3045:(t,e,i)=>{"use strict";var s=i(3103),r=i(7400),n=i(5020),o=i(2991),a=i(2066),h=i(7567),l=i(7933).f;r&&s({target:"Object",proto:!0,forced:n},{__lookupSetter__:function(t){var e,i=o(this),s=a(t,!0);do{if(e=l(i,s))return e.set}while(i=h(i))}})},4682:(t,e,i)=>{var s=i(3103),r=i(5052),n=i(5926).onFreeze,o=i(8476),a=i(4229),h=Object.preventExtensions;s({target:"Object",stat:!0,forced:a((function(){h(1)})),sham:!o},{preventExtensions:function(t){return h&&r(t)?h(n(t)):t}})},3280:(t,e,i)=>{var s=i(3103),r=i(5052),n=i(5926).onFreeze,o=i(8476),a=i(4229),h=Object.seal;s({target:"Object",stat:!0,forced:a((function(){h(1)})),sham:!o},{seal:function(t){return h&&r(t)?h(n(t)):t}})},2506:(t,e,i)=>{i(3103)({target:"Object",stat:!0},{setPrototypeOf:i(6540)})},8188:(t,e,i)=>{var s=i(1601),r=i(7487),n=i(4059);s||r(Object.prototype,"toString",n,{unsafe:!0})},7890:(t,e,i)=>{var s=i(3103),r=i(7664).values;s({target:"Object",stat:!0},{values:function(t){return r(t)}})},2215:(t,e,i)=>{var s=i(3103),r=i(9859),n=i(4555);s({global:!0},{Reflect:{}}),n(r.Reflect,"Reflect",!0)},8673:(t,e,i)=>{"use strict";var s=i(966).charAt,r=i(6407),n=i(7675),o=r.set,a=r.getterFor("String Iterator");n(String,"String",(function(t){o(this,{type:"String Iterator",string:String(t),index:0})}),(function(){var t,e=a(this),i=e.string,r=e.index;return r>=i.length?{value:void 0,done:!0}:(t=s(i,r),e.index+=t.length,{value:t,done:!1})}))},4115:(t,e,i)=>{"use strict";var s=i(3103),r=i(9859),n=i(1333),o=i(4231),a=i(7400),h=i(3839),l=i(6969),c=i(4229),d=i(816),u=i(3718),p=i(5052),g=i(1176),_=i(2991),f=i(905),m=i(2066),y=i(5358),w=i(2391),v=i(5632),b=i(8151),x=i(166),A=i(894),S=i(7933),P=i(1787),C=i(9195),E=i(5762),T=i(7487),D=i(3036),R=i(4399),B=i(5977),M=i(1441),k=i(95),O=i(5391),F=i(8423),I=i(4555),L=i(6407),z=i(9996).forEach,U=R("hidden"),W=k("toPrimitive"),H=L.set,N=L.getterFor("Symbol"),j=Object.prototype,G=r.Symbol,V=n("JSON","stringify"),X=S.f,K=P.f,q=x.f,Y=C.f,Z=D("symbols"),Q=D("op-symbols"),$=D("string-to-symbol-registry"),J=D("symbol-to-string-registry"),tt=D("wks"),et=r.QObject,it=!et||!et.prototype||!et.prototype.findChild,st=a&&c((function(){return 7!=w(K({},"a",{get:function(){return K(this,"a",{value:7}).a}})).a}))?function(t,e,i){var s=X(j,e);s&&delete j[e],K(t,e,i),s&&t!==j&&K(j,e,s)}:K,rt=function(t,e){var i=Z[t]=w(G.prototype);return H(i,{type:"Symbol",tag:t,description:e}),a||(i.description=e),i},nt=l?function(t){return"symbol"==typeof t}:function(t){return Object(t)instanceof G},ot=function(t,e,i){t===j&&ot(Q,e,i),g(t);var s=m(e,!0);return g(i),d(Z,s)?(i.enumerable?(d(t,U)&&t[U][s]&&(t[U][s]=!1),i=w(i,{enumerable:y(0,!1)})):(d(t,U)||K(t,U,y(1,{})),t[U][s]=!0),st(t,s,i)):K(t,s,i)},at=function(t,e){g(t);var i=f(e),s=v(i).concat(dt(i));return z(s,(function(e){a&&!ht.call(i,e)||ot(t,e,i[e])})),t},ht=function(t){var e=m(t,!0),i=Y.call(this,e);return!(this===j&&d(Z,e)&&!d(Q,e))&&(!(i||!d(this,e)||!d(Z,e)||d(this,U)&&this[U][e])||i)},lt=function(t,e){var i=f(t),s=m(e,!0);if(i!==j||!d(Z,s)||d(Q,s)){var r=X(i,s);return!r||!d(Z,s)||d(i,U)&&i[U][s]||(r.enumerable=!0),r}},ct=function(t){var e=q(f(t)),i=[];return z(e,(function(t){d(Z,t)||d(B,t)||i.push(t)})),i},dt=function(t){var e=t===j,i=q(e?Q:f(t)),s=[];return z(i,(function(t){!d(Z,t)||e&&!d(j,t)||s.push(Z[t])})),s};h||(T((G=function(){if(this instanceof G)throw TypeError("Symbol is not a constructor");var t=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,e=M(t),i=function(t){this===j&&i.call(Q,t),d(this,U)&&d(this[U],e)&&(this[U][e]=!1),st(this,e,y(1,t))};return a&&it&&st(j,e,{configurable:!0,set:i}),rt(e,t)}).prototype,"toString",(function(){return N(this).tag})),T(G,"withoutSetter",(function(t){return rt(M(t),t)})),C.f=ht,P.f=ot,S.f=lt,b.f=x.f=ct,A.f=dt,O.f=function(t){return rt(k(t),t)},a&&(K(G.prototype,"description",{configurable:!0,get:function(){return N(this).description}}),o||T(j,"propertyIsEnumerable",ht,{unsafe:!0}))),s({global:!0,wrap:!0,forced:!h,sham:!h},{Symbol:G}),z(v(tt),(function(t){F(t)})),s({target:"Symbol",stat:!0,forced:!h},{for:function(t){var e=String(t);if(d($,e))return $[e];var i=G(e);return $[e]=i,J[i]=e,i},keyFor:function(t){if(!nt(t))throw TypeError(t+" is not a symbol");if(d(J,t))return J[t]},useSetter:function(){it=!0},useSimple:function(){it=!1}}),s({target:"Object",stat:!0,forced:!h,sham:!a},{create:function(t,e){return void 0===e?w(t):at(w(t),e)},defineProperty:ot,defineProperties:at,getOwnPropertyDescriptor:lt}),s({target:"Object",stat:!0,forced:!h},{getOwnPropertyNames:ct,getOwnPropertySymbols:dt}),s({target:"Object",stat:!0,forced:c((function(){A.f(1)}))},{getOwnPropertySymbols:function(t){return A.f(_(t))}}),V&&s({target:"JSON",stat:!0,forced:!h||c((function(){var t=G();return"[null]"!=V([t])||"{}"!=V({a:t})||"{}"!=V(Object(t))}))},{stringify:function(t,e,i){for(var s,r=[t],n=1;arguments.length>n;)r.push(arguments[n++]);if(s=e,(p(e)||void 0!==t)&&!nt(t))return u(e)||(e=function(t,e){if("function"==typeof s&&(e=s.call(this,t,e)),!nt(e))return e}),r[1]=e,V.apply(null,r)}}),G.prototype[W]||E(G.prototype,W,G.prototype.valueOf),I(G,"Symbol"),B[U]=!0},1388:(t,e,i)=>{"use strict";i.d(e,{Z:()=>a});var s=i(1799),r=i.n(s),n=i(2609),o=i.n(n)()(r());o.push([t.id,"/* Buttons styles start */\n\nbutton#excalibur-play {\n  display: inline-block;\n  position: relative;\n  z-index: 999;\n  border-radius: 6px;\n  border: none;\n  /*border: 3px solid;\n    border-color: white;\n    box-shadow: 0 0 10px #ccc;*/\n  padding: 1rem 1.5rem 1rem 4rem;\n  margin: 0;\n  text-decoration: none;\n  background: #00b233;\n  color: #ffffff;\n  font-family: sans-serif;\n  font-size: 2rem;\n  line-height: 1;\n  cursor: pointer;\n  text-align: center;\n  transition: background 250ms ease-in-out, transform 150ms ease;\n  -webkit-appearance: none;\n  -moz-appearance: none;\n\n  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */\n  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */\n  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */\n  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */\n  animation: excalibur-button-fadein 200ms;\n}\n\n/*\nbutton#excalibur-play {\n  display: none;\n}*/\n\nbutton#excalibur-play:after {\n  position: absolute;\n  content: '';\n  border: 8px solid;\n  border-color: transparent transparent transparent white;\n  left: 35px;\n  top: 24px;\n  width: 0;\n  height: 0;\n}\n\nbutton#excalibur-play:before {\n  position: absolute;\n  content: '';\n  border: 3px solid;\n  left: 19px;\n  top: 14px;\n  border-radius: 20px;\n  width: 30px;\n  height: 30px;\n}\n\nbutton#excalibur-play:hover,\nbutton#excalibur-play:focus {\n  background: #00982c;\n}\n\nbutton#excalibur-play:focus {\n  outline: 1px solid #fff;\n  outline-offset: -4px;\n}\n\nbutton#excalibur-play:active {\n  transform: scale(0.99);\n}\n\n@keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Firefox < 16 */\n@-moz-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Safari, Chrome and Opera > 12.1 */\n@-webkit-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Internet Explorer */\n@-ms-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Opera < 12.1 */\n@-o-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n","",{version:3,sources:["webpack://./Loader.css"],names:[],mappings:"AAAA,yBAAyB;;AAEzB;EACE,qBAAqB;EACrB,kBAAkB;EAClB,YAAY;EACZ,kBAAkB;EAClB,YAAY;EACZ;;+BAE6B;EAC7B,8BAA8B;EAC9B,SAAS;EACT,qBAAqB;EACrB,mBAAmB;EACnB,cAAc;EACd,uBAAuB;EACvB,eAAe;EACf,cAAc;EACd,eAAe;EACf,kBAAkB;EAClB,8DAA8D;EAC9D,wBAAwB;EACxB,qBAAqB;;EAErB,gDAAgD,EAAE,oCAAoC;EACtF,6CAA6C,EAAE,iBAAiB;EAChE,4CAA4C,EAAE,sBAAsB;EACpE,2CAA2C,EAAE,iBAAiB;EAC9D,wCAAwC;AAC1C;;AAEA;;;EAGE;;AAEF;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,uDAAuD;EACvD,UAAU;EACV,SAAS;EACT,QAAQ;EACR,SAAS;AACX;;AAEA;EACE,kBAAkB;EAClB,WAAW;EACX,iBAAiB;EACjB,UAAU;EACV,SAAS;EACT,mBAAmB;EACnB,WAAW;EACX,YAAY;AACd;;AAEA;;EAEE,mBAAmB;AACrB;;AAEA;EACE,uBAAuB;EACvB,oBAAoB;AACtB;;AAEA;EACE,sBAAsB;AACxB;;AAEA;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,oCAAoC;AACpC;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,sBAAsB;AACtB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF;;AAEA,iBAAiB;AACjB;EACE;IACE,UAAU;EACZ;EACA;IACE,UAAU;EACZ;AACF",sourcesContent:["/* Buttons styles start */\n\nbutton#excalibur-play {\n  display: inline-block;\n  position: relative;\n  z-index: 999;\n  border-radius: 6px;\n  border: none;\n  /*border: 3px solid;\n    border-color: white;\n    box-shadow: 0 0 10px #ccc;*/\n  padding: 1rem 1.5rem 1rem 4rem;\n  margin: 0;\n  text-decoration: none;\n  background: #00b233;\n  color: #ffffff;\n  font-family: sans-serif;\n  font-size: 2rem;\n  line-height: 1;\n  cursor: pointer;\n  text-align: center;\n  transition: background 250ms ease-in-out, transform 150ms ease;\n  -webkit-appearance: none;\n  -moz-appearance: none;\n\n  -webkit-animation: excalibur-button-fadein 200ms; /* Safari, Chrome and Opera > 12.1 */\n  -moz-animation: excalibur-button-fadein 200ms; /* Firefox < 16 */\n  -ms-animation: excalibur-button-fadein 200ms; /* Internet Explorer */\n  -o-animation: excalibur-button-fadein 200ms; /* Opera < 12.1 */\n  animation: excalibur-button-fadein 200ms;\n}\n\n/*\nbutton#excalibur-play {\n  display: none;\n}*/\n\nbutton#excalibur-play:after {\n  position: absolute;\n  content: '';\n  border: 8px solid;\n  border-color: transparent transparent transparent white;\n  left: 35px;\n  top: 24px;\n  width: 0;\n  height: 0;\n}\n\nbutton#excalibur-play:before {\n  position: absolute;\n  content: '';\n  border: 3px solid;\n  left: 19px;\n  top: 14px;\n  border-radius: 20px;\n  width: 30px;\n  height: 30px;\n}\n\nbutton#excalibur-play:hover,\nbutton#excalibur-play:focus {\n  background: #00982c;\n}\n\nbutton#excalibur-play:focus {\n  outline: 1px solid #fff;\n  outline-offset: -4px;\n}\n\nbutton#excalibur-play:active {\n  transform: scale(0.99);\n}\n\n@keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Firefox < 16 */\n@-moz-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Safari, Chrome and Opera > 12.1 */\n@-webkit-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Internet Explorer */\n@-ms-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n/* Opera < 12.1 */\n@-o-keyframes excalibur-button-fadein {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n"],sourceRoot:""}]);const a=o},2609:t=>{"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i=t(e);return e[2]?"@media ".concat(e[2]," {").concat(i,"}"):i})).join("")},e.i=function(t,i,s){"string"==typeof t&&(t=[[null,t,""]]);var r={};if(s)for(var n=0;n<this.length;n++){var o=this[n][0];null!=o&&(r[o]=!0)}for(var a=0;a<t.length;a++){var h=[].concat(t[a]);s&&r[h[0]]||(i&&(h[2]?h[2]="".concat(i," and ").concat(h[2]):h[2]=i),e.push(h))}},e}},1799:t=>{"use strict";function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}t.exports=function(t){var i=function(t,i){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var i=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null!=i){var s,r,n=[],o=!0,a=!1;try{for(i=i.call(t);!(o=(s=i.next()).done)&&(n.push(s.value),!e||n.length!==e);o=!0);}catch(t){a=!0,r=t}finally{try{o||null==i.return||i.return()}finally{if(a)throw r}}return n}}(t,i)||function(t,i){if(t){if("string"==typeof t)return e(t,i);var s=Object.prototype.toString.call(t).slice(8,-1);return"Object"===s&&t.constructor&&(s=t.constructor.name),"Map"===s||"Set"===s?Array.from(t):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?e(t,i):void 0}}(t,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t,4),s=i[1],r=i[3];if("function"==typeof btoa){var n=btoa(unescape(encodeURIComponent(JSON.stringify(r)))),o="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(n),a="/*# ".concat(o," */"),h=r.sources.map((function(t){return"/*# sourceURL=".concat(r.sourceRoot||"").concat(t," */")}));return[s].concat(h).concat([a]).join("\n")}return[s].join("\n")}}},e={};function i(s){var r=e[s];if(void 0!==r)return r.exports;var n=e[s]={id:s,exports:{}};return t[s](n,n.exports,i),n.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var s={};return(()=>{i.r(s),i.d(s,{ActionContext:()=>He,ActionQueue:()=>Se,ActivateEvent:()=>Lt,Actor:()=>Ii,AddedComponent:()=>_i,AddedEntity:()=>ys,Animation:()=>ye,AudioContextFactory:()=>Li,Axis:()=>$i,BaseAlign:()=>Gr,BinaryTreeNode:()=>Ln,Blink:()=>Fe,Body:()=>Je,BoundingBox:()=>Zt,BroadphaseStrategy:()=>J,BrowserComponent:()=>_r,BrowserEvents:()=>fr,Camera:()=>ds,CanvasDrawComponent:()=>vi,CanvasDrawingSystem:()=>Rs,Cell:()=>rs,Circle:()=>Kt,Class:()=>gi,ClosestLine:()=>Vt,ClosestLineJumpTable:()=>Xt,Collider:()=>ui,CollisionContact:()=>jt,CollisionEndEvent:()=>Ft,CollisionGroup:()=>li,CollisionGroupManager:()=>an,CollisionJumpTable:()=>Gt,CollisionResolutionStrategy:()=>$,CollisionStartEvent:()=>Ot,CollisionType:()=>it,Color:()=>at,ColorBlindCorrector:()=>Ks,ColorBlindness:()=>Bs,Component:()=>Xe,Configurable:()=>pe,ConsoleAppender:()=>y,ConvexPolygon:()=>Yt,CoordPlane:()=>qe,CullingBox:()=>ei,DeactivateEvent:()=>zt,Debug:()=>Ys,Detector:()=>ji,Die:()=>ze,DisplayMode:()=>Qt,DynamicTree:()=>Ki,DynamicTreeCollisionBroadphase:()=>qi,EX_VERSION:()=>jn,EaseTo:()=>Oe,EasingFunctions:()=>Ae,Edge:()=>qt,Effects:()=>e,ElasticToActorStrategy:()=>hs,EmitterType:()=>Qr,Engine:()=>Lr,EnterTriggerEvent:()=>Ht,EnterViewPortEvent:()=>Wt,Entity:()=>wi,EntityManager:()=>xs,EventDispatcher:()=>ee,EventTypes:()=>et,Events:()=>t,ExResponse:()=>dn,ExitTriggerEvent:()=>Nt,ExitViewPortEvent:()=>Ut,Experiments:()=>h,Fade:()=>Ie,Flags:()=>f,Follow:()=>Ue,FontStyle:()=>Vr,FontUnit:()=>Nr,FrameStats:()=>Zs,GameEvent:()=>ct,GameStartEvent:()=>gt,GameStopEvent:()=>_t,GamepadAxisEvent:()=>Et,GamepadButtonEvent:()=>Ct,GamepadConnectEvent:()=>St,GamepadDisconnectEvent:()=>Pt,Gif:()=>Tn,GlobalCoordinates:()=>Z,Graphics:()=>n,HiddenEvent:()=>Bt,InitializeEvent:()=>It,Input:()=>o,Integrator:()=>tt,KillEvent:()=>dt,Label:()=>en,Legacy:()=>l,LimitCameraBoundsStrategy:()=>cs,Line:()=>q,Loader:()=>Hi,LockCameraToActorAxisStrategy:()=>as,LockCameraToActorStrategy:()=>os,LogLevel:()=>c,Logger:()=>m,Matrix:()=>Ge,MatrixLocations:()=>ve,MediaEvent:()=>Ur,Meet:()=>We,MockedElement:()=>zn,MoveBy:()=>Ee,MoveTo:()=>Te,NativeSoundEvent:()=>Wr,NativeSoundProcessedEvent:()=>Hr,Pair:()=>ci,ParseGif:()=>Mn,Particle:()=>rn,ParticleEmitter:()=>on,PerlinDrawer2D:()=>An,PerlinGenerator:()=>xn,Physics:()=>lt,PhysicsStats:()=>Qs,Polygon:()=>hn,Pool:()=>br,PostCollisionEvent:()=>kt,PostDebugDrawEvent:()=>wt,PostDrawEvent:()=>mt,PostFrameEvent:()=>At,PostKillEvent:()=>pt,PostUpdateEvent:()=>bt,PreCollisionEvent:()=>Mt,PreDebugDrawEvent:()=>yt,PreDrawEvent:()=>ft,PreFrameEvent:()=>xt,PreKillEvent:()=>ut,PreUpdateEvent:()=>vt,Projection:()=>Y,Promise:()=>Nn,PromiseState:()=>Wn,Query:()=>Ss,QueryManager:()=>Ps,RadiusAroundActorStrategy:()=>ls,Random:()=>v,Ray:()=>K,RemovedComponent:()=>mi,RemovedEntity:()=>vs,Repeat:()=>Pe,RepeatForever:()=>Ce,Resolution:()=>Jt,Resource:()=>ie,RotateBy:()=>Re,RotateTo:()=>De,RotationType:()=>we,ScaleBy:()=>Me,ScaleTo:()=>Be,Scene:()=>Xs,Screen:()=>te,ScreenAppender:()=>w,ScreenElement:()=>Gi,ScrollPreventionMode:()=>Or,Shape:()=>Ne,Side:()=>u,SortedList:()=>In,Sound:()=>En,Sprite:()=>_e,SpriteFont:()=>cn,SpriteSheet:()=>ln,StrategyContainer:()=>ns,Stream:()=>Bn,SubscribeEvent:()=>Tt,System:()=>ms,SystemManager:()=>Cs,SystemType:()=>_s,TagComponent:()=>Ke,TextAlign:()=>jr,Texture:()=>fe,TileMap:()=>is,Timer:()=>Vi,Traits:()=>a,TransformComponent:()=>$e,TreeNode:()=>Xi,Trigger:()=>gs,UnsubscribeEvent:()=>Dt,Util:()=>g,Vector:()=>X,VectorView:()=>Ve,VisibleEvent:()=>Rt,WebAudioInstance:()=>Sn,World:()=>Es,hasOnInitialize:()=>pn,hasOnPostUpdate:()=>mn,hasOnPreUpdate:()=>_n,hasPostDraw:()=>wn,hasPreDraw:()=>yn,has_initialize:()=>un,has_postupdate:()=>fn,has_preupdate:()=>gn,isAddedComponent:()=>fi,isAddedSystemEntity:()=>ws,isCollider:()=>di,isRemoveSystemEntity:()=>bs,isRemovedComponent:()=>yi,maxMessages:()=>H,obsolete:()=>V,resetObsoleteCounter:()=>j,vec:()=>Q});var t={};i.r(t),i.d(t,{ActivateEvent:()=>Lt,CollisionEndEvent:()=>Ft,CollisionStartEvent:()=>Ot,DeactivateEvent:()=>zt,EnterTriggerEvent:()=>Ht,EnterViewPortEvent:()=>Wt,EventTypes:()=>et,ExitTriggerEvent:()=>Nt,ExitViewPortEvent:()=>Ut,GameEvent:()=>ct,GameStartEvent:()=>gt,GameStopEvent:()=>_t,GamepadAxisEvent:()=>Et,GamepadButtonEvent:()=>Ct,GamepadConnectEvent:()=>St,GamepadDisconnectEvent:()=>Pt,HiddenEvent:()=>Bt,InitializeEvent:()=>It,KillEvent:()=>dt,PostCollisionEvent:()=>kt,PostDebugDrawEvent:()=>wt,PostDrawEvent:()=>mt,PostFrameEvent:()=>At,PostKillEvent:()=>pt,PostUpdateEvent:()=>bt,PreCollisionEvent:()=>Mt,PreDebugDrawEvent:()=>yt,PreDrawEvent:()=>ft,PreFrameEvent:()=>xt,PreKillEvent:()=>ut,PreUpdateEvent:()=>vt,SubscribeEvent:()=>Tt,UnsubscribeEvent:()=>Dt,VisibleEvent:()=>Rt});var e={};i.r(e),i.d(e,{Colorize:()=>ae,Darken:()=>le,Desaturate:()=>de,Fill:()=>ue,Grayscale:()=>re,Invert:()=>ne,Lighten:()=>he,Opacity:()=>oe,Saturate:()=>ce});var r={};i.r(r),i.d(r,{circle:()=>hi,line:()=>ri,point:()=>ni,roundRect:()=>ai,vector:()=>oi});var n={};i.r(n),i.d(n,{Animation:()=>xi,AnimationStrategy:()=>Ye,BaseAlign:()=>Gr,Canvas:()=>Wi,Circle:()=>kn,Direction:()=>Xr,ExcaliburGraphicsContext2DCanvas:()=>kr,ExcaliburGraphicsContextWebGL:()=>Br,Font:()=>qr,FontStyle:()=>Vr,FontUnit:()=>Nr,Graphic:()=>bi,GraphicsComponent:()=>Ci,GraphicsGroup:()=>Ai,GraphicsLayer:()=>Si,GraphicsLayers:()=>Pi,GraphicsSystem:()=>Ds,ImageSource:()=>Yi,Polygon:()=>On,Raster:()=>Bi,Rectangle:()=>Mi,Sprite:()=>Zi,SpriteFont:()=>Zr,SpriteSheet:()=>Qi,Text:()=>Yr,TextAlign:()=>jr});var o={};i.r(o),i.d(o,{Axes:()=>js,Buttons:()=>Ns,Gamepad:()=>gr,Gamepads:()=>pr,KeyEvent:()=>$s,Keyboard:()=>Js,Keys:()=>Ms,NativePointerButton:()=>Fs,Pointer:()=>tr,PointerButton:()=>Is,PointerCancelEvent:()=>lr,PointerDownEvent:()=>nr,PointerDragEvent:()=>sr,PointerEnterEvent:()=>ar,PointerEvent:()=>er,PointerEventFactory:()=>ir,PointerLeaveEvent:()=>hr,PointerMoveEvent:()=>or,PointerScope:()=>Os,PointerType:()=>ks,PointerUpEvent:()=>rr,Pointers:()=>ur,WheelDeltaMode:()=>Ls,WheelEvent:()=>cr,createPointerEventByName:()=>dr});var a={};i.r(a),i.d(a,{CapturePointer:()=>si,OffscreenCulling:()=>ii,TileMapCollisionDetection:()=>ti});var h,l,c,d,u,p,g={};function _(){if("undefined"==typeof window&&(window={audioContext:function(){}}),"undefined"==typeof window||window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setInterval(t,1e3/60)}),"undefined"==typeof window||window.cancelAnimationFrame||(window.cancelAnimationFrame=window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||function(){}),"undefined"!=typeof window&&!window.AudioContext){if(window.webkitAudioContext){const t=window.webkitAudioContext.prototype.decodeAudioData;window.webkitAudioContext.prototype.decodeAudioData=function(e){return new Promise(((i,s)=>{t.call(this,e,i,s)}))}}window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext||window.oAudioContext}"undefined"==typeof window||window.devicePixelRatio||(window.devicePixelRatio=window.devicePixelRatio||1)}i.r(g),i.d(g,{Collection:()=>L,DrawUtil:()=>r,TwoPI:()=>b,addItemToArray:()=>M,base64Encode:()=>A,canonicalizeAngle:()=>T,clamp:()=>P,contains:()=>O,delay:()=>W,extend:()=>x,fail:()=>z,getOppositeSide:()=>F,getPosition:()=>B,getSideFromDirection:()=>I,nullish:()=>S,randomInRange:()=>C,randomIntInRange:()=>E,range:()=>U,removeItemFromArray:()=>k,toDegrees:()=>D,toRadians:()=>R}),i(1390),i(6305),i(8816),(h||(h={})).WebGL="use-webgl",function(t){t.LegacyDrawing="use-legacy-drawing"}(l||(l={}));class f{static freeze(){f._FROZEN=!0}static _reset(){f._FROZEN=!1,f._FLAGS={}}static enable(t){if(this._FROZEN)throw Error("Feature flags can only be enabled before Engine constructor time");f._FLAGS[t]=!0}static disable(t){if(this._FROZEN)throw Error("Feature flags can only be disabled before Engine constructor time");f._FLAGS[t]=!1}static isEnabled(t){return!!f._FLAGS[t]}static show(){return Object.keys(f._FLAGS)}}f._FROZEN=!1,f._FLAGS={},(d=c||(c={}))[d.Debug=0]="Debug",d[d.Info=1]="Info",d[d.Warn=2]="Warn",d[d.Error=3]="Error",d[d.Fatal=4]="Fatal";class m{constructor(){if(this._appenders=[],this.defaultLevel=c.Info,m._INSTANCE)throw new Error("Logger is a singleton");return m._INSTANCE=this,m._INSTANCE.addAppender(new y),m._INSTANCE}static getInstance(){return null==m._INSTANCE&&(m._INSTANCE=new m),m._INSTANCE}addAppender(t){this._appenders.push(t)}clearAppenders(){this._appenders.length=0}_log(t,e){null==t&&(t=this.defaultLevel);const i=this._appenders.length;for(let s=0;s<i;s++)t>=this.defaultLevel&&this._appenders[s].log(t,e)}debug(...t){this._log(c.Debug,t)}info(...t){this._log(c.Info,t)}warn(...t){this._log(c.Warn,t)}error(...t){this._log(c.Error,t)}fatal(...t){this._log(c.Fatal,t)}}m._INSTANCE=null;class y{log(t,e){if(!console&&!console.log&&console.warn&&console.error)return;const i=[];i.unshift.apply(i,e),i.unshift("["+c[t]+"] : "),t<c.Warn?console.log.apply?console.log.apply(console,i):console.log(i.join(" ")):t<c.Error?console.warn.apply?console.warn.apply(console,i):console.warn(i.join(" ")):console.error.apply?console.error.apply(console,i):console.error(i.join(" "))}}class w{constructor(t,e){this._messages=[],this._canvas=document.createElement("canvas"),this._canvas.width=t||window.innerWidth,this._canvas.height=e||window.innerHeight,this._canvas.style.position="absolute",this._ctx=this._canvas.getContext("2d"),document.body.appendChild(this._canvas)}log(t,e){const i=e.join(",");this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._messages.unshift("["+c[t]+"] : "+i);let s=10,r=1;for(let t=0;t<this._messages.length;t++)this._ctx.fillStyle="rgba(255,255,255,"+r.toFixed(2)+")",this._ctx.fillText(this._messages[t],200,s),s+=10,r=r>0?r-.05:0}}class v{constructor(t){this.seed=t,this._lowerMask=2147483647,this._upperMask=2147483648,this._w=32,this._n=624,this._m=397,this._a=2567483615,this._u=11,this._s=7,this._b=2636928640,this._t=15,this._c=4022730752,this._l=18,this._f=1812433253,this._mt=new Array(this._n),this._mt[0]=(t||Date.now())>>>0;for(let t=1;t<this._n;t++){const e=this._mt[t-1]^this._mt[t-1]>>>this._w-2;this._mt[t]=(this._f*((4294901760&e)>>>16)<<16)+this._f*(65535&e)+t>>>0}this._index=this._n}_twist(){const t=[0,this._a];let e=0,i=0;for(;i<this._n-this._m;i++)e=this._mt[i]&this._upperMask|this._mt[i+1]&this._lowerMask,this._mt[i]=this._mt[i+this._m]^e>>>1^4294967295&t[1&e];for(;i<this._n-1;i++)e=this._mt[i]&this._upperMask|this._mt[i+1]&this._lowerMask,this._mt[i]=this._mt[i+(this._m-this._n)]^e>>>1^4294967295&t[1&e];e=this._mt[this._n-1]&this._upperMask|this._mt[0]&this._lowerMask,this._mt[this._n-1]=this._mt[this._m-1]^e>>>1^4294967295&t[1&e],this._index=0}nextInt(){this._index>=this._n&&this._twist();let t=this._mt[this._index++];return t^=t>>>this._u,t^=t<<this._s&this._b,t^=t<<this._t&this._c,t^=t>>>this._l,t>>>0}next(){return this.nextInt()*(1/4294967296)}floating(t,e){return(e-t)*this.next()+t}integer(t,e){return Math.floor((e-t+1)*this.next()+t)}bool(t=.5){return this.next()<=t}pickOne(t){return t[this.integer(0,t.length-1)]}pickSet(t,e,i=!1){return i?this._pickSetWithDuplicates(t,e):this._pickSetWithoutDuplicates(t,e)}_pickSetWithoutDuplicates(t,e){if(e>t.length||e<0)throw new Error("Invalid number of elements to pick, must pick a value 0 < n <= length");if(e===t.length)return t;const i=new Array(e);let s=0;const r=t.slice(0);for(;s<e;){const t=this.integer(0,r.length-1);i[s++]=r[t],r.splice(t,1)}return i}_pickSetWithDuplicates(t,e){if(e<0)throw new Error("Invalid number of elements to pick, must pick a value 0 <= n < MAX_INT");const i=new Array(e);for(let s=0;s<e;s++)i[s]=this.pickOne(t);return i}shuffle(t){const e=t.slice(0);let i=null;for(let t=0;t<e.length-2;t++){const s=this.integer(t,e.length-1);i=e[t],e[t]=e[s],e[s]=i}return e}range(t,e,i){const s=new Array(t);for(let r=0;r<t;r++)s[r]=this.integer(e,i);return s}d4(){return this.integer(1,4)}d6(){return this.integer(1,6)}d8(){return this.integer(1,8)}d10(){return this.integer(1,10)}d12(){return this.integer(1,12)}d20(){return this.integer(1,20)}}(p=u||(u={})).None="None",p.Top="Top",p.Bottom="Bottom",p.Left="Left",p.Right="Right";const b=2*Math.PI;function x(){const t={};let e=!1,i=0;const s=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(e=arguments[0],i++);const r="function"==typeof Object.assign;let n=null;for(n=r?Object.assign:function(i){for(const s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e&&"[object Object]"===Object.prototype.toString.call(i[s])?t[s]=x(!0,t[s],i[s]):t[s]=i[s])};i<s;i++){const e=arguments[i];r?n(t,e):n(e)}return t}function A(t){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let i="",s=0;for(;s<t.length;){const r=255&t.charCodeAt(s++),n=255&t.charCodeAt(s++),o=255&t.charCodeAt(s++),a=r>>2,h=(3&r)<<4|n>>4;let l,c;isNaN(n)?l=c=64:(l=(15&n)<<2|o>>6,c=isNaN(o)?64:63&o),i+=e.charAt(a)+e.charAt(h)+e.charAt(l)+e.charAt(c)}return i}function S(t,e){return null!=t?t:e}function P(t,e,i){return Math.min(Math.max(e,t),i)}function C(t,e,i=new v){return i?i.floating(t,e):t+Math.random()*(e-t)}function E(t,e,i=new v){return i?i.integer(t,e):Math.round(C(t,e))}function T(t){let e=t;if(t>b)for(;e>b;)e-=b;if(t<0)for(;e<0;)e+=b;return e}function D(t){return 180/Math.PI*t}function R(t){return t/180*Math.PI}function B(t){let e=0,i=0;const s=t=>{e+=t.offsetLeft,t.offsetParent&&s(t.offsetParent)},r=t=>{i+=t.offsetTop,t.offsetParent&&r(t.offsetParent)};return s(t),r(t),new X(e,i)}function M(t,e){return-1===e.indexOf(t)&&(e.push(t),!0)}function k(t,e){let i=-1;return(i=e.indexOf(t))>-1&&(e.splice(i,1),!0)}function O(t,e){for(let i=0;i<t.length;i++)if(t[i]===e)return!0;return!1}function F(t){return t===u.Top?u.Bottom:t===u.Bottom?u.Top:t===u.Left?u.Right:t===u.Right?u.Left:u.None}function I(t){const e=[X.Left,X.Right,X.Up,X.Down],i=[u.Left,u.Right,u.Top,u.Bottom];let s=-Number.MAX_VALUE,r=-1;for(let i=0;i<e.length;i++)e[i].dot(t)>s&&(s=e[i].dot(t),r=i);return i[r]}class L{constructor(t=L.DefaultSize){this._internalArray=null,this._endPointer=0,this._internalArray=new Array(t)}_resize(){const t=2*this._internalArray.length,e=new Array(t),i=this.count();for(let t=0;t<i;t++)e[t]=this._internalArray[t];delete this._internalArray,this._internalArray=e}push(t){return this._endPointer===this._internalArray.length&&this._resize(),this._internalArray[this._endPointer++]=t}pop(){return this._endPointer=this._endPointer-1<0?0:this._endPointer-1,this._internalArray[this._endPointer]}count(){return this._endPointer}clear(){this._endPointer=0}internalSize(){return this._internalArray.length}elementAt(t){if(t>=this.count())throw new Error("Invalid index "+t);return this._internalArray[t]}insert(t,e){return t>=this.count()&&this._resize(),this._internalArray[t]=e}remove(t){const e=this.count();if(0===e)throw new Error("Invalid parameter "+t);const i=this._internalArray[t];for(let i=t;i<e;i++)this._internalArray[i]=this._internalArray[i+1];return this._endPointer--,i}removeElement(t){const e=this._internalArray.indexOf(t);this.remove(e)}toArray(){return this._internalArray.slice(0,this._endPointer)}forEach(t){let e=0;const i=this.count();for(;e<i;e++)t.call(this,this._internalArray[e],e)}map(t){const e=this.count();for(let i=0;i<e;i++)this._internalArray[i]=t.call(this,this._internalArray[i],i)}}function z(t){throw new Error(t)}L.DefaultSize=200;const U=(t,e)=>Array.from(new Array(e-t+1),((e,i)=>i+t));function W(t){return new Promise((e=>{setTimeout((()=>{e()}),t)}))}const H=5,N={},j=()=>{for(const t in N)N[t]=0},G=(t,e)=>{const i=f.isEnabled("suppress-obsolete-message");N[t]<H&&!i&&(m.getInstance().warn(t),console.trace&&e.showStackTrace&&console.trace()),N[t]++};function V(t){return t=x({},{message:"This feature will be removed in future versions of Excalibur.",alternateMethod:null,showStackTrack:!1},t),function(e,i,s){if(s&&"function"!=typeof s.value&&"function"!=typeof s.get&&"function"!=typeof s.set)throw new SyntaxError("Only classes/functions/getters/setters can be marked as obsolete");const r=`${e.name||""}${e.name&&i?".":""}${i||""} is marked obsolete: ${t.message}`+(t.alternateMethod?` Use ${t.alternateMethod} instead`:"");N[r]||(N[r]=0);const n=s?Object.assign({},s):e;if(!s){class e extends n{constructor(...e){G(r,t),super(...e)}}return e}return s&&s.value?(n.value=function(){return G(r,t),s.value.apply(this,arguments)},n):(s&&s.get&&(n.get=function(){return G(r,t),s.get.apply(this,arguments)}),s&&s.set&&(n.set=function(){return G(r,t),s.set.apply(this,arguments)}),n)}}class X{constructor(t,e){this._x=0,this._y=0,this._x=t,this._y=e}static get Zero(){return new X(0,0)}static get One(){return new X(1,1)}static get Half(){return new X(.5,.5)}static get Up(){return new X(0,-1)}static get Down(){return new X(0,1)}static get Left(){return new X(-1,0)}static get Right(){return new X(1,0)}static fromAngle(t){return new X(Math.cos(t),Math.sin(t))}static isValid(t){return null!=t&&!isNaN(t.x)&&!isNaN(t.y)&&t.x!==1/0&&t.y!==1/0&&t.x!==-1/0&&t.y!==-1/0}static distance(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}get x(){return this._x}set x(t){this._x=t}get y(){return this._y}set y(t){this._y=t}setTo(t,e){this.x=t,this.y=e}equals(t,e=.001){return Math.abs(this.x-t.x)<=e&&Math.abs(this.y-t.y)<=e}distance(t){return t||(t=X.Zero),Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))}magnitude(){return this.distance()}get size(){return this.distance()}set size(t){const e=this.normalize().scale(t);this.setTo(e.x,e.y)}normalize(){const t=this.distance();return t>0?new X(this.x/t,this.y/t):new X(0,1)}average(t){return this.add(t).scale(.5)}scale(t){return t instanceof X?new X(this.x*t.x,this.y*t.y):new X(this.x*t,this.y*t)}add(t){return new X(this.x+t.x,this.y+t.y)}sub(t){return new X(this.x-t.x,this.y-t.y)}addEqual(t){return this.setTo(this.x+t.x,this.y+t.y),this}subEqual(t){return this.setTo(this.x-t.x,this.y-t.y),this}scaleEqual(t){return this.setTo(this.x*t,this.y*t),this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return t instanceof X?this.x*t.y-this.y*t.x:"number"==typeof t?new X(t*this.y,-t*this.x):void 0}perpendicular(){return new X(this.y,-this.x)}normal(){return this.perpendicular().normalize()}negate(){return this.scale(-1)}toAngle(){return Math.atan2(this.y,this.x)}rotate(t,e){e||(e=new X(0,0));const i=Math.sin(t),s=Math.cos(t),r=s*(this.x-e.x)-i*(this.y-e.y)+e.x,n=i*(this.x-e.x)+s*(this.y-e.y)+e.y;return new X(r,n)}clone(){return new X(this.x,this.y)}toString(){return`(${this.x}, ${this.y})`}}!function(t,e,i,s){var r,n=arguments.length,o=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(o=(n<3?r(o):n>3?r(e,i,o):r(e,i))||o);n>3&&o&&Object.defineProperty(e,i,o)}([V({message:"will be removed in favour of `.size` in version 0.25.0"})],X.prototype,"magnitude",null);class K{constructor(t,e){this.pos=t,this.dir=e.normalize()}intersect(t){const e=t.begin.sub(this.pos);if(0===this.dir.cross(t.getSlope())&&0!==e.cross(this.dir))return-1;const i=this.dir.cross(t.getSlope());if(0===i)return-1;const s=e.cross(t.getSlope())/i;if(s>=0){const r=e.cross(this.dir)/i/t.getLength();if(r>=0&&r<=1)return s}return-1}getPoint(t){return this.pos.add(this.dir.scale(t))}}class q{constructor(t,e){this.begin=t,this.end=e}get slope(){return(this.end.y-this.begin.y)/(this.end.x-this.begin.x)}get intercept(){return this.begin.y-this.slope*this.begin.x}normal(){return this.end.sub(this.begin).normal()}getSlope(){const t=this.begin,e=this.end,i=t.distance(e);return e.sub(t).scale(1/i)}getEdge(){const t=this.begin;return this.end.sub(t)}getLength(){const t=this.begin,e=this.end;return t.distance(e)}get midpoint(){return this.begin.add(this.end).scale(.5)}flip(){return new q(this.end,this.begin)}distanceToPoint(t){const e=t.x,i=t.y,s=this.getLength(),r=this.end.y-this.begin.y,n=this.end.x-this.begin.x;return Math.abs(r*e-n*i+this.end.x*this.begin.y-this.end.y*this.begin.x)/s}findVectorToPoint(t){const e=this.begin.sub(t),i=this.getSlope();return e.sub(i.scale(e.dot(i)))}findPoint(t=null,e=null){const i=this.slope,s=this.intercept;if(null!==t)return new X(t,i*t+s);if(null!==e)return new X((e-s)/i,e);throw new Error("You must provide an X or a Y value")}hasPoint(){let t,e=0;if("number"==typeof arguments[0]&&"number"==typeof arguments[1])t=new X(arguments[0],arguments[1]),e=arguments[2]||0;else{if(!(arguments[0]instanceof X))throw"Could not determine the arguments for Vector.hasPoint";t=arguments[0],e=arguments[1]||0}const i=t.x-this.begin.x,s=t.y-this.begin.y,r=this.end.x-this.begin.x,n=this.end.y-this.begin.y,o=i*n-s*r;return!(Math.abs(o)>e)&&(Math.abs(r)>=Math.abs(n)?r>0?this.begin.x<=t.x&&t.x<=this.end.x:this.end.x<=t.x&&t.x<=this.begin.x:n>0?this.begin.y<=t.y&&t.y<=this.end.y:this.end.y<=t.y&&t.y<=this.begin.y)}}class Y{constructor(t,e){this.min=t,this.max=e}overlaps(t){return this.max>t.min&&t.max>this.min}getOverlap(t){return this.overlaps(t)?this.max>t.max?t.max-this.min:this.max-t.min:0}}class Z{constructor(t,e,i){this.worldPos=t,this.pagePos=e,this.screenPos=i}static fromPagePosition(t,e,i){let s,r,n,o;3===arguments.length?(s=t,r=e,n=new X(s,r),o=i):(n=t,s=n.x,r=n.y,o=e);const a=o.screen.pageToScreenCoordinates(n),h=o.screen.screenToWorldCoordinates(a);return new Z(h,n,a)}}function Q(t,e){return new X(t,e)}var $,J,tt,et,it,st,rt,nt,ot=function(t,e,i,s){var r,n=arguments.length,o=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(o=(n<3?r(o):n>3?r(e,i,o):r(e,i))||o);return n>3&&o&&Object.defineProperty(e,i,o),o};class at{constructor(t,e,i,s){this.r=t,this.g=e,this.b=i,this.a=null!=s?s:1}static fromRGB(t,e,i,s){return new at(t,e,i,s)}static fromRGBString(t){let e=null;if(e=t.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)/i)){const t=parseInt(e[1],10),i=parseInt(e[2],10),s=parseInt(e[3],10);let r=1;return e[4]&&(r=parseFloat(e[4])),new at(t,i,s,r)}throw new Error("Invalid rgb/a string: "+t)}static fromHex(t){let e=null;if(e=t.match(/^#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i)){const t=parseInt(e[1],16),i=parseInt(e[2],16),s=parseInt(e[3],16);let r=1;return e[4]&&(r=parseInt(e[4],16)/255),new at(t,i,s,r)}throw new Error("Invalid hex string: "+t)}static fromHSL(t,e,i,s=1){return new ht(t,e,i,s).toRGBA()}lighten(t=.1){const e=ht.fromRGBA(this.r,this.g,this.b,this.a);return e.l+=(1-e.l)*t,e.toRGBA()}darken(t=.1){const e=ht.fromRGBA(this.r,this.g,this.b,this.a);return e.l-=e.l*t,e.toRGBA()}saturate(t=.1){const e=ht.fromRGBA(this.r,this.g,this.b,this.a);return e.s+=e.s*t,e.toRGBA()}desaturate(t=.1){const e=ht.fromRGBA(this.r,this.g,this.b,this.a);return e.s-=e.s*t,e.toRGBA()}multiply(t){const e=t.r/255*this.r/255*255,i=t.g/255*this.g/255*255,s=t.b/255*this.b/255*255,r=t.a*this.a;return new at(e,i,s,r)}mulitiply(t){return this.multiply(t)}screen(t){const e=t.invert(),i=t.invert();return e.multiply(i).invert()}invert(){return new at(255-this.r,255-this.g,255-this.b,1-this.a)}average(t){const e=(t.r+this.r)/2,i=(t.g+this.g)/2,s=(t.b+this.b)/2,r=(t.a+this.a)/2;return new at(e,i,s,r)}equal(t){return this.toString()===t.toString()}toString(t="rgb"){switch(t){case"rgb":return this.toRGBA();case"hsl":return this.toHSLA();case"hex":return this.toHex();default:throw new Error("Invalid Color format")}}_componentToHex(t){const e=t.toString(16);return 1===e.length?"0"+e:e}toHex(){return"#"+this._componentToHex(this.r)+this._componentToHex(this.g)+this._componentToHex(this.b)}toRGBA(){const t=String(this.r.toFixed(0))+", "+String(this.g.toFixed(0))+", "+String(this.b.toFixed(0));return void 0!==this.a||null!==this.a?"rgba("+t+", "+String(this.a)+")":"rgb("+t+")"}toHSLA(){return ht.fromRGBA(this.r,this.g,this.b,this.a).toString()}fillStyle(){return this.toString()}clone(){return new at(this.r,this.g,this.b,this.a)}static get Black(){return at.fromHex("#000000")}static get White(){return at.fromHex("#FFFFFF")}static get Gray(){return at.fromHex("#808080")}static get LightGray(){return at.fromHex("#D3D3D3")}static get DarkGray(){return at.fromHex("#A9A9A9")}static get Yellow(){return at.fromHex("#FFFF00")}static get Orange(){return at.fromHex("#FFA500")}static get Red(){return at.fromHex("#FF0000")}static get Vermilion(){return at.fromHex("#FF5B31")}static get Vermillion(){return at.Vermilion}static get Rose(){return at.fromHex("#FF007F")}static get Magenta(){return at.fromHex("#FF00FF")}static get Violet(){return at.fromHex("#7F00FF")}static get Blue(){return at.fromHex("#0000FF")}static get Azure(){return at.fromHex("#007FFF")}static get Cyan(){return at.fromHex("#00FFFF")}static get Viridian(){return at.fromHex("#59978F")}static get Green(){return at.fromHex("#00FF00")}static get Chartreuse(){return at.fromHex("#7FFF00")}static get Transparent(){return at.fromHex("#FFFFFF00")}static get ExcaliburBlue(){return at.fromHex("#176BAA")}}ot([V({message:"Alias for incorrect spelling used in older versions, use multiply instead, will be removed in v0.25.0"})],at.prototype,"mulitiply",null),ot([V({message:"Alias for incorrect spelling used in older versions",alternateMethod:"Vermilion"})],at,"Vermillion",null);class ht{constructor(t,e,i,s){this.h=t,this.s=e,this.l=i,this.a=s}static hue2rgb(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}static fromRGBA(t,e,i,s){t/=255,e/=255,i/=255;const r=Math.max(t,e,i),n=Math.min(t,e,i);let o,a;const h=(r+n)/2;if(r===n)o=a=0;else{const s=r-n;switch(a=h>.5?s/(2-r-n):s/(r+n),r){case t:o=(e-i)/s+(e<i?6:0);break;case e:o=(i-t)/s+2;break;case i:o=(t-e)/s+4}o/=6}return new ht(o,a,h,s)}toRGBA(){let t,e,i;if(0===this.s)t=e=i=this.l;else{const s=this.l<.5?this.l*(1+this.s):this.l+this.s-this.l*this.s,r=2*this.l-s;t=ht.hue2rgb(r,s,this.h+1/3),e=ht.hue2rgb(r,s,this.h),i=ht.hue2rgb(r,s,this.h-1/3)}return new at(255*t,255*e,255*i,this.a)}toString(){return`hsla(${this.h.toFixed(0)}, ${this.s.toFixed(0)}, ${this.l.toFixed(0)}, ${this.a.toFixed(0)})`}}(st=$||($={}))[st.Box=0]="Box",st[st.RigidBody=1]="RigidBody",function(t){t[t.Naive=0]="Naive",t[t.DynamicAABBTree=1]="DynamicAABBTree"}(J||(J={})),function(t){t[t.Euler=0]="Euler"}(tt||(tt={}));class lt{static useBoxPhysics(){lt.collisionResolutionStrategy=$.Box}static useRigidBodyPhysics(){lt.collisionResolutionStrategy=$.RigidBody}static get dynamicTreeVelocityMultiplyer(){return lt.dynamicTreeVelocityMultiplier}static set dynamicTreeVelocityMultiplyer(t){lt.dynamicTreeVelocityMultiplier=t}}lt.acc=new X(0,0),lt.enabled=!0,lt.collisionPasses=5,lt.broadphaseStrategy=J.DynamicAABBTree,lt.broadphaseDebug=!1,lt.showCollisionNormals=!1,lt.showMotionVectors=!1,lt.showBounds=!1,lt.showArea=!1,lt.showContacts=!1,lt.showNormals=!1,lt.collisionResolutionStrategy=$.Box,lt.defaultMass=10,lt.integrator=tt.Euler,lt.integrationSteps=1,lt.allowRigidBodyRotation=!0,lt.collisionShift=.001,lt.dynamicTreeVelocityMultiplier=2,lt.boundsPadding=5,lt.surfaceEpsilon=.1,lt.checkForFastBodies=!0,lt.disableMinimumSpeedForFastBody=!1,function(t,e,i,s){var r,n=arguments.length,o=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(o=(n<3?r(o):n>3?r(e,i,o):r(e,i))||o);n>3&&o&&Object.defineProperty(e,i,o)}([V({message:"Alias for incorrect spelling used in older versions, will be removed in v0.25.0",alternateMethod:"dynamicTreeVelocityMultiplier"})],lt,"dynamicTreeVelocityMultiplyer",null),(rt=et||(et={})).Kill="kill",rt.PreKill="prekill",rt.PostKill="postkill",rt.PreDraw="predraw",rt.PostDraw="postdraw",rt.PreDebugDraw="predebugdraw",rt.PostDebugDraw="postdebugdraw",rt.PreUpdate="preupdate",rt.PostUpdate="postupdate",rt.PreFrame="preframe",rt.PostFrame="postframe",rt.PreCollision="precollision",rt.CollisionStart="collisionstart",rt.CollisionEnd="collisionend",rt.PostCollision="postcollision",rt.Initialize="initialize",rt.Activate="activate",rt.Deactivate="deactivate",rt.ExitViewport="exitviewport",rt.EnterViewport="enterviewport",rt.ExitTrigger="exit",rt.EnterTrigger="enter",rt.Connect="connect",rt.Disconnect="disconnect",rt.Button="button",rt.Axis="axis",rt.Subscribe="subscribe",rt.Unsubscribe="unsubscribe",rt.Visible="visible",rt.Hidden="hidden",rt.Start="start",rt.Stop="stop",rt.PointerUp="pointerup",rt.PointerDown="pointerdown",rt.PointerMove="pointermove",rt.PointerEnter="pointerenter",rt.PointerLeave="pointerleave",rt.PointerCancel="pointercancel",rt.PointerWheel="pointerwheel",rt.Up="up",rt.Down="down",rt.Move="move",rt.Enter="enter",rt.Leave="leave",rt.Cancel="cancel",rt.Wheel="wheel",rt.Press="press",rt.Release="release",rt.Hold="hold",rt.PointerDragStart="pointerdragstart",rt.PointerDragEnd="pointerdragend",rt.PointerDragEnter="pointerdragenter",rt.PointerDragLeave="pointerdragleave",rt.PointerDragMove="pointerdragmove";class ct{constructor(){this._bubbles=!0}get bubbles(){return this._bubbles}set bubbles(t){this._bubbles=t}stopPropagation(){this.bubbles=!1}}class dt extends ct{constructor(t){super(),this.target=t}}class ut extends ct{constructor(t){super(),this.target=t}}class pt extends ct{constructor(t){super(),this.target=t}}class gt extends ct{constructor(t){super(),this.target=t}}class _t extends ct{constructor(t){super(),this.target=t}}class ft extends ct{constructor(t,e,i){super(),this.ctx=t,this.delta=e,this.target=i}}class mt extends ct{constructor(t,e,i){super(),this.ctx=t,this.delta=e,this.target=i}}class yt extends ct{constructor(t,e){super(),this.ctx=t,this.target=e}}class wt extends ct{constructor(t,e){super(),this.ctx=t,this.target=e}}class vt extends ct{constructor(t,e,i){super(),this.engine=t,this.delta=e,this.target=i}}class bt extends ct{constructor(t,e,i){super(),this.engine=t,this.delta=e,this.target=i}}class xt extends ct{constructor(t,e){super(),this.engine=t,this.prevStats=e,this.target=t}}class At extends ct{constructor(t,e){super(),this.engine=t,this.stats=e,this.target=t}}class St extends ct{constructor(t,e){super(),this.index=t,this.gamepad=e,this.target=e}}class Pt extends ct{constructor(t,e){super(),this.index=t,this.gamepad=e,this.target=e}}class Ct extends ct{constructor(t,e,i){super(),this.button=t,this.value=e,this.target=i}}class Et extends ct{constructor(t,e,i){super(),this.axis=t,this.value=e,this.target=i}}class Tt extends ct{constructor(t,e){super(),this.topic=t,this.handler=e}}class Dt extends ct{constructor(t,e){super(),this.topic=t,this.handler=e}}class Rt extends ct{constructor(t){super(),this.target=t}}class Bt extends ct{constructor(t){super(),this.target=t}}class Mt extends ct{constructor(t,e,i,s){super(),this.other=e,this.side=i,this.intersection=s,this.target=t}get actor(){return this.target}set actor(t){this.target=t}}class kt extends ct{constructor(t,e,i,s){super(),this.other=e,this.side=i,this.intersection=s,this.target=t}get actor(){return this.target}set actor(t){this.target=t}}class Ot extends ct{constructor(t,e,i){super(),this.other=e,this.pair=i,this.target=t}get actor(){return this.target}set actor(t){this.target=t}}class Ft extends ct{constructor(t,e){super(),this.other=e,this.target=t}get actor(){return this.target}set actor(t){this.target=t}}class It extends ct{constructor(t,e){super(),this.engine=t,this.target=e}}class Lt extends ct{constructor(t,e){super(),this.oldScene=t,this.target=e}}class zt extends ct{constructor(t,e){super(),this.newScene=t,this.target=e}}class Ut extends ct{constructor(t){super(),this.target=t}}class Wt extends ct{constructor(t){super(),this.target=t}}class Ht extends ct{constructor(t,e){super(),this.target=t,this.actor=e}}class Nt extends ct{constructor(t,e){super(),this.target=t,this.actor=e}}(nt=it||(it={})).PreventCollision="PreventCollision",nt.Passive="Passive",nt.Active="Active",nt.Fixed="Fixed";class jt{constructor(t,e,i,s,r){this.colliderA=t,this.colliderB=e,this.mtv=i,this.point=s,this.normal=r}resolve(t){if(t===$.RigidBody)this._resolveRigidBodyCollision();else{if(t!==$.Box)throw new Error("Unknown collision resolution strategy");this._resolveBoxCollision()}}_applyBoxImpulse(t,e,i){if(t.type===it.Active&&e.type!==it.Passive){t.type===it.Active&&e.type===it.Active&&(i=i.scale(.5)),t.body.pos=t.body.pos.add(i);const s=i.normalize();if(s.dot(t.body.vel)<0){const e=s.scale(s.dot(t.body.vel.negate()));t.body.vel=t.body.vel.add(e)}t.emit("postcollision",new kt(t,e,I(i),i))}}_resolveBoxCollision(){const t=I(this.mtv),e=this.mtv.negate();this.colliderA.emit("precollision",new Mt(this.colliderA,this.colliderB,t,e)),this.colliderB.emit("precollision",new Mt(this.colliderB,this.colliderA,F(t),e.negate())),this._applyBoxImpulse(this.colliderA,this.colliderB,e),this._applyBoxImpulse(this.colliderB,this.colliderA,e.negate())}_resolveRigidBodyCollision(){const t=this.colliderA.body,e=this.colliderB.body,i=this.mtv;let s=this.normal;if(t===e)return;const r=I(this.mtv);if(this.colliderA.emit("precollision",new Mt(this.colliderA,this.colliderB,r,this.mtv)),this.colliderB.emit("precollision",new Mt(this.colliderB,this.colliderA,F(r),this.mtv.negate())),this.colliderA.type===it.Passive||this.colliderB.type===it.Passive)return;const n=this.colliderA.type===it.Fixed?0:1/this.colliderA.mass,o=this.colliderB.type===it.Fixed?0:1/this.colliderB.mass,a=this.colliderA.type===it.Fixed?0:1/this.colliderA.inertia,h=this.colliderB.type===it.Fixed?0:1/this.colliderB.inertia,l=Math.min(this.colliderA.bounciness,this.colliderB.bounciness),c=Math.min(this.colliderA.friction,this.colliderB.friction);s=s.normalize();const d=s.normal().normalize(),u=this.point.sub(this.colliderA.center),p=this.point.sub(this.colliderB.center),g=e.vel.add(p.cross(-e.rx)).sub(t.vel.sub(u.cross(t.rx))),_=g.dot(s),f=g.dot(d),m=u.dot(d),y=u.dot(s),w=p.dot(d),v=p.dot(s);if(_>0)return;const b=-(1+l)*_/(n+o+a*m*m+h*w*w);if(this.colliderA.type===it.Fixed?(e.vel=e.vel.add(s.scale(b*o)),lt.allowRigidBodyRotation&&(e.rx-=b*h*-p.cross(s)),e.addMtv(i)):this.colliderB.type===it.Fixed?(t.vel=t.vel.sub(s.scale(b*n)),lt.allowRigidBodyRotation&&(t.rx+=b*a*-u.cross(s)),t.addMtv(i.negate())):(e.vel=e.vel.add(s.scale(b*o)),t.vel=t.vel.sub(s.scale(b*n)),lt.allowRigidBodyRotation&&(e.rx-=b*h*-p.cross(s),t.rx+=b*a*-u.cross(s)),e.addMtv(i.scale(.5)),t.addMtv(i.scale(-.5))),c&&f){const i=g.sub(s.scale(g.dot(s))).normalize(),r=g.dot(i)/(n+o+y*y*a+v*v*h);let l=new X(0,0);l=Math.abs(r)<=b*c?i.scale(r).negate():i.scale(-b*c),this.colliderA.type===it.Fixed?(e.vel=e.vel.add(l.scale(o)),lt.allowRigidBodyRotation&&(e.rx+=l.dot(i)*h*p.cross(i))):this.colliderB.type===it.Fixed?(t.vel=t.vel.sub(l.scale(n)),lt.allowRigidBodyRotation&&(t.rx-=l.dot(i)*a*u.cross(i))):(e.vel=e.vel.add(l.scale(o)),t.vel=t.vel.sub(l.scale(n)),lt.allowRigidBodyRotation&&(e.rx+=l.dot(i)*h*p.cross(i),t.rx-=l.dot(i)*a*u.cross(i)))}this.colliderA.emit("postcollision",new kt(this.colliderA,this.colliderB,r,this.mtv)),this.colliderB.emit("postcollision",new kt(this.colliderB,this.colliderA,F(r),this.mtv.negate()))}}const Gt={CollideCircleCircle(t,e){const i=t.radius+e.radius,s=t.worldPos,r=e.worldPos;if(s.distance(r)>i)return null;const n=r.sub(s).normalize(),o=n.scale(i-r.distance(s)),a=t.getFurthestPoint(n);return new jt(t.collider,e.collider,o,a,n)},CollideCirclePolygon(t,e){let i=t.testSeparatingAxisTheorem(e);if(!i)return null;const s=i.dot(e.center.sub(t.center));i=s<0?i.negate():i;const r=[],n=e.getFurthestPoint(i.negate()),o=t.getFurthestPoint(i);return t.contains(n)&&r.push(n),e.contains(o)&&r.push(o),0===r.length?null:new jt(t.collider,e.collider,i,2===r.length?r[0].average(r[1]):r[0],i.normalize())},CollideCircleEdge(t,e){const i=t.center,s=e.end.sub(e.begin),r=s.dot(e.end.sub(i)),n=s.dot(i.sub(e.begin));if(n<=0){const s=e.begin.sub(i),r=s.dot(s);return r>t.radius*t.radius?null:new jt(t.collider,e.collider,s.normalize().scale(t.radius-Math.sqrt(r)),e.begin,s.normalize())}if(r<=0){const s=e.end.sub(i),r=s.dot(s);return r>t.radius*t.radius?null:new jt(t.collider,e.collider,s.normalize().scale(t.radius-Math.sqrt(r)),e.end,s.normalize())}const o=s.dot(s),a=e.begin.scale(r).add(e.end.scale(n)).scale(1/o),h=i.sub(a),l=h.dot(h);if(l>t.radius*t.radius)return null;let c=s.perpendicular();c.dot(i.sub(e.begin))<0&&(c=Q(-c.x,-c.y)),c=c.normalize();const d=c.scale(Math.abs(t.radius-Math.sqrt(l)));return new jt(t.collider,e.collider,d.negate(),a,c.negate())},CollideEdgeEdge:()=>null,CollidePolygonEdge(t,e){let i=e.end.sub(e.begin).normal();if(t.contains(e.begin)){const{distance:i,face:s}=t.getClosestFace(e.begin);if(i)return new jt(t.collider,e.collider,i.negate(),e.begin.add(i.negate()),s.normal().negate())}if(t.contains(e.end)){const{distance:i,face:s}=t.getClosestFace(e.end);if(i)return new jt(t.collider,e.collider,i.negate(),e.end.add(i.negate()),s.normal().negate())}const s=t.center,r=e.center.sub(s).normalize(),n=new Yt({collider:e.collider,points:[e.begin,e.end,e.end.add(r.scale(30)),e.begin.add(r.scale(30))]});let o=t.testSeparatingAxisTheorem(n);return o?(i=i.dot(r)<0?i.negate():i,o=o.dot(r)<0?o.negate():o,new jt(t.collider,e.collider,o,t.getFurthestPoint(i),i)):null},CollidePolygonPolygon(t,e){let i=t.testSeparatingAxisTheorem(e);if(!i)return null;const s=i.dot(e.center.sub(t.center));i=s<0?i.negate():i;const r=[],n=t.getFurthestPoint(i),o=e.getFurthestPoint(i.negate());e.contains(n)&&r.push(n),t.contains(o)&&r.push(o),0===r.length&&r.push(o);const a=2===r.length?r[0].add(r[1]).scale(.5):r[0];return new jt(t.collider,e.collider,i,a,i.normalize())}};function Vt(t,e,i,s){const r=t.sub(i),n=e.dot(e),o=e.dot(s),a=s.dot(s),h=e.dot(r),l=s.dot(r),c=n*a-o*o;let d=c,u=c;if(0===c||c<=.01){const e=h/o;return new q(t,i.add(s.scale(e)))}let p=o*l-a*h,g=n*l-o*h;return p<0?(p=0,g=l,u=a):p>d&&(p=d,g=l+o,u=a),g<0?(g=0,-h<0?p=0:-h>n?p=d:(p=-h,d=n)):g>u&&(g=u,-h+o<0?p=0:-h+o>n?p=d:(p=-h+o,d=n)),p=Math.abs(p)<.001?0:p/d,g=Math.abs(g)<.001?0:g/u,new q(t.add(e.scale(p)),i.add(s.scale(g)))}const Xt={PolygonPolygonClosestLine(t,e){const i=e.worldPos,s=i.sub(t.worldPos),r=s.negate(),n=new K(t.worldPos,s),o=new K(i,r),a=t.rayCast(n).add(n.dir.scale(.1)),h=e.rayCast(o).add(o.dir.scale(.1)),l=t.getClosestFace(a),c=e.getClosestFace(h);return Vt(l.face.begin,l.face.getEdge(),c.face.begin,c.face.getEdge())},PolygonEdgeClosestLine(t,e){const i=e.worldPos.sub(t.worldPos),s=new K(t.worldPos,i),r=t.rayCast(s).add(s.dir.scale(.1)),n=t.getClosestFace(r),o=n.face.begin,a=n.face.getEdge(),h=e.asLine();return Vt(o,a,h.begin,h.getEdge())},PolygonCircleClosestLine(t,e){const i=e.worldPos,s=i.sub(t.worldPos),r=new K(t.worldPos,s.normalize()),n=t.rayCast(r).add(r.dir.scale(.1)),o=t.getClosestFace(n),a=o.face.begin,h=o.face.getEdge();let l=(h.x*(i.x-a.x)+h.y*(i.y-a.y))/(h.x*h.x+h.y*h.y);l>1?l=1:l<0&&(l=0);const c=Math.sqrt(Math.pow(a.x+h.x*l-i.x,2)+Math.pow(a.y+h.y*l-i.y,2))-e.radius,d=(a.x+h.x*l-i.x)*e.radius/(e.radius+c),u=(a.y+h.y*l-i.y)*e.radius/(e.radius+c);return new q(h.scale(l).add(a),new X(i.x+d,i.y+u))},CircleCircleClosestLine(t,e){const i=e.worldPos.sub(t.worldPos),s=t.worldPos.sub(e.worldPos),r=new K(t.worldPos,i),n=new K(e.worldPos,s),o=t.rayCast(r),a=e.rayCast(n);return new q(o,a)},CircleEdgeClosestLine(t,e){const i=t.worldPos,s=e.asLine(),r=s.begin,n=s.getEdge();let o=(n.x*(i.x-r.x)+n.y*(i.y-r.y))/(n.x*n.x+n.y*n.y);o>1?o=1:o<0&&(o=0);const a=Math.sqrt(Math.pow(r.x+n.x*o-i.x,2)+Math.pow(r.y+n.y*o-i.y,2))-t.radius,h=(r.x+n.x*o-i.x)*t.radius/(t.radius+a),l=(r.y+n.y*o-i.y)*t.radius/(t.radius+a);return new q(n.scale(o).add(r),new X(i.x+h,i.y+l))},EdgeEdgeClosestLine(t,e){const i=t.asLine(),s=i.begin,r=i.getEdge(),n=e.asLine();return Vt(s,r,n.begin,n.getEdge())}};class Kt{constructor(t){this.offset=X.Zero,this.offset=t.offset||X.Zero,this.radius=t.radius||0,this.collider=t.collider||null}get worldPos(){return this.collider&&this.collider.body?this.collider.body.pos.add(this.offset):this.offset}clone(){return new Kt({offset:this.offset.clone(),radius:this.radius,collider:null})}get center(){return this.collider&&this.collider.body?this.offset.add(this.collider.body.pos):this.offset}contains(t){let e=this.offset;return this.collider&&this.collider.body&&(e=this.collider.body.pos),e.distance(t)<=this.radius}rayCast(t,e=1/0){const i=this.center,s=t.dir,r=t.pos,n=Math.sqrt(Math.pow(s.dot(r.sub(i)),2)-Math.pow(r.sub(i).distance(),2)+Math.pow(this.radius,2));if(n<0)return null;{let o=0;if(0===n)return o=-s.dot(r.sub(i)),o>0&&o<e?t.getPoint(o):null;{const o=-s.dot(r.sub(i))+n,a=-s.dot(r.sub(i))-n,h=[];o>=0&&h.push(o),a>=0&&h.push(a);const l=Math.min(...h);return l<=e?t.getPoint(l):null}}}getClosestLineBetween(t){if(t instanceof Kt)return Xt.CircleCircleClosestLine(this,t);if(t instanceof Yt)return Xt.PolygonCircleClosestLine(t,this).flip();if(t instanceof qt)return Xt.CircleEdgeClosestLine(this,t).flip();throw new Error("Polygon could not collide with unknown CollisionShape "+typeof t)}collide(t){if(t instanceof Kt)return Gt.CollideCircleCircle(this,t);if(t instanceof Yt)return Gt.CollideCirclePolygon(this,t);if(t instanceof qt)return Gt.CollideCircleEdge(this,t);throw new Error("Circle could not collide with unknown CollisionShape "+typeof t)}getFurthestPoint(t){return this.center.add(t.normalize().scale(this.radius))}get bounds(){let t=X.Zero;return this.collider&&this.collider.body&&(t=this.collider.body.pos),new Zt(this.offset.x+t.x-this.radius,this.offset.y+t.y-this.radius,this.offset.x+t.x+this.radius,this.offset.y+t.y+this.radius)}get localBounds(){return new Zt(this.offset.x-this.radius,this.offset.y-this.radius,this.offset.x+this.radius,this.offset.y+this.radius)}get axes(){return null}get inertia(){return(this.collider?this.collider.mass:lt.defaultMass)*this.radius*this.radius/2}testSeparatingAxisTheorem(t){const e=t.axes,i=t.center,s=t.getFurthestPoint(this.offset.sub(i));e.push(this.offset.sub(s).normalize());let r=Number.MAX_VALUE,n=null,o=-1;for(let i=0;i<e.length;i++){const s=t.project(e[i]),a=this.project(e[i]),h=s.getOverlap(a);if(h<=0)return null;h<r&&(r=h,n=e[i],o=i)}return o<0?null:n.normalize().scale(r)}recalc(){}project(t){const e=[],i=this.center.dot(t);return e.push(i),e.push(i+this.radius),e.push(i-this.radius),new Y(Math.min.apply(Math,e),Math.max.apply(Math,e))}draw(t,e=at.Green,i=X.Zero){const s=i.add(this.offset);t.beginPath(),t.fillStyle=e.toString(),t.arc(s.x,s.y,this.radius,0,2*Math.PI),t.closePath(),t.fill()}debugDraw(t,e=at.Green){const i=this.collider.body,s=i?i.pos.add(this.offset):this.offset,r=i?i.rotation:0;t.beginPath(),t.strokeStyle=e.toString(),t.arc(s.x,s.y,this.radius,0,2*Math.PI),t.closePath(),t.stroke(),t.beginPath(),t.moveTo(s.x,s.y),t.lineTo(Math.cos(r)*this.radius+s.x,Math.sin(r)*this.radius+s.y),t.closePath(),t.stroke()}}class qt{constructor(t){this.begin=t.begin||X.Zero,this.end=t.end||X.Zero,this.collider=t.collider||null,this.offset=this.center}clone(){return new qt({begin:this.begin.clone(),end:this.end.clone(),collider:null})}get worldPos(){return this.collider&&this.collider.body?this.collider.body.pos.add(this.offset):this.offset}get center(){return this.begin.average(this.end).add(this._getBodyPos())}_getBodyPos(){let t=X.Zero;return this.collider&&this.collider.body&&(t=this.collider.body.pos),t}_getTransformedBegin(){const t=this.collider?this.collider.body:null,e=t?t.rotation:0;return this.begin.rotate(e).add(this._getBodyPos())}_getTransformedEnd(){const t=this.collider?this.collider.body:null,e=t?t.rotation:0;return this.end.rotate(e).add(this._getBodyPos())}getSlope(){const t=this._getTransformedBegin(),e=this._getTransformedEnd(),i=t.distance(e);return e.sub(t).scale(1/i)}getLength(){const t=this._getTransformedBegin(),e=this._getTransformedEnd();return t.distance(e)}contains(){return!1}rayCast(t,e=1/0){const i=this._getTransformedBegin().sub(t.pos);if(0===t.dir.cross(this.getSlope())&&0!==i.cross(t.dir))return null;const s=t.dir.cross(this.getSlope());if(0===s)return null;const r=i.cross(this.getSlope())/s;if(r>=0&&r<=e){const e=i.cross(t.dir)/s/this.getLength();if(e>=0&&e<=1)return t.getPoint(r)}return null}getClosestLineBetween(t){if(t instanceof Kt)return Xt.CircleEdgeClosestLine(t,this);if(t instanceof Yt)return Xt.PolygonEdgeClosestLine(t,this).flip();if(t instanceof qt)return Xt.EdgeEdgeClosestLine(this,t);throw new Error("Polygon could not collide with unknown CollisionShape "+typeof t)}collide(t){if(t instanceof Kt)return Gt.CollideCircleEdge(t,this);if(t instanceof Yt)return Gt.CollidePolygonEdge(t,this);if(t instanceof qt)return Gt.CollideEdgeEdge();throw new Error("Edge could not collide with unknown CollisionShape "+typeof t)}getFurthestPoint(t){const e=this._getTransformedBegin(),i=this._getTransformedEnd();return t.dot(e)>0?e:i}_boundsFromBeginEnd(t,e){return new Zt(Math.min(t.x,e.x),Math.min(t.y,e.y),Math.max(t.x,e.x),Math.max(t.y,e.y))}get bounds(){const t=this._getTransformedBegin(),e=this._getTransformedEnd();return this._boundsFromBeginEnd(t,e)}get localBounds(){return this._boundsFromBeginEnd(this.begin,this.end)}asLine(){return new q(this._getTransformedBegin(),this._getTransformedEnd())}asLocalLine(){return new q(this.begin,this.end)}get axes(){const t=this._getTransformedEnd().sub(this._getTransformedBegin()).normal(),e=[];return e.push(t),e.push(t.negate()),e.push(t.normal()),e.push(t.normal().negate()),e}get inertia(){const t=this.collider?this.collider.mass:lt.defaultMass,e=this.end.sub(this.begin).distance()/2;return t*e*e}recalc(){}project(t){const e=[],i=[this._getTransformedBegin(),this._getTransformedEnd()],s=i.length;for(let r=0;r<s;r++)e.push(i[r].dot(t));return new Y(Math.min.apply(Math,e),Math.max.apply(Math,e))}draw(t,e=at.Green,i=X.Zero){const s=this.begin.add(i),r=this.end.add(i);t.strokeStyle=e.toString(),t.beginPath(),t.moveTo(s.x,s.y),t.lineTo(r.x,r.y),t.closePath(),t.stroke()}debugDraw(t,e=at.Red){const i=this._getTransformedBegin(),s=this._getTransformedEnd();t.strokeStyle=e.toString(),t.beginPath(),t.moveTo(i.x,i.y),t.lineTo(s.x,s.y),t.closePath(),t.stroke()}}class Yt{constructor(t){this._transformedPoints=[],this._axes=[],this._sides=[],this.offset=t.offset||X.Zero;const e=!!t.clockwiseWinding;this.points=(e?t.points.reverse():t.points)||[],this.collider=this.collider=t.collider||null,this._calculateTransformation()}clone(){return new Yt({offset:this.offset.clone(),points:this.points.map((t=>t.clone())),collider:null})}get worldPos(){return this.collider&&this.collider.body?this.collider.body.pos.add(this.offset):this.offset}get center(){const t=this.collider?this.collider.body:null;return t?t.pos.add(this.offset):this.offset}_calculateTransformation(){const t=this.collider?this.collider.body:null,e=t?t.pos.add(this.offset):this.offset,i=t?t.rotation:0,s=t?t.scale:X.One,r=this.points.length;this._transformedPoints.length=0;for(let t=0;t<r;t++)this._transformedPoints[t]=this.points[t].scale(s).rotate(i).add(e)}getTransformedPoints(){return this._transformedPoints.length&&(!this.collider||!this.collider.body||this.collider.body.oldPos.equals(this.collider.body.pos)&&this.collider.body.oldRotation===this.collider.body.rotation&&this.collider.body.oldScale===this.collider.body.scale)||this._calculateTransformation(),this._transformedPoints}getSides(){if(this._sides.length)return this._sides;const t=[],e=this.getTransformedPoints(),i=e.length;for(let s=0;s<i;s++)t.push(new q(e[s],e[(s-1+i)%i]));return this._sides=t,this._sides}recalc(){this._sides.length=0,this._axes.length=0,this._transformedPoints.length=0,this.getTransformedPoints(),this.getSides()}contains(t){const e=new K(t,new X(1,0));return this.getSides().reduce((function(t,i){return e.intersect(i)>=0?t+1:t}),0)%2!=0}getClosestLineBetween(t){if(t instanceof Kt)return Xt.PolygonCircleClosestLine(this,t);if(t instanceof Yt)return Xt.PolygonPolygonClosestLine(this,t);if(t instanceof qt)return Xt.PolygonEdgeClosestLine(this,t);throw new Error("Polygon could not collide with unknown CollisionShape "+typeof t)}collide(t){if(t instanceof Kt)return Gt.CollideCirclePolygon(t,this);if(t instanceof Yt)return Gt.CollidePolygonPolygon(this,t);if(t instanceof qt)return Gt.CollidePolygonEdge(this,t);throw new Error("Polygon could not collide with unknown CollisionShape "+typeof t)}getFurthestPoint(t){const e=this.getTransformedPoints();let i=null,s=-Number.MAX_VALUE;for(let r=0;r<e.length;r++){const n=t.dot(e[r]);n>s&&(s=n,i=e[r])}return i}getClosestFace(t){const e=this.getSides();let i=Number.POSITIVE_INFINITY,s=-1,r=-1;for(let n=0;n<e.length;n++){const o=e[n].distanceToPoint(t);o<i&&(i=o,s=n,r=o)}return-1!==s?{distance:e[s].normal().scale(r),face:e[s]}:null}get bounds(){const t=this.getTransformedPoints();return Zt.fromPoints(t)}get localBounds(){return Zt.fromPoints(this.points)}get inertia(){const t=this.collider?this.collider.mass:lt.defaultMass;let e=0,i=0;for(let t=0;t<this.points.length;t++){const s=(t+1)%this.points.length,r=this.points[s].cross(this.points[t]);e+=r*(this.points[t].dot(this.points[t])+this.points[t].dot(this.points[s])+this.points[s].dot(this.points[s])),i+=r}return t/6*(e/i)}rayCast(t,e=1/0){const i=this.getSides(),s=i.length;let r=Number.MAX_VALUE,n=-1;for(let o=0;o<s;o++){const s=t.intersect(i[o]);s>=0&&s<r&&s<=e&&(r=s,n=o)}return n>=0?t.getPoint(r):null}get axes(){if(this._axes.length)return this._axes;const t=[],e=this.getTransformedPoints(),i=e.length;for(let s=0;s<i;s++)t.push(e[s].sub(e[(s+1)%i]).normal());return this._axes=t,this._axes}testSeparatingAxisTheorem(t){const e=this,i=t,s=e.axes.concat(i.axes);let r=Number.MAX_VALUE,n=null,o=-1;for(let t=0;t<s.length;t++){const a=e.project(s[t]),h=i.project(s[t]),l=a.getOverlap(h);if(l<=0)return null;l<r&&(r=l,n=s[t],o=t)}return-1===o?null:n.normalize().scale(r)}project(t){const e=this.getTransformedPoints(),i=e.length;let s=Number.MAX_VALUE,r=-Number.MAX_VALUE;for(let n=0;n<i;n++){const i=e[n].dot(t);s=Math.min(s,i),r=Math.max(r,i)}return new Y(s,r)}draw(t,e=at.Green,i=X.Zero){const s=i.add(this.offset);t.beginPath(),t.fillStyle=e.toString(),t.moveTo(s.x,s.y);const r=this.points[0].sub(s);this.points.map((t=>t.sub(r))).forEach((function(e){t.lineTo(e.x,e.y)})),t.lineTo(s.x,s.y),t.closePath(),t.fill()}debugDraw(t,e=at.Red){t.beginPath(),t.strokeStyle=e.toString();const i=this.getTransformedPoints()[0];t.moveTo(i.x,i.y),this.getTransformedPoints().forEach((function(e){t.lineTo(e.x,e.y)})),t.lineTo(i.x,i.y),t.closePath(),t.stroke()}}class Zt{constructor(t=0,e=0,i=0,s=0){"object"==typeof t?(this.left=t.left,this.top=t.top,this.right=t.right,this.bottom=t.bottom):"number"==typeof t&&(this.left=t,this.top=e,this.right=i,this.bottom=s)}static getSideFromIntersection(t){return t&&t?Math.abs(t.x)>Math.abs(t.y)?t.x<0?u.Right:u.Left:t.y<0?u.Bottom:u.Top:u.None}static fromPoints(t){let e=1/0,i=1/0,s=-1/0,r=-1/0;for(let n=0;n<t.length;n++)t[n].x<e&&(e=t[n].x),t[n].x>s&&(s=t[n].x),t[n].y<i&&(i=t[n].y),t[n].y>r&&(r=t[n].y);return new Zt(e,i,s,r)}static fromDimension(t,e,i=X.Half,s=X.Zero){return new Zt(-t*i.x+s.x,-e*i.y+s.y,t-t*i.x+s.x,e-e*i.y+s.y)}get width(){return this.right-this.left}get height(){return this.bottom-this.top}hasZeroDimensions(){return 0===this.width||0===this.height}get center(){return new X((this.left+this.right)/2,(this.top+this.bottom)/2)}translate(t){return new Zt(this.left+t.x,this.top+t.y,this.right+t.x,this.bottom+t.y)}rotate(t,e=X.Zero){const i=this.getPoints().map((i=>i.rotate(t,e)));return Zt.fromPoints(i)}scale(t,e=X.Zero){const i=this.translate(e);return new Zt(i.left*t.x,i.top*t.y,i.right*t.x,i.bottom*t.y)}transform(t){const e=this.getPoints().map((e=>t.multv(e)));return Zt.fromPoints(e)}getPerimeter(){return 2*(this.width+this.height)}getPoints(){const t=[];return t.push(new X(this.left,this.top)),t.push(new X(this.right,this.top)),t.push(new X(this.right,this.bottom)),t.push(new X(this.left,this.bottom)),t}toPolygon(t){let e=null;return t&&t.body&&t.body.collider&&(e=t.body.collider),new Yt({collider:e,points:this.getPoints(),offset:X.Zero})}rayCast(t,e=1/0){let i=-1/0,s=1/0;const r=0===t.dir.x?Number.MAX_VALUE:1/t.dir.x,n=0===t.dir.y?Number.MAX_VALUE:1/t.dir.y,o=(this.left-t.pos.x)*r,a=(this.right-t.pos.x)*r;i=Math.min(o,a),s=Math.max(o,a);const h=(this.top-t.pos.y)*n,l=(this.bottom-t.pos.y)*n;return i=Math.max(i,Math.min(h,l)),s=Math.min(s,Math.max(h,l)),s>=Math.max(0,i)&&i<e}rayCastTime(t,e=1/0){let i=-1/0,s=1/0;const r=0===t.dir.x?Number.MAX_VALUE:1/t.dir.x,n=0===t.dir.y?Number.MAX_VALUE:1/t.dir.y,o=(this.left-t.pos.x)*r,a=(this.right-t.pos.x)*r;i=Math.min(o,a),s=Math.max(o,a);const h=(this.top-t.pos.y)*n,l=(this.bottom-t.pos.y)*n;return i=Math.max(i,Math.min(h,l)),s=Math.min(s,Math.max(h,l)),s>=Math.max(0,i)&&i<e?i:-1}contains(t){return t instanceof X?this.left<=t.x&&this.top<=t.y&&this.bottom>=t.y&&this.right>=t.x:t instanceof Zt&&this.left<t.left&&this.top<t.top&&t.bottom<this.bottom&&t.right<this.right}combine(t){return new Zt(Math.min(this.left,t.left),Math.min(this.top,t.top),Math.max(this.right,t.right),Math.max(this.bottom,t.bottom))}get dimensions(){return new X(this.width,this.height)}intersect(t){const e=this.combine(t);if(e.width<t.width+this.width&&e.height<t.height+this.height&&!e.dimensions.equals(t.dimensions)&&!e.dimensions.equals(this.dimensions)){let e=0;e=this.right>=t.left&&this.right<=t.right?t.left-this.right:t.right-this.left;let i=0;return i=this.top<=t.bottom&&this.top>=t.top?t.bottom-this.top:t.top-this.bottom,Math.abs(e)<Math.abs(i)?new X(e,0):new X(0,i)}if(e.dimensions.equals(t.dimensions)||e.dimensions.equals(this.dimensions)){let e=0;e=this.width-t.width>=0?this.right-t.right<=t.left-this.left?t.left-this.right:t.right-this.left:t.right-this.right<=this.left-t.left?this.left-t.right:this.right-t.left;let i=0;return i=this.height-t.height>=0?this.bottom-t.bottom<=t.top-this.top?t.top-this.bottom:t.bottom-this.top:t.bottom-this.bottom<=this.top-t.top?this.top-t.bottom:this.bottom-t.top,Math.abs(e)<Math.abs(i)?new X(e,0):new X(0,i)}return null}intersectWithSide(t){const e=this.intersect(t);return Zt.getSideFromIntersection(e)}debugDraw(t,e=at.Yellow){t.strokeStyle=e.toString(),t.strokeRect(this.left,this.top,this.width,this.height)}draw(t,e=at.Yellow){t.debug.drawRect(this.left,this.top,this.width,this.height,{color:e})}}var Qt,$t;($t=Qt||(Qt={})).Fit="Fit",$t.Fill="Fill",$t.Fixed="Fixed",$t.Position="Position",$t.Container="Container";class Jt{static get SVGA(){return{width:800,height:600}}static get Standard(){return{width:1920,height:1080}}static get Atari2600(){return{width:160,height:192}}static get GameBoy(){return{width:160,height:144}}static get GameBoyAdvance(){return{width:240,height:160}}static get NintendoDS(){return{width:256,height:192}}static get NES(){return{width:256,height:224}}static get SNES(){return{width:256,height:244}}}class te{constructor(t){var e,i,s;this._antialiasing=!0,this._resolutionStack=[],this._viewportStack=[],this._pixelRatioOverride=null,this._isFullScreen=!1,this._isDisposed=!1,this._logger=m.getInstance(),this._fullscreenChangeHandler=()=>{this._isFullScreen=!this._isFullScreen,this._logger.debug("Fullscreen Change",this._isFullScreen)},this._pixelRatioChangeHandler=()=>{this._logger.debug("Pixel Ratio Change",window.devicePixelRatio),this._devicePixelRatio=this._calculateDevicePixelRatio(),this.applyResolutionAndViewport()},this._windowResizeHandler=()=>{const t=this.displayMode===Qt.Container?this.canvas.parentElement||document.body:window;this._logger.debug("View port resized"),this._setResolutionAndViewportByDisplayMode(t),this.applyResolutionAndViewport()},this._devicePixelRatio=this._calculateDevicePixelRatio(),this.viewport=t.viewport,this.resolution=null!==(e=t.resolution)&&void 0!==e?e:Object.assign({},this.viewport),this._displayMode=null!==(i=t.displayMode)&&void 0!==i?i:Qt.Fixed,this._canvas=t.canvas,this._ctx=t.context,this._antialiasing=null!==(s=t.antialiasing)&&void 0!==s?s:this._antialiasing,this._browser=t.browser,this._position=t.position,this._pixelRatioOverride=t.pixelRatio,this._applyDisplayMode(),this._mediaQueryList=this._browser.window.nativeComponent.matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`),this._mediaQueryList.addEventListener("change",this._pixelRatioChangeHandler),this._canvas.addEventListener("fullscreenchange",this._fullscreenChangeHandler)}dispose(){this._isDisposed||(this._isDisposed=!0,this._browser.window.off("resize",this._windowResizeHandler),this._mediaQueryList.removeEventListener("change",this._pixelRatioChangeHandler),this._canvas.removeEventListener("fullscreenchange",this._fullscreenChangeHandler))}_calculateDevicePixelRatio(){return window.devicePixelRatio<1?1:window.devicePixelRatio||1}get pixelRatio(){return this._pixelRatioOverride?this._pixelRatioOverride:this._devicePixelRatio}get isHiDpi(){return 1!==this.pixelRatio}get displayMode(){return this._displayMode}get canvas(){return this._canvas}get resolution(){return this._resolution}set resolution(t){this._resolution=t}get viewport(){return this._viewport?this._viewport:this._resolution}set viewport(t){this._viewport=t}get aspectRatio(){return this._resolution.width/this._resolution.height}get scaledWidth(){return this._resolution.width*this.pixelRatio}get scaledHeight(){return this._resolution.height*this.pixelRatio}setCurrentCamera(t){this._camera=t}pushResolutionAndViewport(){this._resolutionStack.push(this.resolution),this._viewportStack.push(this.viewport),this.resolution=Object.assign({},this.resolution),this.viewport=Object.assign({},this.viewport)}popResolutionAndViewport(){this.resolution=this._resolutionStack.pop(),this.viewport=this._viewportStack.pop()}applyResolutionAndViewport(){this._canvas.width=this.scaledWidth,this._canvas.height=this.scaledHeight,this._antialiasing?this._canvas.style.imageRendering="auto":(this._canvas.style.imageRendering="pixelated",""===this._canvas.style.imageRendering&&(this._canvas.style.imageRendering="crisp-edges")),this._canvas.style.width=this.viewport.width+"px",this._canvas.style.height=this.viewport.height+"px",this._ctx.updateViewport(),this._ctx.resetTransform(),this._ctx.scale(this.pixelRatio,this.pixelRatio),this._ctx.smoothing=this._antialiasing}get antialiasing(){return this._antialiasing}set antialiasing(t){this._antialiasing=t,this._ctx.smoothing=this._antialiasing}get isFullScreen(){return this._isFullScreen}goFullScreen(){return this._canvas.requestFullscreen()}exitFullScreen(){return document.exitFullscreen()}pageToScreenCoordinates(t){let e=t.x,i=t.y;if(this._isFullScreen||(e-=B(this._canvas).x,i-=B(this._canvas).y),this._isFullScreen)if(window.innerWidth/this.aspectRatio<window.innerHeight){const t=window.innerWidth/this.aspectRatio;i=(i-(window.innerHeight-t)/2)/t*this.viewport.height,e=e/window.innerWidth*this.viewport.width}else{const t=window.innerHeight*this.aspectRatio;e=(e-(window.innerWidth-t)/2)/t*this.viewport.width,i=i/window.innerHeight*this.viewport.height}return e=e/this.viewport.width*this.resolution.width,i=i/this.viewport.height*this.resolution.height,new X(e,i)}screenToPageCoordinates(t){let e=t.x,i=t.y;if(e=e/this.resolution.width*this.viewport.width,i=i/this.resolution.height*this.viewport.height,this._isFullScreen)if(window.innerWidth/this.aspectRatio<window.innerHeight){const t=window.innerWidth/this.aspectRatio,s=(window.innerHeight-t)/2;i=i/this.viewport.height*t+s,e=e/this.viewport.width*window.innerWidth}else{const t=window.innerHeight*this.aspectRatio,s=(window.innerWidth-t)/2;e=e/this.viewport.width*t+s,i=i/this.viewport.height*window.innerHeight}return this._isFullScreen||(e+=B(this._canvas).x,i+=B(this._canvas).y),new X(e,i)}screenToWorldCoordinates(t){var e,i,s,r;let n=t.x,o=t.y;return n=n/this.resolution.width*this.drawWidth,o=o/this.resolution.height*this.drawHeight,n-=this.halfDrawWidth,o-=this.halfDrawHeight,n+=null!==(i=null===(e=this._camera)||void 0===e?void 0:e.x)&&void 0!==i?i:0,o+=null!==(r=null===(s=this._camera)||void 0===s?void 0:s.y)&&void 0!==r?r:0,new X(n,o)}worldToScreenCoordinates(t){var e,i,s,r;let n=t.x,o=t.y;return n-=null!==(i=null===(e=this._camera)||void 0===e?void 0:e.x)&&void 0!==i?i:0,o-=null!==(r=null===(s=this._camera)||void 0===s?void 0:s.y)&&void 0!==r?r:0,n+=this.halfDrawWidth,o+=this.halfDrawHeight,n=n/this.drawWidth*this.resolution.width,o=o/this.drawHeight*this.resolution.height,new X(n,o)}pageToWorldCoordinates(t){const e=this.pageToScreenCoordinates(t);return this.screenToWorldCoordinates(e)}worldToPageCoordinates(t){const e=this.worldToScreenCoordinates(t);return this.screenToPageCoordinates(e)}getWorldBounds(){const t=this.screenToWorldCoordinates(X.Zero).x,e=this.screenToWorldCoordinates(X.Zero).y,i=t+this.drawWidth,s=e+this.drawHeight;return new Zt(t,e,i,s)}get canvasWidth(){return this.canvas.width}get halfCanvasWidth(){return this.canvas.width/2}get canvasHeight(){return this.canvas.height}get halfCanvasHeight(){return this.canvas.height/2}get drawWidth(){return this._camera?this.scaledWidth/this._camera.zoom/this.pixelRatio:this.scaledWidth/this.pixelRatio}get halfDrawWidth(){return this.drawWidth/2}get drawHeight(){return this._camera?this.scaledHeight/this._camera.zoom/this.pixelRatio:this.scaledHeight/this.pixelRatio}get halfDrawHeight(){return this.drawHeight/2}_computeFit(){document.body.style.margin="0px",document.body.style.overflow="hidden";const t=this.aspectRatio;let e=0,i=0;window.innerWidth/t<window.innerHeight?(e=window.innerWidth,i=window.innerWidth/t):(e=window.innerHeight*t,i=window.innerHeight),this.viewport={width:e,height:i}}_applyDisplayMode(){if(this.displayMode===Qt.Fit||this.displayMode===Qt.Fill||this.displayMode===Qt.Container){const t=this.displayMode===Qt.Container?this.canvas.parentElement||document.body:window;this._setResolutionAndViewportByDisplayMode(t),this._browser.window.on("resize",this._windowResizeHandler)}else this.displayMode===Qt.Position&&this._initializeDisplayModePosition(this._position)}_setResolutionAndViewportByDisplayMode(t){this.displayMode===Qt.Container&&(this.resolution={width:t.clientWidth,height:t.clientHeight},this.viewport=this.resolution),this.displayMode===Qt.Fill&&(document.body.style.margin="0px",document.body.style.overflow="hidden",this.resolution={width:t.innerWidth,height:t.innerHeight},this.viewport=this.resolution),this.displayMode===Qt.Fit&&this._computeFit()}_initializeDisplayModePosition(t){if(!t)throw new Error("DisplayMode of Position was selected but no position option was given");if(this.canvas.style.display="block",this.canvas.style.position="absolute","string"==typeof t){const t=t654.split(" ");switch(t[0]){case"top":this.canvas.style.top="0px";break;case"bottom":this.canvas.style.bottom="0px";break;case"middle":this.canvas.style.top="50%";const t=-this.halfDrawHeight;this.canvas.style.marginTop=t.toString();break;default:throw new Error("Invalid Position Given")}if(t[1])switch(t[1]){case"left":this.canvas.style.left="0px";break;case"right":this.canvas.style.right="0px";break;case"center":this.canvas.style.left="50%";const t=-this.halfDrawWidth;this.canvas.style.marginLeft=t.toString();break;default:throw new Error("Invalid Position Given")}}else t.top&&("number"==typeof t.top?this.canvas.style.top=t.top.toString()+"px":this.canvas.style.top=t.top),t.right&&("number"==typeof t.right?this.canvas.style.right=t.right.toString()+"px":this.canvas.style.right=t.right),t.bottom&&("number"==typeof t.bottom?this.canvas.style.bottom=t.bottom.toString()+"px":this.canvas.style.bottom=t.bottom),t.left&&("number"==typeof t.left?this.canvas.style.left=t.left.toString()+"px":this.canvas.style.left=t.left)}}class ee{constructor(t){this._handlers={},this._wiredEventDispatchers=[],this._target=t}clear(){this._handlers={},this._wiredEventDispatchers=[]}emit(t,e){if(!t)return;t=t.toLowerCase();const i=this._target;e||(e=new ct);try{e.target=i}catch(t){}let s,r;if(this._handlers[t])for(s=0,r=this._handlers[t].length;s<r;s++)this._handlers[t][s].call(i,e);for(s=0,r=this._wiredEventDispatchers.length;s<r;s++)this._wiredEventDispatchers[s].emit(t,e)}on(t,e){t=t.toLowerCase(),this._handlers[t]||(this._handlers[t]=[]),this._handlers[t].push(e),"unsubscribe"!==t&&"subscribe"!==t&&this.emit("subscribe",new Tt(t,e))}off(t,e){t=t.toLowerCase();const i=this._handlers[t];if(i)if(e){const s=i.indexOf(e);this._handlers[t].splice(s,1)}else this._handlers[t].length=0;"unsubscribe"!==t&&"subscribe"!==t&&this.emit("unsubscribe",new Dt(t,e))}once(t,e){this.on(t,(i=>{const s=i||new ct;try{s.target=s.target||this._target}catch(t){}this.off(t,e),e.call(s.target,s)}))}wire(t){t._wiredEventDispatchers.push(this)}unwire(t){const e=t._wiredEventDispatchers.indexOf(this);e>-1&&t._wiredEventDispatchers.splice(e,1)}}class ie{constructor(t,e,i=!0){this.path=t,this.responseType=e,this.bustCache=i,this.data=null,this.logger=m.getInstance(),this.events=new ee(this)}isLoaded(){return null!==this.data}_cacheBust(t){return/\?\w*=\w*/.test(t)?t+="&__="+Date.now():t+="?__="+Date.now(),t}load(){return new Promise(((t,e)=>{if(null!==this.data)return this.logger.debug("Already have data for resource",this.path),this.events.emit("complete",this.data),void t(this.data);const i=new XMLHttpRequest;i.open("GET",this.bustCache?this._cacheBust(this.path):this.path,!0),i.responseType=this.responseType,i.addEventListener("loadstart",(t=>this.events.emit("loadstart",t))),i.addEventListener("progress",(t=>this.events.emit("progress",t))),i.addEventListener("error",(t=>this.events.emit("error",t))),i.addEventListener("load",(t=>this.events.emit("load",t))),i.addEventListener("load",(()=>{if(0!==i.status&&200!==i.status)return this.logger.error("Failed to load resource ",this.path," server responded with error code",i.status),this.events.emit("error",i.response),void e(i.response);this.data=i.response,this.events.emit("complete",this.data),this.logger.debug("Completed loading resource",this.path),t(this.data)})),i.send()}))}}var se=function(t,e,i,s){var r,n=arguments.length,o=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(o=(n<3?r(o):n>3?r(e,i,o):r(e,i))||o);return n>3&&o&&Object.defineProperty(e,i,o),o};let re=class{updatePixel(t,e,i){const s=4*(t+e*i.width),r=i.data,n=(r[s+0]+r[s+1]+r[s+2])/3;r[s+0]=n,r[s+1]=n,r[s+2]=n}};re=se([V({message:"Grayscale will be removed in v0.26.0"})],re);let ne=class{updatePixel(t,e,i){const s=4*(t+e*i.width),r=i.data;r[s+0]=255-r[s+0],r[s+1]=255-r[s+1],r[s+2]=255-r[s+2]}};ne=se([V({message:"Invert will be removed in v0.26.0"})],ne);let oe=class{constructor(t){this.opacity=t}updatePixel(t,e,i){const s=4*(t+e*i.width),r=i.data;0!==r[s+3]&&(r[s+3]=Math.round(this.opacity*r[s+3]))}};oe=se([V({message:"Opacity will be removed in v0.26.0"})],oe);let ae=class{constructor(t){this.color=t}updatePixel(t,e,i){const s=4*(t+e*i.width),r=i.data;0!==r[s+3]&&(r[s+0]=(r[s+0]+this.color.r)/2,r[s+1]=(r[s+1]+this.color.g)/2,r[s+2]=(r[s+2]+this.color.b)/2)}};ae=se([V({message:"Colorize will be removed in v0.26.0"})],ae);let he=class{constructor(t=.1){this.factor=t}updatePixel(t,e,i){const s=4*(t+e*i.width),r=i.data,n=at.fromRGB(r[s+0],r[s+1],r[s+2],r[s+3]).lighten(this.factor);r[s+0]=n.r,r[s+1]=n.g,r[s+2]=n.b,r[s+3]=n.a}};he=se([V({message:"Lighten will be removed in v0.26.0"})],he);let le=class{constructor(t=.1){this.factor=t}updatePixel(t,e,i){const s=4*(t+e*i.width),r=i.data,n=at.fromRGB(r[s+0],r[s+1],r[s+2],r[s+3]).darken(this.factor);r[s+0]=n.r,r[s+1]=n.g,r[s+2]=n.b,r[s+3]=n.a}};le=se([V({message:"Darken will be removed v0.26.0"})],le);let ce=class{constructor(t=.1){this.factor=t}updatePixel(t,e,i){const s=4*(t+e*i.width),r=i.data,n=at.fromRGB(r[s+0],r[s+1],r[s+2],r[s+3]).saturate(this.factor);r[s+0]=n.r,r[s+1]=n.g,r[s+2]=n.b,r[s+3]=n.a}};ce=se([V({message:"Saturate will be removed in v0.26.0"})],ce);let de=class{constructor(t=.1){this.factor=t}updatePixel(t,e,i){const s=4*(t+e*i.width),r=i.data,n=at.fromRGB(r[s+0],r[s+1],r[s+2],r[s+3]).desaturate(this.factor);r[s+0]=n.r,r[s+1]=n.g,r[s+2]=n.b,r[s+3]=n.a}};de=se([V({message:"Desaturate will be removed in v0.26.0"})],de);let ue=class{constructor(t){this.color=t}updatePixel(t,e,i){const s=4*(t+e*i.width),r=i.data;0!==r[s+3]&&(r[s+0]=this.color.r,r[s+1]=this.color.g,r[s+2]=this.color.b)}};function pe(t){return class extends t{assign(t){for(const e in t)"function"!=typeof this[e]&&(this[e]=t[e])}constructor(...t){super(...t),1!==t.filter((function(t){return void 0!==t})).length||!t[0]||"object"!=typeof t[0]||t[0]instanceof Array||this.assign(t[0])}}}ue=se([V({message:"Fill will be removed in v0.26.0"})],ue);class ge{constructor(t,e,i,s,r){this.x=0,this.y=0,this.rotation=0,this.anchor=X.Half,this.offset=X.Zero,this.scale=X.One,this.drawAroundAnchor=!1,this.logger=m.getInstance(),this.flipVertical=!1,this.flipHorizontal=!1,this.effects=[],this.width=0,this.height=0,this._spriteCanvas=null,this._spriteCtx=null,this._pixelData=null,this._pixelsLoaded=!1,this._dirtyEffect=!0,this._opacity=1;let n=t;if(t&&!(t instanceof fe)&&(e=0|t.x,i=0|t.y,s=0|t.width,r=0|t.height,n=t.image,!n))throw new Error("An image texture is required to construct a sprite");this.x=e||0,this.y=i||0,this.texture=n,this._spriteCanvas=document.createElement("canvas"),this._spriteCanvas.width=s,this._spriteCanvas.height=r,this._spriteCtx=this._spriteCanvas.getContext("2d"),this._initPixelsFromTexture(),this.width=s,this.height=r}get drawWidth(){return Math.abs(this.width*this.scale.x)}get drawHeight(){return Math.abs(this.height*this.scale.y)}_initPixelsFromTexture(){return t=this,e=void 0,s=function*(){try{const t=yield this.texture.loaded;this.width=this.width||t.naturalWidth,this.height=this.height||t.naturalHeight,this._spriteCanvas.width=this._spriteCanvas.width||t.naturalWidth,this._spriteCanvas.height=this._spriteCanvas.height||t.naturalHeight,this._loadPixels(),this._dirtyEffect=!0}catch(t){this.logger.error("Error loading texture ",this.texture.path,t)}},new((i=void 0)||(i=Promise))((function(r,n){function o(t){try{h(s.next(t))}catch(t){n(t)}}function a(t){try{h(s.throw(t))}catch(t){n(t)}}function h(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((s=s.apply(t,e||[])).next())}));var t,e,i,s}_loadPixels(){if(this.texture.isLoaded()&&!this._pixelsLoaded){const t=this.texture.image.naturalWidth||0,e=this.texture.image.naturalHeight||0;if(this.width>t&&this.logger.warn(`The sprite width ${this.width} exceeds the width \n                              ${t} of the backing texture ${this.texture.path}`),this.width<=0||t<=0)throw new Error(`The width of a sprite cannot be 0 or negative, sprite width: ${this.width}, original width: ${t}`);if(this.height>e&&this.logger.warn(`The sprite height ${this.height} exceeds the height \n                              ${e} of the backing texture ${this.texture.path}`),this.height<=0||e<=0)throw new Error(`The height of a sprite cannot be 0 or negative, sprite height: ${this.height}, original height: ${e}`);this._flushTexture(),this._pixelsLoaded=!0}}_flushTexture(){const t=this.texture.image.naturalWidth||0,e=this.texture.image.naturalHeight||0;this._spriteCtx.clearRect(0,0,this.width,this.height),this._spriteCtx.drawImage(this.texture.image,P(this.x,0,t),P(this.y,0,e),P(this.width,0,t),P(this.height,0,e),0,0,this.width,this.height)}opacity(t){this._opacity=t}grayscale(){this.addEffect(new re)}invert(){this.addEffect(new ne)}fill(t){this.addEffect(new ue(t))}colorize(t){this.addEffect(new ae(t))}lighten(t=.1){this.addEffect(new he(t))}darken(t=.1){this.addEffect(new le(t))}saturate(t=.1){this.addEffect(new ce(t))}desaturate(t=.1){this.addEffect(new de(t))}addEffect(t){this.effects.push(t),this.texture.isLoaded()&&this._pixelsLoaded?this._applyEffects():this._dirtyEffect=!0}removeEffect(t){let e=-1;e="number"==typeof t?t:this.effects.indexOf(t),e<0||e>=this.effects.length||(this.effects.splice(e,1),this.texture.isLoaded()&&this._pixelsLoaded?this._applyEffects():this._dirtyEffect=!0)}_applyEffects(){if(this._flushTexture(),this.effects.length>0){this._pixelData=this._spriteCtx.getImageData(0,0,this.width,this.height);const t=this.effects.length;for(let e=0;e<t;e++)for(let t=0;t<this.height;t++)for(let i=0;i<this.width;i++)this.effects[e].updatePixel(i,t,this._pixelData);this._spriteCtx.clearRect(0,0,this.width,this.height),this._spriteCtx.putImageData(this._pixelData,0,0)}this._dirtyEffect=!1}clearEffects(){this.effects.length=0,this._applyEffects()}reset(){}debugDraw(t,e,i){t.save(),t.translate(e,i),t.rotate(this.rotation);const s=this.drawWidth*this.anchor.x,r=this.drawHeight*this.anchor.y;t.strokeStyle=at.Black.toString(),t.strokeRect(-s,-r,this.drawWidth,this.drawHeight),t.restore()}draw(t,e,i){t instanceof CanvasRenderingContext2D?this._drawWithOptions({ctx:t,x:e,y:i}):this._drawWithOptions(t)}_drawWithOptions(t){var e,i,s,r,n,o,a,h;const{ctx:l,x:c,y:d,rotation:u,drawWidth:p,drawHeight:g,anchor:_,offset:f,opacity:m,flipHorizontal:y,flipVertical:w}=Object.assign(Object.assign({},t),{rotation:null!==(e=t.rotation)&&void 0!==e?e:this.rotation,drawWidth:null!==(i=t.drawWidth)&&void 0!==i?i:this.width,drawHeight:null!==(s=t.drawHeight)&&void 0!==s?s:this.height,flipHorizontal:null!==(r=t.flipHorizontal)&&void 0!==r?r:this.flipHorizontal,flipVertical:null!==(n=t.flipVertical)&&void 0!==n?n:this.flipVertical,anchor:null!==(o=t.anchor)&&void 0!==o?o:this.anchor,offset:null!==(a=t.offset)&&void 0!==a?a:this.offset,opacity:null!==(h=t.opacity)&&void 0!==h?h:this._opacity});this._dirtyEffect&&this._applyEffects();const v=p*_.x+f.x,b=g*_.y+f.y,x=this.scale.x>0?1:-1,A=this.scale.y>0?1:-1;l.save(),l.translate(c,d),l.scale(Math.abs(this.scale.x),Math.abs(this.scale.y)),this.drawAroundAnchor&&l.translate(-v,-b),l.translate(v,b),l.rotate(u),l.scale(x,A),l.translate(-v,-b),y&&(l.translate(p,0),l.scale(-1,1)),w&&(l.translate(0,g),l.scale(1,-1));const S=l.globalAlpha;l.globalAlpha=null!=m?m:1,l.drawImage(this._spriteCanvas,0,0,this.width,this.height,0,0,this.width,this.height),l.globalAlpha=S,l.restore()}clone(){const t=new _e(this.texture,this.x,this.y,this.width,this.height);t.anchor=this.anchor.clone(),t.scale=this.scale.clone(),t.rotation=this.rotation,t.flipHorizontal=this.flipHorizontal,t.flipVertical=this.flipVertical;const e=this.effects.length;for(let i=0;i<e;i++)t.addEffect(this.effects[i]);return t}}let _e=class extends(pe(ge)){constructor(t,e,i,s,r){super(t,e,i,s,r)}};_e=function(t,e,i,s){var r,n=arguments.length,o=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(o=(n<3?r(o):n>3?r(e,i,o):r(e,i))||o);return n>3&&o&&Object.defineProperty(e,i,o),o}([V({message:"Label.clearTextShadow will be removed in v0.26.0",alternateMethod:"Use Label.font.shadow"})],_e);class fe{constructor(t,e=!0){this.path=t,this.bustCache=e,this._sprite=null,this.loaded=new Promise((t=>{this._loadedResolve=t})),this._resource=new ie(t,"blob",e),this._sprite=new _e(this,0,0,0,0)}get image(){return this.data}isLoaded(){return!!this.data}load(){return t=this,e=void 0,s=function*(){try{let t;if(this.path.includes("data:image/"))t=this.path;else{const e=yield this._resource.load();t=URL.createObjectURL(e)}const e=new Image;e.src=t,yield e.decode(),this.data=e,this.width=this._sprite.width=e.naturalWidth,this.height=this._sprite.height=e.naturalHeight,this._sprite=new _e(this,0,0,this.width,this.height)}catch(t){yield Promise.reject("Error loading texture")}return this._loadedResolve(this.data),this.data},new((i=void 0)||(i=Promise))((function(r,n){function o(t){try{h(s.next(t))}catch(t){n(t)}}function a(t){try{h(s.throw(t))}catch(t){n(t)}}function h(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((s=s.apply(t,e||[])).next())}));var t,e,i,s}asSprite(){return this._sprite}}class me{constructor(t,e,i,s){this.sprites=[],this.currentFrame=0,this._timeLeftInFrame=0,this._idempotencyToken=-1,this.anchor=X.Zero,this.rotation=0,this.scale=X.One,this.loop=!0,this.freezeFrame=-1,this.flipVertical=!1,this.flipHorizontal=!1,this.drawWidth=0,this.drawHeight=0,this.width=0,this.height=0,this._opacity=1;let r=t;if(t&&!(t instanceof Lr)){const n=t;r=n.engine,e=n.sprites,i=n.speed,s=n.loop}this.sprites=e,this.speed=i,this._engine=r,this._timeLeftInFrame=this.speed,null!=s&&(this.loop=s),e&&e[0]&&(this.drawHeight=e[0]?e[0].drawHeight:0,this.drawWidth=e[0]?e[0].drawWidth:0,this.width=e[0]?e[0].width:0,this.height=e[0]?e[0].height:0,this.freezeFrame=e.length-1)}opacity(t){this._opacity=t}grayscale(){this.addEffect(new re)}invert(){this.addEffect(new ne)}fill(t){this.addEffect(new ue(t))}colorize(t){this.addEffect(new ae(t))}lighten(t=.1){this.addEffect(new he(t))}darken(t=.1){this.addEffect(new le(t))}saturate(t=.1){this.addEffect(new ce(t))}desaturate(t=.1){this.addEffect(new de(t))}addEffect(t){for(const e in this.sprites)this.sprites[e].addEffect(t)}removeEffect(t){for(const e in this.sprites)this.sprites[e].removeEffect(t)}clearEffects(){for(const t in this.sprites)this.sprites[t].clearEffects()}_setAnchor(t){for(const e in this.sprites)this.sprites[e].anchor.setTo(t.x,t.y)}_setRotation(t){for(const e in this.sprites)this.sprites[e].rotation=t}_setScale(t){for(const e in this.sprites)this.sprites[e].scale=t}reset(){this.currentFrame=0}isDone(){return!this.loop&&this.currentFrame>=this.sprites.length}tick(t,e){if(this._idempotencyToken===e)return;this._idempotencyToken=e,this._timeLeftInFrame-=t,this._timeLeftInFrame<=0&&(this.currentFrame=this.loop?(this.currentFrame+1)%this.sprites.length:this.currentFrame+1,this._timeLeftInFrame=this.speed),this._updateValues();const i=this.sprites[this.currentFrame];i&&(this.width=i.width,this.height=i.height,this.drawWidth=i.drawWidth,this.drawHeight=i.drawHeight)}_updateValues(){this._setAnchor(this.anchor),this._setRotation(this.rotation),this._setScale(this.scale)}skip(t){this.currentFrame=(this.currentFrame+t)%this.sprites.length}draw(t,e,i){t instanceof CanvasRenderingContext2D?this._drawWithOptions({ctx:t,x:e,y:i}):this._drawWithOptions(t)}_drawWithOptions(t){var e,i,s,r,n,o,a;const h=Object.assign(Object.assign({},t),{rotation:null!==(e=t.rotation)&&void 0!==e?e:this.rotation,drawWidth:null!==(i=t.drawWidth)&&void 0!==i?i:this.drawWidth,drawHeight:null!==(s=t.drawHeight)&&void 0!==s?s:this.drawHeight,flipHorizontal:null!==(r=t.flipHorizontal)&&void 0!==r?r:this.flipHorizontal,flipVertical:null!==(n=t.flipVertical)&&void 0!==n?n:this.flipVertical,anchor:null!==(o=t.anchor)&&void 0!==o?o:this.anchor,opacity:null!==(a=t.opacity)&&void 0!==a?a:this._opacity});let l;this._updateValues(),this.currentFrame<this.sprites.length&&(l=this.sprites[this.currentFrame],l.draw(h)),-1!==this.freezeFrame&&this.currentFrame>=this.sprites.length&&(l=this.sprites[P(this.freezeFrame,0,this.sprites.length-1)],l.draw(h)),l&&(this.drawWidth=l.drawWidth,this.drawHeight=l.drawHeight)}play(t,e){this.reset(),this._engine.playAnimation(this,t,e)}}let ye=class extends(pe(me)){constructor(t,e,i,s){super(t,e,i,s)}};var we,ve,be,xe;ye=function(t,e,i,s){var r,n=arguments.length,o=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(o=(n<3?r(o):n>3?r(e,i,o):r(e,i))||o);return n>3&&o&&Object.defineProperty(e,i,o),o}([V({message:"Animation will be removed in v0.26.0",alternateMethod:"Use Graphics.Animation"})],ye);class Ae{static CreateReversibleEasingFunction(t){return(e,i,s,r)=>s<i?i-(t(e,s,i,r)-s):t(e,i,s,r)}static CreateReversableEasingFunction(t){return Ae.CreateReversibleEasingFunction(t)}static CreateVectorEasingFunction(t){return(e,i,s,r)=>new X(t(e,i.x,s.x,r),t(e,i.y,s.y,r))}}Ae.Linear=Ae.CreateReversibleEasingFunction(((t,e,i,s)=>(i-=e)*t/s+e)),Ae.EaseInQuad=Ae.CreateReversibleEasingFunction(((t,e,i,s)=>(i-=e)*(t/=s)*t+e)),Ae.EaseOutQuad=Ae.CreateReversibleEasingFunction(((t,e,i,s)=>-(i-=e)*(t/=s)*(t-2)+e)),Ae.EaseInOutQuad=Ae.CreateReversibleEasingFunction(((t,e,i,s)=>(i-=e,(t/=s/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e))),Ae.EaseInCubic=Ae.CreateReversibleEasingFunction(((t,e,i,s)=>(i-=e)*(t/=s)*t*t+e)),Ae.EaseOutCubic=Ae.CreateReversibleEasingFunction(((t,e,i,s)=>(t/=s,(i-=e)*(--t*t*t+1)+e))),Ae.EaseInOutCubic=Ae.CreateReversibleEasingFunction(((t,e,i,s)=>(i-=e,(t/=s/2)<1?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e))),function(t,e,i,s){var r,n=arguments.length,o=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(o=(n<3?r(o):n>3?r(e,i,o):r(e,i))||o);n>3&&o&&Object.defineProperty(e,i,o)}([V({message:"Alias for incorrect spelling used in older versions, will be removed in v0.25.0",alternateMethod:"CreateReversibleEasingFunction"})],Ae,"CreateReversableEasingFunction",null);class Se{constructor(t){this._actions=[],this._completedActions=[],this._actor=t}add(t){this._actions.push(t)}remove(t){const e=this._actions.indexOf(t);this._actions.splice(e,1)}clearActions(){this._actions.length=0,this._completedActions.length=0,this._currentAction&&this._currentAction.stop()}getActions(){return this._actions.concat(this._completedActions)}hasNext(){return this._actions.length>0}isComplete(){return 0===this._actions.length}reset(){this._actions=this.getActions();const t=this._actions.length;for(let e=0;e<t;e++)this._actions[e].reset();this._completedActions=[]}update(t){this._actions.length>0&&(this._currentAction=this._actions[0],this._currentAction.update(t),this._currentAction.isComplete(this._actor)&&this._completedActions.push(this._actions.shift()))}}class Pe{constructor(t,e,i){this._stopped=!1,this._repeatBuilder=e,this._repeatContext=new He(t),this._actionQueue=this._repeatContext.getQueue(),this._repeat=i,this._originalRepeat=i,this._repeatBuilder(this._repeatContext),this._repeat--}update(t){this._actionQueue.isComplete()&&(this._actionQueue.clearActions(),this._repeatBuilder(this._repeatContext),this._repeat--),this._actionQueue.update(t)}isComplete(){return this._stopped||this._repeat<=0&&this._actionQueue.isComplete()}stop(){this._stopped=!0}reset(){this._repeat=this._originalRepeat}}class Ce{constructor(t,e){this._stopped=!1,this._repeatBuilder=e,this._repeatContext=new He(t),this._actionQueue=this._repeatContext.getQueue(),this._repeatBuilder(this._repeatContext)}update(t){this._stopped||(this._actionQueue.isComplete()&&(this._actionQueue.clearActions(),this._repeatBuilder(this._repeatContext)),this._actionQueue.update(t))}isComplete(){return this._stopped}stop(){this._stopped=!0,this._actionQueue.clearActions()}reset(){}}class Ee{constructor(t,e,i,s){if(this._started=!1,this._stopped=!1,this._actor=t,this._speed=s,this._offset=new X(e,i),s<=0)throw m.getInstance().error("Attempted to moveBy with speed less than or equal to zero : "+s),new Error("Speed must be greater than 0 pixels per second")}update(t){this._started||(this._started=!0,this._start=new X(this._actor.pos.x,this._actor.pos.y),this._end=this._start.add(this._offset),this._distance=this._offset.size,this._dir=this._end.sub(this._start).normalize()),this.isComplete(this._actor)?(this._actor.pos=Q(this._end.x,this._end.y),this._actor.vel=Q(0,0)):this._actor.vel=this._dir.scale(this._speed)}isComplete(t){return this._stopped||t.pos.distance(this._start)>=this._distance}stop(){this._actor.vel=Q(0,0),this._stopped=!0}reset(){this._started=!1}}class Te{constructor(t,e,i,s){this._started=!1,this._stopped=!1,this._actor=t,this._end=new X(e,i),this._speed=s}update(t){this._started||(this._started=!0,this._start=new X(this._actor.pos.x,this._actor.pos.y),this._distance=this._start.distance(this._end),this._dir=this._end.sub(this._start).normalize());const e=this._dir.scale(this._speed);this._actor.vel=Q(e.x,e.y),this.isComplete(this._actor)&&(this._actor.pos=Q(this._end.x,this._end.y),this._actor.vel=Q(0,0))}isComplete(t){return this._stopped||new X(t.pos.x,t.pos.y).distance(this._start)>=this._distance}stop(){this._actor.vel=Q(0,0),this._stopped=!0}reset(){this._started=!1}}(be=we||(we={}))[be.ShortestPath=0]="ShortestPath",be[be.LongestPath=1]="LongestPath",be[be.Clockwise=2]="Clockwise",be[be.CounterClockwise=3]="CounterClockwise";class De{constructor(t,e,i,s){this._started=!1,this._stopped=!1,this._actor=t,this._end=e,this._speed=i,this._rotationType=s||we.ShortestPath}update(t){if(!this._started){this._started=!0,this._start=this._actor.rotation,this._currentNonCannonAngle=this._actor.rotation;const t=Math.abs(this._end-this._start),e=b-t;switch(t>e?(this._shortDistance=e,this._longDistance=t):(this._shortDistance=t,this._longDistance=e),this._shortestPathIsPositive=(this._start-this._end+b)%b>=Math.PI,this._rotationType){case we.ShortestPath:this._distance=this._shortDistance,this._shortestPathIsPositive?this._direction=1:this._direction=-1;break;case we.LongestPath:this._distance=this._longDistance,this._shortestPathIsPositive?this._direction=-1:this._direction=1;break;case we.Clockwise:this._direction=1,this._shortestPathIsPositive?this._distance=this._shortDistance:this._distance=this._longDistance;break;case we.CounterClockwise:this._direction=-1,this._shortestPathIsPositive?this._distance=this._longDistance:this._distance=this._shortDistance}}this._actor.rx=this._direction*this._speed,this._currentNonCannonAngle+=this._direction*this._speed*(t/1e3),this.isComplete()&&(this._actor.rotation=this._end,this._actor.rx=0,this._stopped=!0)}isComplete(){const t=Math.abs(this._currentNonCannonAngle-this._start);return this._stopped||t>=Math.abs(this._distance)}stop(){this._actor.rx=0,this._stopped=!0}reset(){this._started=!1}}class Re{constructor(t,e,i,s){this._started=!1,this._stopped=!1,this._actor=t,this._speed=i,this._offset=e,this._rotationType=s||we.ShortestPath}update(t){if(!this._started){this._started=!0,this._start=this._actor.rotation,this._currentNonCannonAngle=this._actor.rotation,this._end=this._start+this._offset;const t=Math.abs(this._end-this._start),e=b-t;switch(t>e?(this._shortDistance=e,this._longDistance=t):(this._shortDistance=t,this._longDistance=e),this._shortestPathIsPositive=(this._start-this._end+b)%b>=Math.PI,this._rotationType){case we.ShortestPath:this._distance=this._shortDistance,this._shortestPathIsPositive?this._direction=1:this._direction=-1;break;case we.LongestPath:this._distance=this._longDistance,this._shortestPathIsPositive?this._direction=-1:this._direction=1;break;case we.Clockwise:this._direction=1,this._shortDistance>=0?this._distance=this._shortDistance:this._distance=this._longDistance;break;case we.CounterClockwise:this._direction=-1,this._shortDistance<=0?this._distance=this._shortDistance:this._distance=this._longDistance}}this._actor.rx=this._direction*this._speed,this._currentNonCannonAngle+=this._direction*this._speed*(t/1e3),this.isComplete()&&(this._actor.rotation=this._end,this._actor.rx=0,this._stopped=!0)}isComplete(){const t=Math.abs(this._currentNonCannonAngle-this._start);return this._stopped||t>=Math.abs(this._distance)}stop(){this._actor.rx=0,this._stopped=!0}reset(){this._started=!1}}class Be{constructor(t,e,i,s,r){this._started=!1,this._stopped=!1,this._actor=t,this._endX=e,this._endY=i,this._speedX=s,this._speedY=r}update(t){if(this._started||(this._started=!0,this._startX=this._actor.scale.x,this._startY=this._actor.scale.y,this._distanceX=Math.abs(this._endX-this._startX),this._distanceY=Math.abs(this._endY-this._startY)),Math.abs(this._actor.scale.x-this._startX)>=this._distanceX)this._actor.sx=0;else{const t=this._endY<this._startY?-1:1;this._actor.sx=this._speedX*t}if(Math.abs(this._actor.scale.y-this._startY)>=this._distanceY)this._actor.sy=0;else{const t=this._endY<this._startY?-1:1;this._actor.sy=this._speedY*t}this.isComplete()&&(this._actor.scale=Q(this._endX,this._endY),this._actor.sx=0,this._actor.sy=0)}isComplete(){return this._stopped||Math.abs(this._actor.scale.y-this._startX)>=this._distanceX&&Math.abs(this._actor.scale.y-this._startY)>=this._distanceY}stop(){this._actor.sx=0,this._actor.sy=0,this._stopped=!0}reset(){this._started=!1}}class Me{constructor(t,e,i,s){this._started=!1,this._stopped=!1,this._actor=t,this._offset=new X(e,i),this._speedX=this._speedY=s}update(t){this._started||(this._started=!0,this._startScale=this._actor.scale.clone(),this._endScale=this._startScale.add(this._offset),this._distanceX=Math.abs(this._endScale.x-this._startScale.x),this._distanceY=Math.abs(this._endScale.y-this._startScale.y),this._directionX=this._endScale.x<this._startScale.x?-1:1,this._directionY=this._endScale.y<this._startScale.y?-1:1),this._actor.sx=this._speedX*this._directionX,this._actor.sy=this._speedY*this._directionY,this.isComplete()&&(this._actor.scale=this._endScale,this._actor.sx=0,this._actor.sy=0)}isComplete(){return this._stopped||Math.abs(this._actor.scale.x-this._startScale.x)>=this._distanceX&&Math.abs(this._actor.scale.y-this._startScale.y)>=this._distanceY}stop(){this._actor.sx=0,this._actor.sy=0,this._stopped=!0}reset(){this._started=!1}}class ke{constructor(t){this._method=null,this._hasBeenCalled=!1,this._method=t}update(t){this._method(),this._hasBeenCalled=!0}isComplete(){return this._hasBeenCalled}reset(){this._hasBeenCalled=!1}stop(){this._hasBeenCalled=!0}}class Oe{constructor(t,e,i,s,r){this.actor=t,this.easingFcn=r,this._currentLerpTime=0,this._lerpDuration=1e3,this._lerpStart=new X(0,0),this._lerpEnd=new X(0,0),this._initialized=!1,this._stopped=!1,this._distance=0,this._lerpDuration=s,this._lerpEnd=new X(e,i)}_initialize(){this._lerpStart=new X(this.actor.pos.x,this.actor.pos.y),this._currentLerpTime=0,this._distance=this._lerpStart.distance(this._lerpEnd)}update(t){this._initialized||(this._initialize(),this._initialized=!0),this._currentLerpTime+=t;let e=this.actor.pos.x,i=this.actor.pos.y;this._currentLerpTime<this._lerpDuration?(e=this._lerpEnd.x<this._lerpStart.x?this._lerpStart.x-(this.easingFcn(this._currentLerpTime,this._lerpEnd.x,this._lerpStart.x,this._lerpDuration)-this._lerpEnd.x):this.easingFcn(this._currentLerpTime,this._lerpStart.x,this._lerpEnd.x,this._lerpDuration),i=this._lerpEnd.y<this._lerpStart.y?this._lerpStart.y-(this.easingFcn(this._currentLerpTime,this._lerpEnd.y,this._lerpStart.y,this._lerpDuration)-this._lerpEnd.y):this.easingFcn(this._currentLerpTime,this._lerpStart.y,this._lerpEnd.y,this._lerpDuration),this.actor.vel=Q((e-this.actor.pos.x)/(t/1e3),(i-this.actor.pos.y)/(t/1e3))):(this.actor.pos=Q(this._lerpEnd.x,this._lerpEnd.y),this.actor.vel=X.Zero)}isComplete(t){return this._stopped||new X(t.pos.x,t.pos.y).distance(this._lerpStart)>=this._distance}reset(){this._initialized=!1}stop(){this.actor.vel=Q(0,0),this._stopped=!0}}class Fe{constructor(t,e,i,s=1){this._timeVisible=0,this._timeNotVisible=0,this._elapsedTime=0,this._totalTime=0,this._stopped=!1,this._started=!1,this._actor=t,this._timeVisible=e,this._timeNotVisible=i,this._duration=(e+i)*s}update(t){this._started||(this._started=!0),this._elapsedTime+=t,this._totalTime+=t,this._actor.visible&&this._elapsedTime>=this._timeVisible&&(this._actor.visible=!1,this._elapsedTime=0),!this._actor.visible&&this._elapsedTime>=this._timeNotVisible&&(this._actor.visible=!0,this._elapsedTime=0),this.isComplete()&&(this._actor.visible=!0)}isComplete(){return this._stopped||this._totalTime>=this._duration}stop(){this._actor.visible=!0,this._stopped=!0}reset(){this._started=!1,this._elapsedTime=0,this._totalTime=0}}class Ie{constructor(t,e,i){this._multiplier=1,this._started=!1,this._stopped=!1,this._actor=t,this._endOpacity=e,this._speed=i}update(t){this._started||(this._started=!0,this._endOpacity<this._actor.opacity?this._multiplier=-1:this._multiplier=1),this._speed>0&&(this._actor.opacity+=this._multiplier*(Math.abs(this._actor.opacity-this._endOpacity)*t)/this._speed),this._speed-=t,this.isComplete()&&(this._actor.opacity=this._endOpacity),m.getInstance().debug("[Action fade] Actor opacity:",this._actor.opacity)}isComplete(){return this._stopped||Math.abs(this._actor.opacity-this._endOpacity)<.05}stop(){this._stopped=!0}reset(){this._started=!1}}class Le{constructor(t,e){this._elapsedTime=0,this._started=!1,this._stopped=!1,this._actor=t,this._delay=e}update(t){this._started||(this._started=!0),this.x=this._actor.pos.x,this.y=this._actor.pos.y,this._elapsedTime+=t}isComplete(){return this._stopped||this._elapsedTime>=this._delay}stop(){this._stopped=!0}reset(){this._elapsedTime=0,this._started=!1}}class ze{constructor(t){this._stopped=!1,this._actor=t}update(t){this._actor.actions.clearActions(),this._actor.kill(),this._stopped=!0}isComplete(){return this._stopped}stop(){}reset(){}}class Ue{constructor(t,e,i){this._started=!1,this._stopped=!1,this._actor=t,this._actorToFollow=e,this._current=new X(this._actor.pos.x,this._actor.pos.y),this._end=new X(e.pos.x,e.pos.y),this._maximumDistance=void 0!==i?i:this._current.distance(this._end),this._speed=0}update(t){this._started||(this._started=!0,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize());const e=Math.sqrt(Math.pow(this._actorToFollow.vel.x,2)+Math.pow(this._actorToFollow.vel.y,2));if(0!==e&&(this._speed=e),this._current=Q(this._actor.pos.x,this._actor.pos.y),this._end=Q(this._actorToFollow.pos.x,this._actorToFollow.pos.y),this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize(),this._distanceBetween>=this._maximumDistance){const t=this._dir.scale(this._speed);this._actor.vel=Q(t.x,t.y)}else this._actor.vel=Q(0,0);this.isComplete()&&(this._actor.pos=Q(this._end.x,this._end.y),this._actor.vel=Q(0,0))}stop(){this._actor.vel=Q(0,0),this._stopped=!0}isComplete(){return this._stopped}reset(){this._started=!1}}class We{constructor(t,e,i){this._started=!1,this._stopped=!1,this._speedWasSpecified=!1,this._actor=t,this._actorToMeet=e,this._current=new X(this._actor.pos.x,this._actor.pos.y),this._end=new X(e.pos.x,e.pos.y),this._speed=i||0,void 0!==i&&(this._speedWasSpecified=!0)}update(t){this._started||(this._started=!0,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize());const e=Math.sqrt(Math.pow(this._actorToMeet.vel.x,2)+Math.pow(this._actorToMeet.vel.y,2));0===e||this._speedWasSpecified||(this._speed=e),this._current=Q(this._actor.pos.x,this._actor.pos.y),this._end=Q(this._actorToMeet.pos.x,this._actorToMeet.pos.y),this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize();const i=this._dir.scale(this._speed);this._actor.vel=Q(i.x,i.y),this.isComplete()&&(this._actor.pos=Q(this._end.x,this._end.y),this._actor.vel=Q(0,0))}isComplete(){return this._stopped||this._distanceBetween<=1}stop(){this._actor.vel=Q(0,0),this._stopped=!0}reset(){this._started=!1}}class He{constructor(t){this._actor=t,this._queue=new Se(t)}getQueue(){return this._queue}update(t){this._queue.update(t)}clearActions(){this._queue.clearActions()}easeTo(t,e,i,s=Ae.Linear){return this._queue.add(new Oe(this._actor,t,e,i,s)),this}moveTo(t,e,i){return this._queue.add(new Te(this._actor,t,e,i)),this}moveBy(t,e,i){return this._queue.add(new Ee(this._actor,t,e,i)),this}rotateTo(t,e,i){return this._queue.add(new De(this._actor,t,e,i)),this}rotateBy(t,e,i){return this._queue.add(new Re(this._actor,t,e,i)),this}scaleTo(t,e,i,s){return this._queue.add(new Be(this._actor,t,e,i,s)),this}scaleBy(t,e,i){return this._queue.add(new Me(this._actor,t,e,i)),this}blink(t,e,i=1){return this._queue.add(new Fe(this._actor,t,e,i)),this}fade(t,e){return this._queue.add(new Ie(this._actor,t,e)),this}delay(t){return this._queue.add(new Le(this._actor,t)),this}die(){return this._queue.add(new ze(this._actor)),this}callMethod(t){return this._queue.add(new ke(t)),this}repeat(t,e){return e?(this._queue.add(new Pe(this._actor,t,e)),this):(this.repeatForever(t),this)}repeatForever(t){return this._queue.add(new Ce(this._actor,t)),this}follow(t,e){return void 0===e?this._queue.add(new Ue(this._actor,t)):this._queue.add(new Ue(this._actor,t,e)),this}meet(t,e){return void 0===e?this._queue.add(new We(this._actor,t)):this._queue.add(new We(this._actor,t,e)),this}asPromise(){return new Promise((t=>{this._queue.add(new ke((()=>{t()})))}))}}class Ne{static Box(t,e,i=X.Half,s=X.Zero){return new Yt({points:new Zt(-t*i.x,-e*i.y,t-t*i.x,e-e*i.y).getPoints(),offset:s})}static Polygon(t,e=!1,i=X.Zero){return new Yt({points:t,offset:i,clockwiseWinding:e})}static Circle(t,e=X.Zero){return new Kt({radius:t,offset:e})}static Edge(t,e){return new qt({begin:t,end:e})}}(xe=ve||(ve={}))[xe.X=12]="X",xe[xe.Y=13]="Y";const je=t=>0===t?0:t<0?-1:1;class Ge{constructor(){this.data=new Float32Array(16),this._scaleSignX=1,this._scaleSignY=1}static ortho(t,e,i,s,r,n){const o=new Ge;return o.data[0]=2/(e-t),o.data[1]=0,o.data[2]=0,o.data[3]=0,o.data[4]=0,o.data[5]=2/(s-i),o.data[6]=0,o.data[7]=0,o.data[8]=0,o.data[9]=0,o.data[10]=-2/(n-r),o.data[11]=0,o.data[12]=-(e+t)/(e-t),o.data[13]=-(s+i)/(s-i),o.data[14]=-(n+r)/(n-r),o.data[15]=1,o}clone(){const t=new Ge;return t.data[0]=this.data[0],t.data[1]=this.data[1],t.data[2]=this.data[2],t.data[3]=this.data[3],t.data[4]=this.data[4],t.data[5]=this.data[5],t.data[6]=this.data[6],t.data[7]=this.data[7],t.data[8]=this.data[8],t.data[9]=this.data[9],t.data[10]=this.data[10],t.data[11]=this.data[11],t.data[12]=this.data[12],t.data[13]=this.data[13],t.data[14]=this.data[14],t.data[15]=this.data[15],t}static identity(){const t=new Ge;return t.data[0]=1,t.data[1]=0,t.data[2]=0,t.data[3]=0,t.data[4]=0,t.data[5]=1,t.data[6]=0,t.data[7]=0,t.data[8]=0,t.data[9]=0,t.data[10]=1,t.data[11]=0,t.data[12]=0,t.data[13]=0,t.data[14]=0,t.data[15]=1,t}static translation(t,e){const i=Ge.identity();return i.data[12]=t,i.data[13]=e,i}static scale(t,e){const i=Ge.identity();return i.data[0]=t,i.data[5]=e,i.data[10]=1,i.data[15]=1,i}static rotation(t){const e=Ge.identity();return e.data[0]=Math.cos(t),e.data[4]=-Math.sin(t),e.data[1]=Math.sin(t),e.data[5]=Math.cos(t),e}multv(t){return t instanceof X?new X(t.x*this.data[0]+t.y*this.data[4]+0*this.data[6]+1*this.data[12],t.x*this.data[1]+t.y*this.data[5]+0*this.data[9]+1*this.data[13]):[t[0]*this.data[0]+t[1]*this.data[4]+0*this.data[6]+1*this.data[12],t[0]*this.data[1]+t[1]*this.data[5]+0*this.data[9]+1*this.data[13]]}multm(t){const e=new Ge,i=this.data[0],s=this.data[1],r=this.data[2],n=this.data[3],o=this.data[4],a=this.data[5],h=this.data[6],l=this.data[7],c=this.data[8],d=this.data[9],u=this.data[10],p=this.data[11],g=this.data[12],_=this.data[13],f=this.data[14],m=this.data[15],y=t.data[0],w=t.data[1],v=t.data[2],b=t.data[3],x=t.data[4],A=t.data[5],S=t.data[6],P=t.data[7],C=t.data[8],E=t.data[9],T=t.data[10],D=t.data[11],R=t.data[12],B=t.data[13],M=t.data[14],k=t.data[15];e.data[0]=i*y+o*w+c*v+g*b,e.data[1]=s*y+a*w+d*v+_*b,e.data[2]=r*y+h*w+u*v+f*b,e.data[3]=n*y+l*w+p*v+m*b,e.data[4]=i*x+o*A+c*S+g*P,e.data[5]=s*x+a*A+d*S+_*P,e.data[6]=r*x+h*A+u*S+f*P,e.data[7]=n*x+l*A+p*S+m*P,e.data[8]=i*C+o*E+c*T+g*D,e.data[9]=s*C+a*E+d*T+_*D,e.data[10]=r*C+h*E+u*T+f*D,e.data[11]=n*C+l*E+p*T+m*D,e.data[12]=i*R+o*B+c*M+g*k,e.data[13]=s*R+a*B+d*M+_*k,e.data[14]=r*R+h*B+u*M+f*k,e.data[15]=n*R+l*B+p*M+m*k;const O=this.getScale();return e._scaleSignX=je(O.x)*je(e._scaleSignX),e._scaleSignY=je(O.y)*je(e._scaleSignY),e}translate(t,e){const i=this.data[0],s=this.data[1],r=this.data[2],n=this.data[3],o=this.data[4],a=this.data[5],h=this.data[6],l=this.data[7],c=this.data[8],d=this.data[9],u=this.data[10],p=this.data[11],g=this.data[12],_=this.data[13],f=this.data[14],m=this.data[15];return this.data[12]=i*t+o*e+0*c+1*g,this.data[13]=s*t+a*e+0*d+1*_,this.data[14]=r*t+h*e+0*u+1*f,this.data[15]=n*t+l*e+0*p+1*m,this}setPosition(t,e){this.data[12]=t,this.data[13]=e}getPosition(){return Q(this.data[12],this.data[13])}rotate(t){const e=this.data[0],i=this.data[1],s=this.data[2],r=this.data[3],n=this.data[4],o=this.data[5],a=this.data[6],h=this.data[7],l=Math.sin(t),c=Math.cos(t);return this.data[0]=c*e+l*n,this.data[1]=c*i+l*o,this.data[2]=c*s+l*a,this.data[3]=c*r+l*h,this.data[4]=c*n-l*e,this.data[5]=c*o-l*i,this.data[6]=c*a-l*s,this.data[7]=c*h-l*r,this}scale(t,e){const i=this.data[0],s=this.data[1],r=this.data[2],n=this.data[3],o=this.data[4],a=this.data[5],h=this.data[6],l=this.data[7];return this.data[0]=i*t,this.data[1]=s*t,this.data[2]=r*t,this.data[3]=n*t,this.data[4]=o*e,this.data[5]=a*e,this.data[6]=h*e,this.data[7]=l*e,this}setRotation(t){const e=this.getScale(),i=Math.sin(t),s=Math.cos(t);this.data[0]=s*e.x,this.data[1]=i*e.y,this.data[4]=-i*e.x,this.data[5]=s*e.y}getRotation(){return T(Math.atan2(this.data[1]/this.getScaleY(),this.data[0]/this.getScaleX()))}getScaleX(){const t=Q(this.data[0],this.data[4]).size;return this._scaleSignX*t}getScaleY(){const t=Q(this.data[1],this.data[5]).size;return this._scaleSignY*t}getScale(){return Q(this.getScaleX(),this.getScaleY())}setScaleX(t){this._scaleSignX=je(t);const e=Q(this.data[0]*this._scaleSignX,this.data[4]*this._scaleSignX).normalize();this.data[0]=e.x*t,this.data[4]=e.y*t}setScaleY(t){this._scaleSignY=je(t);const e=Q(this.data[1]*this._scaleSignY,this.data[5]*this._scaleSignY).normalize();this.data[1]=e.x*t,this.data[5]=e.y*t}setScale(t){this.setScaleX(t.x),this.setScaleY(t.y)}getBasisDeterminant(){return this.data[0]*this.data[5]-this.data[1]*this.data[4]}getAffineInverse(){const t=1/this.getBasisDeterminant(),e=this.data[0],i=this.data[4],s=this.data[1],r=this.data[5],n=Ge.identity();n.data[0]=r*t,n.data[1]=-s*t,n.data[4]=-i*t,n.data[5]=e*t;const o=this.data[12],a=this.data[13];return n.data[12]=-(o*n.data[0]+a*n.data[4]),n.data[13]=-(o*n.data[1]+a*n.data[5]),n}isIdentity(){return 1===this.data[0]&&0===this.data[1]&&0===this.data[2]&&0===this.data[3]&&0===this.data[4]&&1===this.data[5]&&0===this.data[6]&&0===this.data[7]&&0===this.data[8]&&0===this.data[9]&&1===this.data[10]&&0===this.data[11]&&0===this.data[12]&&0===this.data[13]&&0===this.data[14]&&1===this.data[15]}toString(){return`\n[${this.data[0]} ${this.data[4]} ${this.data[8]} ${this.data[12]}]\n[${this.data[1]} ${this.data[5]} ${this.data[9]} ${this.data[13]}]\n[${this.data[2]} ${this.data[6]} ${this.data[10]} ${this.data[14]}]\n[${this.data[3]} ${this.data[7]} ${this.data[11]} ${this.data[15]}]\n`}}class Ve extends X{constructor(t){super(0,0),this._getX=t.getX,this._getY=t.getY,this._setX=t.setX,this._setY=t.setY}get x(){return this._getX()}set x(t){this._setX(t)}get y(){return this._getY()}set y(t){this._setY(t)}}class Xe{constructor(){this.owner=null}clone(){const t=new this.constructor;for(const i in this)if(this.hasOwnProperty(i)){const s=this[i];(null==(e=s)?void 0:e.clone)&&"owner"!==i&&"clone"!==i?t[i]=s.clone():t[i]=s}var e;return t}}class Ke extends Xe{constructor(t,e){super(),this.type=t,this.value=e}}var qe,Ye,Ze,Qe;(Ze=qe||(qe={})).World="world",Ze.Screen="screen";class $e extends Xe{constructor(){super(...arguments),this.type="ex.transform",this._dirty=!1,this.matrix=Ge.identity().translate(0,0).rotate(0).scale(1,1),this._position=(t=>{const e=this.matrix;return new Ve({setX:t=>{e.data[ve.X]=t},setY:t=>{e.data[ve.Y]=t},getX:()=>e.data[ve.X],getY:()=>e.data[ve.Y]})})(),this._rotation=0,this._scale=(t=>{const e=this.matrix;return new Ve({setX:t=>{e.setScaleX(t)},setY:t=>{e.setScaleY(t)},getX:()=>e.getScaleX(),getY:()=>e.getScaleY()})})(),this.coordPlane=qe.World,this.z=0}_recalculate(){this._rotation=this.matrix.getRotation(),this._dirty=!1}getGlobalMatrix(){return this.parent?this.parent.getGlobalMatrix().multm(this.matrix):this.matrix}get parent(){var t,e;return null===(e=null===(t=null==this?void 0:this.owner)||void 0===t?void 0:t.parent)||void 0===e?void 0:e.get($e)}get pos(){return this._dirty&&this._recalculate(),this._position}set pos(t){this.matrix.setPosition(t.x,t.y),this._dirty=!0}get dirty(){var t;return(null===(t=null==this?void 0:this.owner)||void 0===t?void 0:t.parent)&&this.parent.dirty||this._dirty}get globalPos(){const t=this.getGlobalMatrix();return new Ve({getX:()=>t.data[ve.X],getY:()=>t.data[ve.Y],setX:e=>{var i;if(this.parent){const[s]=null===(i=this.parent)||void 0===i?void 0:i.getGlobalMatrix().getAffineInverse().multv([e,t.data[ve.Y]]);this.matrix.data[ve.X]=s}else this.matrix.data[ve.X]=e},setY:e=>{var i;if(this.parent){const[,s]=null===(i=this.parent)||void 0===i?void 0:i.getGlobalMatrix().getAffineInverse().multv([t.data[ve.X],e]);this.matrix.data[ve.Y]=s}else this.matrix.data[ve.Y]=e}})}set globalPos(t){const e=this.parent;this.pos=e?e.getGlobalMatrix().getAffineInverse().multv(t):t}get rotation(){return this._dirty&&this._recalculate(),this._rotation}set rotation(t){this.matrix.setRotation(t),this._dirty=!0}get globalRotation(){return this.getGlobalMatrix().getRotation()}set globalRotation(t){const e=this.parent;this.rotation=e?t-e.globalRotation:t}get scale(){return this._dirty&&this._recalculate(),this._scale}set scale(t){this.matrix.setScale(t),this._dirty=!0}get globalScale(){const t=this.getGlobalMatrix();return new Ve({getX:()=>t.getScaleX(),getY:()=>t.getScaleY(),setX:t=>{if(this.parent){const e=this.parent.globalScale.x;this.matrix.setScaleX(t/e)}else this.matrix.setScaleX(t)},setY:t=>{if(this.parent){const e=this.parent.globalScale.y;this.matrix.setScaleY(t/e)}else this.matrix.setScaleY(t)}})}set globalScale(t){const e=this.parent;this.scale=e?Q(t.x/e.globalScale.x,t.y/e.globalScale.y):t}}class Je{constructor({actor:t,collider:e}){if(this.oldPos=new X(0,0),this.vel=new X(0,0),this.oldVel=new X(0,0),this.acc=new X(0,0),this.oldAcc=X.Zero,this.torque=0,this.motion=10,this.oldRotation=0,this.oldScale=X.One,this.sx=0,this.sy=0,this.rx=0,this._geometryDirty=!1,this._totalMtv=X.Zero,!t&&!e)throw new Error("An actor or collider are required to create a body");this.actor=t,this.collider=!e&&t?this.useBoxCollider(t.width,t.height,t.anchor):e}get id(){return this.actor?this.actor.id:-1}clone(){return new Je({actor:null,collider:this.collider.clone()})}get active(){return!!this.actor&&!this.actor.isKilled()}get center(){return this.pos}set collider(t){t&&(this._collider=t,this._collider.body=this,this._wireColliderEventsToActor())}get collider(){return this._collider}get transform(){return this.actor.get($e)}get pos(){return this.transform.globalPos}set pos(t){this.transform.globalPos=t}get rotation(){return this.transform.globalRotation}set rotation(t){this.transform.globalRotation=t}get scale(){return this.transform.globalScale}set scale(t){this.transform.globalScale=t}addMtv(t){this._totalMtv.addEqual(t)}applyMtv(){this.pos=this.pos.add(this._totalMtv),this._totalMtv.setTo(0,0)}markCollisionShapeDirty(){this._geometryDirty=!0}get isColliderShapeDirty(){return this._geometryDirty}captureOldTransform(){this.oldVel.setTo(this.vel.x,this.vel.y),this.oldPos.setTo(this.pos.x,this.pos.y),this.oldAcc.setTo(this.acc.x,this.acc.y),this.oldScale.setTo(this.scale.x,this.scale.y),this.oldRotation=this.rotation}integrate(t){const e=t/1e3,i=this.acc.clone();this.collider.type===it.Active&&i.addEqual(lt.acc),this.vel.addEqual(i.scale(e)),this.pos=this.pos.add(this.vel.scale(e)).add(i.scale(.5*e*e)),this.rx+=this.torque*(1/this.collider.inertia)*e,this.rotation+=this.rx*e,this.scale=Q(this.scale.x+this.sx*t/1e3,this.scale.y+this.sy*t/1e3),this.scale.equals(this.oldScale)||(this._geometryDirty=!0),this.collider.update(),this._geometryDirty=!1}useBoxCollider(t,e,i=X.Half,s=X.Zero){return null==t&&(t=this.actor?this.actor.width:0),null==e&&(e=this.actor?this.actor.height:0),this.collider.shape=Ne.Box(t,e,i,s),this.collider}usePolygonCollider(t,e=X.Zero){return this.collider.shape=Ne.Polygon(t,!1,e),this.collider}useCircleCollider(t,e=X.Zero){return this.collider.shape=Ne.Circle(t,e),this.collider}useEdgeCollider(t,e){return this.collider.shape=Ne.Edge(t,e),this.collider}_wireColliderEventsToActor(){this.collider.clear(),this.collider.on("precollision",(t=>{this.actor&&this.actor.emit("precollision",new Mt(t.target.body.actor,t.other.body.actor,t.side,t.intersection))})),this.collider.on("postcollision",(t=>{this.actor&&this.actor.emit("postcollision",new kt(t.target.body.actor,t.other.body.actor,t.side,t.intersection))})),this.collider.on("collisionstart",(t=>{this.actor&&this.actor.emit("collisionstart",new Ot(t.target.body.actor,t.other.body.actor,t.pair))})),this.collider.on("collisionend",(t=>{this.actor&&this.actor.emit("collisionend",new Ft(t.target.body.actor,t.other.body.actor))}))}}class ti{update(t,e){const i=t.eventDispatcher;if(t.body.collider.type!==it.PreventCollision&&e.currentScene&&e.currentScene.tileMaps)for(let s=0;s<e.currentScene.tileMaps.length;s++){const r=e.currentScene.tileMaps[s];let n,o=u.None,a=2;for(;(n=r.collides(t))&&!(a--<0);)o=Zt.getSideFromIntersection(n),i.emit("precollision",new Mt(t,null,o,n)),t.body.collider.type===it.Active&&(t.pos=t.pos.add(n),i.emit("postcollision",new kt(t,null,o,n)))}}}class ei{constructor(){this._topLeft=new X(0,0),this._topRight=new X(0,0),this._bottomLeft=new X(0,0),this._bottomRight=new X(0,0)}isSpriteOffScreen(t,e){const i=t.currentDrawing.drawWidth,s=t.currentDrawing.drawHeight,r=t.rotation,n=t.center,o=t.getGlobalPos();this._topLeft=Q(o.x-i/2,o.y-s/2),this._topLeft=this._topLeft.rotate(r,n),this._topRight=Q(o.x+i/2,o.y-s/2),this._topRight=this._topRight.rotate(r,n),this._bottomLeft=Q(o.x-i/2,o.y+s/2),this._bottomLeft=this._bottomLeft.rotate(r,n),this._bottomRight=Q(o.x+i/2,o.y+s/2),this._bottomRight=this._bottomRight.rotate(r,n);const a=e.worldToScreenCoordinates(this._topLeft),h=e.worldToScreenCoordinates(this._topRight),l=e.worldToScreenCoordinates(this._bottomLeft),c=e.worldToScreenCoordinates(this._bottomRight);this._xCoords=[],this._yCoords=[],this._xCoords.push(a.x,h.x,l.x,c.x),this._yCoords.push(a.y,h.y,l.y,c.y),this._xMin=Math.min.apply(null,this._xCoords),this._yMin=Math.min.apply(null,this._yCoords),this._xMax=Math.max.apply(null,this._xCoords),this._yMax=Math.max.apply(null,this._yCoords);const d=e.screenToWorldCoordinates(new X(this._xMin,this._yMin)),u=e.screenToWorldCoordinates(new X(this._xMax,this._yMax));this._xMinWorld=d.x,this._yMinWorld=d.y,this._xMaxWorld=u.x,this._yMaxWorld=u.y;const p=[new X(this._xMin,this._yMin),new X(this._xMax,this._yMin),new X(this._xMin,this._yMax),new X(this._xMax,this._yMax)];if(p[0].x<0&&p[1].x>e.canvas.clientWidth&&(p[0].y>0||p[2].y<e.canvas.clientHeight))return!1;if(p[0].y<0&&p[2].y>e.canvas.clientHeight&&(p[1].x>0||p[0].x<e.canvas.clientWidth))return!1;for(let t=0;t<p.length;t++)if(p[t].x>0&&p[t].y>0&&p[t].x<e.canvas.clientWidth&&p[t].y<e.canvas.clientHeight)return!1;return!0}debugDraw(t){t.beginPath(),t.strokeStyle=at.White.toString(),t.rect(this._xMinWorld,this._yMinWorld,this._xMaxWorld-this._xMinWorld,this._yMaxWorld-this._yMinWorld),t.stroke(),t.fillStyle=at.Red.toString(),t.beginPath(),t.arc(this._topLeft.x,this._topLeft.y,5,0,2*Math.PI),t.closePath(),t.fill(),t.fillStyle=at.Green.toString(),t.beginPath(),t.arc(this._topRight.x,this._topRight.y,5,0,2*Math.PI),t.closePath(),t.fill(),t.fillStyle=at.Blue.toString(),t.beginPath(),t.arc(this._bottomLeft.x,this._bottomLeft.y,5,0,2*Math.PI),t.closePath(),t.fill(),t.fillStyle=at.Magenta.toString(),t.beginPath(),t.arc(this._bottomRight.x,this._bottomRight.y,5,0,2*Math.PI),t.closePath(),t.fill()}}class ii{constructor(){this.cullingBox=new ei}update(t,e){const i=t.eventDispatcher;let s=!0;null!=t.currentDrawing&&(s=this.cullingBox.isSpriteOffScreen(t,e));let r=!1;e&&e.currentScene&&e.currentScene.camera&&e.currentScene.camera.viewport&&!t.parent&&(r=!e.currentScene.camera.viewport.intersect(t.body.collider.bounds)),t.isOffScreen?r&&s||(i.emit("enterviewport",new Wt(t)),t.removeComponent("offscreen")):r&&s&&(i.emit("exitviewport",new Ut(t)),t.addComponent(new Ke("offscreen")))}}class si{update(t,e){t.enableCapturePointer&&(t.isKilled()||e.input.pointers.checkAndUpdateActorUnderPointer(t))}}function ri(t,e=at.Red,i,s,r,n,o=1,a="butt"){t.beginPath(),t.lineWidth=o,t.lineCap=a,t.strokeStyle=e.toString(),t.moveTo(i,s),t.lineTo(r,n),t.closePath(),t.stroke()}function ni(t,e=at.Red,i){t.beginPath(),t.strokeStyle=e.toString(),t.arc(i.x,i.y,5,0,2*Math.PI),t.closePath(),t.stroke()}function oi(t,e,i,s,r=1){const n=e?e.toString():"blue",o=s.scale(r);t.beginPath(),t.strokeStyle=n,t.moveTo(i.x,i.y),t.lineTo(i.x+o.x,i.y+o.y),t.closePath(),t.stroke()}function ai(t,e,i,s,r,n=5,o=at.White,a=null){let h;if("number"==typeof n)h={tl:n,tr:n,br:n,bl:n};else{const t={tl:0,tr:0,br:0,bl:0};for(const e in t)if(t.hasOwnProperty(e)){const i=e;h[i]=n[i]||t[i]}}t.beginPath(),t.moveTo(e+h.tl,i),t.lineTo(e+s-h.tr,i),t.quadraticCurveTo(e+s,i,e+s,i+h.tr),t.lineTo(e+s,i+r-h.br),t.quadraticCurveTo(e+s,i+r,e+s-h.br,i+r),t.lineTo(e+h.bl,i+r),t.quadraticCurveTo(e,i+r,e,i+r-h.bl),t.lineTo(e,i+h.tl),t.quadraticCurveTo(e,i,e+h.tl,i),t.closePath(),a&&(t.fillStyle=a.toString(),t.fill()),o&&(t.strokeStyle=o.toString(),t.stroke())}function hi(t,e,i,s,r=at.White,n=null){t.beginPath(),t.arc(e,i,s,0,2*Math.PI),t.closePath(),n&&(t.fillStyle=n.toString(),t.fill()),r&&(t.strokeStyle=r.toString(),t.stroke())}class li{constructor(t,e,i){this._name=t,this._category=e,this._mask=i}get name(){return this._name}get category(){return this._category}get mask(){return this._mask}canCollide(t){return 0!=(this.category&t.mask)&&0!=(t.category&this.mask)}}li.All=new li("Collide with all groups",-1,-1);class ci{constructor(t,e){this.colliderA=t,this.colliderB=e,this.id=null,this.collision=null,this.id=ci.calculatePairHash(t,e)}static canCollide(t,e){return!(!t.group.canCollide(e.group)||t.type===it.Fixed&&e.type===it.Fixed||e.type===it.PreventCollision||t.type===it.PreventCollision||!t.active||!e.active)}get canCollide(){const t=this.colliderA,e=this.colliderB;return ci.canCollide(t,e)}collide(){this.collision=this.colliderA.collide(this.colliderB)}resolve(t){this.collision&&this.collision.resolve(t)}static calculatePairHash(t,e){return t.id<e.id?`#${t.id}+${e.id}`:`#${e.id}+${t.id}`}debugDraw(t){this.collision&&(lt.showContacts&&ni(t,at.Red,this.collision.point),lt.showCollisionNormals&&oi(t,at.Cyan,this.collision.point,this.collision.normal,30))}}function di(t){return t instanceof ui}class ui{constructor({body:t,type:e,group:i,shape:s,offset:r,useShapeInertia:n=!0}){this._events=new ee(this),this.type=it.PreventCollision,this.group=li.All,this.mass=1,this.inertia=1e3,this.friction=.99,this.bounciness=.2,t&&t.collider&&!s?this._shape=t.collider.shape:(this._shape=s,this.body=t),this.useShapeInertia=n,this._shape.collider=this,this.type=e||this.type,this.group=i||this.group,this.offset=r||X.Zero}clone(){return new ui({body:null,type:this.type,shape:this._shape.clone(),group:this.group,offset:this.offset})}get id(){return this.body?this.body.id:-1}get shape(){return this._shape}set shape(t){this._shape=t,this._shape.collider=this,this.useShapeInertia&&(this.inertia=isNaN(this._shape.inertia)?this.inertia:this._shape.inertia)}get center(){return this.bounds.center}get active(){return this.body.active}collide(t){return this.shape.collide(t.shape)}getClosestLineBetween(t){return this.shape.getClosestLineBetween(t.shape)}get offset(){return this.shape.offset.clone()}set offset(t){this.shape.offset=t.clone()}touching(t){const e=new ci(this,t);return e.collide(),!!e.collision}get bounds(){return this.shape?this.shape.bounds:this.body?(new Zt).translate(this.body.pos):new Zt}get localBounds(){return this.shape?this.shape.localBounds:new Zt}update(){this.shape&&this.shape.recalc()}emit(t,e){this._events.emit(t,e)}on(t,e){this._events.on(t,e)}off(t,e){this._events.off(t,e)}once(t,e){this._events.once(t,e)}clear(){this._events.clear()}debugDraw(t){lt.showMotionVectors&&(oi(t,at.Yellow,this.body.pos,this.body.acc.add(lt.acc)),oi(t,at.Red,this.body.pos,this.body.vel),ni(t,at.Red,this.body.pos)),lt.showBounds&&this.bounds.debugDraw(t,at.Yellow),lt.showArea&&this.shape.debugDraw(t,at.Green)}}class pi{constructor(){this.observers=[]}register(t){this.observers.push(t)}unregister(t){const e=this.observers.indexOf(t);-1!==e&&this.observers.splice(e,1)}notifyAll(t){this.observers.forEach((e=>e.notify(t)))}clear(){this.observers.length=0}}class gi{constructor(){this.eventDispatcher=new ee(this)}on(t,e){this.eventDispatcher.on(t,e)}off(t,e){this.eventDispatcher.off(t,e)}emit(t,e){this.eventDispatcher.emit(t,e)}once(t,e){this.eventDispatcher.once(t,e)}}class _i{constructor(t){this.data=t,this.type="Component Added"}}function fi(t){return!!t&&"Component Added"===t.type}class mi{constructor(t){this.data=t,this.type="Component Removed"}}function yi(t){return!!t&&"Component Removed"===t.type}class wi extends gi{constructor(t){if(super(),this.id=wi._ID++,this.active=!0,this._componentsToRemove=[],this._componentTypeToInstance=new Map,this._componentStringToInstance=new Map,this._tagsMemo=[],this._typesMemo=[],this.componentAdded$=new pi,this.componentRemoved$=new pi,this._parent=null,this.childrenAdded$=new pi,this.childrenRemoved$=new pi,this._children=[],this._isInitialized=!1,t)for(const e of t)this.addComponent(e)}kill(){this.active=!1}isKilled(){return!this.active}get tags(){return this._tagsMemo}hasTag(t){return this.tags.includes(t)}addTag(t){return this.addComponent(new Ke(t))}removeTag(t,e=!1){return this.removeComponent(t,e)}get types(){return this._typesMemo}_rebuildMemos(){this._tagsMemo=Array.from(this._componentStringToInstance.values()).filter((t=>t instanceof Ke)).map((t=>t.type)),this._typesMemo=Array.from(this._componentStringToInstance.keys())}getComponents(){return Array.from(this._componentStringToInstance.values())}_notifyAddComponent(t){this._rebuildMemos();const e=new _i({component:t,entity:this});this.componentAdded$.notifyAll(e)}_notifyRemoveComponent(t){const e=new mi({component:t,entity:this});this.componentRemoved$.notifyAll(e),this._rebuildMemos()}get parent(){return this._parent}get children(){return this._children}unparent(){this._parent&&(this._parent.removeChild(this),this._parent=null)}addChild(t){if(null!==t.parent)throw new Error("Entity already has a parent, cannot add without unparenting");if(this.getAncestors().includes(t))throw new Error("Cycle detected, cannot add entity");return this._children.push(t),t._parent=this,this.childrenAdded$.notifyAll(t),this}removeChild(t){return t.parent===this&&(k(t,this._children),t._parent=null,this.childrenRemoved$.notifyAll(t)),this}removeAllChildren(){return this.children.forEach((t=>{this.removeChild(t)})),this}getAncestors(){const t=[this];let e=this.parent;for(;e;)t.push(e),e=e.parent;return t.reverse()}getDescendants(){let t=[this],e=[this];for(;e.length>0;){const i=e.pop();e=e.concat(i.children),t=t.concat(i.children)}return t}clone(){const t=new wi;for(const e of this.types)t.addComponent(this.get(e).clone());for(const e of this.children)t.addChild(e.clone());return t}addTemplate(t,e=!1){for(const i of t.getComponents())this.addComponent(i.clone(),e);for(const e of t.children)this.addChild(e.clone().addTemplate(e));return this}addComponent(t,e=!1){if(this.has(t.type)){if(!e)return this;this.removeComponent(t)}if(t.dependencies&&t.dependencies.length)for(const e of t.dependencies)this.addComponent(new e);t.owner=this;const i=t.constructor;return this._componentTypeToInstance.set(i,t),this._componentStringToInstance.set(t.type,t),t.onAdd&&t.onAdd(this),this._notifyAddComponent(t),this}removeComponent(t,e=!1){return e?"string"==typeof t?this._removeComponentByType(t):t instanceof Xe&&this._removeComponentByType(t.type):this._componentsToRemove.push(t),this}_removeComponentByType(t){if(this.has(t)){const e=this.get(t);e.owner=null,e.onRemove&&e.onRemove(this);const i=e.constructor;this._componentTypeToInstance.delete(i),this._componentStringToInstance.delete(e.type),this._notifyRemoveComponent(e)}}processComponentRemoval(){for(const t of this._componentsToRemove){const e="string"==typeof t?t:t.type;this._removeComponentByType(e)}this._componentsToRemove.length=0}has(t){return"string"==typeof t?this._componentStringToInstance.has(t):this._componentTypeToInstance.has(t)}get(t){return"string"==typeof t?this._componentStringToInstance.get(t):this._componentTypeToInstance.get(t)}get isInitialized(){return this._isInitialized}_initialize(t){this.isInitialized||(this.onInitialize(t),super.emit("initialize",new It(t,this)),this._isInitialized=!0)}_preupdate(t,e){this.emit("preupdate",new vt(t,e,this)),this.onPreUpdate(t,e)}_postupdate(t,e){this.emit("postupdate",new bt(t,e,this)),this.onPostUpdate(t,e)}onInitialize(t){}onPreUpdate(t,e){}onPostUpdate(t,e){}update(t,e){this._initialize(t),this._preupdate(t,e);for(const i of this.children)i.update(t,e);this._postupdate(t,e)}}wi._ID=0;class vi extends Xe{constructor(t){var e;super(),this.draw=t,this.type="ex.canvas",this.draw=null!==(e=this.draw)&&void 0!==e?e:()=>{}}}class bi{constructor(t){var e,i,s,r,n,o;this.id=bi._ID++,this.showDebug=!1,this.flipHorizontal=!1,this.flipVertical=!1,this.rotation=0,this.opacity=1,this.scale=X.One,this.origin=null,this._width=0,this._height=0,t&&(this.origin=null!==(e=t.origin)&&void 0!==e?e:this.origin,this.flipHorizontal=null!==(i=t.flipHorizontal)&&void 0!==i?i:this.flipHorizontal,this.flipVertical=null!==(s=t.flipVertical)&&void 0!==s?s:this.flipVertical,this.rotation=null!==(r=t.rotation)&&void 0!==r?r:this.rotation,this.opacity=null!==(n=t.opacity)&&void 0!==n?n:this.opacity,this.scale=null!==(o=t.scale)&&void 0!==o?o:this.scale)}cloneGraphicOptions(){return{origin:this.origin?this.origin.clone():null,flipHorizontal:this.flipHorizontal,flipVertical:this.flipVertical,rotation:this.rotation,opacity:this.opacity,scale:this.scale?this.scale.clone():null}}get width(){return Math.abs(this._width*this.scale.x)}get height(){return Math.abs(this._height*this.scale.y)}set width(t){this._width=t}set height(t){this._height=t}get localBounds(){return Zt.fromDimension(this.width,this.height,X.Zero)}draw(t,e,i){this._preDraw(t,e,i),this._drawImage(t,0,0),this._postDraw(t)}_preDraw(t,e,i){t.save(),t.translate(e,i),t.scale(this.scale.x,this.scale.y),this._rotate(t),this._flip(t),t.opacity=t.opacity*this.opacity}_rotate(t){var e;const i=this.scale.x>0?1:-1,s=this.scale.y>0?1:-1,r=null!==(e=this.origin)&&void 0!==e?e:Q(this.width/2,this.height/2);t.translate(r.x,r.y),t.rotate(this.rotation),t.scale(i,s),t.translate(-r.x,-r.y)}_flip(t){this.flipHorizontal&&(t.translate(this.width/this.scale.x,0),t.scale(-1,1)),this.flipVertical&&(t.translate(0,this.height/this.scale.y),t.scale(1,-1))}_postDraw(t){this.showDebug&&t.debug.drawRect(0,0,this.width,this.height),t.restore()}}bi._ID=0,(Qe=Ye||(Ye={})).End="end",Qe.Loop="loop",Qe.PingPong="pingpong",Qe.Freeze="freeze";class xi extends bi{constructor(t){var e,i;super(t),this.events=new ee(this),this.frames=[],this.strategy=Ye.Loop,this.frameDuration=100,this.timeScale=1,this._idempotencyToken=-1,this._firstTick=!0,this._currentFrame=0,this._timeLeftInFrame=0,this._direction=1,this._done=!1,this._playing=!0,this.frames=t.frames,this.strategy=null!==(e=t.strategy)&&void 0!==e?e:this.strategy,this.frameDuration=null!==(i=t.frameDuration)&&void 0!==i?i:this.frameDuration,this.goToFrame(0)}clone(){return new xi(Object.assign({frames:this.frames.map((t=>Object.assign({},t))),frameDuration:this.frameDuration,strategy:this.strategy},this.cloneGraphicOptions()))}static fromSpriteSheet(t,e,i,s=Ye.Loop){return new xi({frames:t.sprites.filter(((t,i)=>e.indexOf(i)>-1)).map((t=>({graphic:t,duration:i}))),strategy:s})}get currentFrame(){return this._currentFrame>=0&&this._currentFrame<this.frames.length?this.frames[this._currentFrame]:null}get isPlaying(){return this._playing}play(){this._playing=!0}pause(){this._playing=!1,this._firstTick=!0}reset(){this._done=!1,this._firstTick=!0,this._currentFrame=0}get canFinish(){switch(this.strategy){case Ye.End:case Ye.Freeze:return!0;default:return!1}}get done(){return this._done}goToFrame(t){var e,i;this._currentFrame=t,this._timeLeftInFrame=this.frameDuration;const s=this.frames[this._currentFrame];s&&!this._done&&(this._timeLeftInFrame=(null==s?void 0:s.duration)||this.frameDuration,this.width=null===(e=s.graphic)||void 0===e?void 0:e.width,this.height=null===(i=s.graphic)||void 0===i?void 0:i.height,this.events.emit("frame",s))}_nextFrame(){const t=this._currentFrame;if(this._done)return t;let e=-1;switch(this.strategy){case Ye.Loop:e=(t+1)%this.frames.length,0===e&&this.events.emit("loop",this);break;case Ye.End:e=t+1,e>=this.frames.length&&(this._done=!0,this._currentFrame=this.frames.length,this.events.emit("end",this));break;case Ye.Freeze:e=P(t+1,0,this.frames.length-1),e>=this.frames.length-1&&(this._done=!0,this.events.emit("end",this));break;case Ye.PingPong:t+this._direction>=this.frames.length&&(this._direction=-1,this.events.emit("loop",this)),t+this._direction<0&&(this._direction=1,this.events.emit("loop",this)),e=t+this._direction%this.frames.length}return e}tick(t,e=0){this._idempotencyToken!==e&&(this._idempotencyToken=e,this._playing&&(this._firstTick&&(this._firstTick=!1,this.events.emit("frame",this.currentFrame)),this._timeLeftInFrame-=t*this.timeScale,this._timeLeftInFrame<=0&&this.goToFrame(this._nextFrame()),this._updateDimensions()))}_updateDimensions(){var t,e;this.currentFrame&&(this.width=null===(t=this.currentFrame.graphic)||void 0===t?void 0:t.width,this.height=null===(e=this.currentFrame.graphic)||void 0===e?void 0:e.height)}_drawImage(t,e,i){this.currentFrame&&this.currentFrame.graphic.draw(t,e,i)}}class Ai extends bi{constructor(t){super(t),this.members=[],this.members=t.members,this._updateDimensions()}clone(){return new Ai(Object.assign({members:[...this.members]},this.cloneGraphicOptions()))}_updateDimensions(){let t=new Zt;for(const{graphic:e,pos:i}of this.members)t=e.localBounds.translate(i).combine(t);return this.width=t.width,this.height=t.height,t}get localBounds(){let t=new Zt;for(const{graphic:e,pos:i}of this.members)t=e.localBounds.translate(i).combine(t);return t}_isAnimationOrGroup(t){return t instanceof xi||t instanceof Ai}tick(t,e){for(const i of this.members){const s=i.graphic;this._isAnimationOrGroup(s)&&s.tick(t,e)}}reset(){for(const t of this.members){const e=t.graphic;this._isAnimationOrGroup(e)&&e.reset()}}_preDraw(t,e,i){this._updateDimensions(),super._preDraw(t,e,i)}_drawImage(t,e,i){for(const s of this.members)t.save(),t.translate(e,i),s.graphic.draw(t,s.pos.x,s.pos.y),this.showDebug&&t.debug.drawRect(0,0,this.width,this.height),t.restore()}}class Si{constructor(t,e){this._options=t,this._graphics=e,this.graphics=[]}get name(){return this._options.name}hide(t){if(t){let e=null;e=t instanceof bi?t:this._graphics.getGraphic(t),this.graphics=this.graphics.filter((t=>t.graphic!==e))}else this.graphics.length=0}show(t,e){let i;return e=Object.assign({offset:this._graphics.offset.clone(),anchor:this._graphics.anchor.clone()},e),t instanceof bi?i=this._graphics.copyGraphics?t.clone():t:(i=this._graphics.getGraphic(t),i||m.getInstance().error(`No such graphic added to component named ${t}. These named graphics are available: `,this._graphics.getNames())),i?(this.graphics.push({graphic:i,options:e}),i):null}use(t,e){return e=Object.assign({offset:this._graphics.offset.clone(),anchor:this._graphics.anchor.clone()},e),this.hide(),this.show(t,e)}get order(){return this._options.order}set order(t){this._options.order=t}get offset(){var t;return null!==(t=this._options.offset)&&void 0!==t?t:X.Zero}set offset(t){this._options.offset=t}}class Pi{constructor(t){this._component=t,this._layers=[],this._layerMap={},this.default=new Si({name:"default",order:0},t),this._maybeAddLayer(this.default)}create(t){const e=new Si(t,this._component);return this._maybeAddLayer(e)}get(t){return t?this._getLayer(t):this._layers}has(t){return t in this._layerMap}_maybeAddLayer(t){return this._layerMap[t.name]?this._layerMap[t.name]:(this._layerMap[t.name]=t,this._layers.push(t),this._layers.sort(((t,e)=>t.order-e.order)),t)}_getLayer(t){return this._layerMap[t]}}class Ci extends Xe{constructor(t){super(),this.type="ex.graphics",this._graphics={},this.visible=!0,this.opacity=1,this.offset=X.Zero,this.anchor=X.Half,this.copyGraphics=!1,this._bounds=null,t=Object.assign({visible:this.visible},t);const{current:e,anchor:i,opacity:s,visible:r,graphics:n,offset:o,copyGraphics:a,onPreDraw:h,onPostDraw:l}=t;this._graphics=n||{},this.offset=null!=o?o:this.offset,this.opacity=null!=s?s:this.opacity,this.anchor=null!=i?i:this.anchor,this.copyGraphics=null!=a?a:this.copyGraphics,this.onPreDraw=null!=h?h:this.onPreDraw,this.onPostDraw=null!=l?l:this.onPostDraw,this.visible=!!r,this.layers=new Pi(this),e&&this._graphics[e]&&this.show(this._graphics[e])}getGraphic(t){return this._graphics[t]}getNames(){return Object.keys(this._graphics)}get current(){return this.layers.default.graphics}get graphics(){return this._graphics}add(t,e){let i="default",s=null;return"string"==typeof t?(i=t,s=e):s=t,this._graphics[i]=this.copyGraphics?s.clone():s,"default"===i&&this.show("default"),s}show(t,e){return this.layers.default.show(t,e)}use(t,e){return this.layers.default.use(t,e)}hide(t){this.layers.default.hide(t)}_isAnimationOrGroup(t){return t instanceof xi||t instanceof Ai}set localBounds(t){this._bounds=t}get localBounds(){if(this._bounds)return this._bounds;let t=new Zt;for(const e of this.layers.get())for(const{graphic:i,options:{offset:s,anchor:r}}of e.graphics){const n=i.localBounds,o=-n.width*i.scale.x*r.x+s.x,a=-n.height*i.scale.y*r.y+s.y;t=null==i?void 0:i.localBounds.translate(Q(o+e.offset.x,a+e.offset.y)).combine(t)}return t}update(t,e=0){for(const i of this.layers.get())for(const{graphic:s}of i.graphics)this._isAnimationOrGroup(s)&&(null==s||s.tick(t,e))}}function Ei(t){return 0==(t&t-1)}function Ti(t){return Ei(t)?t:function(t){--t;for(let e=1;e<32;e<<=1)t|=t>>e;return t+1}(t)}function Di(t,e){return t&&void 0===t.__isProxy?new Proxy(t,{set:(t,i,s)=>(t[i]!==s&&(t[i]=s,"string"==typeof i&&"_"!==i[0]&&e(t)),!0),get:(t,e)=>"__isProxy"===e||t[e]}):t}class Ri{static registerContext(t){Ri._GL=t}static get(t){return Ri._TEXTURE_MAP.get(t)}static has(t){return Ri._TEXTURE_MAP.has(t)}static load(t,e=!1){const i=Ri._GL;if(!i)return null;let s=null;if(Ri.has(t)&&(s=Ri.get(t)),s){if(e){i.bindTexture(i.TEXTURE_2D,s);const e=Ri.toPowerOfTwoImage(t);i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,e)}return s}s=i.createTexture();const r=Ri.toPowerOfTwoImage(t);return i.bindTexture(i.TEXTURE_2D,s),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,r),Ri._TEXTURE_MAP.set(t,s),s}static toPowerOfTwoImage(t){const e=Ri._POT_CANVAS,i=Ri._POT_CTX;return Ei(t.width)&&Ei(t.height)||(e.width=Ti(t.width),e.height=Ti(t.height),i.imageSmoothingEnabled=!1,i.clearRect(0,0,e.width,e.height),i.drawImage(t,0,0,t.width,t.height),t=e),t}}Ri._POT_CANVAS=document.createElement("canvas"),Ri._POT_CTX=Ri._POT_CANVAS.getContext("2d"),Ri._TEXTURE_MAP=new Map;class Bi extends bi{constructor(t){var e,i,s,r,n,o,a;super(t),this._dirty=!0,this._smoothing=!1,this._color=Di(at.Black,(()=>this.flagDirty())),this._lineWidth=1,this._lineDash=[],this._padding=0,t&&(this.color=null!==(e=t.color)&&void 0!==e?e:at.Black,this.strokeColor=null==t?void 0:t.strokeColor,this.smoothing=null!==(i=t.smoothing)&&void 0!==i?i:this.smoothing,this.lineWidth=null!==(s=t.lineWidth)&&void 0!==s?s:this.lineWidth,this.lineDash=null!==(r=t.lineDash)&&void 0!==r?r:this.lineDash,this.padding=null!==(n=t.padding)&&void 0!==n?n:this.padding),this._bitmap=document.createElement("canvas");const h=null!==(o=null==t?void 0:t.width)&&void 0!==o?o:this._bitmap.width,l=null!==(a=null==t?void 0:t.height)&&void 0!==a?a:this._bitmap.height;this.width=Ti(h),this.height=Ti(l);const c=this._bitmap.getContext("2d");if(!c)throw new Error("Browser does not support 2d canvas drawing, cannot create Raster graphic");this._ctx=c}cloneRasterOptions(){return{color:this.color?this.color.clone():null,strokeColor:this.strokeColor?this.strokeColor.clone():null,smoothing:this.smoothing,lineWidth:this.lineWidth,lineDash:this.lineDash,padding:this.padding}}get dirty(){return this._dirty}flagDirty(){this._dirty=!0}get width(){return this._getTotalWidth()}set width(t){this._bitmap.width=t,this._originalWidth=t,this.flagDirty()}get height(){return this._getTotalHeight()}set height(t){this._bitmap.height=t,this._originalHeight=t,this.flagDirty()}_getTotalWidth(){var t;return(null!==(t=this._originalWidth)&&void 0!==t?t:this._bitmap.width)+2*this.padding}_getTotalHeight(){var t;return(null!==(t=this._originalHeight)&&void 0!==t?t:this._bitmap.height)+2*this.padding}get localBounds(){return Zt.fromDimension(this._getTotalWidth()*this.scale.x,this._getTotalHeight()*this.scale.y,X.Zero)}get smoothing(){return this._smoothing}set smoothing(t){this._smoothing=t,this.flagDirty()}get color(){return this._color}set color(t){var e;(null===(e=this._color)||void 0===e?void 0:e.equal(t))||this.flagDirty(),this._color=Di(t,(()=>this.flagDirty()))}get strokeColor(){return this._strokeColor}set strokeColor(t){var e;(null===(e=this._strokeColor)||void 0===e?void 0:e.equal(t))||this.flagDirty(),this._strokeColor=Di(t,(()=>this.flagDirty()))}get lineWidth(){return this._lineWidth}set lineWidth(t){this._lineWidth=t,this.flagDirty()}get lineDash(){return this._lineDash}set lineDash(t){this._lineDash=t,this.flagDirty()}get padding(){return this._padding}set padding(t){this._padding=t,this.flagDirty()}rasterize(){this._dirty=!1,this._ctx.clearRect(0,0,this._getTotalWidth(),this._getTotalHeight()),this._ctx.save(),this._applyRasterProperites(this._ctx),this.execute(this._ctx),this._ctx.restore(),Ri.load(this._bitmap,!0)}_applyRasterProperites(t){var e,i,s;this._bitmap.width=this._getTotalWidth(),this._bitmap.height=this._getTotalHeight(),t.translate(this.padding,this.padding),t.imageSmoothingEnabled=this.smoothing,t.lineWidth=this.lineWidth,t.setLineDash(null!==(e=this.lineDash)&&void 0!==e?e:t.getLineDash()),t.strokeStyle=null===(i=this.strokeColor)||void 0===i?void 0:i.toString(),t.fillStyle=null===(s=this.color)||void 0===s?void 0:s.toString()}_drawImage(t,e,i){this._dirty&&this.rasterize(),t.drawImage(this._bitmap,e,i)}}class Mi extends Bi{constructor(t){super(t),this.width=t.width,this.height=t.height,this.rasterize()}clone(){return new Mi(Object.assign(Object.assign({width:this.width,height:this.height},this.cloneGraphicOptions()),this.cloneRasterOptions()))}execute(t){this.color&&t.fillRect(0,0,this.width,this.height),this.strokeColor&&t.strokeRect(0,0,this.width,this.height)}}var ki=function(t,e,i,s){var r,n=arguments.length,o=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(o=(n<3?r(o):n>3?r(e,i,o):r(e,i))||o);return n>3&&o&&Object.defineProperty(e,i,o),o};function Oi(t){return t instanceof Ii}class Fi extends wi{constructor(t,e,i,s,r){var n;super([new $e,new Ci,new vi(((t,e)=>this.draw(t,e)))]),this._height=0,this._width=0,this.opacity=1,this.previousOpacity=1,this.logger=m.getInstance(),this.scene=null,this.frames={},this.currentDrawing=null,this._draggable=!1,this._dragging=!1,this._pointerDragStartHandler=()=>{this._dragging=!0},this._pointerDragEndHandler=()=>{this._dragging=!1},this._pointerDragMoveHandler=t=>{this._dragging&&(this.pos=t.pointer.lastWorldPos)},this._pointerDragLeaveHandler=t=>{this._dragging&&(this.pos=t.pointer.lastWorldPos)},this.traits=[],this.enableCapturePointer=!1,this.capturePointer={captureMoveEvents:!1,captureDragEvents:!1},this._isKilled=!1,this._capturePointerEvents=["pointerup","pointerdown","pointermove","pointerenter","pointerleave","pointerdragstart","pointerdragend","pointerdragmove","pointerdragenter","pointerdragleave"],this._captureMoveEvents=["pointermove","pointerenter","pointerleave","pointerdragmove","pointerdragenter","pointerdragleave"],this._captureDragEvents=["pointerdragstart","pointerdragend","pointerdragmove","pointerdragenter","pointerdragleave"],this.transform=this.get($e),this.graphics=this.get(Ci),this._initDefaults();let o=!0,a=it.Passive;if(t&&"object"==typeof t){const n=t;n.pos?(t=n.pos?n.pos.x:0,e=n.pos?n.pos.y:0):(t=n.x||0,e=n.y||0),i=n.width,s=n.height,r=n.color,n.body&&(o=!1,this.body=n.body),n.anchor&&(this.anchor=n.anchor),n.collisionType&&(a=n.collisionType)}this._width=i||0,this._height=s||0,o&&(this.body=new Je({collider:new ui({type:a,shape:Ne.Box(this._width,this._height,this.anchor)})})),this.pos=Q(null!==(n=t)&&void 0!==n?n:0,null!=e?e:0),r&&(this.color=r,this.opacity=r.a),r&&this.graphics.add(new Mi({color:r,width:this._width,height:this._height})),this.traits.push(new ti),f.isEnabled(l.LegacyDrawing)&&this.traits.push(new ii),this.traits.push(new si),this.actions=new He(this)}get body(){return this._body}set body(t){this._body=t,this._body.actor=this}get pos(){return this.body.pos}set pos(t){this.body.pos=t}get oldPos(){return this.body.oldPos}set oldPos(t){this.body.oldPos.setTo(t.x,t.y)}get vel(){return this.body.vel}set vel(t){this.body.vel=t}get oldVel(){return this.body.oldVel}set oldVel(t){this.body.oldVel.setTo(t.x,t.y)}get acc(){return this.body.acc}set acc(t){this.body.acc.setTo(t.x,t.y)}set oldAcc(t){this.body.oldAcc.setTo(t.x,t.y)}get oldAcc(){return this.body.oldAcc}get rotation(){return this.body.rotation}set rotation(t){this.body.rotation=t}get rx(){return this.body.rx}set rx(t){this.body.rx=t}get scale(){return this.get($e).scale}set scale(t){this.get($e).scale=t}get oldScale(){return this.body.oldScale}set oldScale(t){this.body.oldScale=t}get sx(){return this.body.sx}set sx(t){this.body.sx=t}get sy(){return this.body.sy}set sy(t){this.body.sy=t}get isOffScreen(){return this.hasTag("offscreen")}get visible(){return this.graphics.visible}set visible(t){this.graphics.visible=t}get draggable(){return this._draggable}set draggable(t){t&&(t&&!this._draggable?(this.on("pointerdragstart",this._pointerDragStartHandler),this.on("pointerdragend",this._pointerDragEndHandler),this.on("pointerdragmove",this._pointerDragMoveHandler),this.on("pointerdragleave",this._pointerDragLeaveHandler)):!t&&this._draggable&&(this.off("pointerdragstart",this._pointerDragStartHandler),this.off("pointerdragend",this._pointerDragEndHandler),this.off("pointerdragmove",this._pointerDragMoveHandler),this.off("pointerdragleave",this._pointerDragLeaveHandler)),this._draggable=t)}get color(){return this._color}set color(t){this._color=t.clone()}onInitialize(t){}_initialize(t){super._initialize(t);for(const e of this.children)e._initialize(t)}_initDefaults(){this.anchor=Ii.defaults.anchor.clone()}_checkForPointerOptIn(t){if(t){const e=t.toLowerCase();-1!==this._capturePointerEvents.indexOf(e)&&(this.enableCapturePointer=!0,-1!==this._captureMoveEvents.indexOf(e)&&(this.capturePointer.captureMoveEvents=!0),-1!==this._captureDragEvents.indexOf(e)&&(this.capturePointer.captureDragEvents=!0))}}on(t,e){this._checkForPointerOptIn(t),super.on(t,e)}once(t,e){this._checkForPointerOptIn(t),super.once(t,e)}off(t,e){super.off(t,e)}_prekill(t){super.emit("prekill",new ut(this)),this.onPreKill(t)}onPreKill(t){}_postkill(t){super.emit("postkill",new pt(this)),this.onPostKill(t)}onPostKill(t){}kill(){this.scene?(this._prekill(this.scene),this.emit("kill",new dt(this)),this._isKilled=!0,this.scene.remove(this),this._postkill(this.scene)):this.logger.warn("Cannot kill actor, it was never added to the Scene")}unkill(){this._isKilled=!1}isKilled(){return this._isKilled}setDrawing(t){t=t.toString(),this.currentDrawing!==this.frames[t]&&(null!=this.frames[t]?(this.frames[t].reset(),this.currentDrawing=this.frames[t]):m.getInstance().error(`the specified drawing key ${t} does not exist`)),this.currentDrawing&&this.currentDrawing instanceof ye&&this.currentDrawing.tick(0)}addDrawing(){2===arguments.length?(this.frames[arguments[0]]=arguments[1],this.currentDrawing||(this.currentDrawing=arguments[1])):(arguments[0]instanceof _e&&this.addDrawing("default",arguments[0]),arguments[0]instanceof fe&&this.addDrawing("default",arguments[0].asSprite()))}get z(){return this.getZIndex()}set z(t){this.setZIndex(t)}getZIndex(){return this.get($e).z}setZIndex(t){this.get($e).z=t}get center(){return new X(this.pos.x+this.width/2-this.anchor.x*this.width,this.pos.y+this.height/2-this.anchor.y*this.height)}get width(){return this._width*this.getGlobalScale().x}set width(t){this._width=t/this.scale.x,this.body.collider.shape=Ne.Box(this._width,this._height,this.anchor),this.body.markCollisionShapeDirty()}get height(){return this._height*this.getGlobalScale().y}set height(t){this._height=t/this.scale.y,this.body.collider.shape=Ne.Box(this._width,this._height,this.anchor),this.body.markCollisionShapeDirty()}getGlobalRotation(){return this.get($e).globalRotation}getGlobalPos(){return this.get($e).globalPos}getGlobalScale(){return this.get($e).globalScale}contains(t,e,i=!1){const s=Q(t,e),r=this.body.collider.shape.contains(s);return i?r||this.children.some((i=>i.contains(t,e,!0))):r}within(t,e){return this.body.collider.shape.getClosestLineBetween(t.body.collider.shape).getLength()<=e}update(t,e){this._initialize(t),this._preupdate(t,e);const i=this.currentDrawing;i&&i instanceof ye&&i.tick(e,t.stats.currFrame.id),this.actions.update(e),this.color&&(this.color.a=this.opacity),0===this.opacity&&(this.visible=!1),this.body.captureOldTransform(),this.body.integrate(e);for(const i of this.traits)i.update(this,t,e);this._postupdate(t,e)}onPreUpdate(t,e){}onPostUpdate(t,e){}_preupdate(t,e){this.emit("preupdate",new vt(t,e,this)),this.onPreUpdate(t,e)}_postupdate(t,e){this.emit("postupdate",new vt(t,e,this)),this.onPostUpdate(t,e)}draw(t,e){if(t.save(),t.translate(-this._width*this.anchor.x,-this._height*this.anchor.y),this._predraw(t,e),this.currentDrawing){const e=this.currentDrawing,i=(this._width-e.drawWidth)*this.anchor.x,s=(this._height-e.drawHeight)*this.anchor.y;this.currentDrawing.draw({ctx:t,x:i,y:s,opacity:this.opacity})}else this.color&&this.body&&this.body.collider&&this.body.collider.shape&&!this.body.collider.bounds.hasZeroDimensions()&&this.body.collider.shape.draw(t,this.color,new X(0,0));t.restore(),this._postdraw(t,e)}onPreDraw(t,e){}onPostDraw(t,e){}_predraw(t,e){this.emit("predraw",new ft(t,e,this)),this.onPreDraw(t,e)}_postdraw(t,e){this.emit("postdraw",new ft(t,e,this)),this.onPostDraw(t,e)}debugDraw(t){this.emit("predebugdraw",new yt(t,this)),this.body.collider.debugDraw(t);const e=this.body.collider.localBounds.translate(this.getGlobalPos());e.debugDraw(t),t.fillText("id: "+this.id,e.left+3,e.top+10),t.fillStyle=at.Yellow.toString(),t.beginPath(),t.arc(this.getGlobalPos().x,this.getGlobalPos().y,3,0,2*Math.PI),t.closePath(),t.fill();for(let e=0;e<this.traits.length;e++)this.traits[e]instanceof ii&&this.traits[e].cullingBox.debugDraw(t);t.strokeStyle=at.Yellow.toString(),t.beginPath();const i=Math.min(this.width,this.height);t.arc(this.getGlobalPos().x,this.getGlobalPos().y,i,0,2*Math.PI),t.closePath(),t.stroke();const s={"0 Pi":0,"Pi/2":Math.PI/2,Pi:Math.PI,"3/2 Pi":3*Math.PI/2},r=t.font;for(const e in s)t.fillStyle=at.Yellow.toString(),t.font="14px",t.textAlign="center",t.fillText(e,this.getGlobalPos().x+Math.cos(s[e])*(i+10),this.getGlobalPos().y+Math.sin(s[e])*(i+10));t.font=r,this.emit("postdebugdraw",new wt(t,this))}}Fi.defaults={anchor:X.Half},ki([V({message:"ex.Actor.sx will be removed in v0.25.0",alternateMethod:"Set width and height directly in constructor"})],Fi.prototype,"sx",null),ki([V({message:"ex.Actor.sy will be removed in v0.25.0",alternateMethod:"Set width and height directly in constructor"})],Fi.prototype,"sy",null),ki([V({message:"Actor.visible will be removed in v0.26.0",alternateMethod:"Use Actor.graphics.visible"})],Fi.prototype,"visible",null),ki([V({message:"Actor.setDrawing will be removed in v0.26.0",alternateMethod:"Use Actor.graphics.show() or Actor.graphics.swap()"})],Fi.prototype,"setDrawing",null),ki([V({message:"Actor.addDrawing will be removed in v0.26.0",alternateMethod:"Use Actor.graphics.add()"})],Fi.prototype,"addDrawing",null),ki([V({message:"Actor.getZIndex will be removed in v0.26.0",alternateMethod:"Use Actor.transform.z or Actor.z"})],Fi.prototype,"getZIndex",null),ki([V({message:"Actor.setZIndex will be removed in v0.26.0",alternateMethod:"Use Actor.transform.z or Actor.z"})],Fi.prototype,"setZIndex",null);class Ii extends(pe(Fi)){constructor(t,e,i,s,r){super(t,e,i,s,r)}}class Li{static create(){return this._INSTANCE||(window.AudioContext||window.webkitAudioContext)&&(this._INSTANCE=new AudioContext),this._INSTANCE}}Li._INSTANCE=null;class zi{static unlock(){return new Promise(((t,e)=>{if(zi._UNLOCKED||!Li.create())return t(!0);const i=setTimeout((()=>{m.getInstance().warn("Excalibur was unable to unlock the audio context, audio probably will not play in this browser."),t(!1)}),200),s=Li.create();s.resume().then((()=>{const e=s.createBuffer(1,1,22050),r=s.createBufferSource();let n=!1;r.buffer=e,r.connect(s.destination),r.onended=()=>n=!0,r.start(0),setTimeout((()=>{r.playbackState?r.playbackState!==r.PLAYING_STATE&&r.playbackState!==r.FINISHED_STATE||(zi._UNLOCKED=!0):(s.currentTime>0||n)&&(zi._UNLOCKED=!0)}),0),clearTimeout(i),t(!0)}),(()=>{e()}))}))}static isUnlocked(){return this._UNLOCKED}}zi._UNLOCKED=!1;var Ui=i(1388);class Wi extends Bi{constructor(t){super(t),this._options=t}get ctx(){return this._ctx}clone(){return new Wi(Object.assign(Object.assign(Object.assign({},this._options),this.cloneGraphicOptions()),this.cloneRasterOptions()))}execute(t){var e,i;(null===(e=this._options)||void 0===e?void 0:e.draw)&&(null===(i=this._options)||void 0===i||i.draw(t)),this._options.cache||this.flagDirty()}}class Hi extends gi{constructor(t){super(),this.canvas=new Wi({smoothing:!0,draw:this.draw.bind(this)}),this._resourceList=[],this._index=0,this._playButtonShown=!1,this._resourceCount=0,this._numLoaded=0,this._progressCounts={},this._totalCounts={},this.logo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAdQAAAB2CAYAAABxhGI9AAAACXBIWXMAAAsSAAALEgHS3X78AAAKnUlEQVR42u3dP2wjSx0H8N8hJIonIRmJjsq0SBR+BQ1dcqKhe0lD77SvSwpKkJKGPulpktfRIMUdEqKIqV57rpAokM4dbSiyq7ONPTP7x39ifz7SFbnEnp3xer47O7uzH15fXwMA6OYHmgAABCoACFQAEKgAgEAFAIEKAAIVAAQqACBQAUCgAoBABQCBCgAIVAAQqAAgUAFAoAIAAhUABCoACFQAEKgAgECFLbmOiNeFf2PbAyz68Pr6qhUgbRwR92v+/zwiJrYHMEKFMmcN///UtgcQqFBk1PD/97U9Qx8VCFSgu4EmAIEKAAIVAAQqACBQ4Z25jojP8eX+0WtNAgIVaOY+Im5j+eKh24h41jQgUIEyZ7F5NaPU7wCBCiwYd/w9cOB+qAlgJ3KLLow0EV198803RWvJfvfddx+0lhEqHKu5JgAjVCBvlhmFzjQRXUekHz9+TP79y8uLRjNChXfvoePvAYEKxNtj1e42/O5JoIJABcrdRMRVLM+X3kTEpaaB988cKuzWg9EobTWdMx0Oly8uN4dqhAoARqgnaN3arHfqu7OyH8ItKLVB/P+CEfMTHyGPY3npx1m8zWGDEeoBfUk/xdti57dr/r1Wv2+6EPow3tZ5rRdS72s1neuF97xvWd+XTH0/V+UMttDWqbI/r2nrxfp+jv2uSjSO7S+OXy/A/3lN+9xX5T5HxEUPZZ0tfB71+w57eJ/HFu+z+jkv1u92YX9fbI/HhX3JA9rp5MPr66tWaG9UfUGbrHIzi7cLUyYFf/tpTady03EEeL8mUJ6i7MKYNvWNqr4Pe2jradXO60LrvPAz2PQ5RPX684ah8dxD+2zantnCgVipSVV+m/tgB9W2DDq2Sx/vM95wcHhZhWVJm8yrv58cSgfTdc70+++/X/r522+/tUKSEepBqo+om4ZLPerMjUwuNnQCtx1GWJtee1FwdD5uWd86xLs8UaVt2aNEO1/saZ/Z5rYMW4zq6v34rGV9Bg3q2eZ9SkeNm9qwyUh30OPIHYFKx5FG03C7znSOqYBq+qW/zpQ3anH037TNHluG6f0WPsPhHvab4QFty7ogOeuxDYcNy2/zu2214WNYWxmBurNO8bGn97pNBOO8xy/9uCorZZ4I2r4C7aJgO7ZV9iE49Dm6NvOWx+pWE9CUq3zbdTp9doz38TbXtzqH9RT5CyWe422OaZoZGeZCabrhPQY9HjwsjpTvCg4YtlE2+Ta/j2bzn8fqrDqgm+6yUHOmAvWUjAtGhbNYvsBknDnqH1Qhc7VmxHgeb/NbudA5j/UXlYwif2p6luhAc9teu1npiHKnDs8if6tCm7JLX3NKpgttXe9ruc9mHMd7a83iwdxF5vt8tutARaCeklRnNK9C8WnNF7geJQ4T4XG3JhSnVdilQrG+yOnrlVHfsEGYzhNBn7Lu6tS7+HJafJQ4EMiNlNqWXZ9WPvVgnVYHG5M1ByDXkT6leX2EgTqJtyt45yv7S2qO3sEZjZhDLXeR+YKdJ0Zdk8QocvH9N732KrNtq+FZ/zzIHABcJrYpd+Xv14lOd5ap76SgrduW/VTQ1qcQpqnbgu4ifZvUMNpd9XuoZmvCtPaQ2Y/BCHVLgbrJTeRPDdVf6pfMKDU2fOkHmVFFfXr3MsouLsnNvV5kRoe5+s431PeuoKPqWnaurY/ZPBEeqwceN4l96iwO6H7Mjq4y7VGPVNe10VaZMzVCPVWpI/Z6FZbcv5fMqGCU+dLfFGzj58jP8+bCdJCo7yzKTwdOF0bu9Ug7V4c+yz7FJfYeGoysUss0HssIdVZwYLDujMqlESoCdTtGsZtbHnJBeNdDSJSs0jTKdMJN1HNX54Wv7bvsU9NkVJVa13dX+/wuArV0X/l5RHyo/lnfF4G6p6DrS0kHdtXhy35TGErDPYZUn2WfWqDOo/lVqdMD2O/hKJhD7S/odukymq9s02QN4EEPR/zbaOumZc+r15zK1Zqznl9jsfiemTM1QmV3HUuTkedlg9HIQzRbUD93dfC+2tpj2fIHEH2+RqCCQH13gZq7hWXTNpVu19OB1fc9nQ0AKOKUb5lU0P1kDyOneoWk0lOZ9cIP0x7qu8+2BhCoR2wYu1+e7DmaXzBSsu5vaX1ne2zrpmUPTmxf7PM1Dm4y/vC7ny7Nif7+z/9ZmtM0Z3panPLtPmra9f16bcK0Dpbnwk43Vd/RHtu6zfNQTy1QBy3aqG2g9nVmxml+BOoJyT3NpWmn9xhfFnu4bvDa+44BXhqqfdf3uUF9+yz77AT31Yue2mjecYQ62NLfgkA9ghHqLNEhNem4H1c6vdyDxhf/bpz5m4coW/c39wi6VH2bPtHlcaV9cvXts+zxCe6rTeqc2ndL7uGd93QwM9bFcAzMoZZ7SgTBbWx+asui61h/iq1+RmjqdbnQXQ3T1DNQ63V/U9ucqm/pMzPb1rePsk/1iTOjgvatR4W3Lc8ULB78pELyrnAfeTcj1NU509/86mfJ33/8+Mf00a05UyPUEw7UVCeWG/WNEiExyHRMt5ltW30izUPk18ytt7lNfc8i//DvtvXto+ySA5BjljsLUF8lPkqMPEtW1JomDsiGBZ9Byb4NAvUITSN9GuwsIj6t6UTOqk7jJREkmzqli8xIs96udSO20sX0H1vW92IL9e1a9rgqVyf91gbPsTy9UD9n9lOkT8k+RfkFR5PMNqxOcdSf32PBvg3vilO+zdxE+okx9Wm0ph36XYsRZCpMF993GOk5qvqB3Dct6jvssb67KvuUNJ3frw92bhr8/STSF0JdRPMLpUCgnsgo9S76PZ246ZFk1wWvK5m3vVoYvW1Sz7nN91jfXbQ1ZQc7TW6HeaoOalypG/8/p/rP1aNAc6ZHzSnfdqPUPhdy2PQw6Nz9gSVhuhiqueUHR3uu7y7K3rdDX4u46ZrPbUa0IFBZ0seKQ3XQTRt2vm3W/a2DbNKys++rvm3ep6+y1x2UdP3bWU9lzra47U1GmlctX/sQ23t+aOlByLTh/4NAPaCRxtcdO5HLSJ/6vNtCwGx67VPmPbvWd1q9frKHtp4kAqRJ2HR9j762JfX3bZ//elPtj13PPDx1+D5tqk/Xi6NO8SHz7MmH19dXrdBNfVFP6T2PT1UHNit87/t4m5+aRH+nQBdvqyhZDKJLfZs8h7XPsqdV2ZOV+tanKB8aln0dyxdAXbV4j4gvt4oMOrbP6vbU73NW7TMlbdTnPrWpfqXfh9HKZ9vke7KuTeZRNtXRSe6+1FV//ce/ln5eXfsXgcqXzr6+9261M3moOoa7E6nvTZTfy7iNsmfb7kjfgXGsvxe0vihsEts9HTquPpt1q1vtahu2TqAiUAEEKj0zhwoARqgAu/OnX/442WH+9xc/Wvr58re/Tr7f41/+ZsRqhAoACFQAEKgAcHjMoQJskJsz/eqrr5Z+vvr7v5fmQFevAl5lztQIFQAQqAAgUAHgIJlDBdhgdQ41N2eKESoAIFABQKACwFEwhwoARqgAIFABQKACAAIVAAQqAAhUABCoAIBABQCBCgACFQAEKgAgUAFAoAKAQAUAgQoACFQAEKgAIFABQKACAAIVAAQqAAhUABCoAIBABQCBCgACFQAQqAAgUAFAoAKAQAUAlvwPcFDns1DsH4sAAAAASUVORK5CYII=",this.logoWidth=468,this.logoHeight=118,this.loadingBarColor=at.White,this.backgroundColor="#176BAA",this.suppressPlayButton=!1,this._playButtonStyles=Ui.Z.toString(),this.playButtonText="Play game",this.startButtonFactory=()=>{let t=document.getElementById("excalibur-play");return t||(t=document.createElement("button")),t.id="excalibur-play",t.textContent=this.playButtonText,t.style.display="none",t},t&&this.addResources(t)}get _image(){return this._imageElement||(this._imageElement=new Image,this._imageElement.src=this.logo),this._imageElement}get playButtonRootElement(){return this._playButtonRootElement}get playButtonElement(){return this._playButtonElement}get _playButton(){const t=document.getElementById("excalibur-play-root");return t&&(this._playButtonRootElement=t),this._playButtonRootElement||(this._playButtonRootElement=document.createElement("div"),this._playButtonRootElement.id="excalibur-play-root",this._playButtonRootElement.style.position="absolute",document.body.appendChild(this._playButtonRootElement)),this._styleBlock||(this._styleBlock=document.createElement("style"),this._styleBlock.textContent=this._playButtonStyles,document.head.appendChild(this._styleBlock)),this._playButtonElement||(this._playButtonElement=this.startButtonFactory(),this._playButtonRootElement.appendChild(this._playButtonElement)),this._playButtonElement}wireEngine(t){this._engine=t,this.canvas.width=this._engine.canvas.width,this.canvas.height=this._engine.canvas.height}addResource(t){const e=this._index++;this._resourceList.push(t),this._progressCounts[e]=0,this._totalCounts[e]=1,this._resourceCount++}addResources(t){let e=0;const i=t.length;for(;e<i;e++)this.addResource(t[e])}isLoaded(){return this._numLoaded===this._resourceCount}showPlayButton(){return this.suppressPlayButton?Promise.resolve():(this._playButtonShown=!0,this._playButton.style.display="block",document.body.addEventListener("keyup",(t=>{"Enter"===t.key&&this._playButton.click()})),new Promise((t=>{const e=e=>{e.stopPropagation(),t()};this._playButton.addEventListener("click",e),this._playButton.addEventListener("touchend",e),this._playButton.addEventListener("pointerup",e)})))}hidePlayButton(){this._playButtonShown=!1,this._playButton.style.display="none"}dispose(){this._playButtonRootElement.parentElement&&(this._playButtonRootElement.removeChild(this._playButtonElement),document.body.removeChild(this._playButtonRootElement),document.head.removeChild(this._styleBlock),this._playButtonRootElement=null,this._playButtonElement=null,this._styleBlock=null)}update(t,e){}load(){return t=this,e=void 0,s=function*(){return yield Promise.all(this._resourceList.map((t=>t.load().finally((()=>{this._numLoaded++}))))),yield W(200),yield this.showPlayButton(),yield zi.unlock(),this.hidePlayButton(),this.data=this._resourceList},new((i=void 0)||(i=Promise))((function(r,n){function o(t){try{h(s.next(t))}catch(t){n(t)}}function a(t){try{h(s.throw(t))}catch(t){n(t)}}function h(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((s=s.apply(t,e||[])).next())}));var t,e,i,s}markResourceComplete(){this._numLoaded++}get progress(){return this._resourceCount>0?P(this._numLoaded,0,this._resourceCount)/this._resourceCount:1}draw(t){const e=this._engine.canvasHeight/this._engine.pixelRatio,i=this._engine.canvasWidth/this._engine.pixelRatio;if(this._playButtonRootElement){const t=this._engine.canvas.offsetLeft,s=this._engine.canvas.offsetTop,r=this._playButton.clientWidth,n=this._playButton.clientHeight;this.playButtonPosition?(this._playButtonRootElement.style.left=this.playButtonPosition.x+"px",this._playButtonRootElement.style.top=this.playButtonPosition.y+"px"):(this._playButtonRootElement.style.left=t+i/2-r/2+"px",this._playButtonRootElement.style.top=s+e/2-n/2+100+"px")}t.fillStyle=this.backgroundColor,t.fillRect(0,0,i,e);let s=e/2;const r=Math.min(this.logoWidth,.75*i);let n=i/2-r/2;this.logoPosition&&(n=this.logoPosition.x,s=this.logoPosition.y);const o=Math.floor(r*(this.logoHeight/this.logoWidth)),a=this._engine.getAntialiasing();if(this._engine.setAntialiasing(!0),this.logoPosition?t.drawImage(this._image,0,0,this.logoWidth,this.logoHeight,n,s,r,o):t.drawImage(this._image,0,0,this.logoWidth,this.logoHeight,n,s-o-20,r,o),!this.suppressPlayButton&&this._playButtonShown)return void this._engine.setAntialiasing(a);let h=n,l=s;this.loadingBarPosition&&(h=this.loadingBarPosition.x,l=this.loadingBarPosition.y),t.lineWidth=2,ai(t,h,l,r,20,10,this.loadingBarColor);const c=r*this.progress-10;ai(t,h+5,l+5,c>10?c:10,10,5,null,this.loadingBarColor),this._engine.setAntialiasing(a)}}const Ni={webgl:"WebGL",webaudio:"WebAudio",gamepadapi:"Gamepad API"};class ji{constructor(){this._features=null,this.failedTests=[],this._criticalTests={canvasSupport:function(){const t=document.createElement("canvas");return!(!t.getContext||!t.getContext("2d"))},arrayBufferSupport:function(){const t=new XMLHttpRequest;t.open("GET","/");try{t.responseType="arraybuffer"}catch(t){return!1}return"arraybuffer"===t.responseType},dataUrlSupport:function(){return 0===document.createElement("canvas").toDataURL("image/png").indexOf("data:image/png")},objectUrlSupport:function(){return"URL"in window&&"revokeObjectURL"in URL&&"createObjectURL"in URL},rgbaSupport:function(){const t=document.createElement("a").style;return t.cssText="background-color:rgba(150,255,150,.5)",(""+t.backgroundColor).indexOf("rgba")>-1}},this._warningTest={webAudioSupport:function(){return!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext||window.oAudioContext)},webglSupport:function(){const t=document.createElement("canvas");return!(!t.getContext||!t.getContext("webgl"))}},this._features=this._loadBrowserFeatures()}getBrowserFeatures(){return null===this._features&&(this._features=this._loadBrowserFeatures()),this._features}logBrowserFeatures(){let t="%cSUPPORTED BROWSER FEATURES\n==========================%c\n";const e=["font-weight: bold; color: navy","font-weight: normal; color: inherit"],i=this.getBrowserFeatures();for(const s of Object.keys(Ni))i[s]?(t+="(%c✓%c)",e.push("font-weight: bold; color: green"),e.push("font-weight: normal; color: inherit")):(t+="(%c✗%c)",e.push("font-weight: bold; color: red"),e.push("font-weight: normal; color: inherit")),t+=" "+Ni[s]+"\n";e.unshift(t),console.log.apply(console,e)}_loadBrowserFeatures(){return{canvas:(()=>this._criticalTests.canvasSupport())(),arraybuffer:(()=>this._criticalTests.arrayBufferSupport())(),dataurl:(()=>this._criticalTests.dataUrlSupport())(),objecturl:(()=>this._criticalTests.objectUrlSupport())(),rgba:(()=>this._criticalTests.rgbaSupport())(),webaudio:(()=>this._warningTest.webAudioSupport())(),webgl:(()=>this._warningTest.webglSupport())(),gamepadapi:!!navigator.getGamepads}}test(){let t=!1;for(const e in this._criticalTests)this._criticalTests[e].call(this)||(this.failedTests.push(e),m.getInstance().error("Critical browser feature missing, Excalibur requires:",e),t=!0);if(t)return!1;for(const t in this._warningTest)this._warningTest[t]()||m.getInstance().warn("Warning browser feature missing, Excalibur will have reduced performance:",t);return!0}}class Gi extends Ii{constructor(t,e,i,s){"object"!=typeof t?super(t,e,i,s):super(t),this.get($e).coordPlane=qe.Screen,this.traits=[],this.traits.push(new si),this.anchor=X.Zero,this.body.collider.type=it.PreventCollision,this.body.collider.shape=Ne.Box(this.width,this.height,this.anchor),this.enableCapturePointer=!0}_initialize(t){this._engine=t,super._initialize(t)}contains(t,e,i=!0){if(i)return super.contains(t,e);const s=this._engine.worldToScreenCoordinates(new X(t,e));return super.contains(s.x,s.y)}}class Vi{constructor(t,e,i,s){if(this.id=0,this.interval=10,this.repeats=!1,this.maxNumberOfRepeats=-1,this._elapsedTime=0,this._totalTimeAlive=0,this._paused=!1,this._numberOfTicks=0,this.complete=!1,this.scene=null,"function"!=typeof t){const r=t;t=r.fcn,e=r.interval,i=r.repeats,s=r.numberOfRepeats}if(s&&s>=0&&(this.maxNumberOfRepeats=s,!i))throw new Error("repeats must be set to true if numberOfRepeats is set");this.id=Vi.id++,this.interval=e||this.interval,this.repeats=i||this.repeats,this._callbacks=[],t&&this.on(t)}on(t){this._callbacks.push(t)}off(t){const e=this._callbacks.indexOf(t);this._callbacks.splice(e,1)}update(t){this._paused||(this._totalTimeAlive+=t,this._elapsedTime+=t,this.maxNumberOfRepeats>-1&&this._numberOfTicks>=this.maxNumberOfRepeats&&(this.complete=!0),!this.complete&&this._elapsedTime>=this.interval&&(this._callbacks.forEach((t=>{t.call(this)})),this._numberOfTicks++,this.repeats?this._elapsedTime=0:this.complete=!0))}reset(t,e){if(t&&t>=0&&(this.interval=t),this.maxNumberOfRepeats&&this.maxNumberOfRepeats>=0&&(this.maxNumberOfRepeats=e,!this.repeats))throw new Error("repeats must be set to true if numberOfRepeats is set");this.complete=!1,this._elapsedTime=0,this._numberOfTicks=0}get timesRepeated(){return this._numberOfTicks}getTimeRunning(){return this._totalTimeAlive}pause(){this._paused=!0}unpause(){this._paused=!1}cancel(){this.scene&&this.scene.cancelTimer(this)}}Vi.id=0;class Xi{constructor(t){this.parent=t,this.parent=t||null,this.body=null,this.bounds=new Zt,this.left=null,this.right=null,this.height=0}isLeaf(){return!this.left&&!this.right}}class Ki{constructor(t=new Zt(-Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)){this.worldBounds=t,this.root=null,this.nodes={}}_insert(t){if(null===this.root)return this.root=t,void(this.root.parent=null);const e=t.bounds;let i=this.root;for(;!i.isLeaf();){const t=i.left,s=i.right,r=i.bounds.getPerimeter(),n=i.bounds.combine(e).getPerimeter(),o=2*n,a=2*(n-r);let h=0;const l=e.combine(t.bounds);let c,d;t.isLeaf()?h=l.getPerimeter()+a:(d=t.bounds.getPerimeter(),c=l.getPerimeter(),h=c-d+a);let u=0;const p=e.combine(s.bounds);if(s.isLeaf()?u=p.getPerimeter()+a:(d=s.bounds.getPerimeter(),c=p.getPerimeter(),u=c-d+a),o<h&&o<u)break;i=h<u?t:s}const s=i.parent,r=new Xi(s);r.bounds=e.combine(i.bounds),r.height=i.height+1,null!==s?(s.left===i?s.left=r:s.right=r,r.left=i,r.right=t,i.parent=r,t.parent=r):(r.left=i,r.right=t,i.parent=r,t.parent=r,this.root=r);let n=t.parent;for(;n;){if(n=this._balance(n),!n.left)throw new Error("Parent of current leaf cannot have a null left child"+n);if(!n.right)throw new Error("Parent of current leaf cannot have a null right child"+n);n.height=1+Math.max(n.left.height,n.right.height),n.bounds=n.left.bounds.combine(n.right.bounds),n=n.parent}}_remove(t){if(t===this.root)return void(this.root=null);const e=t.parent,i=e.parent;let s;if(s=e.left===t?e.right:e.left,i){i.left===e?i.left=s:i.right=s,s.parent=i;let t=i;for(;t;)t=this._balance(t),t.bounds=t.left.bounds.combine(t.right.bounds),t.height=1+Math.max(t.left.height,t.right.height),t=t.parent}else this.root=s,s.parent=null}trackBody(t){const e=new Xi;e.body=t,e.bounds=t.collider.bounds,e.bounds.left-=2,e.bounds.top-=2,e.bounds.right+=2,e.bounds.bottom+=2,this.nodes[t.id]=e,this._insert(e)}updateBody(t){const e=this.nodes[t.id];if(!e)return!1;const i=t.collider.bounds;if(!this.worldBounds.contains(i))return m.getInstance().warn("Collider with id "+t.id+" is outside the world bounds and will no longer be tracked for physics"),this.untrackBody(t),!1;if(e.bounds.contains(i))return!1;this._remove(e),i.left-=lt.boundsPadding,i.top-=lt.boundsPadding,i.right+=lt.boundsPadding,i.bottom+=lt.boundsPadding;const s=t.vel.x*lt.dynamicTreeVelocityMultiplier,r=t.vel.y*lt.dynamicTreeVelocityMultiplier;return s<0?i.left+=s:i.right+=s,r<0?i.top+=r:i.bottom+=r,e.bounds=i,this._insert(e),!0}untrackBody(t){const e=this.nodes[t.collider.id];e&&(this._remove(e),this.nodes[t.collider.id]=null,delete this.nodes[t.collider.id])}_balance(t){if(null===t)throw new Error("Cannot balance at null node");if(t.isLeaf()||t.height<2)return t;const e=t.left,i=t.right,s=t,r=e,n=i,o=e.left,a=e.right,h=i.left,l=i.right,c=n.height-r.height;if(c>1)return n.left=s,n.parent=s.parent,s.parent=n,n.parent?n.parent.left===s?n.parent.left=n:n.parent.right=n:this.root=n,h.height>l.height?(n.right=h,s.right=l,l.parent=s,s.bounds=r.bounds.combine(l.bounds),n.bounds=s.bounds.combine(h.bounds),s.height=1+Math.max(r.height,l.height),n.height=1+Math.max(s.height,h.height)):(n.right=l,s.right=h,h.parent=s,s.bounds=r.bounds.combine(h.bounds),n.bounds=s.bounds.combine(l.bounds),s.height=1+Math.max(r.height,h.height),n.height=1+Math.max(s.height,l.height)),n;if(c<-1){if(r.left=s,r.parent=s.parent,s.parent=r,r.parent)if(r.parent.left===s)r.parent.left=r;else{if(r.parent.right!==s)throw"Error rotating Dynamic Tree";r.parent.right=r}else this.root=r;return o.height>a.height?(r.right=o,s.left=a,a.parent=s,s.bounds=n.bounds.combine(a.bounds),r.bounds=s.bounds.combine(o.bounds),s.height=1+Math.max(n.height,a.height),r.height=1+Math.max(s.height,o.height)):(r.right=a,s.left=o,o.parent=s,s.bounds=n.bounds.combine(o.bounds),r.bounds=s.bounds.combine(a.bounds),s.height=1+Math.max(n.height,o.height),r.height=1+Math.max(s.height,a.height)),r}return t}getHeight(){return null===this.root?0:this.root.height}query(t,e){const i=t.collider.bounds,s=r=>{if(r&&r.bounds.intersect(i)){if(!r.isLeaf()||r.body===t)return s(r.left)||s(r.right);if(e.call(t,r.body))return!0}return!1};s(this.root)}rayCastQuery(t,e=1/0,i){const s=r=>{if(r&&r.bounds.rayCast(t,e)){if(!r.isLeaf())return s(r.left)||s(r.right);if(i.call(t,r.body))return!0}return!1};s(this.root)}getNodes(){const t=e=>e?[e].concat(t(e.left),t(e.right)):[];return t(this.root)}debugDraw(t){const e=i=>{i&&(i.isLeaf()?(t.lineWidth=1,t.strokeStyle="green"):(t.lineWidth=1,t.strokeStyle="white"),i.bounds.debugDraw(t),i.left&&e(i.left),i.right&&e(i.right))};e(this.root)}}class qi{constructor(){this._dynamicCollisionTree=new Ki,this._collisionHash={},this._collisionPairCache=[],this._lastFramePairs=[],this._lastFramePairsHash={}}track(t){t?this._dynamicCollisionTree.trackBody(t):m.getInstance().warn("Cannot track null physics body")}untrack(t){t?this._dynamicCollisionTree.untrackBody(t):m.getInstance().warn("Cannot untrack a null physics body")}_shouldGenerateCollisionPair(t,e){const i=ci.calculatePairHash(t,e);return!this._collisionHash[i]&&ci.canCollide(t,e)}broadphase(t,e,i){const s=e/1e3,r=t.map((t=>t.collider)).filter((t=>t.active&&t.type!==it.PreventCollision));let n;this._collisionPairCache=[],this._collisionHash={};for(let t=0,e=r.length;t<e;t++)n=r[t],this._dynamicCollisionTree.query(n.body,(t=>{if(this._shouldGenerateCollisionPair(n,t.collider)){const e=new ci(n,t.collider);this._collisionHash[e.id]=!0,this._collisionPairCache.push(e)}return!1}));if(i&&(i.physics.pairs=this._collisionPairCache.length),lt.checkForFastBodies)for(const t of r){if(t.type!==it.Active)continue;const e=t.body.vel.size*s+.5*t.body.acc.size*s*s,r=Math.min(t.bounds.height,t.bounds.width);if(lt.disableMinimumSpeedForFastBody||e>r/2){i&&i.physics.fastBodies++;const s=t.body.pos.sub(t.body.oldPos),r=t.shape.center,n=t.shape.getFurthestPoint(t.body.vel),o=n.sub(s),a=new K(o,t.body.vel);let h;a.pos=a.pos.add(a.dir.scale(-2*lt.surfaceEpsilon));let l=new X(1/0,1/0);if(this._dynamicCollisionTree.rayCastQuery(a,e+2*lt.surfaceEpsilon,(i=>{if(t.body!==i&&i.collider.shape&&ci.canCollide(t,i.collider)){const t=i.collider.shape.rayCast(a,e+10*lt.surfaceEpsilon);if(t){const e=t.sub(o);e.size<l.size&&(l=e,h=i)}}return!1})),h&&X.isValid(l)){const e=new ci(t,h.collider);this._collisionHash[e.id]||(this._collisionHash[e.id]=!0,this._collisionPairCache.push(e));const s=r.sub(n);t.body.pos=o.add(s).add(l).add(a.dir.scale(2*lt.surfaceEpsilon)),t.shape.recalc(),i&&i.physics.fastBodyCollisions++}}}return this._collisionPairCache}narrowphase(t,e){for(let i=0;i<t.length;i++)t[i].collide(),e&&t[i].collision&&(e.physics.collisions++,e.physics.collidersHash[t[i].id]=t[i]);return t.filter((t=>t.collision))}resolve(t,e,i){for(const s of t)s.resolve(i),s.collision&&(s.colliderA.body.applyMtv(),s.colliderB.body.applyMtv(),s.colliderA.body.integrate(e*lt.collisionShift),s.colliderB.body.integrate(e*lt.collisionShift));return t.filter((t=>t.canCollide))}runCollisionStartEnd(t){const e={};for(const i of t)if(e[i.id]=i,!this._lastFramePairsHash[i.id]){const t=i.colliderA,e=i.colliderB;t.emit("collisionstart",new Ot(t,e,i)),e.emit("collisionstart",new Ot(e,t,i))}for(const t of this._lastFramePairs)if(!e[t.id]){const e=t.colliderA,i=t.colliderB;e.emit("collisionend",new Ft(e,i)),i.emit("collisionend",new Ft(i,e))}this._lastFramePairs=t,this._lastFramePairsHash=e}update(t){let e=0;const i=t.length;for(let s=0;s<i;s++)this._dynamicCollisionTree.updateBody(t[s])&&e++;return e}debugDraw(t){if(lt.broadphaseDebug&&this._dynamicCollisionTree.debugDraw(t),lt.showContacts||lt.showCollisionNormals)for(const e of this._collisionPairCache)e.debugDraw(t)}}class Yi{constructor(t,e=!1){this.path=t,this.data=new Image,this._resource=new ie(t,"blob",e),this.ready=new Promise((t=>{this._loadedResolve=t}))}get width(){return this.image.naturalWidth}get height(){return this.image.naturalHeight}isLoaded(){return!!this.data.src}get image(){return this.data}load(){return t=this,e=void 0,s=function*(){if(this.isLoaded())return this.data;try{let t;if(this.path.includes("data:image/"))t=this.path;else{const e=yield this._resource.load();t=URL.createObjectURL(e)}const e=new Image;e.src=t,yield e.decode(),this.data=e}catch(t){yield Promise.reject("Error loading texture")}return this._loadedResolve(this.data),this.data},new((i=void 0)||(i=Promise))((function(r,n){function o(t){try{h(s.next(t))}catch(t){n(t)}}function a(t){try{h(s.throw(t))}catch(t){n(t)}}function h(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((s=s.apply(t,e||[])).next())}));var t,e,i,s}toSprite(){return Zi.from(this)}static fromLegacyTexture(t){const e=new Yi(t.path);return t.isLoaded()?e.data=t.data:t.loaded.then((()=>{e.data=t.data})),e}unload(){this.data=new Image}}class Zi extends bi{constructor(t){var e,i;super(t),this.image=t.image,this.sourceView=null!==(e=t.sourceView)&&void 0!==e?e:{x:0,y:0,width:0,height:0},this.destSize=null!==(i=t.destSize)&&void 0!==i?i:{width:0,height:0},this._updateSpriteDimensions(),this.image.ready.then((()=>{this._updateSpriteDimensions()}))}static from(t){return new Zi({image:t})}_updateSpriteDimensions(){var t,e,i,s,r,n;const{width:o,height:a}=this.image;this.sourceView.width=(null===(t=this.sourceView)||void 0===t?void 0:t.width)||o,this.sourceView.height=(null===(e=this.sourceView)||void 0===e?void 0:e.height)||a,this.destSize.width=(null===(i=this.destSize)||void 0===i?void 0:i.width)||(null===(s=this.sourceView)||void 0===s?void 0:s.width)||o,this.destSize.height=(null===(r=this.destSize)||void 0===r?void 0:r.height)||(null===(n=this.sourceView)||void 0===n?void 0:n.height)||a,this.width=Math.ceil(this.destSize.width),this.height=Math.ceil(this.destSize.height)}_preDraw(t,e,i){this.image.isLoaded()&&this._updateSpriteDimensions(),super._preDraw(t,e,i)}_drawImage(t,e,i){this.image.isLoaded()&&(this._updateSpriteDimensions(),t.drawImage(this.image.image,this.sourceView.x,this.sourceView.y,this.sourceView.width,this.sourceView.height,e,i,this.destSize.width,this.destSize.height))}static fromLegacySprite(t){const e=t.texture,i=Yi.fromLegacyTexture(e);return new Zi({image:i,sourceView:{x:t.x,y:t.y,width:t.width,height:t.height}})}static toLegacySprite(t){const e=t.image,i=new fe(e.path);return i.data=e.image,new _e(i,t.sourceView.x,t.sourceView.y,t.sourceView.width,t.sourceView.height)}clone(){return new Zi(Object.assign({image:this.image,sourceView:Object.assign({},this.sourceView),destSize:Object.assign({},this.destSize)},this.cloneGraphicOptions()))}}class Qi{constructor(t){this.sprites=[];const{sprites:e}=t;this.sprites=e}static fromLegacySpriteSheet(t){const e=t.sprites.map((t=>Zi.fromLegacySprite(t)));return new Qi({sprites:e})}static fromGrid(t){var e;const i=[];t.spacing=null!==(e=t.spacing)&&void 0!==e?e:{};const{image:s,grid:{rows:r,columns:n,spriteWidth:o,spriteHeight:a},spacing:{originOffset:h,margin:l}}=t,c=Object.assign({x:0,y:0},h),d=Object.assign({x:0,y:0},l);for(let t=0;t<n;t++)for(let e=0;e<r;e++)i[t+e*n]=new Zi({image:s,sourceView:{x:t*o+d.x*t+c.x,y:e*a+d.y*e+c.y,width:o,height:a},destSize:{height:a,width:o}});return new Qi({sprites:i})}}var $i,Ji,ts=function(t,e,i,s){var r,n=arguments.length,o=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(o=(n<3?r(o):n>3?r(e,i,o):r(e,i))||o);return n>3&&o&&Object.defineProperty(e,i,o),o};class es extends wi{constructor(t,e,i,s,r,n){if(super([new $e,new Ci({onPostDraw:(t,e)=>this.draw(t,e)}),new vi(((t,e)=>this.draw(t,e)))]),this._collidingX=-1,this._collidingY=-1,this._onScreenXStart=0,this._onScreenXEnd=9999,this._onScreenYStart=0,this._onScreenYEnd=9999,this._spriteSheets={},this._legacySpriteMap=new Map,this.logger=m.getInstance(),this.data=[],this.visible=!0,this.isOffscreen=!1,t&&"object"==typeof t){const o=t;t=o.x,e=o.y,i=o.cellWidth,s=o.cellHeight,r=o.rows,n=o.cols}this.x=t,this.y=e,this.cellWidth=i,this.cellHeight=s,this.rows=r,this.cols=n,this.data=new Array(r*n);for(let o=0;o<n;o++)for(let a=0;a<r;a++)(()=>{const r=new rs(o*i+t,a*s+e,i,s,o+a*n);this.data[o+a*n]=r})();this._transform=this.get($e),this.get(Ci).localBounds=new Zt({left:0,top:0,right:this.cols*this.cellWidth,bottom:this.rows*this.cellHeight})}get x(){var t;return null!==(t=this._transform.pos.x)&&void 0!==t?t:0}set x(t){var e;(null===(e=this._transform)||void 0===e?void 0:e.pos)&&(this.get($e).pos=Q(t,this.y))}get y(){var t,e;return null!==(e=null===(t=this._transform)||void 0===t?void 0:t.pos.y)&&void 0!==e?e:0}set y(t){var e;(null===(e=this._transform)||void 0===e?void 0:e.pos)&&(this._transform.pos=Q(this.x,t))}get z(){var t;return null!==(t=this._transform.z)&&void 0!==t?t:0}set z(t){var e;(null===(e=this._transform)||void 0===e?void 0:e.z)&&(this._transform.z=t)}get rotation(){var t,e;return null!==(e=null===(t=this._transform)||void 0===t?void 0:t.rotation)&&void 0!==e?e:0}set rotation(t){var e;(null===(e=this._transform)||void 0===e?void 0:e.rotation)&&(this._transform.rotation=t)}get scale(){var t,e;return null!==(e=null===(t=this._transform)||void 0===t?void 0:t.scale)&&void 0!==e?e:X.One}set scale(t){var e;(null===(e=this._transform)||void 0===e?void 0:e.scale)&&(this._transform.scale=t)}get pos(){return this._transform.pos}set pos(t){this._transform.pos=t}on(t,e){super.on(t,e)}_initialize(t){super._initialize(t)}registerSpriteSheet(t,e){this._spriteSheets[t]=e instanceof Qi?e:Qi.fromLegacySpriteSheet(e)}collides(t){const e=t.pos.x+t.width,i=t.pos.y+t.height,s=t.body.collider.bounds,r=[];if(t.width<=0||t.height<=0)return null;for(let n=s.left;n<=e;n+=Math.min(t.width/2,this.cellWidth/2))for(let e=s.top;e<=i;e+=Math.min(t.height/2,this.cellHeight/2)){const i=this.getCellByPoint(n,e);if(i&&i.solid){const e=s.intersect(i.bounds),n=t.center.sub(i.center);e&&e.dot(n)>0&&r.push(e)}}return 0===r.length?null:r.reduce(((t,e)=>{let i=t.x,s=t.y;return Math.abs(t.x)<Math.abs(e.x)&&(i=e.x),Math.abs(t.y)<Math.abs(e.y)&&(s=e.y),new X(i,s)}))}getCellByIndex(t){return this.data[t]}getCell(t,e){return t<0||e<0||t>=this.cols||e>=this.rows?null:this.data[t+e*this.cols]}getCellByPoint(t,e){t=Math.floor((t-this.x)/this.cellWidth),e=Math.floor((e-this.y)/this.cellHeight);const i=this.getCell(t,e);return t>=0&&e>=0&&t<this.cols&&e<this.rows&&i?i:null}onPreUpdate(t,e){}onPostUpdate(t,e){}update(t,e){this.onPreUpdate(t,e),this.emit("preupdate",new vt(t,e,this));const i=t.getWorldBounds(),s=Q(i.left,i.top),r=Q(i.right,i.bottom);this._onScreenXStart=Math.max(Math.floor((s.x-this.x)/this.cellWidth)-2,0),this._onScreenYStart=Math.max(Math.floor((s.y-this.y)/this.cellHeight)-2,0),this._onScreenXEnd=Math.max(Math.floor((r.x-this.x)/this.cellWidth)+2,0),this._onScreenYEnd=Math.max(Math.floor((r.y-this.y)/this.cellHeight)+2,0),this._transform.pos=Q(this.x,this.y),this.onPostUpdate(t,e),this.emit("postupdate",new bt(t,e,this))}draw(t,e){this.emit("predraw",new ft(t,e,this));let i=this._onScreenXStart;const s=Math.min(this._onScreenXEnd,this.cols);let r=this._onScreenYStart;const n=Math.min(this._onScreenYEnd,this.rows);let o,a,h;for(;i<s;i++){for(;r<n;r++)for(o=this.getCell(i,r).sprites,a=0,h=o.length;a<h;a++){const e=o[a];e&&(t instanceof CanvasRenderingContext2D?(this._legacySpriteMap.has(e)||this._legacySpriteMap.set(e,Zi.toLegacySprite(e)),this._legacySpriteMap.get(e).draw(t,i*this.cellWidth,r*this.cellHeight)):e.draw(t,i*this.cellWidth,r*this.cellHeight))}r=this._onScreenYStart}this.emit("postdraw",new mt(t,e,this))}debugDraw(t){const e=this.cols*this.cellWidth,i=this.rows*this.cellHeight;t.save(),t.strokeStyle=at.Red.toString();for(let e=0;e<this.cols+1;e++)t.beginPath(),t.moveTo(this.x+e*this.cellWidth,this.y),t.lineTo(this.x+e*this.cellWidth,this.y+i),t.stroke();for(let i=0;i<this.rows+1;i++)t.beginPath(),t.moveTo(this.x,this.y+i*this.cellHeight),t.lineTo(this.x+e,this.y+i*this.cellHeight),t.stroke();const s=at.Red;s.a=.3,this.data.filter((function(t){return t.solid})).forEach((function(e){t.fillStyle=s.toString(),t.fillRect(e.x,e.y,e.width,e.height)})),this._collidingY>-1&&this._collidingX>-1&&(t.fillStyle=at.Cyan.toString(),t.fillRect(this.x+this._collidingX*this.cellWidth,this.y+this._collidingY*this.cellHeight,this.cellWidth,this.cellHeight)),t.restore()}}ts([V({message:"No longer used, will be removed in v0.26.0"})],es.prototype,"registerSpriteSheet",null);class is extends(pe(es)){constructor(t,e,i,s,r,n){super(t,e,i,s,r,n)}}class ss extends wi{constructor(t,e,i,s,r,n=!1,o=[]){if(super(),this.solid=!1,this.sprites=[],t&&"object"==typeof t){const a=t;t=a.x,e=a.y,i=a.width,s=a.height,r=a.index,n=a.solid,o=a.sprites}this.x=t,this.y=e,this.width=i,this.height=s,this.index=r,this.solid=n,this.sprites=o,this._bounds=new Zt(this.x,this.y,this.x+this.width,this.y+this.height)}get bounds(){return this._bounds}get center(){return new X(this.x+this.width/2,this.y+this.height/2)}pushSprite(t){this.addSprite(t)}addSprite(t){t instanceof _e?this.sprites.push(Zi.fromLegacySprite(t)):this.sprites.push(t)}removeSprite(t){k(t,this.sprites)}clearSprites(){this.sprites.length=0}}ts([V({message:"Will be removed in v0.26.0",alternateMethod:"addSprite"})],ss.prototype,"pushSprite",null);class rs extends(pe(ss)){constructor(t,e,i,s,r,n,o){super(t,e,i,s,r,n,o)}}class ns{constructor(t){this.camera=t}lockToActor(t){this.camera.addStrategy(new os(t))}lockToActorAxis(t,e){this.camera.addStrategy(new as(t,e))}elasticToActor(t,e,i){this.camera.addStrategy(new hs(t,e,i))}radiusAroundActor(t,e){this.camera.addStrategy(new ls(t,e))}limitCameraBounds(t){this.camera.addStrategy(new cs(t))}}(Ji=$i||($i={}))[Ji.X=0]="X",Ji[Ji.Y=1]="Y";class os{constructor(t){this.target=t,this.action=(t,e,i,s)=>t.center}}class as{constructor(t,e){this.target=t,this.axis=e,this.action=(t,e,i,s)=>{const r=t.center,n=e.getFocus();return this.axis===$i.X?new X(r.x,n.y):new X(n.x,r.y)}}}class hs{constructor(t,e,i){this.target=t,this.cameraElasticity=e,this.cameraFriction=i,this.action=(t,e,i,s)=>{const r=t.center;let n=e.getFocus(),o=e.vel.clone();const a=r.sub(n).scale(this.cameraElasticity);o=o.add(a);const h=o.scale(-1).scale(this.cameraFriction);return o=o.add(h),n=n.add(o),n}}}class ls{constructor(t,e){this.target=t,this.radius=e,this.action=(t,e,i,s)=>{const r=t.center,n=e.getFocus(),o=r.sub(n),a=o.size;if(a>=this.radius){const t=a-this.radius;return n.add(o.normalize().scale(t))}return n}}}class cs{constructor(t){this.target=t,this.boundSizeChecked=!1,this.action=(t,e,i,s)=>{const r=e.getFocus();this.boundSizeChecked||((t.bottom-t.top<i.drawHeight||t.right-t.left<i.drawWidth)&&m.getInstance().warn("Camera bounds should not be smaller than the engine viewport"),this.boundSizeChecked=!0);let n=r.x,o=r.y;return r.x<t.left+i.halfDrawWidth?n=t.left+i.halfDrawWidth:r.x>t.right-i.halfDrawWidth&&(n=t.right-i.halfDrawWidth),r.y<t.top+i.halfDrawHeight?o=t.top+i.halfDrawHeight:r.y>t.bottom-i.halfDrawHeight&&(o=t.bottom-i.halfDrawHeight),Q(n,o)}}}class ds extends gi{constructor(){super(...arguments),this._cameraStrategies=[],this.strategy=new ns(this),this._z=1,this.dz=0,this.az=0,this.rotation=0,this.rx=0,this.pos=X.Zero,this.vel=X.Zero,this.acc=X.Zero,this._cameraMoving=!1,this._currentLerpTime=0,this._lerpDuration=1e3,this._lerpStart=null,this._lerpEnd=null,this._isShaking=!1,this._shakeMagnitudeX=0,this._shakeMagnitudeY=0,this._shakeDuration=0,this._elapsedShakeTime=0,this._xShake=0,this._yShake=0,this._isZooming=!1,this._zoomStart=1,this._zoomEnd=1,this._currentZoomTime=0,this._zoomDuration=0,this._zoomEasing=Ae.EaseInOutCubic,this._easing=Ae.EaseInOutCubic,this._halfWidth=0,this._halfHeight=0,this._viewport=null,this._isInitialized=!1}get zoom(){return this._z}set zoom(t){this._z=t,this._engine&&(this._halfWidth=this._engine.halfDrawWidth,this._halfHeight=this._engine.halfDrawHeight)}get angularVelocity(){return this.rx}set angularVelocity(t){this.rx=t}get x(){return this.pos.x}set x(t){this._follow||this._cameraMoving||(this.pos=Q(t,this.pos.y))}get y(){return this.pos.y}set y(t){this._follow||this._cameraMoving||(this.pos=Q(this.pos.x,t))}get dx(){return this.vel.x}set dx(t){this.vel=Q(t,this.vel.y)}get dy(){return this.vel.y}set dy(t){this.vel=Q(this.vel.x,t)}get ax(){return this.acc.x}set ax(t){this.acc=Q(t,this.acc.y)}get ay(){return this.acc.y}set ay(t){this.acc=Q(this.acc.x,t)}getFocus(){return this.pos}move(t,e,i=Ae.EaseInOutCubic){if("function"!=typeof i)throw"Please specify an EasingFunction";return this._follow?Promise.reject(t):(this._lerpPromise&&this._lerpResolve&&this._lerpResolve(t),this._lerpPromise=new Promise((t=>{this._lerpResolve=t})),this._lerpStart=this.getFocus().clone(),this._lerpDuration=e,this._lerpEnd=t,this._currentLerpTime=0,this._cameraMoving=!0,this._easing=i,this._lerpPromise)}shake(t,e,i){this._isShaking=!0,this._shakeMagnitudeX=t,this._shakeMagnitudeY=e,this._shakeDuration=i}zoomOverTime(t,e=0,i=Ae.EaseInOutCubic){return this._zoomPromise=new Promise((t=>{this._zoomResolve=t})),e?(this._isZooming=!0,this._zoomEasing=i,this._currentZoomTime=0,this._zoomDuration=e,this._zoomStart=this.zoom,this._zoomEnd=t,this._zoomPromise):(this._isZooming=!1,this.zoom=t,Promise.resolve(!0))}get viewport(){return this._viewport?this._viewport:new Zt(0,0,0,0)}addStrategy(t){this._cameraStrategies.push(t)}removeStrategy(t){k(t,this._cameraStrategies)}clearAllStrategies(){this._cameraStrategies.length=0}_preupdate(t,e){this.emit("preupdate",new vt(t,e,this)),this.onPreUpdate(t,e)}onPreUpdate(t,e){}_postupdate(t,e){this.emit("postupdate",new bt(t,e,this)),this.onPostUpdate(t,e)}onPostUpdate(t,e){}get isInitialized(){return this._isInitialized}_initialize(t){this.isInitialized||(this.onInitialize(t),super.emit("initialize",new It(t,this)),this._isInitialized=!0,this._engine=t,this._halfWidth=this._engine.halfDrawWidth,this._halfHeight=this._engine.halfDrawHeight)}onInitialize(t){}on(t,e){super.on(t,e)}off(t,e){super.off(t,e)}once(t,e){super.once(t,e)}update(t,e){if(this._initialize(t),this._preupdate(t,e),this.pos=this.pos.add(this.vel.scale(e/1e3)),this.zoom+=this.dz*e/1e3,this.vel=this.vel.add(this.acc.scale(e/1e3)),this.dz+=this.az*e/1e3,this.rotation+=this.angularVelocity*e/1e3,this._isZooming)if(this._currentZoomTime<this._zoomDuration){const t=this._zoomEasing(this._currentZoomTime,this._zoomStart,this._zoomEnd,this._zoomDuration);this.zoom=t,this._currentZoomTime+=e}else this._isZooming=!1,this.zoom=this._zoomEnd,this._currentZoomTime=0,this._zoomResolve(!0);if(this._cameraMoving)if(this._currentLerpTime<this._lerpDuration){const t=Ae.CreateVectorEasingFunction(this._easing)(this._currentLerpTime,this._lerpStart,this._lerpEnd,this._lerpDuration);this.pos=t,this._currentLerpTime+=e}else{this.pos=this._lerpEnd;const t=this._lerpEnd.clone();this._lerpStart=null,this._lerpEnd=null,this._currentLerpTime=0,this._cameraMoving=!1,this._lerpResolve(t)}this._isDoneShaking()?(this._isShaking=!1,this._elapsedShakeTime=0,this._shakeMagnitudeX=0,this._shakeMagnitudeY=0,this._shakeDuration=0,this._xShake=0,this._yShake=0):(this._elapsedShakeTime+=e,this._xShake=1+(Math.random()*this._shakeMagnitudeX|0),this._yShake=1+(Math.random()*this._shakeMagnitudeY|0));for(const i of this._cameraStrategies)this.pos=i.action.call(i,i.target,this,t,e);this._viewport=new Zt(this.x-this._halfWidth,this.y-this._halfHeight,this.x+this._halfWidth,this.y+this._halfHeight),this._postupdate(t,e)}draw(t){let e=0,i=0;t instanceof CanvasRenderingContext2D?(e=t.canvas.width,i=t.canvas.height):(e=t.width,i=t.height);const s=this.getFocus(),r=this._engine?this._engine.pixelRatio:1,n=this.zoom,o=e/n/r,a=i/n/r;t.scale(n,n),t.translate(-s.x+o/2+this._xShake,-s.y+a/2+this._yShake)}debugDraw(t){const e=this.getFocus();t.fillStyle="red",t.strokeStyle="white",t.lineWidth=3,t.beginPath(),t.arc(e.x,e.y,15,0,2*Math.PI),t.closePath(),t.stroke(),t.beginPath(),t.arc(e.x,e.y,5,0,2*Math.PI),t.closePath(),t.stroke(),t.beginPath(),t.setLineDash([5,15]),t.lineWidth=5,t.strokeStyle="white",t.strokeRect(this.viewport.left,this.viewport.top,this.viewport.width,this.viewport.height),t.closePath()}_isDoneShaking(){return!this._isShaking||this._elapsedShakeTime>=this._shakeDuration}}function us(t){return t instanceof Gi}const ps={pos:X.Zero,width:10,height:10,visible:!1,action:()=>{},filter:()=>!0,repeat:-1};class gs extends Ii{constructor(t){super(t.pos.x,t.pos.y,t.width,t.height),this.action=()=>{},this.filter=()=>!0,this.repeat=-1,t=x({},ps,t),this.filter=t.filter||this.filter,this.repeat=t.repeat||this.repeat,this.action=t.action||this.action,t.target&&(this.target=t.target),this.visible=t.visible,this.body.collider.type=it.Passive,this.eventDispatcher=new ee(this),this.on("collisionstart",(t=>{Oi(t.other)&&this.filter(t.other)&&(this.emit("enter",new Ht(this,t.other)),this._dispatchAction(),0===this.repeat&&this.kill())})),this.on("collisionend",(t=>{Oi(t.other)&&this.filter(t.other)&&this.emit("exit",new Nt(this,t.other))}))}set target(t){this._target=t,this.filter=e=>e===t}get target(){return this._target}_initialize(t){super._initialize(t)}_dispatchAction(){this.action.call(this),this.repeat--}debugDraw(t){super.debugDraw(t),t.save(),t.translate(this.pos.x,this.pos.y);const e=this.body.collider.bounds,i=this.getGlobalPos();e.left=e.left-i.x,e.right=e.right-i.x,e.top=e.top-i.y,e.bottom=e.bottom-i.y,t.fillStyle=at.Violet.toString(),t.strokeStyle=at.Violet.toString(),t.fillText("Trigger",10,10),e.debugDraw(t),t.restore()}}var _s,fs;(fs=_s||(_s={})).Update="update",fs.Draw="draw";class ms{constructor(){this.priority=0}notify(t){}}class ys{constructor(t){this.data=t,this.type="Entity Added"}}function ws(t){return!!t&&"Entity Added"===t.type}class vs{constructor(t){this.data=t,this.type="Entity Removed"}}function bs(t){return!!t&&"Entity Removed"===t.type}class xs{constructor(t){this._world=t,this.entities=[],this._entityIndex={}}notify(t){fi(t)&&this._world.queryManager.addEntity(t.data.entity),yi(t)&&this._world.queryManager.removeComponent(t.data.entity,t.data.component)}addEntity(t){t&&!this._entityIndex[t.id]&&(this._entityIndex[t.id]=t,this.entities.push(t),this._world.queryManager.addEntity(t),t.componentAdded$.register(this),t.componentRemoved$.register(this),t.children.forEach((t=>this.addEntity(t))),t.childrenAdded$.register({notify:t=>{this.addEntity(t)}}),t.childrenRemoved$.register({notify:t=>{this.removeEntity(t)}}))}removeEntity(t){let e=0;e=t instanceof wi?t.id:t;const i=this._entityIndex[e];delete this._entityIndex[e],i&&(k(i,this.entities),this._world.queryManager.removeEntity(i),i.componentAdded$.unregister(this),i.componentRemoved$.unregister(this),i.children.forEach((t=>this.removeEntity(t))),i.childrenAdded$.clear(),i.childrenRemoved$.clear())}processComponentRemovals(){for(const t of this.entities)t.processComponentRemoval()}getById(t){return this._entityIndex[t]}clear(){for(const t of this.entities)this.removeEntity(t)}}const As=t=>[...t].sort(((t,e)=>t.localeCompare(e))).join("+");class Ss extends pi{constructor(t){super(),this._entities=[],t[0]instanceof Function?this.types=t.map((t=>(new t).type)):this.types=t}get key(){return this._key?this._key:this._key=As(this.types)}getEntities(t){return t&&this._entities.sort(t),this._entities}addEntity(t){!O(this._entities,t)&&this.matches(t)&&(this._entities.push(t),this.notifyAll(new ys(t)))}removeEntity(t){k(t,this._entities)&&this.notifyAll(new vs(t))}clear(){this._entities.length=0;for(const t of this.observers)this.unregister(t)}matches(t){let e=[];e=t instanceof wi?t.types:t;let i=!0;for(const t of this.types)if(i=i&&e.indexOf(t)>-1,!i)return!1;return i}contain(t){return this.types.indexOf(t)>-1}}class Ps{constructor(t){this._world=t,this._queries={}}_addQuery(t){this._queries[As(t.types)]=t;for(const e of this._world.entityManager.entities)t.addEntity(e)}maybeRemoveQuery(t){0===t.observers.length&&(t.clear(),delete this._queries[As(t.types)])}addEntity(t){for(const e in this._queries)this._queries[e]&&this._queries[e].addEntity(t)}removeComponent(t,e){for(const i in this._queries)this._queries[i].contain(e.type)&&this._queries[i].removeEntity(t)}removeEntity(t){for(const e in this._queries)this._queries[e].removeEntity(t)}createQuery(t){const e=this.getQuery(t);if(e)return e;const i=new Ss(t);return this._addQuery(i),i}getQuery(t){const e=As(t);return this._queries[e]?this._queries[e]:null}}class Cs{constructor(t){this._world=t,this.systems=[]}addSystem(t){if(!t.types||0===t.types.length)throw new Error("Attempted to add a System without any types");const e=this._world.queryManager.createQuery(t.types);this.systems.push(t),this.systems.sort(((t,e)=>t.priority-e.priority)),e.register(t),t.initialize&&t.initialize(this._world.context)}removeSystem(t){k(t,this.systems);const e=this._world.queryManager.getQuery(t.types);e&&(e.unregister(t),this._world.queryManager.maybeRemoveQuery(e))}updateSystems(t,e,i){const s=this.systems.filter((e=>e.systemType===t));for(const t of s)t.preupdate&&t.preupdate(e,i);for(const t of s){const s=this._world.queryManager.getQuery(t.types).getEntities(t.sort);if(e instanceof Xs)for(const t of s)t._initialize(null==e?void 0:e.engine);t.update(s,i)}for(const t of s)t.postupdate&&t.postupdate(e,i)}clear(){for(const t of this.systems)this.removeSystem(t)}}class Es{constructor(t){this.context=t,this.queryManager=new Ps(this),this.entityManager=new xs(this),this.systemManager=new Cs(this)}update(t,e){this.systemManager.updateSystems(t,this.context,e),this.entityManager.processComponentRemovals()}add(t){t instanceof wi&&this.entityManager.addEntity(t),t instanceof ms&&this.systemManager.addSystem(t)}remove(t){t instanceof wi&&this.entityManager.removeEntity(t),t instanceof ms&&this.systemManager.removeSystem(t)}clearEntities(){this.entityManager.clear()}clearSystems(){this.systemManager.clear()}}class Ts{static clear(){Ts.DrawCallCount=0,Ts.DrawnImagesCount=0}}Ts.DrawCallCount=0,Ts.DrawnImagesCount=0;class Ds extends ms{constructor(){super(...arguments),this.types=["ex.transform","ex.graphics"],this.systemType=_s.Draw,this.priority=0,this._token=0}initialize(t){this._graphicsContext=t.engine.graphicsContext,this._camera=t.camera,this._engine=t.engine}sort(t,e){return t.get($e).z-e.get($e).z}update(t,e){var i;let s,r;this._clearScreen(),this._token++;for(const n of t){s=n.get($e),r=n.get(Ci);const t=this._isOffscreen(s,r);t&&!n.hasTag("offscreen")&&(n.eventDispatcher.emit("exitviewport",new Ut(n)),n.addComponent(new Ke("offscreen"))),!t&&n.hasTag("offscreen")&&(n.eventDispatcher.emit("enterviewport",new Wt(n)),n.removeComponent("offscreen")),t||(this._pushCameraTransform(s),this._graphicsContext.save(),r.onPreDraw&&r.onPreDraw(this._graphicsContext,e),r.update(e,this._token),this._applyTransform(n),this._graphicsPositionDebugDraw(),this._graphicsContext.opacity=r.opacity*(null!==(i=n.opacity)&&void 0!==i?i:1),this._drawGraphicsComponent(r),r.onPostDraw&&r.onPostDraw(this._graphicsContext,e),this._graphicsContext.restore(),this._graphicsBoundsDebugDraw(n,s,r),this._popCameraTransform(s))}this._graphicsContext.flush(),this._engine.stats.currFrame.graphics.drawnImages=Ts.DrawnImagesCount,this._engine.stats.currFrame.graphics.drawCalls=Ts.DrawCallCount}_clearScreen(){this._graphicsContext.clear()}_isOffscreen(t,e){return t.coordPlane===qe.World&&!this._camera.viewport.intersect(e.localBounds.transform(t.getGlobalMatrix()))}_drawGraphicsComponent(t){var e,i;if(t.visible){for(const i of t.layers.get())for(const{graphic:t,options:{offset:s,anchor:r}}of i.graphics){const n=-t.width*r.x+s.x,o=-t.height*r.y+s.y;null==t||t.draw(this._graphicsContext,n+i.offset.x,o+i.offset.y),(null===(e=this._engine)||void 0===e?void 0:e.isDebug)&&(null==t||t.localBounds.translate(Q(n+i.offset.x,o+i.offset.y)).draw(this._graphicsContext,at.Red))}(null===(i=this._engine)||void 0===i?void 0:i.isDebug)&&t.localBounds.draw(this._graphicsContext,at.Red)}}_applyTransform(t){const e=t.getAncestors();for(const t of e){const e=null==t?void 0:t.get($e);e&&(this._graphicsContext.translate(e.pos.x,e.pos.y),this._graphicsContext.scale(e.scale.x,e.scale.y),this._graphicsContext.rotate(e.rotation))}}_pushCameraTransform(t){t.coordPlane===qe.World&&(this._graphicsContext.save(),this._camera&&this._camera.draw(this._graphicsContext))}_popCameraTransform(t){t.coordPlane===qe.World&&this._graphicsContext.restore()}_graphicsPositionDebugDraw(){var t;(null===(t=this._engine)||void 0===t?void 0:t.isDebug)&&this._graphicsContext.debug.drawPoint(X.Zero,{color:at.Yellow,size:5})}_graphicsBoundsDebugDraw(t,e,i){var s;(null===(s=this._engine)||void 0===s?void 0:s.isDebug)&&Oi(t)&&t.body.collider.localBounds.translate(t.getGlobalPos()).draw(this._graphicsContext)}}class Rs extends ms{constructor(){super(...arguments),this.types=["ex.transform","ex.canvas"],this.systemType=_s.Draw,this.priority=-1}initialize(t){this._ctx=t.engine.ctx,this._engine=t.engine,this._camera=t.camera}sort(t,e){return t.get($e).z-e.get($e).z}update(t,e){let i,s;this._clearScreen();const r=t.length;for(let n=0;n<r;n++)t[n].visible&&!t[n].isOffScreen&&(i=t[n].get($e),s=t[n].get(vi),this._ctx.save(),this._pushCameraTransform(i),this._ctx.save(),this._applyTransform(t[n]),s.draw(this._ctx,e),this._ctx.restore(),this._popCameraTransform(i),this._ctx.restore()),this._engine.isDebug&&(this._ctx.save(),this._pushCameraTransform(i),this._ctx.strokeStyle="yellow",t[n].debugDraw(this._ctx),this._popCameraTransform(i),this._ctx.restore());this._engine.isDebug&&(this._ctx.save(),this._camera.draw(this._ctx),this._camera.debugDraw(this._ctx),this._ctx.restore()),this._engine.stats.currFrame.graphics.drawnImages=Ts.DrawnImagesCount,this._engine.stats.currFrame.graphics.drawCalls=Ts.DrawCallCount}_applyTransform(t){const e=t.getAncestors();for(const t of e){const e=null==t?void 0:t.get($e);e&&(this._ctx.translate(e.pos.x,e.pos.y),this._ctx.rotate(e.rotation),this._ctx.scale(e.scale.x,e.scale.y))}}_clearScreen(){this._ctx.clearRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height),this._ctx.fillStyle=this._engine.backgroundColor.toString(),this._ctx.fillRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height)}_pushCameraTransform(t){t.coordPlane===qe.World&&(this._ctx.save(),this._camera&&this._camera.draw(this._ctx))}_popCameraTransform(t){t.coordPlane===qe.World&&this._ctx.restore()}}var Bs,Ms,ks,Os,Fs,Is,Ls,zs,Us,Ws,Hs,Ns,js,Gs,Vs=function(t,e,i,s){var r,n=arguments.length,o=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(o=(n<3?r(o):n>3?r(e,i,o):r(e,i))||o);return n>3&&o&&Object.defineProperty(e,i,o),o};class Xs extends gi{constructor(t){super(),this.actors=[],this.world=new Es(this),this._bodies=[],this.triggers=[],this.tileMaps=[],this._isInitialized=!1,this._broadphase=new qi,this._killQueue=[],this._triggerKillQueue=[],this._timers=[],this._cancelQueue=[],this._logger=m.getInstance(),this.camera=new ds,t&&(this.engine=t,this.camera.x=this.engine.halfDrawWidth,this.camera.y=this.engine.halfDrawHeight)}get screenElements(){return this.actors.filter((t=>t instanceof Gi))}on(t,e){super.on(t,e)}once(t,e){super.once(t,e)}off(t,e){super.off(t,e)}onInitialize(t){}onActivate(t,e){}onDeactivate(t,e){}onPreUpdate(t,e){}onPostUpdate(t,e){}onPreDraw(t,e){}onPostDraw(t,e){}_initializeChildren(){for(const t of this.actors)t._initialize(this.engine)}get isInitialized(){return this._isInitialized}_initialize(t){this.isInitialized||(this.engine=t,this.camera&&(this.camera.x=t.halfDrawWidth,this.camera.y=t.halfDrawHeight),f.isEnabled(l.LegacyDrawing)?this.world.add(new Rs):this.world.add(new Ds),this.onInitialize.call(this,t),this._initializeChildren(),this._logger.debug("Scene.onInitialize",this,t),this.eventDispatcher.emit("initialize",new It(t,this)),this._isInitialized=!0)}_activate(t,e){this._logger.debug("Scene.onActivate",this),this.onActivate(t,e)}_deactivate(t,e){this._logger.debug("Scene.onDeactivate",this),this.onDeactivate(t,e)}_preupdate(t,e){this.emit("preupdate",new vt(t,e,this)),this.onPreUpdate(t,e)}_postupdate(t,e){this.emit("postupdate",new bt(t,e,this)),this.onPostUpdate(t,e)}_predraw(t,e){this.emit("predraw",new ft(t,e,this)),this.onPreDraw(t,e)}_postdraw(t,e){this.emit("postdraw",new mt(t,e,this)),this.onPostDraw(t,e)}update(t,e){let i,s;for(this._preupdate(t,e),this.world.update(_s.Update,e),this.camera&&this.camera.update(t,e),i=0,s=this._cancelQueue.length;i<s;i++)this.removeTimer(this._cancelQueue[i]);this._cancelQueue.length=0;for(const t of this._timers)t.update(e);for(const i of this.world.entityManager.entities)i.update(t,e);for(i=0,s=this.actors.length;i<s;i++)this._bodies[i]=this.actors[i].body;if(this._collectActorStats(t),t.input.pointers.dispatchPointerEvents(),this._broadphase&&lt.enabled){const i=Date.now();this._broadphase.update(this._bodies,e);let s=this._broadphase.broadphase(this._bodies,e,t.stats.currFrame);const r=Date.now(),n=Date.now();let o=lt.collisionPasses;const a=e/o;for(;o>0;)s=this._broadphase.narrowphase(s,t.stats.currFrame),s=this._broadphase.resolve(s,a,lt.collisionResolutionStrategy),this._broadphase.runCollisionStartEnd(s),o--;const h=Date.now();t.stats.currFrame.physics.broadphase=r-i,t.stats.currFrame.physics.narrowphase=h-n}t.stats.currFrame.actors.killed=this._killQueue.length+this._triggerKillQueue.length,this._processKillQueue(this._killQueue,this.actors),this._processKillQueue(this._triggerKillQueue,this.triggers),this._postupdate(t,e)}_processKillQueue(t,e){let i;for(const s of t)s.isKilled()&&(i=e.indexOf(s),i>-1&&(e.splice(i,1),this.world.remove(s),s.children.forEach((t=>this.world.remove(t)))));t.length=0}draw(t,e){this._predraw(t,e),this.world.update(_s.Draw,e),this._postdraw(t,e)}debugDraw(t){this.emit("predebugdraw",new yt(t,this)),this._broadphase.debugDraw(t,20),this.emit("postdebugdraw",new wt(t,this))}contains(t){return this.actors.indexOf(t)>-1}add(t){this.world.add(t),t instanceof Ii&&t.unkill(),t instanceof Ii?O(this.actors,t)||(this._broadphase.track(t.body),t.scene=this,t instanceof gs?this.triggers.push(t):this.actors.push(t),t.children.forEach((t=>this.add(t))),t.childrenAdded$.register({notify:t=>{this.add(t)}}),t.childrenRemoved$.register({notify:t=>{this.remove(t)}})):t instanceof Vi?O(this._timers,t)||this.addTimer(t):t instanceof is&&(O(this.tileMaps,t)||this.addTileMap(t))}remove(t){if(this.world.remove(t),t instanceof Ii){if(!O(this.actors,t))return;this._broadphase.untrack(t.body),t instanceof gs?this._triggerKillQueue.push(t):(t.isKilled()||t.kill(),this._killQueue.push(t))}t instanceof Vi&&this.removeTimer(t),t instanceof is&&this.removeTileMap(t)}addScreenElement(t){this.add(t)}removeScreenElement(t){this.remove(t)}addTileMap(t){this.tileMaps.push(t),this.world.add(t)}removeTileMap(t){const e=this.tileMaps.indexOf(t);e>-1&&(this.tileMaps.splice(e,1),this.world.remove(t))}addTimer(t){return this._timers.push(t),t.scene=this,t}removeTimer(t){const e=this._timers.indexOf(t);return-1!==e&&this._timers.splice(e,1),t}cancelTimer(t){return this._cancelQueue.push(t),t}isTimerActive(t){return this._timers.indexOf(t)>-1&&!t.complete}isCurrentScene(){return!!this.engine&&this.engine.currentScene===this}_collectActorStats(t){for(const e of this.screenElements)t.stats.currFrame.actors.ui++;for(const e of this.actors){t.stats.currFrame.actors.alive++;for(const i of e.children)us(i)?t.stats.currFrame.actors.ui++:t.stats.currFrame.actors.alive++}}}Vs([V({message:"Will be removed in excalibur v0.26.0",alternateMethod:"ScreenElements now are normal actors with a Transform Coordinate Plane of Screen"})],Xs.prototype,"screenElements",null),Vs([V({message:"Will be removed in excalibur v0.26.0",alternateMethod:"Use Scene.add"})],Xs.prototype,"addScreenElement",null),Vs([V({message:"Will be removed in excalibur v0.26.0",alternateMethod:"Use Scene.remove"})],Xs.prototype,"removeScreenElement",null),Vs([V({message:"Will be removed in excalibur v0.26.0",alternateMethod:"Use Scene.add"})],Xs.prototype,"addTileMap",null),Vs([V({message:"Will be removed in excalibur v0.26.0",alternateMethod:"Use Scene.remove"})],Xs.prototype,"removeTileMap",null),(zs=Bs||(Bs={}))[zs.Protanope=0]="Protanope",zs[zs.Deuteranope=1]="Deuteranope",zs[zs.Tritanope=2]="Tritanope";class Ks{constructor(t,e=!1,i=Bs.Protanope){this.engine=t,this.simulate=e,this.colorMode=i,this._vertexShader="attribute vec2 a_position;attribute vec2 a_texCoord;uniform vec2 u_resolution;varying vec2 v_texCoord;void main() {vec2 zeroToOne = a_position / u_resolution;vec2 zeroToTwo = zeroToOne * 2.0;vec2 clipSpace = zeroToTwo - 1.0;gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);v_texCoord = a_texCoord;}",this._fragmentShader="precision mediump float;uniform sampler2D u_image;varying vec2 v_texCoord;void main() {vec4 o =  texture2D(u_image, v_texCoord);float L = (17.8824 * o.r) + (43.5161 * o.g) + (4.11935 * o.b);float M = (3.45565 * o.r) + (27.1554 * o.g) + (3.86714 * o.b);float S = (0.0299566 * o.r) + (0.184309 * o.g) + (1.46709 * o.b);//MODE CODE//vec4 error;error.r = (0.0809444479 * l) + (-0.130504409 * m) + (0.116721066 * s);error.g = (-0.0102485335 * l) + (0.0540193266 * m) + (-0.113614708 * s);error.b = (-0.000365296938 * l) + (-0.00412161469 * m) + (0.693511405 * s);error.a = 1.0;vec4 diff = o - error;vec4 correction;correction.r = 0.0;correction.g =  (diff.r * 0.7) + (diff.g * 1.0);correction.b =  (diff.r * 0.7) + (diff.b * 1.0);correction = o + correction;correction.a = o.a;//SIMULATE//}",this._internalCanvas=document.createElement("canvas"),this._internalCanvas.width=t.drawWidth,this._internalCanvas.height=t.drawHeight,this._gl=this._internalCanvas.getContext("webgl",{preserveDrawingBuffer:!0}),this._program=this._gl.createProgram();const s=this._getShader("Fragment",this._getFragmentShaderByMode(i)),r=this._getShader("Vertex",this._vertexShader);this._gl.attachShader(this._program,r),this._gl.attachShader(this._program,s),this._gl.linkProgram(this._program),this._gl.getProgramParameter(this._program,this._gl.LINK_STATUS)||m.getInstance().error("Unable to link shader program!"),this._gl.useProgram(this._program)}_getFragmentShaderByMode(t){let e="";return t===Bs.Protanope?e="float l = 0.0 * L + 2.02344 * M + -2.52581 * S;float m = 0.0 * L + 1.0 * M + 0.0 * S;float s = 0.0 * L + 0.0 * M + 1.0 * S;":t===Bs.Deuteranope?e="float l = 1.0 * L + 0.0 * M + 0.0 * S;float m = 0.494207 * L + 0.0 * M + 1.24827 * S;float s = 0.0 * L + 0.0 * M + 1.0 * S;":t===Bs.Tritanope&&(e="float l = 1.0 * L + 0.0 * M + 0.0 * S;float m = 0.0 * L + 1.0 * M + 0.0 * S;float s = -0.395913 * L + 0.801109 * M + 0.0 * S;"),this.simulate?this._fragmentShader=this._fragmentShader.replace("//SIMULATE//","gl_FragColor = error.rgba;"):this._fragmentShader=this._fragmentShader.replace("//SIMULATE//","gl_FragColor = correction.rgba;"),this._fragmentShader.replace("//MODE CODE//",e)}_setRectangle(t,e,i,s){const r=t,n=t+i,o=e,a=e+s;this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array([r,o,n,o,r,a,r,a,n,o,n,a]),this._gl.STATIC_DRAW)}_getShader(t,e){let i;return"Fragment"===t?i=this._gl.createShader(this._gl.FRAGMENT_SHADER):"Vertex"===t?i=this._gl.createShader(this._gl.VERTEX_SHADER):m.getInstance().error("Error unknown shader type",t),this._gl.shaderSource(i,e),this._gl.compileShader(i),this._gl.getShaderParameter(i,this._gl.COMPILE_STATUS)?i:(m.getInstance().error("Unable to compile shader!",this._gl.getShaderInfoLog(i)),null)}process(t,e){const i=this._gl.getAttribLocation(this._program,"a_position"),s=this._gl.getAttribLocation(this._program,"a_texCoord"),r=this._gl.createBuffer();this._gl.bindBuffer(this._gl.ARRAY_BUFFER,r),this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),this._gl.STATIC_DRAW),this._gl.enableVertexAttribArray(s),this._gl.vertexAttribPointer(s,2,this._gl.FLOAT,!1,0,0);const n=this._gl.createTexture();this._gl.bindTexture(this._gl.TEXTURE_2D,n),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,1),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,this._gl.RGBA,this._gl.UNSIGNED_BYTE,t);const o=this._gl.getUniformLocation(this._program,"u_resolution");this._gl.uniform2f(o,this._internalCanvas.width,this._internalCanvas.height);const a=this._gl.createBuffer();this._gl.bindBuffer(this._gl.ARRAY_BUFFER,a),this._gl.enableVertexAttribArray(i),this._gl.vertexAttribPointer(i,2,this._gl.FLOAT,!1,0,0),this._setRectangle(0,0,t.width,t.height),this._gl.drawArrays(this._gl.TRIANGLES,0,6);const h=new Uint8Array(t.width*t.height*4);this._gl.readPixels(0,0,t.width,t.height,this._gl.RGBA,this._gl.UNSIGNED_BYTE,h),t.data.set(h),e.putImageData(t,0,0)}}class qs{constructor(t){this._engine=t}correct(t){this._engine.postProcessors.push(new Ks(this._engine,!1,t))}simulate(t){this._engine.postProcessors.push(new Ks(this._engine,!0,t))}}class Ys{constructor(t){this.stats={currFrame:new Zs,prevFrame:new Zs},this._engine=t,this.colorBlindMode=new qs(this._engine)}}class Zs{constructor(){this._id=0,this._delta=0,this._fps=0,this._actorStats={alive:0,killed:0,ui:0,get remaining(){return this.alive-this.killed},get total(){return this.remaining+this.ui}},this._durationStats={update:0,draw:0,get total(){return this.update+this.draw}},this._physicsStats=new Qs,this._graphicsStats={drawCalls:0,drawnImages:0}}reset(t){t?(this.id=t.id,this.delta=t.delta,this.fps=t.fps,this.actors.alive=t.actors.alive,this.actors.killed=t.actors.killed,this.actors.ui=t.actors.ui,this.duration.update=t.duration.update,this.duration.draw=t.duration.draw,this._physicsStats.reset(t.physics),this.graphics.drawCalls=t.graphics.drawCalls,this.graphics.drawnImages=t.graphics.drawnImages):(this.id=this.delta=this.fps=0,this.actors.alive=this.actors.killed=this.actors.ui=0,this.duration.update=this.duration.draw=0,this._physicsStats.reset(),this.graphics.drawnImages=this.graphics.drawCalls=0)}clone(){const t=new Zs;return t.reset(this),t}get id(){return this._id}set id(t){this._id=t}get delta(){return this._delta}set delta(t){this._delta=t}get fps(){return this._fps}set fps(t){this._fps=t}get actors(){return this._actorStats}get duration(){return this._durationStats}get physics(){return this._physicsStats}get graphics(){return this._graphicsStats}}class Qs{constructor(){this._pairs=0,this._collisions=0,this._collidersHash={},this._fastBodies=0,this._fastBodyCollisions=0,this._broadphase=0,this._narrowphase=0}reset(t){t?(this.pairs=t.pairs,this.collisions=t.collisions,this.collidersHash=t.collidersHash,this.fastBodies=t.fastBodies,this.fastBodyCollisions=t.fastBodyCollisions,this.broadphase=t.broadphase,this.narrowphase=t.narrowphase):(this.pairs=this.collisions=this.fastBodies=0,this.fastBodyCollisions=this.broadphase=this.narrowphase=0,this.collidersHash={})}clone(){const t=new Qs;return t.reset(this),t}get pairs(){return this._pairs}set pairs(t){this._pairs=t}get collisions(){return this._collisions}set collisions(t){this._collisions=t}get collidersHash(){return this._collidersHash}set collidersHash(t){this._collidersHash=t}get fastBodies(){return this._fastBodies}set fastBodies(t){this._fastBodies=t}get fastBodyCollisions(){return this._fastBodyCollisions}set fastBodyCollisions(t){this._fastBodyCollisions=t}get broadphase(){return this._broadphase}set broadphase(t){this._broadphase=t}get narrowphase(){return this._narrowphase}set narrowphase(t){this._narrowphase=t}}(Us=Ms||(Ms={})).Num0="Numpad0",Us.Num1="Numpad1",Us.Num2="Numpad2",Us.Num3="Numpad3",Us.Num4="Numpad4",Us.Num5="Numpad5",Us.Num6="Numpad6",Us.Num7="Numpad7",Us.Num8="Numpad8",Us.Num9="Numpad9",Us.NumAdd="NumpadAdd",Us.NumSubtract="NumpadSubtract",Us.NumMultiply="NumpadMultiply",Us.NumDivide="NumpadDivide",Us.NumDecimal="NumpadDecimal",Us.Numpad0="Numpad0",Us.Numpad1="Numpad1",Us.Numpad2="Numpad2",Us.Numpad3="Numpad3",Us.Numpad4="Numpad4",Us.Numpad5="Numpad5",Us.Numpad6="Numpad6",Us.Numpad7="Numpad7",Us.Numpad8="Numpad8",Us.Numpad9="Numpad9",Us.NumpadAdd="NumpadAdd",Us.NumpadSubtract="NumpadSubtract",Us.NumpadMultiply="NumpadMultiply",Us.NumpadDivide="NumpadDivide",Us.NumpadDecimal="NumpadDecimal",Us.NumLock="NumLock",Us.ShiftLeft="ShiftLeft",Us.ShiftRight="ShiftRight",Us.AltLeft="AltLeft",Us.AltRight="AltRight",Us.Key0="Digit0",Us.Key1="Digit1",Us.Key2="Digit2",Us.Key3="Digit3",Us.Key4="Digit4",Us.Key5="Digit5",Us.Key6="Digit6",Us.Key7="Digit7",Us.Key8="Digit8",Us.Key9="Digit9",Us.Digit0="Digit0",Us.Digit1="Digit1",Us.Digit2="Digit2",Us.Digit3="Digit3",Us.Digit4="Digit4",Us.Digit5="Digit5",Us.Digit6="Digit6",Us.Digit7="Digit7",Us.Digit8="Digit8",Us.Digit9="Digit9",Us.A="KeyA",Us.B="KeyB",Us.C="KeyC",Us.D="KeyD",Us.E="KeyE",Us.F="KeyF",Us.G="KeyG",Us.H="KeyH",Us.I="KeyI",Us.J="KeyJ",Us.K="KeyK",Us.L="KeyL",Us.M="KeyM",Us.N="KeyN",Us.O="KeyO",Us.P="KeyP",Us.Q="KeyQ",Us.R="KeyR",Us.S="KeyS",Us.T="KeyT",Us.U="KeyU",Us.V="KeyV",Us.W="KeyW",Us.X="KeyX",Us.Y="KeyY",Us.Z="KeyZ",Us.KeyA="KeyA",Us.KeyB="KeyB",Us.KeyC="KeyC",Us.KeyD="KeyD",Us.KeyE="KeyE",Us.KeyF="KeyF",Us.KeyG="KeyG",Us.KeyH="KeyH",Us.KeyI="KeyI",Us.KeyJ="KeyJ",Us.KeyK="KeyK",Us.KeyL="KeyL",Us.KeyM="KeyM",Us.KeyN="KeyN",Us.KeyO="KeyO",Us.KeyP="KeyP",Us.KeyQ="KeyQ",Us.KeyR="KeyR",Us.KeyS="KeyS",Us.KeyT="KeyT",Us.KeyU="KeyU",Us.KeyV="KeyV",Us.KeyW="KeyW",Us.KeyX="KeyX",Us.KeyY="KeyY",Us.KeyZ="KeyZ",Us.Semicolon="Semicolon",Us.Quote="Quote",Us.Comma="Comma",Us.Minus="Minus",Us.Period="Period",Us.Slash="Slash",Us.Equal="Equal",Us.BracketLeft="BracketLeft",Us.Backslash="Backslash",Us.BracketRight="BracketRight",Us.Backquote="Backquote",Us.Up="ArrowUp",Us.Down="ArrowDown",Us.Left="ArrowLeft",Us.Right="ArrowRight",Us.ArrowUp="ArrowUp",Us.ArrowDown="ArrowDown",Us.ArrowLeft="ArrowLeft",Us.ArrowRight="ArrowRight",Us.Space="Space",Us.Esc="Escape",Us.Escape="Escape";class $s extends ct{constructor(t,e,i){super(),this.key=t,this.value=e,this.originalEvent=i}}class Js extends gi{constructor(){super(),this._keys=[],this._keysUp=[],this._keysDown=[]}on(t,e){super.on(t,e)}init(t){if(!t)try{const e=()=>{};window.top.addEventListener("blur",e),window.top.removeEventListener("blur",e),t=window.top}catch(e){t=window,m.getInstance().warn("Failed to bind to keyboard events to top frame. If you are trying to embed Excalibur in a cross-origin iframe, keyboard events will not fire.")}t.addEventListener("blur",(()=>{this._keys.length=0})),t.addEventListener("keyup",(t=>{const e=t.code,i=this._keys.indexOf(e);this._keys.splice(i,1),this._keysUp.push(e);const s=new $s(e,t.key,t);this.eventDispatcher.emit("up",s),this.eventDispatcher.emit("release",s)})),t.addEventListener("keydown",(t=>{const e=t.code;if(-1===this._keys.indexOf(e)){this._keys.push(e),this._keysDown.push(e);const i=new $s(e,t.key,t);this.eventDispatcher.emit("down",i),this.eventDispatcher.emit("press",i)}}))}update(){this._keysDown.length=0,this._keysUp.length=0;for(let t=0;t<this._keys.length;t++)this.eventDispatcher.emit("hold",new $s(this._keys[t]))}getKeys(){return this._keys}wasPressed(t){return this._keysDown.indexOf(t)>-1}isHeld(t){return this._keys.indexOf(t)>-1}wasReleased(t){return this._keysUp.indexOf(t)>-1}}(Ws=ks||(ks={})).Touch="Touch",Ws.Mouse="Mouse",Ws.Pen="Pen",Ws.Unknown="Unknown",function(t){t.Canvas="Canvas",t.Document="Document"}(Os||(Os={}));class tr extends gi{constructor(){super(),this.id=tr._MAX_ID++,this._isDown=!1,this._wasDown=!1,this._actorsUnderPointer={length:0},this._actors=[],this._actorsLastFrame=[],this._actorsNoLongerUnderPointer=[],this._actorSortingFcn=(t,e)=>t.z===e.z?e.id-t.id:e.z-t.z,this.lastPagePos=null,this.lastScreenPos=null,this.lastWorldPos=null,this.dragTarget=null,this.on("move",this._onPointerMove),this.on("down",this._onPointerDown),this.on("up",this._onPointerUp)}get isDragging(){return this._isDown}get isDragStart(){return!this._wasDown&&this._isDown}get isDragEnd(){return this._wasDown&&!this._isDown}get hasActorsUnderPointer(){return!!this._actorsUnderPointer.length}on(t,e){super.on(t,e)}once(t,e){super.once(t,e)}off(t,e){super.off(t,e)}update(){this._wasDown&&!this._isDown?this._wasDown=!1:!this._wasDown&&this._isDown&&(this._wasDown=!0),this._actorsLastFrame=[...this._actors],this._actorsNoLongerUnderPointer=[]}addActorUnderPointer(t){this.isActorAliveUnderPointer(t)||(this._actorsUnderPointer[t.id]=t,this._actorsUnderPointer.length+=1,this._actors.push(t)),this._actors.sort(this._actorSortingFcn)}removeActorUnderPointer(t){this.isActorAliveUnderPointer(t)&&(delete this._actorsUnderPointer[t.id],this._actorsUnderPointer.length-=1,k(t,this._actors),this._actorsNoLongerUnderPointer.push(t))}getActorsUnderPointer(){return this._actors}getActorsUnderPointerLastFrame(){return this._actorsLastFrame}getActorsForEvents(){return this._actors.concat(this._actorsLastFrame).filter(((t,e,i)=>i.indexOf(t)===e)).sort(this._actorSortingFcn)}checkActorUnderPointer(t){return!!this.lastWorldPos&&t.contains(this.lastWorldPos.x,this.lastWorldPos.y,!us(t))}wasActorUnderPointer(t){return this._actorsLastFrame.indexOf(t)>-1}isActorAliveUnderPointer(t){return!(t.isKilled()||!t.scene||!this._actorsUnderPointer.hasOwnProperty(t.id.toString()))}_onPointerMove(t){this.lastPagePos=new X(t.pagePos.x,t.pagePos.y),this.lastScreenPos=new X(t.screenPos.x,t.screenPos.y),this.lastWorldPos=new X(t.worldPos.x,t.worldPos.y)}_onPointerDown(t){this.lastPagePos=new X(t.pagePos.x,t.pagePos.y),this.lastScreenPos=new X(t.screenPos.x,t.screenPos.y),this.lastWorldPos=new X(t.worldPos.x,t.worldPos.y),this._isDown=!0}_onPointerUp(t){this._isDown=!1,this.dragTarget=null}}tr._MAX_ID=0,(Hs=Fs||(Fs={}))[Hs.NoButton=-1]="NoButton",Hs[Hs.Left=0]="Left",Hs[Hs.Middle=1]="Middle",Hs[Hs.Right=2]="Right",Hs[Hs.Unknown=3]="Unknown",function(t){t.Left="Left",t.Middle="Middle",t.Right="Right",t.Unknown="Unknown",t.NoButton="NoButton"}(Is||(Is={})),function(t){t.Pixel="Pixel",t.Line="Line",t.Page="Page"}(Ls||(Ls={}));class er extends ct{constructor(t,e,i,s,r,n){super(),this.coordinates=t,this.pointer=e,this.index=i,this.pointerType=s,this.button=r,this.ev=n,this._canceled=!1}get name(){return this._name}get worldPos(){return this.coordinates.worldPos.clone()}get pagePos(){return this.coordinates.pagePos.clone()}get screenPos(){return this.coordinates.screenPos.clone()}get pos(){return this.coordinates.worldPos.clone()}cancel(){this._canceled=!0}isCanceled(){return this._canceled}propagate(t){this.doAction(t),this.bubbles&&!this.isCanceled()&&t.parent&&this.propagate(t.parent)}doAction(t){t&&(this._onActionStart(t),t.emit(this._name,this),this._onActionEnd(t))}_onActionStart(t){}_onActionEnd(t){}}class ir{constructor(t){this._pointerEventType=t}create(t,e,i,s,r,n){return new this._pointerEventType(t,e,i,s,r,n)}}class sr extends er{}class rr extends er{constructor(){super(...arguments),this._name="pointerup"}_onActionEnd(t){this.pointer.isDragEnd&&t.capturePointer.captureDragEvents&&t.eventDispatcher.emit("pointerdragend",this)}}class nr extends er{constructor(){super(...arguments),this._name="pointerdown"}_onActionEnd(t){this.pointer.isDragStart&&t.capturePointer.captureDragEvents&&t.eventDispatcher.emit("pointerdragstart",this)}}class or extends er{constructor(){super(...arguments),this._name="pointermove"}propagate(t){this.pointer.isActorAliveUnderPointer(t)&&(this.doAction(t),this.bubbles&&!this.isCanceled()&&t.parent&&this.propagate(t.parent))}_onActionStart(t){t.capturePointer.captureMoveEvents&&this.pointer.isDragging&&t.capturePointer.captureDragEvents&&t.eventDispatcher.emit("pointerdragmove",this)}}class ar extends er{constructor(){super(...arguments),this._name="pointerenter"}_onActionStart(t){t.capturePointer.captureMoveEvents}_onActionEnd(t){this.pointer.isDragging&&t.capturePointer.captureDragEvents&&t.eventDispatcher.emit("pointerdragenter",this)}}class hr extends er{constructor(){super(...arguments),this._name="pointerleave"}_onActionStart(t){t.capturePointer.captureMoveEvents}_onActionEnd(t){this.pointer.isDragging&&t.capturePointer.captureDragEvents&&t.eventDispatcher.emit("pointerdragleave",this)}}class lr extends er{constructor(){super(...arguments),this._name="pointercancel"}}class cr extends ct{constructor(t,e,i,s,r,n,o,a,h,l,c,d){super(),this.x=t,this.y=e,this.pageX=i,this.pageY=s,this.screenX=r,this.screenY=n,this.index=o,this.deltaX=a,this.deltaY=h,this.deltaZ=l,this.deltaMode=c,this.ev=d,this._isCanceled=!1}cancel(){this._isCanceled=!0}isCanceled(){return this._isCanceled}}function dr(t,e,i,s,r,n,o){let a;switch(t){case"up":a=new ir(rr);break;case"down":a=new ir(nr);break;case"move":a=new ir(or);break;case"cancel":a=new ir(lr);break;case"enter":a=new ir(ar);break;case"leave":a=new ir(hr)}return a.create(e,i,s,r,n,o)}class ur extends gi{constructor(t){super(),this._pointerDown=[],this._pointerUp=[],this._pointerMove=[],this._pointerCancel=[],this._wheel=[],this._pointers=[],this._activePointers=[],this._engine=t,this._pointers.push(new tr),this._activePointers=[-1],this.primary=this._pointers[0]}on(t,e){super.on(t,e)}init(t){(t=t||this._engine.canvas).addEventListener("touchstart",this._handleTouchEvent("down",this._pointerDown)),t.addEventListener("touchend",this._handleTouchEvent("up",this._pointerUp)),t.addEventListener("touchmove",this._handleTouchEvent("move",this._pointerMove)),t.addEventListener("touchcancel",this._handleTouchEvent("cancel",this._pointerCancel)),window.PointerEvent?(this._engine.canvas.style.touchAction="none",t.addEventListener("pointerdown",this._handlePointerEvent("down",this._pointerDown)),t.addEventListener("pointerup",this._handlePointerEvent("up",this._pointerUp)),t.addEventListener("pointermove",this._handlePointerEvent("move",this._pointerMove)),t.addEventListener("pointercancel",this._handlePointerEvent("cancel",this._pointerCancel))):window.MSPointerEvent?(this._engine.canvas.style.msTouchAction="none",t.addEventListener("MSPointerDown",this._handlePointerEvent("down",this._pointerDown)),t.addEventListener("MSPointerUp",this._handlePointerEvent("up",this._pointerUp)),t.addEventListener("MSPointerMove",this._handlePointerEvent("move",this._pointerMove)),t.addEventListener("MSPointerCancel",this._handlePointerEvent("cancel",this._pointerCancel))):(t.addEventListener("mousedown",this._handleMouseEvent("down",this._pointerDown)),t.addEventListener("mouseup",this._handleMouseEvent("up",this._pointerUp)),t.addEventListener("mousemove",this._handleMouseEvent("move",this._pointerMove)));const e={passive:!(this._engine.pageScrollPreventionMode===Or.All||this._engine.pageScrollPreventionMode===Or.Canvas)};"onwheel"in document.createElement("div")?t.addEventListener("wheel",this._handleWheelEvent("wheel",this._wheel),e):void 0!==document.onmousewheel?t.addEventListener("mousewheel",this._handleWheelEvent("wheel",this._wheel),e):t.addEventListener("MozMousePixelScroll",this._handleWheelEvent("wheel",this._wheel),e)}triggerEvent(t,e,i=Fs.Left,s="mouse",r=0){let n,o=0,a=0;e instanceof Z?(o=e.pagePos.x,a=e.pagePos.y,n=e):(o=e.x,a=e.y,n=new Z(e.clone(),e.clone(),e.clone()));const h={pageX:o,pageY:a,pointerId:r,pointerType:s,button:i,preventDefault:()=>{}};switch(t){case"move":this._handlePointerEvent(t,this._pointerMove,n)(h);break;case"down":this._handlePointerEvent(t,this._pointerDown,n)(h);break;case"up":this._handlePointerEvent(t,this._pointerUp,n)(h);break;case"cancel":this._handlePointerEvent(t,this._pointerCancel,n)(h)}for(const t of this._engine.currentScene.actors){const e=t.traits.filter((t=>t instanceof si))[0];e&&e.update(t,this._engine,1)}this.dispatchPointerEvents(),this.update()}update(){this._pointerUp.length=0,this._pointerDown.length=0,this._pointerMove.length=0,this._pointerCancel.length=0,this._wheel.length=0;for(let t=0;t<this._pointers.length;t++)this._pointers[t].update()}at(t){if(t>=this._pointers.length)for(let e=this._pointers.length-1,i=t;e<i;e++)this._pointers.push(new tr),this._activePointers.push(-1);return this._pointers[t]}count(){return this._pointers.length}checkAndUpdateActorUnderPointer(t){for(const e of this._pointers)e.checkActorUnderPointer(t)?e.addActorUnderPointer(t):e.removeActorUnderPointer(t)}_dispatchWithBubble(t){for(const e of t)for(const t of e.pointer.getActorsForEvents())if(e.isCanceled()||e.propagate(t),!e.bubbles||e.isCanceled())break}_dispatchPointerLeaveEvents(){const t={},e=[];for(const i of this._pointerMove)for(const s of i.pointer.getActorsForEvents())if(!t[i.pointer.id+"+"+s.id]&&i.pointer.wasActorUnderPointer(s)&&!i.pointer.isActorAliveUnderPointer(s)&&!i.isCanceled()){t[i.pointer.id+"+"+s.id]=i;const r=dr("leave",new Z(i.worldPos,i.pagePos,i.screenPos),i.pointer,i.index,i.pointerType,i.button,i.ev);r.propagate(s),e.push(r)}return e}_dispatchPointerEnterEvents(){const t={},e=[];for(const i of this._pointerMove)for(const s of i.pointer.getActorsForEvents())if(!t[i.pointer.id]&&!i.pointer.wasActorUnderPointer(s)&&i.pointer.isActorAliveUnderPointer(s)&&!i.isCanceled()){t[i.pointer.id]=i;const r=dr("enter",new Z(i.worldPos,i.pagePos,i.screenPos),i.pointer,i.index,i.pointerType,i.button,i.ev);r.propagate(s),e.push(r),i.pointer.isDragging&&(i.pointer.dragTarget=s)}return e}dispatchPointerEvents(){this._dispatchWithBubble(this._pointerDown),this._dispatchWithBubble(this._pointerUp),this._dispatchWithBubble(this._pointerMove),this._dispatchPointerLeaveEvents(),this._dispatchPointerEnterEvents(),this._dispatchWithBubble(this._pointerCancel);for(const t of this._wheel)for(const e of this._pointers[t.index].getActorsUnderPointer())if(this._propagateWheelPointerEvent(e,t),!t.bubbles||t.isCanceled())break}_propagateWheelPointerEvent(t,e){t.emit("pointerwheel",e),e.bubbles&&!e.isCanceled()&&t.parent&&this._propagateWheelPointerEvent(t.parent,e)}_handleMouseEvent(t,e){return i=>{i.preventDefault();const s=this.at(0),r=Z.fromPagePosition(i.pageX,i.pageY,this._engine),n=dr(t,r,s,0,ks.Mouse,this._nativeButtonToPointerButton(i.button),i);e.push(n),s.eventDispatcher.emit(t,n)}}_handleTouchEvent(t,e){return i=>{i.preventDefault();for(let s=0,r=i.changedTouches.length;s<r;s++){const r=this._pointers.length>1?this._getPointerIndex(i.changedTouches[s].identifier):0;if(-1===r)continue;const n=this.at(r),o=Z.fromPagePosition(i.changedTouches[s].pageX,i.changedTouches[s].pageY,this._engine),a=dr(t,o,n,r,ks.Touch,Is.Unknown,i);e.push(a),n.eventDispatcher.emit(t,a),this.emit(t,a),this._pointers.length>1&&("up"===t?this._activePointers[r]=-1:"down"===t&&(this._activePointers[r]=i.changedTouches[s].identifier))}}}_handlePointerEvent(t,e,i){return s=>{s.preventDefault();const r=this._pointers.length>1?this._getPointerIndex(s.pointerId):0;if(-1===r)return;const n=this.at(r),o=i||Z.fromPagePosition(s.pageX,s.pageY,this._engine),a=dr(t,o,n,r,this._stringToPointerType(s.pointerType),this._nativeButtonToPointerButton(s.button),s);e.push(a),n.eventDispatcher.emit(t,a),this.emit(t,a),this._pointers.length>1&&("up"===t?this._activePointers[r]=-1:"down"===t&&(this._activePointers[r]=s.pointerId))}}_handleWheelEvent(t,e){return i=>{(this._engine.pageScrollPreventionMode===Or.All||this._engine.pageScrollPreventionMode===Or.Canvas&&i.target===this._engine.canvas)&&i.preventDefault();const s=this._engine.screen.pageToScreenCoordinates(Q(i.pageX,i.pageY)),r=this._engine.screen.screenToWorldCoordinates(s),n=i.deltaX||i.wheelDeltaX*(-1/40)||0,o=i.deltaY||i.wheelDeltaY*(-1/40)||i.wheelDelta*(-1/40)||i.detail||0,a=i.deltaZ||0;let h=Ls.Pixel;i.deltaMode&&(1===i.deltaMode?h=Ls.Line:2===i.deltaMode&&(h=Ls.Page));const l=new cr(r.x,r.y,i.pageX,i.pageY,s.x,s.y,0,n,o,a,h,i);e.push(l),this.at(0).eventDispatcher.emit(t,l),this.emit(t,l)}}_getPointerIndex(t){let e;if((e=this._activePointers.indexOf(t))>-1)return e;for(let t=0;t<this._activePointers.length;t++)if(-1===this._activePointers[t])return t;return-1}_nativeButtonToPointerButton(t){switch(t){case Fs.NoButton:return Is.NoButton;case Fs.Left:return Is.Left;case Fs.Middle:return Is.Middle;case Fs.Right:return Is.Right;case Fs.Unknown:return Is.Unknown;default:return z(t)}}_stringToPointerType(t){switch(t){case"touch":return ks.Touch;case"mouse":return ks.Mouse;case"pen":return ks.Pen;default:return ks.Unknown}}}class pr extends gi{constructor(){super(),this.enabled=!1,this.supported=!!navigator.getGamepads,this._gamePadTimeStamps=[0,0,0,0],this._oldPads=[],this._pads=[],this._initSuccess=!1,this._navigator=navigator,this._minimumConfiguration=null}init(){this.supported&&(this._initSuccess||(this._oldPads=this._clonePads(this._navigator.getGamepads()),this._oldPads.length&&this._oldPads[0]&&(this._initSuccess=!0)))}setMinimumGamepadConfiguration(t){this._enableAndUpdate(),this._minimumConfiguration=t}_enableAndUpdate(){this.enabled||(this.enabled=!0,this.update())}_isGamepadValid(t){if(!this._minimumConfiguration)return!0;if(!t)return!1;const e=t.axes.filter((t=>!0)).length,i=t.buttons.filter((t=>!0)).length;return e>=this._minimumConfiguration.axis&&i>=this._minimumConfiguration.buttons&&t.connected}on(t,e){this._enableAndUpdate(),super.on(t,e)}off(t,e){this._enableAndUpdate(),super.off(t,e)}update(){if(!this.enabled||!this.supported)return;this.init();const t=this._navigator.getGamepads();for(let e=0;e<t.length;e++){if(!t[e]){const t=this.at(e);t.connected&&this.eventDispatcher.emit("disconnect",new Pt(e,t)),t.connected=!1;continue}if(!this.at(e).connected&&this._isGamepadValid(t[e])&&this.eventDispatcher.emit("connect",new St(e,this.at(e))),this.at(e).connected=!0,t[e].timestamp&&t[e].timestamp===this._gamePadTimeStamps[e])continue;let i,s,r,n,o;for(i in this._gamePadTimeStamps[e]=t[e].timestamp,this.at(e).navigatorGamepad=t[e],Ns)s=Ns[i],"number"==typeof s&&t[e].buttons[s]&&(o=t[e].buttons[s].value,o!==this._oldPads[e].getButton(s)&&(t[e].buttons[s].pressed?(this.at(e).updateButton(s,o),this.at(e).eventDispatcher.emit("button",new Ct(s,o,this.at(e)))):this.at(e).updateButton(s,0)));for(r in js)n=js[r],"number"==typeof n&&(o=t[e].axes[n],o!==this._oldPads[e].getAxes(n)&&(this.at(e).updateAxes(n,o),this.at(e).eventDispatcher.emit("axis",new Et(n,o,this.at(e)))));this._oldPads[e]=this._clonePad(t[e])}}at(t){if(this._enableAndUpdate(),t>=this._pads.length)for(let e=this._pads.length-1,i=t;e<i;e++)this._pads.push(new gr),this._oldPads.push(new gr);return this._pads[t]}getValidGamepads(){this._enableAndUpdate();const t=[];for(let e=0;e<this._pads.length;e++)this._isGamepadValid(this.at(e).navigatorGamepad)&&this.at(e).connected&&t.push(this.at(e));return t}count(){return this._pads.filter((t=>t.connected)).length}_clonePads(t){const e=[];for(let i=0,s=t.length;i<s;i++)e.push(this._clonePad(t[i]));return e}_clonePad(t){let e,i;const s=new gr;if(!t)return s;for(e=0,i=t.buttons.length;e<i;e++)t.buttons[e]&&s.updateButton(e,t.buttons[e].value);for(e=0,i=t.axes.length;e<i;e++)s.updateAxes(e,t.axes[e]);return s}}pr.MinAxisMoveThreshold=.05;class gr extends gi{constructor(){super(),this.connected=!1,this._buttons=new Array(16),this._axes=new Array(4);for(let t=0;t<this._buttons.length;t++)this._buttons[t]=0;for(let t=0;t<this._axes.length;t++)this._axes[t]=0}isButtonPressed(t,e=1){return this._buttons[t]>=e}getButton(t){return this._buttons[t]}getAxes(t){const e=this._axes[t];return Math.abs(e)<pr.MinAxisMoveThreshold?0:e}updateButton(t,e){this._buttons[t]=e}updateAxes(t,e){this._axes[t]=e}}(Gs=Ns||(Ns={}))[Gs.Face1=0]="Face1",Gs[Gs.Face2=1]="Face2",Gs[Gs.Face3=2]="Face3",Gs[Gs.Face4=3]="Face4",Gs[Gs.LeftBumper=4]="LeftBumper",Gs[Gs.RightBumper=5]="RightBumper",Gs[Gs.LeftTrigger=6]="LeftTrigger",Gs[Gs.RightTrigger=7]="RightTrigger",Gs[Gs.Select=8]="Select",Gs[Gs.Start=9]="Start",Gs[Gs.LeftStick=10]="LeftStick",Gs[Gs.RightStick=11]="RightStick",Gs[Gs.DpadUp=12]="DpadUp",Gs[Gs.DpadDown=13]="DpadDown",Gs[Gs.DpadLeft=14]="DpadLeft",Gs[Gs.DpadRight=15]="DpadRight",function(t){t[t.LeftStickX=0]="LeftStickX",t[t.LeftStickY=1]="LeftStickY",t[t.RightStickX=2]="RightStickX",t[t.RightStickY=3]="RightStickY"}(js||(js={}));class _r{constructor(t){this.nativeComponent=t,this._paused=!1,this._nativeHandlers={}}on(t,e){this._nativeHandlers[t]&&this.off(t,this._nativeHandlers[t]),this._nativeHandlers[t]=this._decorate(e),this.nativeComponent.addEventListener(t,this._nativeHandlers[t])}off(t,e){e||(e=this._nativeHandlers[t]),this.nativeComponent.removeEventListener(t,e),this._nativeHandlers[t]=null}_decorate(t){return e=>{this._paused||t(e)}}pause(){this._paused=!0}resume(){this._paused=!1}clear(){for(const t in this._nativeHandlers)this.off(t)}}class fr{constructor(t,e){this._windowGlobal=t,this._documentGlobal=e,this._windowComponent=new _r(this._windowGlobal),this._documentComponent=new _r(this._documentGlobal)}get window(){return this._windowComponent}get document(){return this._documentComponent}pause(){this.window.pause(),this.document.pause()}resume(){this.window.resume(),this.document.resume()}clear(){this.window.clear(),this.document.clear()}}class mr{constructor(){this._transforms=[],this._currentTransform=Ge.identity()}save(){this._transforms.push(this._currentTransform),this._currentTransform=this._currentTransform.clone()}restore(){this._currentTransform=this._transforms.pop()}translate(t,e){return this._currentTransform.translate(t,e)}rotate(t){return this._currentTransform.rotate(t)}scale(t,e){return this._currentTransform.scale(t,e)}set current(t){this._currentTransform=t}get current(){return this._currentTransform}}class yr{constructor(){this._states=[],this._currentState=this._getDefaultState()}_getDefaultState(){return{opacity:1}}_cloneState(){return{opacity:this._currentState.opacity}}save(){this._states.push(this._currentState),this._currentState=this._cloneState()}restore(){this._currentState=this._states.pop()}get current(){return this._currentState}}class wr{constructor(t,e,i){this._gl=t,this._vertexSource=e,this._fragmentSource=i,this.program=null,this.uniforms={},this.attributes={},this.layout=[],this.compile(t)}_createProgram(t,e,i){const s=t.createProgram();if(null===s)throw Error("Could not create graphics shader program");if(t.attachShader(s,e),t.attachShader(s,i),t.linkProgram(s),!t.getProgramParameter(s,t.LINK_STATUS))throw Error(`Could not link the program: [${t.getProgramInfoLog(s)}]`);return s}_compileShader(t,e,i){const s=t.createShader(i);if(null===s)throw Error(`Could not build shader: [${e}]`);if(t.shaderSource(s,e),t.compileShader(s),!t.getShaderParameter(s,t.COMPILE_STATUS))throw Error(`Could not compile shader [${t.getShaderInfoLog(s)}]`);return s}compile(t){const e=this._compileShader(t,this._vertexSource,t.VERTEX_SHADER),i=this._compileShader(t,this._fragmentSource,t.FRAGMENT_SHADER),s=this._createProgram(t,e,i);return this.program=s}addUniformMatrix(t,e){if(!e)throw Error(`Shader Uniform Matrix '${t}' was set to null or undefined`);const i=this._gl;this.uniforms[t]={name:t,type:"matrix",location:i.getUniformLocation(this.program,t),data:e}}addUniformIntegerArray(t,e){if(!e)throw Error(`Shader Uniform Integery Array '${t}' was set to null or undefined`);const i=this._gl;this.uniforms[t]={name:t,type:"numbers",location:i.getUniformLocation(this.program,t),data:e}}addAttribute(t,e,i,s=!1){const r=this._gl.getAttribLocation(this.program,t);this.attributes[t]={name:t,size:e,glType:i,normalized:s,location:r},this.layout.push(this.attributes[t])}get vertexAttributeSize(){let t=0;for(const e of this.layout)t+=e.size;return t}get totalVertexSizeBytes(){let t=0;for(const e of this.layout){let i=1;switch(e.glType){case this._gl.FLOAT:i=4;break;default:i=1}t+=i*e.size}return t}getAttributeSize(t){let e=1;switch(this.attributes[t].glType){case this._gl.FLOAT:e=4;break;default:e=1}return e*this.attributes[t].size}use(){const t=this._gl;t.useProgram(this.program);let e=0;for(const i of this.layout)t.vertexAttribPointer(i.location,i.size,i.glType,i.normalized,this.totalVertexSizeBytes,e),t.enableVertexAttribArray(i.location),e+=this.getAttributeSize(i.name);for(const e in this.uniforms){const i=this.uniforms[e];switch(i.type){case"matrix":t.uniformMatrix4fv(i.location,!1,i.data);break;case"numbers":t.uniform1iv(i.location,i.data)}}}}class vr{constructor(t){this.max=t,this._pool=void 0,this.commands=[]}isFull(){return this.commands.length>=this.max}canAdd(){return!this.isFull()}add(t){this.commands.push(t)}dispose(){return this.commands.length=0,this}}class br{constructor(t,e,i=100){this.builder=t,this.recycler=e,this.maxObjects=i,this.totalAllocations=0,this.index=0,this.objects=[]}using(t){const e=t(this);return e?this.done(...e):this.done()}borrow(t){t(this.get()),this.index--}get(...t){if(this.index===this.maxObjects)throw new Error("Max pooled objects reached, possible memory leak?");if(this.objects[this.index])return this.recycler(this.objects[this.index++],...t);{this.totalAllocations++;const e=this.objects[this.index++]=this.builder(...t);return e._pool=this,e}}done(...t){this.index=0;for(const e of t){const t=this.objects.indexOf(e);this.objects[t]=this.builder(),this.objects[t]._pool=this,this.totalAllocations++,e._pool=void 0}return t}}class xr{constructor(t){var e,i,s;this.priority=0,this._buffer=null,this._maxCommandsPerBatch=2e3,this._batches=[],this._gl=t.gl;const r=t.command;this._verticesPerCommand=null!==(e=null==t?void 0:t.verticesPerCommand)&&void 0!==e?e:1,this._maxCommandsPerBatch=null!==(i=null==t?void 0:t.maxCommandsPerBatch)&&void 0!==i?i:this._maxCommandsPerBatch;const n=null!==(s=null==t?void 0:t.batchFactory)&&void 0!==s?s:()=>new vr(this._maxCommandsPerBatch);this.commands=new br((()=>new r),(t=>t.dispose()),this._maxCommandsPerBatch),this._batchPool=new br(n,(t=>t.dispose()),100)}init(){const t=this._gl;this.shader=this.buildShader(t),this._vertices=new Float32Array(this.shader.vertexAttributeSize*this._verticesPerCommand*this._maxCommandsPerBatch),this._buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this._buffer),t.bufferData(t.ARRAY_BUFFER,this._vertices,t.DYNAMIC_DRAW)}get vertexSize(){return this.shader.vertexAttributeSize}addCommand(t){0===this._batches.length&&this._batches.push(this._batchPool.get());const e=this._batches[this._batches.length-1];if(e.canAdd())e.add(t);else{const e=this._batchPool.get();e.add(t),this._batches.push(e)}}render(){const t=this._gl;t.bindBuffer(t.ARRAY_BUFFER,this._buffer),this.shader.use();let e=0,i=0;for(const s of this._batches){const r=this.buildBatchVertices(this._vertices,s);t.bufferSubData(t.ARRAY_BUFFER,0,this._vertices),this.renderBatch(t,s,r),i+=s.commands.length,e++}this.commands.done(),this._batchPool.done(),this._batches.length=0,Ts.DrawCallCount+=e,Ts.DrawnImagesCount+=i}}class Ar{constructor(){this.color=at.Black,this.start=X.Zero,this.end=X.Zero}dispose(){return this.color.r=0,this.color.g=0,this.color.b=0,this.color.a=1,this.start.setTo(0,0),this.end.setTo(0,0),this}}class Sr extends xr{constructor(t,e){super({gl:t,command:Ar,verticesPerCommand:2}),this._contextInfo=e,this.init()}buildShader(t){const e=new wr(t,"attribute vec4 a_position;\nattribute vec4 a_color;\n\nvarying lowp vec4 v_color;\n\nuniform mat4 u_matrix;\n\n\nvoid main() {\n   // Set the vertex position using the ortho transform matrix\n   gl_Position = u_matrix * a_position;\n\n   // Passthrough the color\n   v_color = a_color;\n}","precision mediump float;\n\n// Color\nvarying lowp vec4 v_color;\n\n\nvoid main() {\n  gl_FragColor = v_color;\n}");return e.addAttribute("a_position",2,t.FLOAT),e.addAttribute("a_color",4,t.FLOAT),e.addUniformMatrix("u_matrix",this._contextInfo.matrix.data),e}addLine(t,e,i){const s=this.commands.get();s.start=this._contextInfo.transform.current.multv(t),s.end=this._contextInfo.transform.current.multv(e),s.color=i,s.color.a=s.color.a*this._contextInfo.state.current.opacity,this.addCommand(s)}buildBatchVertices(t,e){let i=0;for(const s of e.commands)t[i++]=s.start.x,t[i++]=s.start.y,t[i++]=s.color.r/255,t[i++]=s.color.g/255,t[i++]=s.color.b/255,t[i++]=s.color.a,t[i++]=s.end.x,t[i++]=s.end.y,t[i++]=s.color.r/255,t[i++]=s.color.g/255,t[i++]=s.color.b/255,t[i++]=s.color.a;return i/this.vertexSize}renderBatch(t,e,i){t.drawArrays(t.LINES,0,i)}}class Pr{constructor(t,e,i,s,r,n,o,a,h){this._pool=void 0,this.snapToPixel=!0,this.opacity=1,this.width=0,this.height=0,this.dest=[0,0],this.view=[0,0,0,0],this._geom=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],this.init(t,e,i,s,r,n,o,a,h)}init(t,e,i,s,r,n,o,a,h){this.image=t,this.width=(null==t?void 0:t.width)||s||0,this.height=(null==t?void 0:t.height)||r||0,this.view=[0,0,null!=s?s:null==t?void 0:t.width,null!=r?r:null==t?void 0:t.height],this.dest=[e,i],void 0!==n&&void 0!==o&&void 0!==a&&void 0!==h&&(this.view=[e,i,null!=s?s:null==t?void 0:t.width,null!=r?r:null==t?void 0:t.height],this.dest=[n,o],this.width=a,this.height=h);let l=0;if(this._geom[l++]=[this.dest[0],this.dest[1]],this._geom[l++]=[this.dest[0],this.dest[1]+this.height],this._geom[l++]=[this.dest[0]+this.width,this.dest[1]],this._geom[l++]=[this.dest[0]+this.width,this.dest[1]],this._geom[l++]=[this.dest[0],this.dest[1]+this.height],this._geom[l++]=[this.dest[0]+this.width,this.dest[1]+this.height],this.snapToPixel)for(const t of this._geom)t[0]=~~t[0],t[1]=~~t[1];return this}dispose(){this.image=null,this.width=0,this.height=0,this.view=[0,0,0,0],this.dest=[0,0];let t=0;return this._geom[t++]=[this.dest[0],this.dest[1]],this._geom[t++]=[this.dest[0],this.dest[1]+this.height],this._geom[t++]=[this.dest[0]+this.width,this.dest[1]],this._geom[t++]=[this.dest[0]+this.width,this.dest[1]],this._geom[t++]=[this.dest[0],this.dest[1]+this.height],this._geom[t++]=[this.dest[0]+this.width,this.dest[1]+this.height],this}applyTransform(t,e){if(t)for(let e=0;e<this._geom.length;e++)this._geom[e]=t.multv(this._geom[e]),this.snapToPixel&&(this._geom[e]=[~~this._geom[e][0],~~this._geom[e][1]]);this.opacity=e}get geometry(){return this._geom}}class Cr extends vr{constructor(t,e){super(t),this.maxDraws=t,this.maxTextures=e,this.textures=[],this.commands=[],this._graphicMap={}}isFull(){return this.commands.length>=this.maxDraws||this.textures.length>=this.maxTextures}canAdd(){return!(this.commands.length>=this.maxDraws)&&this.textures.length<this.maxTextures}_isCommandFull(){return this.commands.length>=this.maxDraws}_isTextureFull(){return this.textures.length>=this.maxTextures}_wouldAddTexture(t){return!this._graphicMap[t.image.id]}maybeAdd(t){return!((this._isCommandFull()||this._isTextureFull())&&this._wouldAddTexture(t)||(this.add(t),0))}add(t){const e=Ri.load(t.image);-1===this.textures.indexOf(e)&&this.textures.push(e),this.commands.push(t)}bindTextures(t){for(let e=0;e<this.maxTextures;e++)t.activeTexture(t.TEXTURE0+e),t.bindTexture(t.TEXTURE_2D,this.textures[e]||this.textures[0])}getBatchTextureId(t){return t.image?this.textures.indexOf(Ri.get(t.image)):-1}dispose(){return this.clear(),this}clear(){this.commands.length=0,this.textures.length=0,this._graphicMap={}}}class Er extends xr{constructor(t,e){super({gl:t,command:Pr,verticesPerCommand:6,maxCommandsPerBatch:2e3,batchFactory:()=>new Cr(2e3,t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS))}),this._contextInfo=e,Ri.registerContext(t),this.init()}buildShader(t){const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),i=new wr(t,"attribute vec4 a_position;\n\n// Opacity \nattribute float a_opacity;\nvarying float v_opacity;\n\n// UV coordinate\nattribute vec2 a_texcoord;\nvarying vec2 v_texcoord;\n\n// Texture number\nattribute lowp float a_textureIndex;\nvarying lowp float v_textureIndex;\n\nuniform mat4 u_matrix;\n\n\nvoid main() {\n   // Set the vertex position using the ortho transform matrix\n   gl_Position = u_matrix * a_position;\n\n   // Pass through the Opacity to the fragment shader\n   v_opacity = a_opacity;\n   // Pass through the UV coord to the fragment shader\n   v_texcoord = a_texcoord;\n   // Pass through the texture number to the fragment shader\n   v_textureIndex = a_textureIndex;\n}",this._transformFragmentSource("precision mediump float;\n\n// UV coord\nvarying vec2 v_texcoord;\n\n// Texture index\nvarying lowp float v_textureIndex;\n\n// Opacity\nvarying float v_opacity;\n\nuniform sampler2D u_textures[%%count%%];\n\nvoid main() {\n   // In order to support the most efficient sprite batching, we have multiple\n   // textures loaded into the gpu (usually 8) this picker logic skips over textures\n   // that do not apply to a particular sprite.\n\n   // Error color\n   vec4 color = vec4(1.0, 0.0, 0.0, 1.0);\n\n   // Always at least 1 texture at 0\n   if (v_textureIndex <= .5) {\n      gl_FragColor = texture2D(u_textures[0], v_texcoord);\n      gl_FragColor.w = gl_FragColor.w * v_opacity;\n      %%texture_picker%%\n   } else {\n      gl_FragColor = color;\n   }\n}",e));return i.addAttribute("a_position",3,t.FLOAT),i.addAttribute("a_texcoord",2,t.FLOAT),i.addAttribute("a_textureIndex",1,t.FLOAT),i.addAttribute("a_opacity",1,t.FLOAT),i.addUniformMatrix("u_matrix",this._contextInfo.matrix.data),i.addUniformIntegerArray("u_textures",[...Array(e)].map(((t,e)=>e))),i}_transformFragmentSource(t,e){let i=t.replace("%%count%%",e.toString()),s="";for(let t=0;t<e;t++)s+=`   } else if (v_textureIndex <= ${t}.5) {\n\n                gl_FragColor = texture2D(u_textures[${t}], v_texcoord);\n\n                gl_FragColor.w = gl_FragColor.w * v_opacity;\n`;return i=i.replace("%%texture_picker%%",s),i}addImage(t,e,i,s,r,n,o,a,h){const l=this.commands.get().init(t,e,i,s,r,n,o,a,h);l.applyTransform(this._contextInfo.transform.current,this._contextInfo.state.current.opacity),this.addCommand(l)}renderBatch(t,e,i){e.bindTextures(t),t.drawArrays(t.TRIANGLES,0,i)}buildBatchVertices(t,e){let i=0,s=0,r=0,n=0,o=0,a=0,h=0,l=0;for(const c of e.commands){s=c.view[0],r=c.view[1],n=c.view[2],o=c.view[3],a=Ti(c.image.width||c.width),h=Ti(c.image.height||c.height),l=e.getBatchTextureId(c);const d=s/a,u=r/h,p=(s+n)/a,g=(r+o)/h;t[i++]=c.geometry[0][0],t[i++]=c.geometry[0][1],t[i++]=0,t[i++]=d,t[i++]=u,t[i++]=l,t[i++]=c.opacity,t[i++]=c.geometry[1][0],t[i++]=c.geometry[1][1],t[i++]=0,t[i++]=d,t[i++]=g,t[i++]=l,t[i++]=c.opacity,t[i++]=c.geometry[2][0],t[i++]=c.geometry[2][1],t[i++]=0,t[i++]=p,t[i++]=u,t[i++]=l,t[i++]=c.opacity,t[i++]=c.geometry[3][0],t[i++]=c.geometry[3][1],t[i++]=0,t[i++]=p,t[i++]=u,t[i++]=l,t[i++]=c.opacity,t[i++]=c.geometry[4][0],t[i++]=c.geometry[4][1],t[i++]=0,t[i++]=d,t[i++]=g,t[i++]=l,t[i++]=c.opacity,t[i++]=c.geometry[5][0],t[i++]=c.geometry[5][1],t[i++]=0,t[i++]=p,t[i++]=g,t[i++]=l,t[i++]=c.opacity}return i/this.vertexSize}}class Tr{constructor(){this.point=X.Zero,this.color=at.Black,this.size=1}dispose(){return this.point.setTo(0,0),this.color.r=0,this.color.g=0,this.color.b=0,this.color.a=1,this.size=1,this}}class Dr extends xr{constructor(t,e){super({gl:t,command:Tr,verticesPerCommand:1}),this._contextInfo=e,this.init()}buildShader(t){t.getExtension("OES_standard_derivatives");const e=new wr(t,"attribute vec4 a_position;\nattribute vec4 a_color;\nattribute float a_size;\nvarying lowp vec4 v_color;\nuniform mat4 u_matrix;\n\nvoid main() {\n  gl_Position = u_matrix * a_position;\n  gl_PointSize = a_size * 2.0;\n  v_color = a_color;\n}","#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\n\nprecision mediump float;\nvarying lowp vec4 v_color;\n\nvoid main() {\n  float r = 0.0, delta = 0.0, alpha = 1.0;\n  vec2 cxy = 2.0 * gl_PointCoord - 1.0;\n  r = dot(cxy, cxy);\n  \n#ifdef GL_OES_standard_derivatives\n  delta = fwidth(r);\n  alpha = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);\n#else\n  if (r > 1.0) {\n    discard;\n  }\n#endif\n  gl_FragColor = vec4(v_color.rgb, v_color.a * alpha);\n}");return e.addAttribute("a_position",2,t.FLOAT),e.addAttribute("a_color",4,t.FLOAT),e.addAttribute("a_size",1,t.FLOAT),e.addUniformMatrix("u_matrix",this._contextInfo.matrix.data),e}addPoint(t,e,i){const s=this.commands.get();s.point=this._contextInfo.transform.current.multv(t),s.color.r=e.r,s.color.g=e.g,s.color.b=e.b,s.color.a=e.a*this._contextInfo.state.current.opacity,s.size=i*Math.max(this._contextInfo.transform.current.getScaleX(),this._contextInfo.transform.current.getScaleY()),this.addCommand(s)}buildBatchVertices(t,e){let i=0;for(const s of e.commands)t[i++]=s.point.x,t[i++]=s.point.y,t[i++]=s.color.r/255,t[i++]=s.color.g/255,t[i++]=s.color.b/255,t[i++]=s.color.a,t[i++]=s.size;return i/this.vertexSize}renderBatch(t,e,i){t.drawArrays(t.POINTS,0,i)}}class Rr{constructor(t){this._webglCtx=t}drawRect(t,e,i,s,r={color:at.Black}){this.drawLine(Q(t,e),Q(t+i,e),Object.assign({},r)),this.drawLine(Q(t+i,e),Q(t+i,e+s),Object.assign({},r)),this.drawLine(Q(t+i,e+s),Q(t,e+s),Object.assign({},r)),this.drawLine(Q(t,e+s),Q(t,e),Object.assign({},r))}drawLine(t,e,i={color:at.Black}){this._webglCtx.__lineRenderer.addLine(t,e,i.color)}drawPoint(t,e={color:at.Black,size:5}){this._webglCtx.__pointRenderer.addPoint(t,e.color,e.size)}}class Br{constructor(t){this._transform=new mr,this._state=new yr,this.snapToPixel=!0,this.smoothing=!1,this.backgroundColor=at.ExcaliburBlue,this.debug=new Rr(this);const{canvasElement:e,enableTransparency:i,smoothing:s,snapToPixel:r,backgroundColor:n}=t;this.__gl=e.getContext("webgl",{antialias:null!=s?s:this.smoothing,premultipliedAlpha:!1,alpha:null==i||i,depth:!0,powerPreference:"high-performance"}),this.snapToPixel=null!=r?r:this.snapToPixel,this.smoothing=null!=s?s:this.smoothing,this.backgroundColor=null!=n?n:this.backgroundColor,this._init()}get opacity(){return this._state.current.opacity}set opacity(t){this._state.current.opacity=t}get width(){return this.__gl.canvas.width}get height(){return this.__gl.canvas.height}_init(){const t=this.__gl;this._ortho=Ge.ortho(0,t.canvas.width,t.canvas.height,0,400,-400),t.viewport(0,0,t.canvas.width,t.canvas.height),t.clearColor(this.backgroundColor.r/255,this.backgroundColor.g/255,this.backgroundColor.b/255,this.backgroundColor.a),t.clear(t.COLOR_BUFFER_BIT),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),this.__pointRenderer=new Dr(t,{matrix:this._ortho,transform:this._transform,state:this._state}),this.__lineRenderer=new Sr(t,{matrix:this._ortho,transform:this._transform,state:this._state}),this.__imageRenderer=new Er(t,{matrix:this._ortho,transform:this._transform,state:this._state}),this._canvas=new Wi({width:t.canvas.width,height:t.canvas.height}),this.__ctx=this._canvas.ctx}resetTransform(){this._transform.current=Ge.identity()}updateViewport(){const t=this.__gl;this._ortho=this._ortho=Ge.ortho(0,t.canvas.width,t.canvas.height,0,400,-400),this.__pointRenderer.shader.addUniformMatrix("u_matrix",this._ortho.data),this.__lineRenderer.shader.addUniformMatrix("u_matrix",this._ortho.data),this.__imageRenderer.shader.addUniformMatrix("u_matrix",this._ortho.data),this._canvas.width=t.canvas.width,this._canvas.height=t.canvas.height}drawImage(t,e,i,s,r,n,o,a,h){if(0!==s&&0!==r&&0!==a&&0!==h&&0!==t.width&&0!==t.height)return t?void this.__imageRenderer.addImage(t,e,i,s,r,n,o,a,h):(m.getInstance().warn("Cannot draw a null or undefined image"),void(console.trace&&console.trace()))}save(){this._transform.save(),this._state.save()}restore(){this._transform.restore(),this._state.restore()}translate(t,e){this._transform.translate(this.snapToPixel?~~t:t,this.snapToPixel?~~e:e)}rotate(t){this._transform.rotate(t)}scale(t,e){this._transform.scale(t,e)}transform(t){this._transform.current=t}clear(){const t=this.__gl;t.clearColor(this.backgroundColor.r/255,this.backgroundColor.g/255,this.backgroundColor.b/255,this.backgroundColor.a),t.clear(t.COLOR_BUFFER_BIT),Ts.clear()}flush(){const t=this.__gl;t.viewport(0,0,t.canvas.width,t.canvas.height),this.__imageRenderer.render(),this.__lineRenderer.render(),this.__pointRenderer.render()}}class Mr{constructor(t){this._ex=t}drawRect(t,e,i,s){this._ex.__ctx.save(),this._ex.__ctx.strokeStyle="red",this._ex.__ctx.strokeRect(this._ex.snapToPixel?~~t:t,this._ex.snapToPixel?~~e:e,this._ex.snapToPixel?~~i:i,this._ex.snapToPixel?~~s:s),this._ex.__ctx.restore()}drawLine(t,e,i={color:at.Black}){this._ex.__ctx.save(),this._ex.__ctx.beginPath(),this._ex.__ctx.strokeStyle=i.color.toString(),this._ex.__ctx.moveTo(this._ex.snapToPixel?~~t.x:t.x,this._ex.snapToPixel?~~t.y:t.y),this._ex.__ctx.lineTo(this._ex.snapToPixel?~~e.x:e.x,this._ex.snapToPixel?~~e.y:e.y),this._ex.__ctx.lineWidth=2,this._ex.__ctx.stroke(),this._ex.__ctx.closePath(),this._ex.__ctx.restore()}drawPoint(t,e={color:at.Black,size:5}){this._ex.__ctx.save(),this._ex.__ctx.beginPath(),this._ex.__ctx.fillStyle=e.color.toString(),this._ex.__ctx.arc(this._ex.snapToPixel?~~t.x:t.x,this._ex.snapToPixel?~~t.y:t.y,e.size,0,2*Math.PI),this._ex.__ctx.fill(),this._ex.__ctx.closePath(),this._ex.__ctx.restore()}}class kr{constructor(t){this.backgroundColor=at.ExcaliburBlue,this._state=new yr,this.snapToPixel=!0,this.debug=new Mr(this);const{canvasElement:e,enableTransparency:i,snapToPixel:s,smoothing:r,backgroundColor:n}=t;this.__ctx=e.getContext("2d",{alpha:null==i||i}),this.backgroundColor=null!=n?n:this.backgroundColor,this.snapToPixel=null!=s?s:this.snapToPixel,this.smoothing=null!=r?r:this.smoothing}get width(){return this.__ctx.canvas.width}get height(){return this.__ctx.canvas.height}get opacity(){return this._state.current.opacity}set opacity(t){this._state.current.opacity=t}get smoothing(){return this.__ctx.imageSmoothingEnabled}set smoothing(t){this.__ctx.imageSmoothingEnabled=t}resetTransform(){this.__ctx.resetTransform()}updateViewport(){}drawImage(t,e,i,s,r,n,o,a,h){if(0===s||0===r)return;if(0===a||0===h)return;if(0===t.width||0===t.height)return;this.__ctx.globalAlpha=this.opacity;const l=[t,e,i,s,r,n,o,a,h].filter((t=>void 0!==t)).map((t=>"number"==typeof t&&this.snapToPixel?~~t:t));this.__ctx.drawImage.apply(this.__ctx,l),Ts.DrawCallCount++,Ts.DrawnImagesCount=1}save(){this.__ctx.save()}restore(){this.__ctx.restore()}translate(t,e){this.__ctx.translate(this.snapToPixel?~~t:t,this.snapToPixel?~~e:e)}rotate(t){this.__ctx.rotate(t)}scale(t,e){this.__ctx.scale(t,e)}clear(){this.__ctx.clearRect(0,0,this.width,this.height),this.__ctx.fillStyle=this.backgroundColor.toString(),this.__ctx.fillRect(0,0,this.width,this.height),Ts.clear()}flush(){}}var Or,Fr,Ir=function(t,e,i,s){var r,n=arguments.length,o=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(o=(n<3?r(o):n>3?r(e,i,o):r(e,i))||o);return n>3&&o&&Object.defineProperty(e,i,o),o};_(),(Fr=Or||(Or={}))[Fr.None=0]="None",Fr[Fr.Canvas=1]="Canvas",Fr[Fr.All=2]="All";class Lr extends gi{constructor(t){var e,i,s;super(),this._hasStarted=!1,this.postProcessors=[],this.scenes={},this._animations=[],this._suppressPlayButton=!1,this.pauseAudioWhenHidden=!0,this._isDebug=!1,this.debugColor=new at(255,255,255),this.enableCanvasTransparency=!0,this.onFatalException=t=>{m.getInstance().fatal(t)},this._timescale=1,this._isLoading=!1,this._isInitialized=!1,this._deferredGoTo=null,t=Object.assign(Object.assign({},Lr._DEFAULT_ENGINE_OPTIONS),t),f.freeze(),this.browser=new fr(window,document);const r=new ji;if(!t.suppressMinimumBrowserFeatureDetection&&!(this._compatible=r.test())){const e=document.createElement("div");if(e.innerText="Sorry, your browser does not support all the features needed for Excalibur",document.body.appendChild(e),r.failedTests.forEach((function(t){const e=document.createElement("div");e.innerText="Browser feature missing "+t,document.body.appendChild(e)})),t.canvasElementId){const e=document.getElementById(t.canvasElementId);e&&e.parentElement.removeChild(e)}return}this._compatible=!0,console.log&&!t.suppressConsoleBootMessage&&(console.log(`%cPowered by Excalibur.js (v${jn})`,"background: #176BAA; color: white; border-radius: 5px; padding: 15px; font-size: 1.5em; line-height: 80px;"),console.log("\n      /| ________________\nO|===|* >________________>\n      \\|"),console.log("Visit","http://excaliburjs.com","for more information")),t.suppressPlayButton&&(this._suppressPlayButton=!0),this._logger=m.getInstance(),this._logger.defaultLevel===c.Debug&&r.logBrowserFeatures(),this._logger.debug("Building engine..."),this.canvasElementId=t.canvasElementId,t.canvasElementId?(this._logger.debug("Using Canvas element specified: "+t.canvasElementId),this.canvas=document.getElementById(t.canvasElementId)):t.canvasElement?(this._logger.debug("Using Canvas element specified:",t.canvasElement),this.canvas=t.canvasElement):(this._logger.debug("Using generated canvas element"),this.canvas=document.createElement("canvas"));let n=null!==(e=t.displayMode)&&void 0!==e?e:Qt.Fixed;if(t.width&&t.height||t.viewport?(void 0===t.displayMode&&(n=Qt.Fixed),this._logger.debug("Engine viewport is size "+t.width+" x "+t.height)):t.displayMode||(this._logger.debug("Engine viewport is fit"),n=Qt.Fit),f.isEnabled(h.WebGL)){const e=new Br({canvasElement:this.canvas,enableTransparency:this.enableCanvasTransparency,smoothing:t.antialiasing,backgroundColor:t.backgroundColor,snapToPixel:t.snapToPixel});this.graphicsContext=e,this.ctx=e.__ctx}else{const e=new kr({canvasElement:this.canvas,enableTransparency:this.enableCanvasTransparency,smoothing:t.antialiasing,backgroundColor:t.backgroundColor,snapToPixel:t.snapToPixel});this.graphicsContext=e,this.ctx=e.__ctx}this.screen=new te({canvas:this.canvas,context:this.graphicsContext,antialiasing:null===(i=t.antialiasing)||void 0===i||i,browser:this.browser,viewport:null!==(s=t.viewport)&&void 0!==s?s:t.width&&t.height?{width:t.width,height:t.height}:Jt.SVGA,resolution:t.resolution,displayMode:n,position:t.position,pixelRatio:t.suppressHiDPIScaling?1:null}),this.screen.applyResolutionAndViewport(),t.backgroundColor&&(this.backgroundColor=t.backgroundColor.clone()),this.enableCanvasTransparency=t.enableCanvasTransparency,this._loader=new Hi,this.debug=new Ys(this),this._initialize(t),this.rootScene=this.currentScene=new Xs(this),this.addScene("root",this.rootScene)}get canvasWidth(){return this.screen.canvasWidth}get halfCanvasWidth(){return this.screen.halfCanvasWidth}get canvasHeight(){return this.screen.canvasHeight}get halfCanvasHeight(){return this.screen.halfCanvasHeight}get drawWidth(){return this.screen.drawWidth}get halfDrawWidth(){return this.screen.halfDrawWidth}get drawHeight(){return this.screen.drawHeight}get halfDrawHeight(){return this.screen.halfDrawHeight}get isHiDpi(){return this.screen.isHiDpi}get stats(){return this.debug.stats}get isFullscreen(){return this.screen.isFullScreen}get displayMode(){return this.screen.displayMode}get pixelRatio(){return this.screen.pixelRatio}get isDebug(){return this._isDebug}on(t,e){super.on(t,e)}once(t,e){super.once(t,e)}off(t,e){super.off(t,e)}getWorldBounds(){return this.screen.getWorldBounds()}get timescale(){return this._timescale}set timescale(t){t<=0?m.getInstance().error("Cannot set engine.timescale to a value of 0 or less than 0."):this._timescale=t}playAnimation(t,e,i){this._animations.push(new zr(t,e,i))}addTileMap(t){this.currentScene.addTileMap(t)}removeTileMap(t){this.currentScene.removeTileMap(t)}addTimer(t){return this.currentScene.addTimer(t)}removeTimer(t){return this.currentScene.removeTimer(t)}addScene(t,e){this.scenes[t]&&this._logger.warn("Scene",t,"already exists overwriting"),this.scenes[t]=e}removeScene(t){if(t instanceof Xs)for(const e in this.scenes)this.scenes.hasOwnProperty(e)&&this.scenes[e]===t&&delete this.scenes[e];"string"==typeof t&&delete this.scenes[t]}add(t){2===arguments.length&&this.addScene(arguments[0],arguments[1]),this._deferredGoTo&&this.scenes[this._deferredGoTo]?this.scenes[this._deferredGoTo].add(t):this.currentScene.add(t)}remove(t){t instanceof Ii&&this.currentScene.remove(t),t instanceof Xs&&this.removeScene(t),"string"==typeof t&&this.removeScene(t)}goToScene(t){if(this.isInitialized)if(this.scenes[t]){const e=this.currentScene,i=this.scenes[t];this._logger.debug("Going to scene:",t),this.currentScene.isInitialized&&(this.currentScene._deactivate.call(this.currentScene,[e,i]),this.currentScene.eventDispatcher.emit("deactivate",new zt(i,this.currentScene))),this.currentScene=i,this.screen.setCurrentCamera(i.camera),this.currentScene._initialize(this),this.currentScene._activate.call(this.currentScene,[e,i]),this.currentScene.eventDispatcher.emit("activate",new Lt(e,this.currentScene))}else this._logger.error("Scene",t,"does not exist!");else this._deferredGoTo=t}screenToWorldCoordinates(t){return this.screen.screenToWorldCoordinates(t)}worldToScreenCoordinates(t){return this.screen.worldToScreenCoordinates(t)}_initialize(t){let e,i;this.pageScrollPreventionMode=t.scrollPreventionMode,this.input={keyboard:new Js,pointers:new ur(this),gamepads:new pr},this.input.keyboard.init(),this.input.pointers.init(t&&t.pointerScope===Os.Document?document:this.canvas),this.input.gamepads.init(),void 0!==document.hidden?(e="hidden",i="visibilitychange"):"msHidden"in document?(e="msHidden",i="msvisibilitychange"):"webkitHidden"in document&&(e="webkitHidden",i="webkitvisibilitychange"),this.browser.document.on(i,(()=>{document[e]?(this.eventDispatcher.emit("hidden",new Bt(this)),this._logger.debug("Window hidden")):(this.eventDispatcher.emit("visible",new Rt(this)),this._logger.debug("Window visible"))})),this.canvasElementId||t.canvasElement||document.body.appendChild(this.canvas)}onInitialize(t){}setAntialiasing(t){this.screen.antialiasing=t}getAntialiasing(){return this.screen.antialiasing}get isInitialized(){return this._isInitialized}_overrideInitialize(t){this.isInitialized||(this.onInitialize(t),super.emit("initialize",new It(t,this)),this._isInitialized=!0,this._deferredGoTo?this.goToScene(this._deferredGoTo):this.goToScene("root"))}_update(t){if(this._isLoading)return this._loader.update(this,t),this.input.keyboard.update(),this.input.pointers.update(),void this.input.gamepads.update();this._overrideInitialize(this),this._preupdate(t),this.currentScene.update(this,t),this._animations=this._animations.filter((function(t){return!t.animation.isDone()})),this.input.keyboard.update(),this.input.pointers.update(),this.input.gamepads.update(),this._postupdate(t)}_preupdate(t){this.emit("preupdate",new vt(this,t,this)),this.onPreUpdate(this,t)}onPreUpdate(t,e){}_postupdate(t){this.emit("postupdate",new bt(this,t,this)),this.onPostUpdate(this,t)}onPostUpdate(t,e){}_draw(t){const e=this.ctx;if(this._predraw(e,t),this._isLoading)return this._loader.canvas.draw(this.graphicsContext,0,0),void this.graphicsContext.flush();this.graphicsContext.backgroundColor=this.backgroundColor,this.currentScene.draw(this.ctx,t);let i=0;const s=this._animations.length;for(;i<s;i++)this._animations[i].animation.draw(e,this._animations[i].x,this._animations[i].y);if(this.isDebug){this.ctx.font="Consolas",this.ctx.fillStyle=this.debugColor.toString();const t=this.input.keyboard.getKeys();for(let e=0;e<t.length;e++)this.ctx.fillText(t[e].toString()+" : "+(Ms[t[e]]?Ms[t[e]]:"Not Mapped"),100,10*e+10);this.ctx.fillText("FPS:"+this.stats.currFrame.fps.toFixed(2).toString(),10,10)}for(let t=0;t<this.postProcessors.length;t++)this.postProcessors[t].process(this.ctx.getImageData(0,0,this.canvasWidth,this.canvasHeight),this.ctx);this._postdraw(e,t)}_predraw(t,e){this.emit("predraw",new ft(t,e,this)),this.onPreDraw(t,e)}onPreDraw(t,e){}_postdraw(t,e){this.emit("postdraw",new mt(t,e,this)),this.onPostDraw(t,e)}onPostDraw(t,e){}showDebug(t){this._isDebug=t}toggleDebug(){return this._isDebug=!this._isDebug,this._isDebug}start(t){if(!this._compatible)return Promise.reject("Excalibur is incompatible with your browser");let e;return this.screen.pushResolutionAndViewport(),this.screen.resolution=this.screen.viewport,this.screen.applyResolutionAndViewport(),this.graphicsContext.updateViewport(),t?(this._loader=t,this._loader.suppressPlayButton=this._suppressPlayButton||this._loader.suppressPlayButton,this._loader.wireEngine(this),e=this.load(this._loader)):e=Promise.resolve(),e.then((()=>{this.screen.popResolutionAndViewport(),this.screen.applyResolutionAndViewport(),this.graphicsContext.updateViewport(),this.emit("start",new gt(this))})),this._hasStarted||(this._hasStarted=!0,this._logger.debug("Starting game..."),this.browser.resume(),Lr.createMainLoop(this,window.requestAnimationFrame,Date.now)(),this._logger.debug("Game started")),e}static createMainLoop(t,e,i){let s=i();return function r(){if(t._hasStarted)try{t._requestId=e(r),t.emit("preframe",new xt(t,t.stats.prevFrame));const n=i();let o=Math.floor(n-s)||1;o>200&&(o=1);const a=o*t.timescale,h=t.stats.prevFrame.id+1;t.stats.currFrame.reset(),t.stats.currFrame.id=h,t.stats.currFrame.delta=a,t.stats.currFrame.fps=1/(a/1e3);const l=i();t._update(a);const c=i();t._draw(a);const d=i();t.stats.currFrame.duration.update=c-l,t.stats.currFrame.duration.draw=d-c,s=n,t.emit("postframe",new At(t,t.stats.currFrame)),t.stats.prevFrame.reset(t.stats.currFrame)}catch(e){window.cancelAnimationFrame(t._requestId),t.stop(),t.onFatalException(e)}}}stop(){this._hasStarted&&(this.emit("stop",new _t(this)),this.browser.pause(),this._hasStarted=!1,this._logger.debug("Game stopped"))}isPaused(){return!this._hasStarted}screenshot(){const t=new Image,e=this.canvas.toDataURL("image/png");return t.src=e,t}load(t){return new Promise((e=>{this._isLoading=!0,t.load().then((()=>{this._suppressPlayButton?setTimeout((()=>{this._isLoading=!1,e()}),500):(this._isLoading=!1,e())}))}))}}Lr._DEFAULT_ENGINE_OPTIONS={width:0,height:0,enableCanvasTransparency:!0,canvasElementId:"",canvasElement:void 0,snapToPixel:!1,pointerScope:Os.Document,suppressConsoleBootMessage:null,suppressMinimumBrowserFeatureDetection:null,suppressHiDPIScaling:null,suppressPlayButton:null,scrollPreventionMode:Or.Canvas,backgroundColor:at.fromHex("#2185d0")},Ir([V({message:"Will be removed in excalibur v0.26.0",alternateMethod:"Use Actor.graphics"})],Lr.prototype,"playAnimation",null);let zr=class{constructor(t,e,i){this.animation=t,this.x=e,this.y=i}};zr=Ir([V({message:"Will be removed in excalibur v0.26.0"})],zr);class Ur extends ct{constructor(t,e="MediaEvent"){super(),this.target=t,this._name=e}set bubbles(t){}get bubbles(){return!1}get _path(){return null}set _path(t){}stopPropagation(){}action(){}propagate(){}layPath(t){}}class Wr extends Ur{constructor(t,e){super(t,"NativeSoundEvent"),this.track=e}}class Hr extends Ur{constructor(t,e){super(t,"NativeSoundProcessedEvent"),this._processedData=e,this.data=this._processedData}}var Nr,jr,Gr,Vr,Xr,Kr;(Kr=Nr||(Nr={})).Em="em",Kr.Rem="rem",Kr.Px="px",Kr.Pt="pt",Kr.Percent="%",function(t){t.Left="left",t.Right="right",t.Center="center",t.Start="start",t.End="end"}(jr||(jr={})),function(t){t.Top="top",t.Hanging="hanging",t.Middle="middle",t.Alphabetic="alphabetic",t.Ideographic="ideographic",t.Bottom="bottom"}(Gr||(Gr={})),function(t){t.Normal="normal",t.Italic="italic",t.Oblique="oblique"}(Vr||(Vr={})),function(t){t.LeftToRight="ltr",t.RightToLeft="rtl"}(Xr||(Xr={}));class qr extends Bi{constructor(t={}){var e,i,s,r,n,o,a,h,l,c,d,u;super(t),this.quality=2,this.family="sans-serif",this.style=Vr.Normal,this.bold=!1,this.unit=Nr.Px,this.textAlign=jr.Left,this.baseAlign=Gr.Alphabetic,this.direction=Xr.LeftToRight,this.size=10,this.shadow=null,this._textBounds=new Zt,this._textWidth=0,this._textHeight=0,this.family=null!==(e=null==t?void 0:t.family)&&void 0!==e?e:this.family,this.style=null!==(i=null==t?void 0:t.style)&&void 0!==i?i:this.style,this.bold=null!==(s=null==t?void 0:t.bold)&&void 0!==s?s:this.bold,this.size=null!==(r=null==t?void 0:t.size)&&void 0!==r?r:this.size,this.unit=null!==(n=null==t?void 0:t.unit)&&void 0!==n?n:this.unit,this.textAlign=null!==(o=null==t?void 0:t.textAlign)&&void 0!==o?o:this.textAlign,this.baseAlign=null!==(a=null==t?void 0:t.baseAlign)&&void 0!==a?a:this.baseAlign,this.direction=null!==(h=null==t?void 0:t.direction)&&void 0!==h?h:this.direction,this.quality=null!==(l=null==t?void 0:t.quality)&&void 0!==l?l:this.quality,(null==t?void 0:t.shadow)&&(this.shadow={},this.shadow.blur=null!==(c=t.shadow.blur)&&void 0!==c?c:this.shadow.blur,this.shadow.offset=null!==(d=t.shadow.offset)&&void 0!==d?d:this.shadow.offset,this.shadow.color=null!==(u=t.shadow.color)&&void 0!==u?u:this.shadow.color),this.flagDirty()}clone(){return new qr(Object.assign(Object.assign(Object.assign({},this.cloneGraphicOptions()),this.cloneRasterOptions()),{size:this.size,unit:this.unit,family:this.family,style:this.style,bold:this.bold,textAlign:this.textAlign,baseAlign:this.baseAlign,direction:this.direction,shadow:this.shadow?{blur:this.shadow.blur,offset:this.shadow.offset,color:this.shadow.color}:null}))}get fontString(){return`${this.style} ${this.bold?"bold":""} ${this.size}${this.unit} ${this.family}`}get width(){return this._textWidth}set width(t){this._textWidth=t}get height(){return this._textHeight}set height(t){this._textHeight=t}get _rasterWidth(){return this._bitmap.width}get _rasterHeight(){return this._bitmap.height}get _halfRasterWidth(){return Math.floor(this._bitmap.width/2)}get _halfRasterHeight(){return Math.floor(this._bitmap.height/2)}get localBounds(){return this._textBounds}_drawImage(t,e,i){this.dirty&&this.rasterize(),t.drawImage(this._bitmap,0,0,this._rasterWidth,this._rasterHeight,e-this._rasterWidth/this.quality/2,i-this._rasterHeight/this.quality/2,this._rasterWidth/this.quality,this._rasterHeight/this.quality)}_rotate(t){var e;const i=null!==(e=this.origin)&&void 0!==e?e:this._textBounds.center;t.translate(i.x,i.y),t.rotate(this.rotation),t.translate(-i.x,-i.y)}_flip(t){this.flipHorizontal&&(t.translate(this._textBounds.width/this.scale.x,0),t.scale(-1,1)),this.flipVertical&&(t.translate(0,-this._textBounds.height/2/this.scale.y),t.scale(1,-1))}updateText(t){this._text!==t&&(this._text=t,this._updateDimensions(),this.flagDirty())}_updateDimensions(){if(this._text){this._applyFont(this._ctx);const t=this._ctx.measureText(this._text);this._textWidth=Math.abs(t.actualBoundingBoxLeft)+Math.abs(t.actualBoundingBoxRight),this._textHeight=Math.abs(t.actualBoundingBoxAscent)+Math.abs(t.actualBoundingBoxDescent),this._bitmap.width=2*(this._textWidth+2*this.padding)*this.quality,this._bitmap.height=2*(this._textHeight+2*this.padding)*this.quality;const e=0,i=0;this._textBounds=new Zt({left:e-Math.abs(t.actualBoundingBoxLeft)-this.padding,top:i-Math.abs(t.actualBoundingBoxAscent)-this.padding,bottom:i+Math.abs(t.actualBoundingBoxDescent)+this.padding,right:e+Math.abs(t.actualBoundingBoxRight)+this.padding})}}_preDraw(t,e,i){this.dirty&&this._updateDimensions(),super._preDraw(t,e,i)}_postDraw(t){this.showDebug&&t.debug.drawRect(-this._halfRasterWidth,-this._halfRasterHeight,this._rasterWidth,this._rasterHeight),t.restore()}_applyFont(t){t.translate(this.padding+this._halfRasterWidth,this.padding+this._halfRasterHeight),t.scale(this.quality,this.quality),t.textAlign=this.textAlign,t.textBaseline=this.baseAlign,t.font=this.fontString,t.direction=this.direction,this.shadow&&(t.shadowColor=this.shadow.color.toString(),t.shadowBlur=this.shadow.blur,t.shadowOffsetX=this.shadow.offset.x,t.shadowOffsetY=this.shadow.offset.y)}execute(t){this._text&&(this._applyRasterProperites(t),this._applyFont(t),this.color&&t.fillText(this._text,0,0),this.strokeColor&&t.strokeText(this._text,0,0),this.showDebug&&(ri(t,at.Red,-this._halfRasterWidth,0,this._halfRasterWidth,0,2),ri(t,at.Red,0,-this._halfRasterHeight,0,this._halfRasterHeight,2)))}render(t,e,i,s){this.updateText(e),this.draw(t,i,s)}}class Yr extends bi{constructor(t){var e,i;super(t),this._text="",this.font=null!==(e=t.font)&&void 0!==e?e:new qr,this.color=null!==(i=t.color)&&void 0!==i?i:this.color,this.text=t.text}clone(){return new Yr({text:this.text.slice(),color:this.color.clone(),font:this.font.clone()})}get text(){return this._text}set text(t){this._text=t,this.font.updateText(t)}get color(){return this.font instanceof qr?this.font.color:at.Black}set color(t){this.font instanceof qr&&(this.font.color=t)}get font(){return this._font}set font(t){this._font=t instanceof qr?Di(t,(t=>t.flagDirty())):t}get width(){return this.font.width}get height(){return this.font.height}get localBounds(){return this.font.localBounds}_rotate(t){}_flip(t){}_drawImage(t,e,i){this.font instanceof qr&&(this.font.color=this.color),this.font.flipHorizontal=this.flipHorizontal,this.font.flipVertical=this.flipVertical,this.font.scale=this.scale,this.font.rotation=this.rotation,this.font.origin=this.origin,this.font.opacity=this.opacity,this.font.render(t,this._text,e,i)}}class Zr extends bi{constructor(t){super(t),this._text="",this._dirty=!0,this.alphabet="",this.shadow=null,this.caseInsensitive=!1,this.spacing=0,this._logger=m.getInstance(),this._sprites=[];const{alphabet:e,spriteSheet:i,caseInsensitive:s,spacing:r,shadow:n}=t;this.alphabet=e,this.spriteSheet=i,this.caseInsensitive=null!=s?s:this.caseInsensitive,this.spacing=null!=r?r:this.spacing,this.shadow=null!=n?n:this.shadow,this.spriteSheet.sprites[0].image.ready.then((()=>{this._updateDimensions()}))}static fromLegacySpriteFont(t){const e=t.sprites.map(Zi.fromLegacySprite);return new Zr({alphabet:t.alphabet,spacing:0,caseInsensitive:t.caseInsensitive,spriteSheet:new Qi({sprites:e})})}_getCharacterSprites(t){if(!this._dirty)return this._sprites;const e=[],i=this.caseInsensitive?t.toLocaleLowerCase():t,s=this.caseInsensitive?this.alphabet.toLocaleLowerCase():this.alphabet;for(let t=0;t<i.length;t++){const r=i[t];let n=s.indexOf(r);-1===n&&(n=0,this._logger.warn(`SpriteFont - Cannot find letter '${r}' in configured alphabet '${s}'`));const o=this.spriteSheet.sprites[n];o?e.push(o):this._logger.warn(`SpriteFont - Cannot find sprite for '${r}' at index '${n}' in configured SpriteSheet`)}return this._dirty=!1,this._sprites=e}_updateDimensions(){const t=this._getCharacterSprites(this._text);let e=0,i=0;for(const s of t)e+=s.width+this.spacing,i=Math.max(i,s.height);this.width=e,this.height=i}updateText(t){this._text!==t&&(this._dirty=!0,this._text=t,this._updateDimensions())}_preDraw(t,e,i){this._updateDimensions(),super._preDraw(t,e,i)}_drawImage(t,e,i){let s=0;for(const r of this._getCharacterSprites(this._text))r.draw(t,e+s,i),s+=r.width+this.spacing}render(t,e,i,s){this._text!==e&&(this._dirty=!0,this._text=e),this.shadow&&(t.save(),t.translate(this.shadow.offset.x,this.shadow.offset.y),this.draw(t,i,s),t.restore()),this.draw(t,i,s)}clone(){return new Zr({alphabet:this.alphabet,spriteSheet:this.spriteSheet,spacing:this.spacing})}}var Qr,$r,Jr=function(t,e,i,s){var r,n=arguments.length,o=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(o=(n<3?r(o):n>3?r(e,i,o):r(e,i))||o);return n>3&&o&&Object.defineProperty(e,i,o),o};class tn extends Ii{constructor(t,e,i,s,r){var n,o,a;super(),this.font=new qr,this._text=new Yr({text:"",font:this.font}),this.letterSpacing=0,this.caseInsensitive=!0;let h="",l=X.Zero;t&&"object"==typeof t?(s=t.fontFamily,r=t.spriteFont,h=t.text,l=null!==(n=t.pos)&&void 0!==n?n:Q(null!==(o=t.x)&&void 0!==o?o:0,null!==(a=t.y)&&void 0!==a?a:0)):(h=t,l=Q(null!=e?e:0,null!=i?i:0)),this.addComponent(new $e),this.get($e).pos=l,this.addComponent(new vi(((t,e)=>this.draw(t,e)))),this.addComponent(new Ci);const c=this.get(Ci);c.anchor=X.Zero,c.use(this._text),this.text=h||"",this.color=at.Black,s&&(this.font.family=s),r&&(this.spriteFont=r)}get text(){return this._text.text}set text(t){this._text.text=t}get color(){return this._text.color}set color(t){this._text.color=t}get bold(){return this.font.bold}set bold(t){this.font.bold=t}get fontFamily(){return this.font.family}set fontFamily(t){this.font.family=t}get fontSize(){return this.font.size}set fontSize(t){this.font.size=t}get fontStyle(){return this.font.style}set fontStyle(t){this.font.style=t}get fontUnit(){return this.font.unit}set fontUnit(t){this.font.unit=t}get textAlign(){return this.font.textAlign}set textAlign(t){this.font.textAlign=t}get baseAlign(){return this.font.baseAlign}set baseAlign(t){this.font.baseAlign=t}get spriteFont(){return this._legacySpriteFont}set spriteFont(t){this._legacySpriteFont=t,t&&(this._spriteFont=Zr.fromLegacySpriteFont(t),this._text.font=this._spriteFont)}_initialize(t){super._initialize(t),this._graphicsContext=t.graphicsContext}getTextWidth(){return this._text.width}setTextShadow(t,e,i){this.font.shadow={offset:Q(t,e),blur:2,color:i}}useTextShadow(t){this.spriteFont&&this.spriteFont.useTextShadow(t)}clearTextShadow(){this.font.shadow=null}draw(t,e){const i=this._graphicsContext;this._text.draw(i,0,0)}}Jr([V({message:"Label.bold will be removed in v0.26.0",alternateMethod:"Use Label.font.bold"})],tn.prototype,"bold",null),Jr([V({message:"Label.fontFamily will be removed in v0.26.0",alternateMethod:"Use Label.font.family"})],tn.prototype,"fontFamily",null),Jr([V({message:"Label.fontSize will be removed in v0.26.0",alternateMethod:"Use Label.font.size"})],tn.prototype,"fontSize",null),Jr([V({message:"Label.fontStyle will be removed in v0.26.0",alternateMethod:"Use Lable.font.style"})],tn.prototype,"fontStyle",null),Jr([V({message:"Label.fontUnit will be removed in v0.26.0",alternateMethod:"Use Label.font.unit"})],tn.prototype,"fontUnit",null),Jr([V({message:"Label.textAlign will be removed in v0.26.0",alternateMethod:"Use Label.font.textAlign"})],tn.prototype,"textAlign",null),Jr([V({message:"Label.baseAlign will be removed in v0.26.0",alternateMethod:"Use Label.font.baseAlign"})],tn.prototype,"baseAlign",null),Jr([V()],tn.prototype,"spriteFont",null),Jr([V({message:"Label.setTextShadow will be removed in v0.26.0",alternateMethod:"Use Label.font.shadow"})],tn.prototype,"setTextShadow",null),Jr([V({message:"Label.useTextShadow will be removed in v0.26.0",alternateMethod:"Use Label.font.shadow"})],tn.prototype,"useTextShadow",null),Jr([V({message:"Label.clearTextShadow will be removed in v0.26.0",alternateMethod:"Use Label.font.shadow"})],tn.prototype,"clearTextShadow",null);class en extends(pe(tn)){constructor(t,e,i,s,r){super(t,e,i,s,r)}}($r=Qr||(Qr={}))[$r.Circle=0]="Circle",$r[$r.Rectangle=1]="Rectangle";class sn extends wi{constructor(t,e,i,s,r,n,o,a,h,l){super(),this.position=new X(0,0),this.velocity=new X(0,0),this.acceleration=new X(0,0),this.particleRotationalVelocity=0,this.currentRotation=0,this.focus=null,this.focusAccel=0,this.opacity=1,this.beginColor=at.White,this.endColor=at.White,this.life=300,this.fadeFlag=!1,this._rRate=1,this._gRate=1,this._bRate=1,this._aRate=0,this._currentColor=at.White,this.emitter=null,this.particleSize=5,this.particleSprite=null,this.sizeRate=0,this.elapsedMultiplier=0,this.visible=!0,this.isOffscreen=!1;let c=t;if(c&&!(t instanceof on)){const d=t;c=d.emitter,e=d.life,i=d.opacity,r=d.endColor,s=d.beginColor,n=d.position,o=d.velocity,a=d.acceleration,h=d.startSize,l=d.endSize}this.emitter=c,this.life=e||this.life,this.opacity=i||this.opacity,this.endColor=r||this.endColor.clone(),this.beginColor=s||this.beginColor.clone(),this._currentColor=this.beginColor.clone(),this.position=(n||this.position).add(this.emitter.pos),this.velocity=o||this.velocity,this.acceleration=a||this.acceleration,this._rRate=(this.endColor.r-this.beginColor.r)/this.life,this._gRate=(this.endColor.g-this.beginColor.g)/this.life,this._bRate=(this.endColor.b-this.beginColor.b)/this.life,this._aRate=this.opacity/this.life,this.startSize=h||0,this.endSize=l||0,this.endSize>0&&this.startSize>0&&(this.sizeRate=(this.endSize-this.startSize)/this.life,this.particleSize=this.startSize),this.addComponent(this.transform=new $e),this.addComponent(new vi((t=>this.draw(t)))),this.addComponent(this.graphics=new Ci),this.transform.pos=this.position,this.transform.rotation=this.currentRotation,this.transform.scale=Q(1,1),this.particleSprite?(this.graphics.opacity=this.opacity,this.graphics.use(Zi.fromLegacySprite(this.particleSprite))):this.graphics.onPostDraw=t=>{t.save(),this.graphics.opacity=this.opacity;const e=this._currentColor.clone();e.a=1,t.debug.drawPoint(Q(0,0),{color:e,size:this.particleSize}),t.restore()}}kill(){this.emitter.removeParticle(this)}update(t,e){if(this.life=this.life-e,this.elapsedMultiplier=this.elapsedMultiplier+e,this.life<0&&this.kill(),this.fadeFlag&&(this.opacity=P(this._aRate*this.life,1e-4,1)),this.startSize>0&&this.endSize>0&&(this.particleSize=P(this.sizeRate*e+this.particleSize,Math.min(this.startSize,this.endSize),Math.max(this.startSize,this.endSize))),this._currentColor.r=P(this._currentColor.r+this._rRate*e,0,255),this._currentColor.g=P(this._currentColor.g+this._gRate*e,0,255),this._currentColor.b=P(this._currentColor.b+this._bRate*e,0,255),this._currentColor.a=P(this.opacity,1e-4,1),this.focus){const t=this.focus.sub(this.position).normalize().scale(this.focusAccel).scale(e/1e3);this.velocity=this.velocity.add(t)}else this.velocity=this.velocity.add(this.acceleration.scale(e/1e3));this.position=this.position.add(this.velocity.scale(e/1e3)),this.particleRotationalVelocity&&(this.currentRotation=(this.currentRotation+this.particleRotationalVelocity*e/1e3)%(2*Math.PI)),this.transform.pos=this.position,this.transform.rotation=this.currentRotation,this.transform.scale=Q(1,1),this.graphics.opacity=this.opacity}draw(t){if(this.particleSprite)return this.particleSprite.opacity(this.opacity),void this.particleSprite.draw(t,0,0);t.save(),this._currentColor.a=P(this.opacity,1e-4,1),t.fillStyle=this._currentColor.toString(),t.beginPath(),t.arc(0,0,this.particleSize,0,2*Math.PI),t.fill(),t.closePath(),t.restore()}}class rn extends(pe(sn)){constructor(t,e,i,s,r,n,o,a,h,l){super(t,e,i,s,r,n,o,a,h,l)}}class nn extends Ii{constructor(t,e,i,s){super("number"==typeof t?{pos:new X(t,e),width:i,height:s}:t),this.numParticles=0,this.isEmitting=!0,this.particles=[],this.deadParticles=[],this.minVel=0,this.maxVel=0,this.acceleration=new X(0,0),this.minAngle=0,this.maxAngle=0,this.emitRate=1,this.particleLife=2e3,this.opacity=1,this.fadeFlag=!1,this.focus=null,this.focusAccel=1,this.startSize=null,this.endSize=null,this.minSize=5,this.maxSize=5,this.beginColor=at.White,this.endColor=at.White,this._og=null,this._sprite=null,this.emitterType=Qr.Rectangle,this.radius=0,this.particleRotationalVelocity=0,this.randomRotation=!1,this._particlesToEmit=0,this.body.collider.type=it.PreventCollision,this.random=new v,this.removeComponent("canvas");for(let t=0;t<this.traits.length;t++)this.traits[t]instanceof ii&&this.traits.splice(t,1)}get particleSprite(){return this._og}set particleSprite(t){this._og=t,t&&(this._sprite=Zi.fromLegacySprite(t))}removeParticle(t){this.deadParticles.push(t)}emitParticles(t){var e;for(let i=0;i<t;i++){const t=this._createParticle();this.particles.push(t),(null===(e=null==this?void 0:this.scene)||void 0===e?void 0:e.world)&&this.scene.world.add(t)}}clearParticles(){this.particles.length=0}_createParticle(){let t=0,e=0;const i=C(this.minAngle,this.maxAngle,this.random),s=C(this.minVel,this.maxVel,this.random),r=this.startSize||C(this.minSize,this.maxSize,this.random),n=s*Math.cos(i),o=s*Math.sin(i);if(this.emitterType===Qr.Rectangle)t=C(0,this.width,this.random),e=C(0,this.height,this.random);else if(this.emitterType===Qr.Circle){const s=C(0,this.radius,this.random);t=s*Math.cos(i),e=s*Math.sin(i)}const a=new rn(this,this.particleLife,this.opacity,this.beginColor,this.endColor,new X(t,e),new X(n,o),this.acceleration,this.startSize,this.endSize);return a.fadeFlag=this.fadeFlag,a.particleSize=r,this.particleSprite&&(a.particleSprite=this.particleSprite,a.graphics.opacity=this.opacity,a.graphics.use(this._sprite)),a.particleRotationalVelocity=this.particleRotationalVelocity,this.randomRotation&&(a.currentRotation=C(0,2*Math.PI,this.random)),this.focus&&(a.focus=this.focus.add(new X(this.pos.x,this.pos.y)),a.focusAccel=this.focusAccel),a}update(t,e){var i;super.update(t,e),this.isEmitting&&(this._particlesToEmit+=this.emitRate*(e/1e3),this._particlesToEmit>1&&(this.emitParticles(Math.floor(this._particlesToEmit)),this._particlesToEmit=this._particlesToEmit-Math.floor(this._particlesToEmit)));for(let t=0;t<this.deadParticles.length;t++)k(this.deadParticles[t],this.particles),(null===(i=null==this?void 0:this.scene)||void 0===i?void 0:i.world)&&this.scene.world.remove(this.deadParticles[t]);this.deadParticles.length=0}draw(t){this.particles.forEach((e=>e.draw(t)))}debugDraw(t){super.debugDraw(t),t.fillStyle=at.Black.toString(),t.fillText("Particles: "+this.particles.length,this.pos.x,this.pos.y+20),this.focus&&(t.fillRect(this.focus.x+this.pos.x,this.focus.y+this.pos.y,3,3),ri(t,at.Yellow,this.focus.x+this.pos.x,this.focus.y+this.pos.y,this.center.x,this.center.y),t.fillText("Focus",this.focus.x+this.pos.x,this.focus.y+this.pos.y))}}class on extends(pe(nn)){constructor(t,e,i,s){super(t,e,i,s)}}class an{static create(t,e){if(this._CURRENT_GROUP>this._MAX_GROUPS)throw new Error(`Cannot have more than ${this._MAX_GROUPS} collision groups`);if(this._GROUPS.get(t))throw new Error(`Collision group ${t} already exists`);const i=new li(t,this._CURRENT_BIT,void 0!==e?e:~this._CURRENT_BIT);return this._CURRENT_BIT=this._CURRENT_BIT<<1|0,this._CURRENT_GROUP++,this._GROUPS.set(t,i),i}static get groups(){return Array.from(this._GROUPS.values())}static groupByName(t){return this._GROUPS.get(t)}static reset(){this._GROUPS=new Map,this._CURRENT_BIT=this._STARTING_BIT,this._CURRENT_GROUP=1}}an._STARTING_BIT=1,an._MAX_GROUPS=32,an._CURRENT_GROUP=1,an._CURRENT_BIT=an._STARTING_BIT,an._GROUPS=new Map;let hn=class{constructor(t){this.lineWidth=5,this.filled=!1,this._points=[],this.anchor=X.Zero,this.offset=X.Zero,this.rotation=0,this.scale=X.One,this.opacity=1,this._points=t;const e=this._points.reduce(((t,e)=>Math.min(t,e.x)),0),i=this._points.reduce(((t,e)=>Math.max(t,e.x)),0);this.drawWidth=i-e;const s=this._points.reduce(((t,e)=>Math.min(t,e.y)),0),r=this._points.reduce(((t,e)=>Math.max(t,e.y)),0);this.drawHeight=r-s,this.height=this.drawHeight,this.width=this.drawWidth}addEffect(){}removeEffect(){}clearEffects(){}reset(){}draw(t,e,i){t instanceof CanvasRenderingContext2D?this._drawWithOptions({ctx:t,x:e,y:i}):this._drawWithOptions(t)}_drawWithOptions(t){var e,i,s,r,n,o,a,h;const{ctx:l,x:c,y:d,rotation:u,drawWidth:p,drawHeight:g,anchor:_,offset:f,opacity:m,flipHorizontal:y,flipVertical:w}=Object.assign(Object.assign({},t),{rotation:null!==(e=t.rotation)&&void 0!==e?e:this.rotation,drawWidth:null!==(i=t.drawWidth)&&void 0!==i?i:this.drawWidth,drawHeight:null!==(s=t.drawHeight)&&void 0!==s?s:this.drawHeight,flipHorizontal:null!==(r=t.flipHorizontal)&&void 0!==r?r:this.flipHorizontal,flipVertical:null!==(n=t.flipVertical)&&void 0!==n?n:this.flipVertical,anchor:null!==(o=t.anchor)&&void 0!==o?o:this.anchor,offset:null!==(a=t.offset)&&void 0!==a?a:this.offset,opacity:null!==(h=t.opacity)&&void 0!==h?h:this.opacity}),v=p*_.x+f.x+c,b=g*_.y+f.y+d;l.save(),l.translate(v,b),l.scale(this.scale.x,this.scale.y),l.rotate(u),l.beginPath(),l.lineWidth=this.lineWidth;const x=this._points[0];l.moveTo(x.x,x.y);let A=0;const S=this._points.length;for(;A<S;A++)l.lineTo(this._points[A].x,this._points[A].y);l.lineTo(x.x,x.y),l.closePath(),this.filled&&(l.fillStyle=this.fillColor.toString(),l.fill()),l.strokeStyle=this.lineColor.toString(),y&&(l.translate(p,0),l.scale(-1,1)),w&&(l.translate(0,g),l.scale(1,-1));const P=l.globalAlpha;l.globalAlpha=null!=m?m:1,l.stroke(),l.globalAlpha=P,l.restore()}};hn=function(t,e,i,s){var r,n=arguments.length,o=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(o=(n<3?r(o):n>3?r(e,i,o):r(e,i))||o);return n>3&&o&&Object.defineProperty(e,i,o),o}([V({message:"Polygon will be removed in v0.26.0",alternateMethod:"Use Graphics.Polygon"})],hn);class ln{constructor(t,e,i,s,r,n){this._sprites=[],this._image=null,this._columns=0,this._rows=0,this._spWidth=0,this._spHeight=0,this._spacing=0;let o=!1;if(t instanceof Array?this._sprites=t:(!t||t instanceof fe?(this._image=t,this._columns=e,this._rows=i,this._spWidth=s,this._spHeight=r,this._spacing=n||0):(this._columns=t.columns,this._rows=t.rows,this._spWidth=t.spWidth,this._spHeight=t.spHeight,this._image=t.image,this._spacing=t.spacing||0),this._sprites=new Array(this._columns*this._rows),o=!0),this.image instanceof fe){let t=!1,e=!1;if(this.image.isLoaded()){if(t=this.spWidth*this.columns>this.image.image.naturalWidth,e=this.spHeight*this.rows>this.image.image.naturalHeight,t)throw new RangeError(`SpriteSheet specified is wider, ${this.columns} cols x ${this.spWidth} pixels > ${this.image.image.naturalWidth} pixels than image width`);if(e)throw new RangeError(`SpriteSheet specified is taller, ${this.rows} rows x ${this.spHeight} pixels > ${this.image.image.naturalHeight} pixels than image height`)}}if(o){const t=this.getSpacingDimensions();for(let e=0;e<this.rows;e++)for(let i=0;i<this.columns;i++)this._sprites[i+e*this.columns]=new _e(this.image,i*this.spWidth+t.margin*i+t.left,e*this.spHeight+t.margin*e+t.top,this.spWidth,this.spHeight)}}get spacing(){return this._spacing}get sprites(){return[...this._sprites]}get image(){return this._image}get columns(){return this._columns}get rows(){return this._rows}get spWidth(){return this._spWidth}get spHeight(){return this._spHeight}getSpacingDimensions(){var t,e,i;return"number"==typeof this.spacing?{left:this.spacing,top:this.spacing,margin:this.spacing}:{left:null!==(t=this.spacing.left)&&void 0!==t?t:0,top:null!==(e=this.spacing.top)&&void 0!==e?e:0,margin:null!==(i=this.spacing.margin)&&void 0!==i?i:0}}getAnimationByIndices(t,e,i){let s=e.map((t=>this.sprites[t]));return s=s.map((function(t){return t.clone()})),new ye(t,s,i)}getAnimationBetween(t,e,i,s){let r=this.sprites.slice(e,i);return r=r.map((function(t){return t.clone()})),new ye(t,r,s)}getAnimationForAll(t,e){const i=this.sprites.map((function(t){return t.clone()}));return new ye(t,i,e)}getSprite(t){if(t>=0&&t<this.sprites.length)return this.sprites[t];throw new Error("Invalid index: "+t)}getAnimationByCoords(t,e,i){let s=0,r=0;const n=new Array(e.length);for(let t=0;t<e.length;t++){const i=e[t];i.image=i.image||this.image,s=Math.max(s,i.drawWidth),r=Math.max(r,i.drawHeight),n[t]=new _e(i)}const o=new ye(t,n,i);return o.drawWidth=s,o.drawHeight=r,o}}let cn=class extends ln{constructor(t,e,i,s,r,n,o,a){super(t instanceof fe?{image:t,spWidth:n,spHeight:o,rows:r,columns:s,spacing:a||0}:t),this._currentColor=at.Black,this._currentOpacity=1,this._spriteRecord={},this._textShadowOn=!1,this._textShadowDirty=!0,this._textShadowColor=at.Black,this._textShadowSprites={},this._shadowOffsetX=5,this._shadowOffsetY=5,!t||t instanceof fe||(e=t.alphabet,i=t.caseInsensitive),this.alphabet=e,this.caseInsensitive=i,this._spriteRecord=this.getTextSprites()}getTextSprites(){const t={};for(let e=0;e<this.alphabet.length;e++){let i=this.alphabet[e];this.caseInsensitive&&(i=i.toLowerCase()),t[i]=this.sprites[e].clone()}return t}setTextShadow(t,e,i){this._textShadowOn=!0,this._shadowOffsetX=t,this._shadowOffsetY=e,this._textShadowColor=i.clone(),this._textShadowDirty=!0;for(const t in this._spriteRecord)this._textShadowSprites[t]=this._spriteRecord[t].clone()}useTextShadow(t){this._textShadowOn=t,t&&this.setTextShadow(5,5,this._textShadowColor)}draw(t,e,i,s,r){if(r=this._parseOptions(r),this._currentColor.toString()!==r.color.toString()||this._currentOpacity!==r.opacity){this._currentOpacity=r.opacity,this._currentColor=r.color;for(const t in this._spriteRecord)this._spriteRecord[t].clearEffects(),this._spriteRecord[t].fill(r.color),this._spriteRecord[t].opacity(r.opacity)}if(this._textShadowOn&&this._textShadowDirty&&this._textShadowColor){for(const t in this._textShadowSprites)this._textShadowSprites[t].clearEffects(),this._textShadowSprites[t].addEffect(new ue(this._textShadowColor.clone()));this._textShadowDirty=!1}const n=this.sprites[0],o=n.height,a=r.fontSize/o,h=e.length*n.width*a+e.length*r.letterSpacing;let l=i;r.textAlign===jr.Left||r.textAlign===jr.Start?l=i:r.textAlign===jr.Right||r.textAlign===jr.End?l=i-h:r.textAlign===jr.Center&&(l=i-h/2);let c=s-o*a;r.baseAlign===Gr.Top||r.baseAlign===Gr.Hanging?c=s:r.baseAlign===Gr.Ideographic||r.baseAlign===Gr.Bottom||r.baseAlign===Gr.Alphabetic?c=s-o*a:r.baseAlign===Gr.Middle&&(c=s-o*a/2);for(let i=0;i<e.length;i++){let s=e[i];this.caseInsensitive&&(s=s.toLowerCase());try{this._textShadowOn&&(this._textShadowSprites[s].drawAroundAnchor=!1,this._textShadowSprites[s].scale=Q(a,a),this._textShadowSprites[s].draw(t,l+this._shadowOffsetX,c+this._shadowOffsetY));const e=this._spriteRecord[s];e.drawAroundAnchor=!1,e.scale=Q(a,a),e.draw(t,l,c),l+=e.drawWidth+r.letterSpacing}catch(t){m.getInstance().error("SpriteFont Error drawing char "+s)}}}_parseOptions(t){return{fontSize:t.fontSize||10,letterSpacing:t.letterSpacing||0,color:t.color||at.Black,textAlign:(t.textAlign,t.textAlign),baseAlign:(t.baseAlign,t.baseAlign),maxWidth:t.maxWidth||-1,opacity:t.opacity||0}}};cn=function(t,e,i,s){var r,n=arguments.length,o=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(o=(n<3?r(o):n>3?r(e,i,o):r(e,i))||o);return n>3&&o&&Object.defineProperty(e,i,o),o}([V({message:"SpriteSheet will be removed in v0.26.0",alternateMethod:"Use Graphics.SpriteSheet"})],cn);class dn{}function un(t){return!!t._initialize}function pn(t){return!!t.onInitialize}function gn(t){return!!t._preupdate}function _n(t){return!!t.onPreUpdate}function fn(t){return!!t.onPostUpdate}function mn(t){return!!t.onPostUpdate}function yn(t){return!!t.onPreDraw}function wn(t){return!!t.onPostDraw}function vn(t,e,i){return e+t*(i-e)}function bn(t){return t*t*t*(t*(6*t-15)+10)}dn.type={any:"",blob:"blob",json:"json",text:"text",document:"document",arraybuffer:"arraybuffer"};class xn{constructor(t){this._perm=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],this._p=new Uint8Array(512),this._defaultPerlinOptions={octaves:1,frequency:1,amplitude:1,persistance:.5},t=x({},this._defaultPerlinOptions,t),this.persistance=t.persistance,this.amplitude=t.amplitude,this.frequency=t.frequency,this.octaves=t.octaves,t.seed?this._random=new v(t.seed):this._random=new v,this._perm=this._random.shuffle(this._perm);for(let t=0;t<512;t++)this._p[t]=255&this._perm[t%256]}noise(){let t=this.amplitude,e=this.frequency,i=0,s=0;for(let r=0;r<this.octaves;r++){switch(arguments.length){case 1:i+=this._noise1d(arguments[0]*e)*t;break;case 2:i+=this._noise2d(arguments[0]*e,arguments[1]*e)*t;break;case 3:i+=this._noise3d(arguments[0]*e,arguments[1]*e,arguments[2]*e)*t;break;default:throw new Error("Invalid arguments for perlin noise")}s+=t,t*=this.persistance,e*=2}return i/s}sequence(t,e){e||(e=1/t);const i=new Array(t);for(let s=0;s<t;s++)i[s]=this.noise(s*e);return i}grid(t,e,i){i||(i=1/Math.min(t,e));const s=new Array(t*e);for(let r=0;r<e;r++)for(let e=0;e<t;e++)s[e+r*t]=this.noise(e*i,r*i);return s}_gradient3d(t,e,i,s){const r=15&t,n=r<8?e:i,o=r<4?i:12===r||14===r?e:s;return(0==(1&r)?n:-n)+(0==(2&r)?o:-o)}_gradient2d(t,e,i){const s=0==(1&t)?e:i;return 0==(2&t)?-s:s}_gradient1d(t,e){return 0==(1&t)?-e:e}_noise1d(t){const e=255&Math.floor(t);return(vn(bn(t-=Math.floor(t)),this._gradient1d(this._p[e],t),this._gradient1d(this._p[e+1],t-1))+1)/2}_noise2d(t,e){const i=255&Math.floor(t),s=255&Math.floor(e);t-=Math.floor(t),e-=Math.floor(e);const r=bn(t),n=bn(e),o=this._p[i]+s,a=this._p[i+1]+s;return(vn(n,vn(r,this._gradient2d(this._p[o],t,e),this._gradient2d(this._p[a],t-1,e)),vn(r,this._gradient2d(this._p[o+1],t,e-1),this._gradient2d(this._p[a+1],t-1,e-1)))+1)/2}_noise3d(t,e,i){const s=255&Math.floor(t),r=255&Math.floor(e),n=255&Math.floor(i);t-=Math.floor(t),e-=Math.floor(e),i-=Math.floor(i);const o=bn(t),a=bn(e),h=bn(i),l=this._p[s]+r,c=this._p[s+1]+r,d=this._p[l]+n,u=this._p[c]+n,p=this._p[l+1]+n,g=this._p[c+1]+n;return(vn(h,vn(a,vn(o,this._gradient3d(this._p[d],t,e,i),this._gradient3d(this._p[u],t-1,e,i)),vn(o,this._gradient3d(this._p[p],t,e-1,i),this._gradient3d(this._p[g],t-1,e-1,i))),vn(a,vn(o,this._gradient3d(this._p[d+1],t,e,i-1),this._gradient3d(this._p[u+1],t-1,e,i-1)),vn(o,this._gradient3d(this._p[p+1],t,e-1,i-1),this._gradient3d(this._p[g+1],t-1,e-1,i-1))))+1)/2}}class An{constructor(t,e){this.generator=t,this.colorFcn=e,e||(this.colorFcn=t=>t<125?at.Black:at.White)}image(t,e){const i=document.createElement("img"),s=document.createElement("canvas");s.width=t,s.height=e;const r=s.getContext("2d");return this.draw(r,0,0,t,e),i.src=s.toDataURL(),i}draw(t,e,i,s,r){const n=this.generator.grid(s,r),o=t.getImageData(e,i,s,r);for(let t=0;t<r;t++)for(let e=0;e<s;e++){const i=n[e+s*t],r=255&Math.floor(255*i),a=4*(e+t*o.width),h=this.colorFcn(r);o.data[a]=h.r,o.data[a+1]=h.g,o.data[a+2]=h.b,o.data[a+3]=Math.floor(255*h.a)}t.putImageData(o,e,i)}}class Sn{constructor(t){this._src=t,this._volume=1,this._duration=void 0,this._loop=!1,this._isPlaying=!1,this._isPaused=!1,this._audioContext=Li.create(),this._volumeNode=this._audioContext.createGain(),this._currentOffset=0,this._createNewBufferSource()}set loop(t){this._loop=t,this._instance&&(this._instance.loop=t,this._wireUpOnEnded())}get loop(){return this._loop}set volume(t){t=P(t,0,1),this._volume=t,this._isPlaying&&this._volumeNode.gain.setTargetAtTime?this._volumeNode.gain.setTargetAtTime(t,this._audioContext.currentTime,.1):this._volumeNode.gain.value=t}get volume(){return this._volume}set duration(t){this._duration=t}get duration(){return this._duration}get _playbackRate(){return this._instance?1/(this._instance.playbackRate.value||1):null}isPlaying(){return this._isPlaying}play(t=(()=>{})){return this._isPaused&&(this._resumePlayBack(),t()),this._isPlaying||(this._startPlayBack(),t()),this._playingPromise}pause(){this._isPlaying&&(this._isPaused=!0,this._isPlaying=!1,this._instance.stop(0),this._setPauseOffset())}stop(){this._isPlaying&&(this._isPlaying=!1,this._isPaused=!1,this._currentOffset=0,this._instance.stop(0),this._instance.onended||this._handleOnEnded())}_startPlayBack(){this._isPlaying=!0,this._isPaused=!1,this._playingPromise=new Promise((t=>{this._playingResolve=t})),this._instance||this._createNewBufferSource(),this._rememberStartTime(),this._volumeNode.connect(this._audioContext.destination),this._instance.start(0,0),this._currentOffset=0,this._wireUpOnEnded()}_resumePlayBack(){if(!this._isPaused)return;this._isPaused=!1,this._isPlaying=!0,this._instance.onended=null,this._createNewBufferSource();const t=this._playbackRate*this._src.duration,e=this._currentOffset%t;this._rememberStartTime(-1e3*e),this._instance.start(0,e),this._wireUpOnEnded()}_wireUpOnEnded(){this.loop||(this._instance.onended=()=>this._handleOnEnded())}_handleOnEnded(){this._isPaused||(this._isPlaying=!1,this._playingResolve(!0))}_rememberStartTime(t){this._startTime=(new Date).getTime()+(0|t)}_setPauseOffset(){this._currentOffset=((new Date).getTime()-this._startTime)*this._playbackRate/1e3}_createNewBufferSource(){this._instance=this._audioContext.createBufferSource(),this._instance.buffer=this._src,this._instance.loop=this.loop,this._instance.playbackRate.setValueAtTime(1,0),this._instance.connect(this._volumeNode)}}function Pn(t){try{const e=new Audio,i=/.*\.([A-Za-z0-9]+)$/,s=t.match(i)[1];return!!e.canPlayType("audio/"+s)}catch(t){return m.getInstance().warn("Cannot determine audio support, assuming no support for the Audio Tag",t),!1}}var Cn=function(t,e,i,s){return new(i||(i=Promise))((function(r,n){function o(t){try{h(s.next(t))}catch(t){n(t)}}function a(t){try{h(s.throw(t))}catch(t){n(t)}}function h(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((s=s.apply(t,e||[])).next())}))};class En extends gi{constructor(...t){super(),this.logger=m.getInstance(),this._loop=!1,this._volume=1,this._duration=void 0,this._isStopped=!1,this._isPaused=!1,this._tracks=[],this._wasPlayingOnHidden=!1,this._audioContext=Li.create(),this._resource=new ie("",dn.type.arraybuffer);for(const e of t)if(Pn(e)){this.path=e;break}this.path||(this.logger.warn("This browser does not support any of the audio files specified:",t.join(", ")),this.logger.warn("Attempting to use",t[0]),this.path=t[0])}set loop(t){this._loop=t;for(const t of this._tracks)t.loop=this._loop;this.logger.debug("Set loop for all instances of sound",this.path,"to",this._loop)}get loop(){return this._loop}set volume(t){this._volume=t;for(const t of this._tracks)t.volume=this._volume;this.emit("volumechange",new Wr(this)),this.logger.debug("Set loop for all instances of sound",this.path,"to",this._volume)}get volume(){return this._volume}get duration(){return this._duration}get instances(){return this._tracks}get path(){return this._resource.path}set path(t){this._resource.path=t}isLoaded(){return!!this.data}load(){return Cn(this,void 0,void 0,(function*(){if(this.data)return this.data;const t=yield this._resource.load(),e=yield this.decodeAudio(t.slice(0));return this._duration="object"==typeof e?e.duration:void 0,this.emit("processed",new Hr(this,e)),this.data=e}))}decodeAudio(t){return Cn(this,void 0,void 0,(function*(){try{return yield this._audioContext.decodeAudioData(t.slice(0))}catch(t){return this.logger.error("Unable to decode  this browser may not fully support this format, or the file may be corrupt, if this is an mp3 try removing id3 tags and album art from the file."),yield Promise.reject()}}))}wireEngine(t){t&&(this._engine=t,this._engine.on("hidden",(()=>{t.pauseAudioWhenHidden&&this.isPlaying()&&(this._wasPlayingOnHidden=!0,this.pause())})),this._engine.on("visible",(()=>{t.pauseAudioWhenHidden&&this._wasPlayingOnHidden&&(this.play(),this._wasPlayingOnHidden=!1)})),this._engine.on("start",(()=>{this._isStopped=!1})),this._engine.on("stop",(()=>{this.stop(),this._isStopped=!0})))}instanceCount(){return this._tracks.length}isPlaying(){return this._tracks.some((t=>t.isPlaying()))}play(t){return this.isLoaded()?this._isStopped?(this.logger.warn("Cannot start playing. Engine is in a stopped state."),Promise.resolve(!1)):(this.volume=t||this.volume,this._isPaused?this._resumePlayback():this._startPlayback()):(this.logger.warn("Cannot start playing. Resource",this.path,"is not loaded yet"),Promise.resolve(!0))}pause(){if(this.isPlaying()){for(const t of this._tracks)t.pause();this._isPaused=!0,this.emit("pause",new Wr(this)),this.logger.debug("Paused all instances of sound",this.path)}}stop(){for(const t of this._tracks)t.stop();this.emit("stop",new Wr(this)),this._isPaused=!1,this._tracks.length=0,this.logger.debug("Stopped all instances of sound",this.path)}getTrackId(t){return this._tracks.indexOf(t)}_resumePlayback(){return Cn(this,void 0,void 0,(function*(){if(this._isPaused){const t=[];for(const e of this._tracks)t.push(e.play());this._isPaused=!1,this.emit("resume",new Wr(this)),this.logger.debug("Resuming paused instances for sound",this.path,this._tracks),yield Promise.all(t)}return!0}))}_startPlayback(){return Cn(this,void 0,void 0,(function*(){const t=yield this._getTrackInstance(this.data),e=yield t.play((()=>{this.emit("playbackstart",new Wr(this,t)),this.logger.debug("Playing new instance for sound",this.path)}));return this.emit("playbackend",new Wr(this,t)),this._tracks.splice(this.getTrackId(t),1),e}))}_getTrackInstance(t){const e=new Sn(t);return e.loop=this.loop,e.volume=this.volume,e.duration=this.duration,this._tracks.push(e),e}}class Tn{constructor(t,e=at.Magenta,i=!0){this.path=t,this.color=e,this.bustCache=i,this._stream=null,this._gif=null,this._textures=[],this._animation=null,this._transparentColor=null,this._resource=new ie(t,"arraybuffer",i),this._transparentColor=e}load(){return t=this,e=void 0,s=function*(){const t=yield this._resource.load();this._stream=new Bn(t),this._gif=new Mn(this._stream,this._transparentColor);const e=this._gif.images.map((t=>new fe(t.src,!1)));return yield Promise.all(e.map((t=>t.load()))),this.data=this._textures=e},new((i=void 0)||(i=Promise))((function(r,n){function o(t){try{h(s.next(t))}catch(t){n(t)}}function a(t){try{h(s.throw(t))}catch(t){n(t)}}function h(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((s=s.apply(t,e||[])).next())}));var t,e,i,s}isLoaded(){return!!this.data}asSprite(t=0){return this._textures[t].asSprite()}asSpriteSheet(){const t=this._textures.map((t=>t.asSprite()));return new ln(t)}asAnimation(t,e){const i=this.asSpriteSheet();return this._animation=i.getAnimationForAll(t,e),this._animation}get readCheckBytes(){return this._gif.checkBytes}}const Dn=t=>t.reduce((function(t,e){return 2*t+e}),0),Rn=t=>{const e=[];for(let i=7;i>=0;i--)e.push(!!(t&1<<i));return e};class Bn{constructor(t){if(this.data=null,this.len=0,this.position=0,this.readByte=()=>{if(this.position>=this.data.byteLength)throw new Error("Attempted to read past end of stream.");return this.data[this.position++]},this.readBytes=t=>{const e=[];for(let i=0;i<t;i++)e.push(this.readByte());return e},this.read=t=>{let e="";for(let i=0;i<t;i++)e+=String.fromCharCode(this.readByte());return e},this.readUnsigned=()=>{const t=this.readBytes(2);return(t[1]<<8)+t[0]},this.data=new Uint8Array(t),this.len=this.data.byteLength,0===this.len)throw new Error("No data loaded from file")}}class Mn{constructor(t,e=at.Magenta){this._st=null,this._handler={},this._transparentColor=null,this.frames=[],this.images=[],this.globalColorTable=[],this.checkBytes=[],this.parseColorTable=t=>{const e=[];for(let i=0;i<t;i++){const t="#"+this._st.readBytes(3).map((t=>{const e=t.toString(16);return 1===e.length?"0"+e:e})).join("");e.push(t)}return e},this.readSubBlocks=()=>{let t,e;e="";do{t=this._st.readByte(),e+=this._st.read(t)}while(0!==t);return e},this.parseHeader=()=>{const t={sig:null,ver:null,width:null,height:null,colorRes:null,globalColorTableSize:null,gctFlag:null,sorted:null,globalColorTable:[],bgColor:null,pixelAspectRatio:null};if(t.sig=this._st.read(3),t.ver=this._st.read(3),"GIF"!==t.sig)throw new Error("Not a GIF file.");t.width=this._st.readUnsigned(),t.height=this._st.readUnsigned();const e=Rn(this._st.readByte());t.gctFlag=e.shift(),t.colorRes=Dn(e.splice(0,3)),t.sorted=e.shift(),t.globalColorTableSize=Dn(e.splice(0,3)),t.bgColor=this._st.readByte(),t.pixelAspectRatio=this._st.readByte(),t.gctFlag&&(t.globalColorTable=this.parseColorTable(1<<t.globalColorTableSize+1),this.globalColorTable=t.globalColorTable),this._handler.hdr&&this._handler.hdr(t)&&this.checkBytes.push(this._handler.hdr)},this.parseExt=t=>{const e=t=>{this.checkBytes.push(this._st.readByte());const e=Rn(this._st.readByte());t.reserved=e.splice(0,3),t.disposalMethod=Dn(e.splice(0,3)),t.userInput=e.shift(),t.transparencyGiven=e.shift(),t.delayTime=this._st.readUnsigned(),t.transparencyIndex=this._st.readByte(),t.terminator=this._st.readByte(),this._handler.gce&&this._handler.gce(t)&&this.checkBytes.push(this._handler.gce)},i=t=>{t.comment=this.readSubBlocks(),this._handler.com&&this._handler.com(t)&&this.checkBytes.push(this._handler.com)},s=t=>{this.checkBytes.push(this._st.readByte()),t.ptHeader=this._st.readBytes(12),t.ptData=this.readSubBlocks(),this._handler.pte&&this._handler.pte(t)&&this.checkBytes.push(this._handler.pte)},r=t=>{const e=t=>{this.checkBytes.push(this._st.readByte()),t.unknown=this._st.readByte(),t.iterations=this._st.readUnsigned(),t.terminator=this._st.readByte(),this._handler.app&&this._handler.app.NETSCAPE&&this._handler.app.NETSCAPE(t)&&this.checkBytes.push(this._handler.app)},i=t=>{t.appData=this.readSubBlocks(),this._handler.app&&this._handler.app[t.identifier]&&this._handler.app[t.identifier](t)&&this.checkBytes.push(this._handler.app[t.identifier])};switch(this.checkBytes.push(this._st.readByte()),t.identifier=this._st.read(8),t.authCode=this._st.read(3),t.identifier){case"NETSCAPE":e(t);break;default:i(t)}},n=t=>{t.data=this.readSubBlocks(),this._handler.unknown&&this._handler.unknown(t)&&this.checkBytes.push(this._handler.unknown)};switch(t.label=this._st.readByte(),t.label){case 249:t.extType="gce",e(t);break;case 254:t.extType="com",i(t);break;case 1:t.extType="pte",s(t);break;case 255:t.extType="app",r(t);break;default:t.extType="unknown",n(t)}},this.parseImg=t=>{t.leftPos=this._st.readUnsigned(),t.topPos=this._st.readUnsigned(),t.width=this._st.readUnsigned(),t.height=this._st.readUnsigned();const e=Rn(this._st.readByte());t.lctFlag=e.shift(),t.interlaced=e.shift(),t.sorted=e.shift(),t.reserved=e.splice(0,2),t.lctSize=Dn(e.splice(0,3)),t.lctFlag&&(t.lct=this.parseColorTable(1<<t.lctSize+1)),t.lzwMinCodeSize=this._st.readByte();const i=this.readSubBlocks();t.pixels=function(t,e){let i=0;const s=function(t){let s=0;for(let r=0;r<t;r++)e.charCodeAt(i>>3)&1<<(7&i)&&(s|=1<<r),i++;return s},r=[],n=1<<t,o=n+1;let a=t+1,h=[];const l=function(){h=[],a=t+1;for(let t=0;t<n;t++)h[t]=[t];h[n]=[],h[o]=null};let c,d;for(;;)if(d=c,c=s(a),c!==n){if(c===o)break;if(c<h.length)d!==n&&h.push(h[d].concat(h[c][0]));else{if(c!==h.length)throw new Error("Invalid LZW code.");h.push(h[d].concat(h[d][0]))}r.push.apply(r,h[c]),h.length===1<<a&&a<12&&a++}else l();return r}(t.lzwMinCodeSize,i),t.interlaced&&(t.pixels=((t,e)=>{const i=new Array(t.length),s=t.length/e,r=(s,r)=>{const n=t.slice(r*e,(r+1)*e);i.splice.apply(i,[s*e,e].concat(n))},n=[0,4,2,1],o=[8,8,4,2];let a=0;for(let t=0;t<4;t++)for(let e=n[t];e<s;e+=o[t])r(e,a),a++;return i})(t.pixels,t.width)),this.frames.push(t),this.arrayToImage(t),this._handler.img&&this._handler.img(t)&&this.checkBytes.push(this._handler)},this.parseBlock=()=>{const t={sentinel:this._st.readByte(),type:""};switch(String.fromCharCode(t.sentinel)){case"!":t.type="ext",this.parseExt(t);break;case",":t.type="img",this.parseImg(t);break;case";":t.type="eof",this._handler.eof&&this._handler.eof(t)&&this.checkBytes.push(this._handler.eof);break;default:throw new Error("Unknown block: 0x"+t.sentinel.toString(16))}"eof"!==t.type&&this.parseBlock()},this.arrayToImage=t=>{let e=0;const i=document.createElement("canvas");i.id=e.toString(),i.width=t.width,i.height=t.height,e++;const s=i.getContext("2d");let r=0,n=0;for(let e=0;e<t.pixels.length;e++)n%t.width==0&&(r++,n=0),this.globalColorTable[t.pixels[e]]===this._transparentColor.toHex()?s.fillStyle="rgba(0, 0, 0, 0)":s.fillStyle=this.globalColorTable[t.pixels[e]],s.fillRect(n,r,1,1),n++;const o=new Image;o.src=i.toDataURL(),this.images.push(o)},this._st=t,this._handler={},this._transparentColor=e,this.parseHeader(),this.parseBlock()}}class kn extends Bi{constructor(t){super(t),this._radius=0,this.radius=t.radius,this.rasterize()}get radius(){return this._radius}set radius(t){this._radius=t,this.width=2*this._radius,this.height=2*this._radius,this.flagDirty()}clone(){return new kn(Object.assign(Object.assign({radius:this.radius},this.cloneGraphicOptions()),this.cloneRasterOptions()))}execute(t){this.radius>0&&(t.beginPath(),t.arc(this.radius,this.radius,this.radius,0,2*Math.PI),this.color&&t.fill(),this.strokeColor&&t.stroke())}}class On extends Bi{constructor(t){super(t),this.points=t.points,this.rasterize()}get points(){return this._points}set points(t){this._points=t;const e=this.minPoint;this.width=this._points.reduce(((t,e)=>Math.max(e.x,t)),0)-e.x,this.height=this._points.reduce(((t,e)=>Math.max(e.y,t)),0)-e.y,this.flagDirty()}get minPoint(){return Q(this._points.reduce(((t,e)=>Math.min(e.x,t)),1/0),this._points.reduce(((t,e)=>Math.min(e.y,t)),1/0))}clone(){return new On(Object.assign(Object.assign({points:this.points.map((t=>t.clone()))},this.cloneGraphicOptions()),this.cloneRasterOptions()))}execute(t){if(this.points&&this.points.length){t.beginPath();const e=this.minPoint.negate(),i=this.points[0].add(e);t.moveTo(i.x,i.y),this.points.forEach((i=>{t.lineTo(i.x+e.x,i.y+e.y)})),t.lineTo(i.x,i.y),t.closePath(),this.color&&t.fill(),this.strokeColor&&t.stroke()}}}var Fn=function(t,e,i,s){var r,n=arguments.length,o=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(o=(n<3?r(o):n>3?r(e,i,o):r(e,i))||o);return n>3&&o&&Object.defineProperty(e,i,o),o};let In=class{constructor(t){this._getComparable=t}find(t){return this._find(this._root,t)}_find(t,e){return null!=t&&(this._getComparable(e)===t.getKey()?t.getData().indexOf(e)>-1:this._getComparable(e)<t.getKey()?this._find(t.getLeft(),e):this._find(t.getRight(),e))}get(t){return this._get(this._root,t)}_get(t,e){return null==t?[]:e===t.getKey()?t.getData():e<t.getKey()?this._get(t.getLeft(),e):this._get(t.getRight(),e)}add(t){return null==this._root?(this._root=new Ln(this._getComparable(t),[t],null,null),!0):this._insert(this._root,t)}_insert(t,e){return null!=t&&(this._getComparable(e)===t.getKey()?!(t.getData().indexOf(e)>-1||(t.getData().push(e),0)):this._getComparable(e)<t.getKey()?null==t.getLeft()?(t.setLeft(new Ln(this._getComparable(e),[e],null,null)),!0):this._insert(t.getLeft(),e):null==t.getRight()?(t.setRight(new Ln(this._getComparable(e),[e],null,null)),!0):this._insert(t.getRight(),e))}removeByComparable(t){this._root=this._remove(this._root,t)}_remove(t,e){if(null==t)return null;if(this._getComparable(e)!==t.getKey())return this._getComparable(e)<t.getKey()?(t.setLeft(this._remove(t.getLeft(),e)),t):(t.setRight(this._remove(t.getRight(),e)),t);{const i=t.getData().indexOf(e);if(i>-1){if(t.getData().splice(i,1),0===t.getData().length){if(null==t.getLeft()&&null==t.getRight())return null;if(null==t.getLeft())return t.getRight();if(null==t.getRight())return t.getLeft();const e=this._findMinNode(t.getRight());return t.setKey(e.getKey()),t.setData(e.getData()),t.setRight(this._cleanup(t.getRight(),e)),t}return t}}return null}_cleanup(t,e){const i=e.getKey();if(null==t)return null;if(i===t.getKey()){if(null==t.getLeft()&&null==t.getRight())return null;if(null==t.getLeft())return t.getRight();if(null==t.getRight())return t.getLeft();const e=this._findMinNode(t.getRight());return t.setKey(e.getKey()),t.setData(e.getData()),t.setRight(this._cleanup(t.getRight(),e)),t}return e.getKey()<t.getKey()?(t.setLeft(this._cleanup(t.getLeft(),e)),t):(t.setRight(this._cleanup(t.getRight(),e)),t)}_findMinNode(t){let e=t;for(;null!=e.getLeft();)e=e.getLeft();return e}list(){const t=new Array;return this._list(this._root,t),t}_list(t,e){null!=t&&(this._list(t.getLeft(),e),t.getData().forEach((t=>{e.push(t)})),this._list(t.getRight(),e))}};In=Fn([V({message:"Will be removed in excalibur v0.26.0",alternateMethod:"Use built in JS array.sort"})],In);let Ln=class{constructor(t,e,i,s){this._key=t,this._data=e,this._left=i,this._right=s}getKey(){return this._key}setKey(t){this._key=t}getData(){return this._data}setData(t){this._data=t}getLeft(){return this._left}setLeft(t){this._left=t}getRight(){return this._right}setRight(t){this._right=t}};Ln=Fn([V({message:"Will be removed in excalibur v0.26.0"})],Ln);class zn{constructor(t){this._key=0,this._key=t}getTheKey(){return this._key}setKey(t){this._key=t}}var Un,Wn,Hn;(Hn=Wn||(Wn={}))[Hn.Resolved=0]="Resolved",Hn[Hn.Rejected=1]="Rejected",Hn[Hn.Pending=2]="Pending";let Nn=Un=class{constructor(){this._state=Wn.Pending,this._successCallbacks=[],this._rejectCallback=()=>{}}static resolve(t){return(new Un).resolve(t)}static reject(t){return(new Un).reject(t)}static join(){let t=[];if(arguments.length>0&&!Array.isArray(arguments[0]))for(let e=0;e<arguments.length;e++)t[e-0]=arguments[e];else 1===arguments.length&&Array.isArray(arguments[0])&&(t=arguments[0]);const e=new Un;if(!t||!t.length)return e.resolve();const i=t.length;let s=0,r=0;const n=[];return t.forEach((t=>{t.then((()=>{s+=1,s===i?e.resolve():s+r+n.length===i&&e.reject(n)}),(()=>{r+=1,s+r+n.length===i&&e.reject(n)})).error((t=>{n.push(t),n.length+s+r===i&&e.reject(n)}))})),e}then(t,e){if(t&&(this._successCallbacks.push(t),this.state()===Wn.Resolved))try{t.call(this,this._value)}catch(t){this._handleError(t)}if(e&&(this._rejectCallback=e,this.state()===Wn.Rejected))try{e.call(this,this._value)}catch(t){this._handleError(t)}return this}error(t){return t&&(this._errorCallback=t),this}resolve(t){if(this._state!==Wn.Pending)throw new Error("Cannot resolve a promise that is not in a pending state!");this._value=t;try{this._state=Wn.Resolved,this._successCallbacks.forEach((t=>{t.call(this,this._value)}))}catch(t){this._handleError(t)}return this}reject(t){if(this._state!==Wn.Pending)throw new Error("Cannot reject a promise that is not in a pending state!");this._value=t;try{this._state=Wn.Rejected,this._rejectCallback.call(this,this._value)}catch(t){this._handleError(t)}return this}state(){return this._state}_handleError(t){if(!this._errorCallback)throw t;this._errorCallback.call(this,t)}};Nn=Un=function(t,e,i,s){var r,n=arguments.length,o=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(o=(n<3?r(o):n>3?r(e,i,o):r(e,i))||o);return n>3&&o&&Object.defineProperty(e,i,o),o}([V({message:"ex.Promises are being replaced by native browser promises in v0.26.0",alternateMethod:"Use browser native promises"})],Nn);const jn="0.25.0-alpha.115+170937a";_()})(),s})()},"object"==typeof h?h=a():"function"==typeof define&&define.amd?define([],a):"object"==typeof h?h.ex=a():o.ex=a();var l;n.register("31oBo",(function(e,i){var s;t(e.exports,"getBundleURL",(()=>s),(t=>s=t));var r=null;function n(t){return(""+t).replace(/^((?:https?|file|ftp):\/\/.+)\/[^/]+$/,"$1")+"/"}s=function(){return r||(r=function(){try{throw new Error}catch(e){var t=(""+e.stack).match(/(https?|file|ftp):\/\/[^)\n]+/g);if(t)return n(t[0])}return"/"}()),r}})),n.register("3XRD4",(function(t,e){"use strict";var i=n("3OOJ5").resolve;function s(t){if(""===t)return".";var e="/"===t[t.length-1]?t.slice(0,t.length-1):t,i=e.lastIndexOf("/");return-1===i?".":e.slice(0,i)}function r(t,e){if(t===e)return"";var i=t.split("/");"."===i[0]&&i.shift();var s,r,n=e.split("/");for("."===n[0]&&n.shift(),s=0;(s<n.length||s<i.length)&&null==r;s++)i[s]!==n[s]&&(r=s);var o=[];for(s=0;s<i.length-r;s++)o.push("..");return n.length>r&&o.push.apply(o,n.slice(r)),o.join("/")}t.exports=function(t,e){return r(s(i(t)),i(e))},t.exports._dirname=s,t.exports._relative=r})),l=n("31oBo").getBundleURL()+n("3XRD4")("2zX4k","nuBan");let c={Sword:new h.Graphics.ImageSource(e(l))};class d extends h.Actor{constructor(t){super(t)}onInitialize(){const t=new h.Graphics.GraphicsGroup({members:[{graphic:new h.Graphics.Polygon({points:[h.vec(30,0),h.vec(0,60),h.vec(60,60)],color:h.Color.LightGray}),pos:h.vec(0,0)},{graphic:new h.Graphics.Rectangle({height:90,width:60,color:h.Color.LightGray}),pos:h.vec(0,60)}]});t.rotation=1,this.graphics.add(t)}}class u{constructor(){this.state={currentPlanet:null,ship:null}}static getInstance(){return u.instance||(u.instance=new u),u.instance}getState(){return this.state}setState(t){this.state=t}setCurrentPlanet(t){this.state={...this.state,currentPlanet:t}}setShip(t){this.state={...this.state,ship:t}}}class p extends h.Scene{constructor(){super(),this.key="orbitviewscene"}onActivate(t,e){const i=u.getInstance().getState();console.log(i);const s=i.currentPlanet;console.log(s);const r=new _({planet:s,scaleFactor:3,pos:h.vec(2*this.engine.canvasWidth/3,.5*this.engine.canvasHeight)}),n=new d({ship:i.ship,pos:h.vec(1*this.engine.canvasWidth/3,.5*this.engine.canvasWidth)});this.add(r),this.add(n)}}p.getViewKey=()=>"orbitviewscene";class g{}g.TextBlue=h.Color.fromHex("#81C7B8"),g.PlanetBlue=h.Color.fromHex("#B6F6FA");h.GameEvent;class _ extends h.Actor{constructor(t){super(t),this.planet=t.planet,this.scaleFactor=t.scaleFactor,this.color=g.PlanetBlue,this.body.collider.shape=h.Shape.Circle(this.planet.radius)}toString(){return`Planet ${this.planet.name} of type ${this.planet.type}.`}onInitialize(){console.log(this.planet.resources);const t=new h.Graphics.Circle({radius:this.planet.radius*this.scaleFactor,color:this.color});this.graphics.add(t),this.enableCapturePointer=!0,this.on("pointerenter",(()=>{const t=new h.Label({text:this.toString(),pos:h.vec(this.pos.x+30,this.pos.y+30)});t.color=h.Color.Orange,this.labelActor=t,this.scene.engine.currentScene.add(t),this.scene.engine.eventDispatcher.emit("yo",new h.GameEvent)})),this.on("pointerleave",(()=>{this.scene.engine.remove(this.labelActor)})),this.on("pointerup",(()=>{u.getInstance().setCurrentPlanet(this.planet),this.scene.engine.emit("to_scene",new h.GameEvent)}))}}class f extends h.Scene{constructor(){super(),this.key="systemviewscene"}}var m,y,w,v;(y=m||(m={}))[y.IRON=0]="IRON",y[y.GOLD=1]="GOLD";class b{static generateResources(t=2){const e=new h.Random,i=[];for(let s=0;s<t;s++)i.push(new b(m[e.integer(0,t-1)]));return i}constructor(t){this.type=t}}(v=w||(w={}))[v.Big=0]="Big",v[v.Small=1]="Small",v[v.Medium=2]="Medium";class x{constructor(){this.name=(()=>{const t=new h.Random,e=["b","c","d","f","g","h","j","k","l","m","n","p","q","r","s","t","v","w","x","z"],i=["a","e","i","o","u","y"],s=t.integer(4,10);let r="";for(let n=0;n<s;n++)r+=t.bool(.4)?t.pickOne(i):t.pickOne(e);return r})(),this.type=0==(new h.Random).integer(0,2)?w.Big:w.Small,this.radius=(t=>{const e=new h.Random;switch(t){case w.Big:return e.integer(70,100);case w.Medium:return e.integer(40,69);case w.Small:return e.integer(20,39)}})(this.type),this.resources=b.generateResources(),this.visited=!1}}class A{constructor(){this.planets=[];const t=(new h.Random).integer(3,5);for(let e=1;e<t+1;e++){const t=new x;this.planets.push(t)}}getPlanets(){return this.planets}}class S{constructor(){this.resources=[]}}class P extends h.Engine{constructor(){super({displayMode:h.DisplayMode.Fill,backgroundColor:h.Color.Black})}initialize(){const t=u.getInstance(),e=new h.Label({text:"info",pos:new h.Vector(100,10)});e.color=g.TextBlue,this.add(e);const i=new S;t.setShip(i);const s=new A,r=new f;e.text=`This system has ${s.getPlanets().length} planets`,r.add(e);new h.Random;for(const[t,e]of s.getPlanets().entries()){const i=new _({planet:e,scaleFactor:1,pos:new h.Vector(2*this.canvasWidth/3,150*(t+1))});r.add(i)}const n=new d({pos:h.vec(1*this.canvasWidth/3,100),ship:i});r.add(n);const o=new p;this.addScene(r.key,r),this.addScene(o.key,o),this.on("toorbitview",(t=>{console.log("orbit view event",t),console.log(t.target),t.target.goToScene(o.key)}));const a=new h.Loader([c.Sword]);this.start(a).then((()=>{this.goToScene(r.key)}))}}const C=new P;C.on("to_scene",(t=>{console.log("Switching scene",t),C.goToScene(p.getViewKey())})),C.initialize()}();
//# sourceMappingURL=index.866dc970.js.map
